<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="40264" />
<meta name="LOC_US_SRCFILE" content="//depot/ecs/eam/v11gr1/ref/fm/prog.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="08/24/10 04:17:26" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Application-to-Application Programming Examples</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Reference Guide
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="atmi.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next_grey1.gif" border="0" alt="Next" />&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/ref.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1067548"> </a>
Application-to-Application Programming Examples
</h1>
<p class="pBody"><a name="wp1064791"> </a>
This section provides the following transaction scenarios for the programming environments supported by Oracle Tuxedo Mainframe Adapter for SNA:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1020848"> </a><a href="prog.html#wp1028400"><span class="cHyperlink">
Distributed Program Link (DPL) Examples</span></a> </li>
<li><a name="wp1020849"> </a><a href="prog.html#wp1021664"><span class="cHyperlink">
Distributed Transaction Processing (DTP) Examples</span></a> </li>
<li><a name="wp1020850"> </a><a href="prog.html#wp1023094"><span class="cHyperlink">
CPI-C Programming Examples</span></a> </li>
<li><a name="wp1061404"> </a><a href="prog.html#wp1024610"></a><a href="prog.html#wp1024610"><span class="cHyperlink">
CICS/ESA Mirror Transaction Examples</span></a></li>
</ul></div>
<a name="wp1028397"> </a>
<table class="Note">
<tr>
<td valign="top"><strong>Caution:</strong></td>
<td>The scenarios in this section demonstrate how ATMI calls relate to CICS/ESA programming structures. They are not intended for use in developing application code, or for the replacement of existing application code. The use of any of these examples in actual situations may have unpredictable results.</td>
</tr>
</table>
<p class="pBody"><a name="wp1028398"> </a>
Each example provides a graphical illustration of the scenario followed by a description of each step of the scenario.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1028400"> </a>
Distributed Program Link (DPL) Examples
</h2><p class="pBody"><a name="wp1020853"> </a>
The examples in this section represent a few of the many programming scenarios available for using DPL and ATMI service invocations. These examples employ the most natural and efficient approaches.
</p>
<h3 class="pHeading2"><a name="wp1073442"> </a>
ATMI Client Request/Response to CICS/ESA DPL
</h3>
<p class="pGraphic"><a name="wp1073518"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-01.gif" height="444" width="515" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1073445"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1073519"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1073520"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpcall</code> for <code class="cCode">SIMPDPL</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of the DMCONFIG file.</li>
<li><a name="wp1045916"> </a>Host mirror transaction starts <code class="cCode">TOUPDPLS</code> program and passes <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1045917"> </a>The <code class="cCode">TOUPDPLS</code> program processes data.</li>
<li><a name="wp1045918"> </a>The CICS/ESA server returns the <code class="cCode">commarea</code> into the client&#8217;s <code class="cCode">odata</code> buffer.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1045919"> </a>
ATMI Client Asynchronous Request/Response to CICS/ESA DPL
</h3>
<p class="pGraphic"><a name="wp1046006"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-02.gif" height="444" width="515" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1045921"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1046007"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1046008"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpacall</code> for <code class="cCode">SIMPDPL</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file.</li>
<li><a name="wp1046009"> </a>Host mirror transaction starts <code class="cCode">TOUPDPLS</code> program and passes <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1046010"> </a>The <code class="cCode">TOUPDPLS</code> program processes data.</li>
<li><a name="wp1046011"> </a>The CICS/ESA system returns the <code class="cCode">commarea</code> into the client&#8217;s <code class="cCode">tpgetreply odata</code> buffer.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1046012"> </a>
ATMI Client Asynchronous Request/Response with No Reply to CICS/ESA DPL
</h3>
<p class="pGraphic"><a name="wp1046089"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-03.gif" height="444" width="515" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1046014"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1046090"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1046091"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpacall</code> for <code class="cCode">SIMPDPL</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file. The <code class="cCode">toupsrv</code> service uses <code class="cCode">TPNOREPLY</code> to specify that no reply is expected.</li>
<li><a name="wp1046092"> </a>Host mirror transaction starts <code class="cCode">TOUPDPLS</code> program and passes <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1046093"> </a>The <code class="cCode">TOUPDPLS</code> program processes data.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1073345"> </a>
CICS/ESA DPL to ATMI Request/Response Server
</h3>
<p class="pGraphic"><a name="wp1073418"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-04.gif" height="436" width="505" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1073347"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1073419"> </a>User-entered <code class="cCode">HOPL</code> invokes <code class="cCode">MIRRDPLC</code> program.</li>
<li><a name="wp1046179"> </a>The <code class="cCode">EXEC CICS LINK</code> command causes the advertised service mapped to <code class="cCode">MIRRDPLS</code> (in the DM_LOCAL_SERVICES section of the DMCONFIG file) to execute.</li>
<li><a name="wp1046180"> </a>The <code class="cCode">MIRROR</code> service processes the data received in the service <code class="cCode">TPSVCINFO</code> data buffer from the <code class="cCode">EXEC</code> <code class="cCode">CICS LINK</code>.</li>
<li><a name="wp1046181"> </a>The <code class="cCode">tpreturn</code> call returns the data into the <code class="cCode">COMM-AREA</code> buffer.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1046183"> </a>
CICS/ESA DPL to ATMI Request/Response Server, Service in Autonomous Transaction
</h3>
<p class="pGraphic"><a name="wp1046277"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-05.gif" height="526" width="499" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1046185"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1046278"> </a>User-entered <code class="cCode">H0PL</code> invokes <code class="cCode">MIRRDPLC</code> program.</li>
<li><a name="wp1046279"> </a>The <code class="cCode">EXEC CICS LINK</code> command causes the advertised service mapped to <code class="cCode">MIRRDPLS </code>(in the DM_LOCAL_SERVICES section of the DMCONFIG file) to execute. The <code class="cCode">SYNCONRETURN</code> option indicates that the invoked service will not participate in the CICS/ESA transaction.</li>
<li><a name="wp1046280"> </a>The <code class="cCode">MIRROR</code> service request <code class="cCode">tpbegin</code> incorporates all further operations in a transaction.</li>
<li><a name="wp1046281"> </a>The <code class="cCode">MIRROR</code> service processes the data.</li>
<li><a name="wp1046282"> </a>The <code class="cCode">tpcommit</code> indicates the end of the transaction; all updates performed within the service transaction are to be committed.</li>
<li><a name="wp1046283"> </a>The <code class="cCode">tpreturn</code> call returns the data into the <code class="cCode">commarea</code> buffer.</li>
<li><a name="wp1046284"> </a>The <code class="cCode">EXEC CICS SYNCPOINT</code> is an explicit commit request. All updated resources in the CICS/ESA transaction are committed.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1046286"> </a>
ATMI Client Request/Response to CICS/ESA DPL, Autonomous Transaction
</h3>
<p class="pGraphic"><a name="wp1046381"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-06.gif" height="526" width="504" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1046288"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1046382"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1046383"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpbegin</code> to start the transaction.</li>
<li><a name="wp1046384"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpcall</code> for <code class="cCode">SIMPDPL</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file. The <code class="cCode">TPNOTRAN </code>parameter indicates the CICS/ESA application does not participate in the service transaction.</li>
<li><a name="wp1046385"> </a>Host mirror transaction starts <code class="cCode">TOUPDPLS</code> program and passes <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1046386"> </a>The <code class="cCode">TOUPDPLS</code> program processes data.</li>
<li><a name="wp1046387"> </a>The <code class="cCode">EXEC CICS SYNCPOINT</code> is an explicit commit request. All updated resources in the CICS/ESA transaction are committed.</li>
<li><a name="wp1046388"> </a>The CICS/ESA server returns the <code class="cCode">commarea</code> into the client&#8217;s <code class="cCode">odata</code> buffer.</li>
<li><a name="wp1046389"> </a>The <code class="cCode">toupsrv</code> service <code class="cCode">tpcommit</code> request signals the successful completion of the transaction, causing a commit of its own updated resources.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1046390"> </a>
Transactional ATMI Client Multiple Requests/Responses to CICS/ESA DPL
</h3>
<p class="pGraphic"><a name="wp1046494"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-07.gif" height="502" width="515" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1046392"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1046495"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1046496"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpbegin</code> to start the transaction.</li>
<li><a name="wp1046497"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpcall</code> for <code class="cCode">SIMPDPL</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of the DMCONFIG file. The <code class="cCode">tpcall</code> is requested multiple times within the same transaction.</li>
<li><a name="wp1046498"> </a>Host mirror transaction starts <code class="cCode">TOUPDPLS</code> program and passes <code class="cCode">idata</code> buffer contents for processing. The host mirror transaction remains as a long-running task to service all further requests on the transaction.</li>
<li><a name="wp1046499"> </a>The <code class="cCode">TOUPDPLS</code> program processes data.</li>
<li><a name="wp1046500"> </a>The CICS/ESA system returns the <code class="cCode">commarea</code> into the client&#8217;s <code class="cCode">odata</code> buffer.</li>
<li><a name="wp1046501"> </a>Step 3 through Step 6 are repeated until the <code class="cCode">toupsrv</code> service loop end conditions are met.</li>
<li><a name="wp1046502"> </a>The <code class="cCode">tpcommit</code> request indicates the successful completion of the transaction, causing a commit of its own resources and the resources held by the host mirror transaction.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1046503"> </a>
Transactional CICS/ESA DPL to ATMI Request/Response Server
</h3>
<p class="pGraphic"><a name="wp1046585"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-08.gif" height="526" width="499" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1046505"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1046586"> </a>User-entered <code class="cCode">H2PL</code> invokes <code class="cCode">MIRRDPLC</code> program.</li>
<li><a name="wp1046587"> </a>The <code class="cCode">EXEC CICS LINK</code> command causes the advertised service mapped to <code class="cCode">MIRRDPLS </code>(in the DM_LOCAL_SERVICES section of the DMCONFIG file)<code class="cCode"> </code>to execute. The invoked service participates in the CICS/ESA transaction.</li>
<li><a name="wp1046588"> </a>The <code class="cCode">MIRROR</code> service processes the data.</li>
<li><a name="wp1046589"> </a>The <code class="cCode">tpreturn</code> call returns the data into the <code class="cCode">commarea</code> buffer.</li>
<li><a name="wp1046590"> </a>The <code class="cCode">EXEC CICS SYNCPOINT</code> is an explicit commit request indicating a successful end of the conversation. All updated resources in the transaction are committed.</li>
</ol></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1021664"> </a>
Distributed Transaction Processing (DTP) Examples
</h2><p class="pBody"><a name="wp1021666"> </a>
The following examples represent programming scenarios for using DTP and ATMI service invocations.
</p>
<p class="pBody"><a name="wp1021667"> </a>
Although it is most suited for the DPL environment, the <code class="cCode">tpcall</code> is usually used for the DPL environment, it can also be used for a request/response to a DTP server.
</p>
<p class="pBody"><a name="wp1021668"> </a>
The examples in this section represent some of the programming scenarios available for using DTP and ATMI service invocations. These examples employ the most natural and efficient approaches.
</p>
<h3 class="pHeading2"><a name="wp1047011"> </a>
ATMI Client Request/Response to CICS/ESA DTP
</h3>
<p class="pGraphic"><a name="wp1047118"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-09.gif" height="527" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047013"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1047119"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1047120"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpcall</code> for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file.</li>
<li><a name="wp1047121"> </a>User transaction <code class="cCode">DTPS</code> starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1047122"> </a>It is recommended you save the <code class="cCode">eibtrmid</code> to a program variable. This value may be used to identify the specific conversation in your CICS/ESA APPC verbs.</li>
<li><a name="wp1047123"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1047124"> </a>The <code class="cCode">TOUPDTPS</code> program processes data.</li>
<li><a name="wp1047125"> </a>The <code class="cCode">EXEC CICS SEND</code> command returns the <code class="cCode">OUT-BUFFER</code> contents into the clients <code class="cCode">odata</code> buffer. LAST indicates the conversation is finished. WAIT suspends processing until the data has successfully been received.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1047126"> </a>
ATMI Client Asynchronous Request/Response to CICS/ESA DTP
</h3>
<p class="pGraphic"><a name="wp1047236"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-10.gif" height="516" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047128"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1047237"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1047238"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpacall</code> for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of the DMCONFIG file.</li>
<li><a name="wp1047239"> </a>User transaction DTPS starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1047240"> </a>It is recommended you save the <code class="cCode">EIBTRMID</code> to a program variable. This value may be used to identify the specific conversation in your CICS/ESA APPC verbs.</li>
<li><a name="wp1047241"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1047242"> </a>The <code class="cCode">TOUPDTPS</code> program processes data.</li>
<li><a name="wp1047243"> </a>The <code class="cCode">EXEC CICS SEND</code> command returns the <code class="cCode">OUT-BUFFER</code> contents into the clients <code class="cCode">tpgetreply odata</code> buffer. <code class="cCode">LAST</code> indicates the conversation is finished. <code class="cCode">WAIT</code> suspends processing until the data has successfully been received.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1047244"> </a>
ATMI Client Asynchronous Request/Response with No Reply to CICS/ESA DTP
</h3>
<p class="pGraphic"><a name="wp1047338"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-11.gif" height="464" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047246"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1047339"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1047340"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpacall</code> with a <code class="cCode">TPNOREPLY</code> request for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file.</li>
<li><a name="wp1047341"> </a>User transaction DTPS starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1047342"> </a>It is recommended you save the <code class="cCode">EIBTRMID</code> to a program variable. This value may be used to identify the specific conversation on your CICS/ESA APPC verbs.</li>
<li><a name="wp1047343"> </a>The <code class="cCode">EXEC CICS RECEIVE </code>command receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1047344"> </a>The <code class="cCode">TOUPDTPS</code> program processes data.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1047345"> </a>
ATMI Conversational Client to CICS/ESA DTP, Server Gets Control
</h3>
<p class="pGraphic"><a name="wp1047457"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-12.gif" height="532" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047347"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1047458"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1047459"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpconnect</code> for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file. The <code class="cCode">TPRECVONLY</code> flag indicates the server gets control and the first conversation verb <code class="cCode">toupsrv</code> can issue is <code class="cCode">tprecv</code>. Data is sent on the <code class="cCode">tpconnect</code> in the <code class="cCode">idata</code> buffer.</li>
<li><a name="wp1047460"> </a>User transaction DTPS starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1047461"> </a>It is recommended you save the <code class="cCode">EIBTRMID</code> to a program variable. This value may be used to identify the specific conversation on your CICS/ESA APPC verbs.</li>
<li><a name="wp1047462"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1047463"> </a>The <code class="cCode">TOUPDTPS</code> program processes data.</li>
<li><a name="wp1047464"> </a>The <code class="cCode">EXEC CICS SEND</code> command returns the <code class="cCode">OUT-BUFFER</code> contents into the clients <code class="cCode">tprecv odata</code> buffer.<code class="cCode"> WAIT</code> suspends processing in <code class="cCode">TOUPDTPS </code>until the data has successfully been received. <code class="cCode">LAST</code> indicates the conversation is finished and is communicated to the <code class="cCode">tprecv</code> as <code class="cCode">TPEV_SVCSUCC</code>. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1047465"> </a>
ATMI Conversational Client to CICS/ESA DTP, Client Sends/Receives Data
</h3>
<p class="pGraphic"><a name="wp1047589"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-13.gif" height="554" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047467"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1047590"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1047591"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpconnect</code> for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file. The <code class="cCode">TPSENDONLY</code> indicates the client retains control and continues to send data. Data is sent on the <code class="cCode">tpconnect</code> in the <code class="cCode">idata</code> buffer.</li>
<li><a name="wp1047592"> </a>User transaction DTPS starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1047593"> </a>It is recommended you save the <code class="cCode">EIBTRMID</code> to a program variable. This value may be used to identify the specific conversation on your CICS/ESA APPC verbs.</li>
<li><a name="wp1047594"> </a>The <code class="cCode">EXEC CICS RECEIVE </code>command receives the <code class="cCode">tpconnect</code> <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1047595"> </a>The <code class="cCode">TOUPDTPS</code> program processes data.</li>
<li><a name="wp1047596"> </a>The <code class="cCode">EXEC CICS RECEIVE </code>command receives the <code class="cCode">tpsend idata</code> contents into the server&#8217;s <code class="cCode">IN-BUFFER</code>. </li>
<li><a name="wp1047597"> </a>The server processes the data.</li>
<li><a name="wp1047598"> </a>The <code class="cCode">EXEC CICS SEND WAIT LAST</code> returns <code class="cCode">OUT-BUFFER</code> data in the <code class="cCode">tprecv</code> <code class="cCode">odata</code> buffer, along with notification that the conversation is over.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1047599"> </a>
ATMI Conversational Client to CICS/ESA DTP, Client Grants Control
</h3>
<p class="pGraphic"><a name="wp1047733"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-14.gif" height="557" width="505" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047601"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1047734"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1047735"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpconnect</code> for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file. The <code class="cCode">TPRECVONLY</code> indicates the server gets control and the first conversation verb <code class="cCode">toupsrv</code> can issue is <code class="cCode">tprecv</code>.</li>
<li><a name="wp1047736"> </a>User transaction DTPS starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1047737"> </a>It is recommended you save the <code class="cCode">EIBTRMID</code> to a program variable. This value may be used to identify the specific conversation on your CICS/ESA APPC verbs.</li>
<li><a name="wp1047738"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives a <code class="cCode">send state</code> indicator from the <code class="cCode">tpconnect</code> <code class="cCode">TPRECVONLY</code> flag. No data is received into the <code class="cCode">INBUFFER</code>.</li>
<li><a name="wp1047739"> </a>The <code class="cCode">EXEC CICS SEND</code> command returns the <code class="cCode">OUT-BUFFER</code> contents into the clients <code class="cCode">tprecv odata</code> buffer. The <code class="cCode">EXEC CICS SEND</code> command relinquishes control to the client by using the <code class="cCode">INVITE</code> option. This is communicated to the <code class="cCode">tprecv</code> as <code class="cCode">TPEV_SENDONLY</code>.</li>
<li><a name="wp1047740"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">tpsend</code> <code class="cCode">idata</code> contents into the server&#8217;s <code class="cCode">IN-BUFFER</code>, along with notification that the server has relinquished control.</li>
<li><a name="wp1047741"> </a>The <code class="cCode">EXEC CICS RETURN</code> ends the conversation, communicated to the <code class="cCode">tprecv</code> as <code class="cCode">TPEV_SVCSUCC</code>.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1047742"> </a>
CICS/ESA DTP to ATMI Conversational Server, Client Retains Control
</h3>
<p class="pGraphic"><a name="wp1047869"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-15.gif" height="552" width="503" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047744"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1047870"> </a>User-entered <code class="cCode">H0TP</code> invokes <code class="cCode">MIRRDTPC</code> program.</li>
<li><a name="wp1047874"> </a>The <code class="cCode">EXEC CICS ALLOCATE</code> acquires a session to the remote Tuxedo domain.</li>
<li><a name="wp1047875"> </a>Save the conversation ID returned in <code class="cCode">EIBRSRCE</code> to a program variable. This value is used to identify the specific conversation in your CICS/ESA APPC verbs.</li>
<li><a name="wp1047876"> </a>The <code class="cCode">EXEC CICS CONNECT PROCESS</code> command initiates the advertised service mapped to <code class="cCode">MIRROR</code> in the DM_LOCAL_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1047877"> </a>Execute the <code class="cCode">EXEC CICS SEND </code>command to send the contents of the <code class="cCode">OUT-BUFFER</code> to the Tuxedo service in the <code class="cCode">tpsvcinfo-&gt;data</code> buffer. The contents might be sent immediately.</li>
<li><a name="wp1047881"> </a>The <code class="cCode">EXEC CICS SEND INVITE WAIT</code> command sends <code class="cCode">out-buff</code> contents into the <code class="cCode">tprecv odata</code> buffer. The <code class="cCode">INVITE</code> parameter relinquishes control of the conversation, seen as a <code class="cCode">TPEV_SENDONLY</code> in the <code class="cCode">reevent</code> parameter on the <code class="cCode">tprecv</code> command. The data is sent immediately, along with the data from the previous <code class="cCode">SEND</code> operation.</li>
<li><a name="wp1047885"> </a>The Tuxedo service processes data.</li>
<li><a name="wp1047886"> </a>The CICS/ESA server processes data.</li>
<li><a name="wp1047887"> </a>The ATMI <code class="cCode">tpreturn</code> data returns data to the <code class="cCode">EXEC CICS RECEIVE</code>, along with notification that the conversation completed successfully.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1047888"> </a>
CICS/ESA DTP to ATMI Conversational Server, Client Relinquishes Control
</h3>
<p class="pGraphic"><a name="wp1048000"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-16.gif" height="534" width="503" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1047890"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1048001"> </a>User-entered HOTP invokes <code class="cCode">MIRRDTPC</code> program.</li>
<li><a name="wp1048005"> </a>The <code class="cCode">EXEC CICS ALLOCATE</code> acquires a session to the remote Tuxedo domain.</li>
<li><a name="wp1048006"> </a>Save the conversation ID returned in <code class="cCode">EIBRSRCE</code> to a program variable. This value is used to identify the specific conversation in your CICS/ESA APPC verbs.</li>
<li><a name="wp1048007"> </a>The <code class="cCode">EXEC CICS CONNECT PROCESS</code> command initiates the advertised service mapped to <code class="cCode">MIRROR </code>in the DM_LOCAL_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1048008"> </a>The <code class="cCode">EXEC CICS SEND </code>command relinquishes control with the <code class="cCode">INVITE WAIT</code> option.</li>
<li><a name="wp1048009"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">tpsend</code> <code class="cCode">idata</code> buffer contents into the <code class="cCode">IN-BUFFER</code>.</li>
<li><a name="wp1048010"> </a>The <code class="cCode">tpreturn</code> request tears down the conversation and indicates on the <code class="cCode">EXEC CICS RECEIVE</code> that the conversation is over.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1048012"> </a>
Transactional ATMI Client Request/Response to CICS/ESA DTP
</h3>
<p class="pGraphic"><a name="wp1048134"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-17.gif" height="552" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1048014"/></div><p class="pGraphic">

</p>
<a name="wp1048135"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>This is not the recommended method of performing a DTP transactional service. Please refer to the transactional DPL using request/response for the recommended method.</td>
</tr>
</table>

<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1048136"> </a>ATMI client <code class="cCode">toupclt </code>invokes <code class="cCode">toupsrv</code> service. (Note that each <code class="cCode">tpcall </code>made in the program must be bookended with a <code class="cCode">tpbegin</code> and a <code class="cCode">tpcommit</code>.)</li>
<li><a name="wp1048137"> </a>The service issues <code class="cCode">tpbegin</code> to start a transaction.</li>
<li><a name="wp1048138"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpcall</code> for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of the DMCONFIG file.</li>
<li><a name="wp1048139"> </a>User transaction DTPS starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1048140"> </a>Save the <code class="cCode">EIBTRMID</code> to a program variable. This value is used to identify the specific conversation on your CICS/ESA APPC verbs.</li>
<li><a name="wp1048141"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1048142"> </a>The <code class="cCode">TOUPDTPS</code> program processes data.</li>
<li><a name="wp1048143"> </a>The <code class="cCode">EXEC CICS SEND</code> command returns the <code class="cCode">OUT-BUUFER</code> contents into the clients <code class="cCode">odata</code> buffer. <code class="cCode">CONFIRM</code> indicates the conversation is finished. <code class="cCode">INVITE</code> allows the client to respond with a <code class="cCode">COMMIT</code> request.</li>
<li><a name="wp1048144"> </a>The <code class="cCode">toupsrv </code>service issues <code class="cCode">tpcommit</code> to end the transaction. The <code class="cCode">COMMIT</code> is received on the <code class="cCode">EXEC</code> <code class="cCode">CICS RECEIVE </code>verb and the server issues <code class="cCode">EXEC</code> <code class="cCode">CICS RETURN</code> to commit the resources, terminate the transaction, and free the outstanding conversation.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1048145"> </a>
Transactional ATMI Conversational Client to CICS/ESA DTP, Server Gets Control
</h3>
<p class="pGraphic"><a name="wp1048271"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-18.gif" height="540" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1048147"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1048272"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1048273"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpbegin</code> to start the transaction.</li>
<li><a name="wp1048274"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpconnect</code> for <code class="cCode">SIMPDTP</code>, which is advertised in the <code class="cCode">DM_REMOTE_SERVICES</code> section of DMCONFIG file. The <code class="cCode">TPRECVONLY</code> indicates the server gains control and the first conversation verb <code class="cCode">toupsrv</code> can issue is <code class="cCode">tprecv</code>. Data is sent on the <code class="cCode">tpconnect</code> in the <code class="cCode">idata</code> buffer.</li>
<li><a name="wp1048275"> </a>User transaction DTPS starts <code class="cCode">TOUPDTPS</code> program.</li>
<li><a name="wp1048276"> </a>It is recommended you save the <code class="cCode">EIBTRMID</code> to a program variable. This value may be used to identify the specific conversation on your CICS/ESA APPC verbs.</li>
<li><a name="wp1048277"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1048278"> </a>The <code class="cCode">TOUPDTPS</code> program processes data.</li>
<li><a name="wp1048279"> </a>The <code class="cCode">EXEC CICS SEND</code> command returns the <code class="cCode">OUT-BUFFER</code> contents into the clients <code class="cCode">tprecv odata</code> buffer.<code class="cCode"> CONFIRM</code> indicates that the conversation is finished and is communicated to the <code class="cCode">tprecv</code> as <code class="cCode">TPEV_SVCSUCC</code>. <code class="cCode">INVITE</code> enables the client to respond with a <code class="cCode">COMMIT</code> request.</li>
<li><a name="wp1048280"> </a>The <code class="cCode">toupsrv </code>service issues <code class="cCode">tpcommit</code> to end the transaction. The <code class="cCode">COMMIT</code> is received on the <code class="cCode">EXEC</code> <code class="cCode">CICS RECEIVE </code>verb and the server issues <code class="cCode">EXEC</code> <code class="cCode">CICS RETURN</code> to commit the resources, terminate the transaction, and free the outstanding conversation.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1048281"> </a>
Transactional CICS/ESA DTP to ATMI Conversational Server, Host Client Relinquishes Control
</h3>
<p class="pGraphic"><a name="wp1048399"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-19.gif" height="548" width="503" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1048283"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1048400"> </a>User-entered H2TP invokes <code class="cCode">MIRRDTPC</code> program.</li>
<li><a name="wp1048404"> </a>The <code class="cCode">EXEC CICS ALLOCATE</code> acquires a session to the remote Tuxedo domain.</li>
<li><a name="wp1048405"> </a>Save the conversation ID returned in <code class="cCode">EIBRSRCE</code> to a program variable. This value is used to identify the specific conversation on your CICS/ESA APPC verbs.</li>
<li><a name="wp1048406"> </a>The <code class="cCode">EXEC CICS CONNECT PROCESS</code> command initiates the advertised service mapped to <code class="cCode">MIRRDTPS</code>. The <code class="cCode">SYNCLEVEL(2)</code> parameter indicates the inclusion of the ATMI service in the CICS/ESA transaction.</li>
<li><a name="wp1048407"> </a>The <code class="cCode">EXEC CICS SEND INVITE WAIT</code> command causes the client to immediately relinquish control to the Tuxedo server. This is communicated to the service in <code class="cCode">TPSVCINFO</code> as <code class="cCode">TPSENDONLY</code>. No data is sent to the server on this request.</li>
<li><a name="wp1048411"> </a>The <code class="cCode">EXEC CICS RECEIVE</code> command receives the <code class="cCode">tpsend</code> idata buffer contents into the <code class="cCode">IN-BUFFER</code>. The <code class="cCode">EXEC CICS RECEIVE</code> command receives a confirm request indicating the conversation should be terminated.</li>
<li><a name="wp1048412"> </a>The <code class="cCode">EXEC CICS ISSUE CONFIRMATION</code> verb responds positively to the confirm request.</li>
<li><a name="wp1048413"> </a>The <code class="cCode">EXEC CICS SYNCPOINT</code> is an explicit commit request to end the conversation and update all resources in the transaction. </li>
<li><a name="wp1048414"> </a>The <code class="cCode">EXEC CICS FREE</code> verb explicitly frees the outstanding conversation.</li>
</ol></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1023094"> </a>
CPI-C Programming Examples
</h2><p class="pBody"><a name="wp1023096"> </a>
The examples in this section show the protocol exchanges between the local ATMI platform and remote host application program. The type of ATMI service request determines the nature of the client/server communication model. For requests initiated by the host application, the configuration information for the local service determines the protocol exchanges on the conversation.
</p>
<p class="pBody"><a name="wp1023098"> </a>
Although it is most suited for the DPL environment, the <code class="cCode">tpcall</code> is usually used in the DPL environment but can also be used for a request/response to an APPC server.
</p>
<p class="pBody"><a name="wp1023099"> </a>
The examples in this section represent a few of the many programming scenarios available for using CPI-C and ATMI service invocations. These examples employ the most natural and efficient approaches.
</p>
<h3 class="pHeading2"><a name="wp1048662"> </a>
ATMI Client Request/Response to Host CPI-C
</h3>
<p class="pGraphic"><a name="wp1048767"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-20.gif" height="525" width="524" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1048664"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1048769"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1048770"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpcall</code> for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1048771"> </a>The remote service with the <code class="cCode">tpname</code> <code class="cCode">TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program. </li>
<li><a name="wp1048772"> </a>The server accepts the conversation with the <code class="cCode">cmaccp</code> call. The conversation id returned on the request in <code class="cCode">convid</code> is used for all other requests on this conversation. </li>
<li><a name="wp1048773"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">idata</code> buffer contents for processing</li>
<li><a name="wp1048774"> </a>The <code class="cCode">TOUPCPIC</code> program processes data.</li>
<li><a name="wp1048775"> </a>The <code class="cCode">cmsst</code> request prepares the next send request by setting the send type to <code class="cCode">CM_SEND_AND_DEALLOCATE</code>.</li>
<li><a name="wp1048776"> </a>The <code class="cCode">cmsend</code> request returns the <code class="cCode">obuffer</code> contents into the client <code class="cCode">odata</code> buffer. The buffer is flushed, and the conversation ended.   </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1048777"> </a>
ATMI Client Asynchronous Request/Response to Host CPI-C
</h3>
<p class="pGraphic"><a name="wp1048886"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-21.gif" height="525" width="510" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1048779"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1048888"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1048889"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpacall</code> for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1048890"> </a>The remote service with <code class="cCode">tpname</code> <code class="cCode">TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program. </li>
<li><a name="wp1048891"> </a>The server accepts the conversation with the <code class="cCode">cmaccp</code> call. The conversation id returned on the request in <code class="cCode">convid</code> is used for all other requests on this conversation.</li>
<li><a name="wp1048892"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1048893"> </a>The <code class="cCode">TOUPCPIC</code> program processes data.</li>
<li><a name="wp1048894"> </a>The <code class="cCode">cmsend</code> command returns the <code class="cCode">obuffer</code> contents into the client <code class="cCode">tpgetreply odata </code>buffer. The data may not be immediately sent to the <code class="cCode">tpgetreply odata</code> buffer on this request.</li>
<li><a name="wp1048895"> </a>The <code class="cCode">cmdeal</code> flushes the data to the client, and indicates the conversation is finished. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1048896"> </a>
ATMI Client Asynchronous Request/Response to Host CPI-C with No Reply
</h3>
<p class="pGraphic"><a name="wp1048986"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-22.gif" height="525" width="508" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1048898"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1048988"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1048989"> </a>The <code class="cCode">toupsrv</code> service issues tpacall with a <code class="cCode">TPNOREPLY</code> request for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file. </li>
<li><a name="wp1048990"> </a>The remote service with <code class="cCode">tpname TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program.</li>
<li><a name="wp1048991"> </a>The server accepts the conversation with the <code class="cCode">cmaccp</code> call. The conversation id returned on the request in <code class="cCode">convid</code> is used for all other requests on this conversation.</li>
<li><a name="wp1048992"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">idata </code>buffer contents for processing, and notification that the conversation has ended with the return code value of <code class="cCode">CM_DEALLOCATED_NORMAL</code>.</li>
<li><a name="wp1048993"> </a>The <code class="cCode">TOUPCPIC</code> program processes data. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1048994"> </a>
ATMI Conversational Client to Host CPI-C, Server Gets Control 
</h3>
<p class="pGraphic"><a name="wp1049108"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-23.gif" height="555" width="543" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1048996"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049110"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1049111"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpconnect</code> for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file. The <code class="cCode">TPRECVONLY</code> indicates the server gains control and the first conversation verb the <code class="cCode">toupsrv</code> can issue is <code class="cCode">tprecv</code>. Data is sent on the <code class="cCode">tpconnect</code> in the <code class="cCode">idata</code> buffer.</li>
<li><a name="wp1049112"> </a>The remote service with <code class="cCode">tpname TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program.</li>
<li><a name="wp1049113"> </a>The server accepts the conversation with the <code class="cCode">cmaccp</code> call. The conversation ID returned on the request in <code class="cCode">convid</code> is used for all other requests on this conversation.</li>
<li><a name="wp1049114"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1049115"> </a>The <code class="cCode">TOUPCPIC</code> program processes data.</li>
<li><a name="wp1049116"> </a>The <code class="cCode">cmsst</code> request prepares the next send request by setting the send type to <code class="cCode">CM_SEND_AND_FLUSH.</code></li>
<li><a name="wp1049117"> </a>The <code class="cCode">cmsend</code> command returns the <code class="cCode">obuffer </code>contents into the client <code class="cCode">tprecv</code> <code class="cCode">odata</code> buffer. The data is immediately flushed on the send request.</li>
<li><a name="wp1049118"> </a>The <code class="cCode">cmdeal</code> request ends the conversation. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049119"> </a>
ATMI Conversational Client To Host CPI-C, Client Retains Control
</h3>
<p class="pGraphic"><a name="wp1049231"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-24.gif" height="525" width="506" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049121"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049233"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service. </li>
<li><a name="wp1049234"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpconnect</code> for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file. The TPSENDONLY indicates the client retains control and continues to send data. No data is sent with the <code class="cCode">tpconnect</code>.</li>
<li><a name="wp1049235"> </a>The remote service with <code class="cCode">tpname</code> <code class="cCode">TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program.</li>
<li><a name="wp1049236"> </a>The server accepts the conversation with the <code class="cCode">cmaccp</code> call. The conversation id returned on the request in <code class="cCode">convid</code> is used for all other requests on this conversation.</li>
<li><a name="wp1049237"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">tpsend</code> <code class="cCode">idata</code> buffer contents for processing. The conversation is relinquished with the <code class="cCode">TPRECVONLY</code> flag. </li>
<li><a name="wp1049238"> </a>The <code class="cCode">TOUPCPIC</code> program processes data. </li>
<li><a name="wp1049239"> </a>The <code class="cCode">cmsend</code> returns a response in the <code class="cCode">tprecv</code> <code class="cCode">idata</code> buffer, along with notification from the <code class="cCode">cmdeal</code> command that the conversation is over. The <code class="cCode">cmdeal</code> flushes the data buffer and the <code class="cCode">tprecv reevent</code> parameter is set to <code class="cCode">TPEV_SUCCESS</code>. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049240"> </a>
ATMI Conversational Client to Host CPI-C, Client Grants/gets Control
</h3>
<p class="pGraphic"><a name="wp1049382"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-25.gif" height="538" width="509" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049242"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049384"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1049385"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpconnect</code> for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file. The TPRECVONLY indicates the server gains control and the first conversation verb the <code class="cCode">toupsrv </code>can issue is <code class="cCode">tprecv</code>. </li>
<li><a name="wp1049386"> </a>The remote service with <code class="cCode">tpname</code> <code class="cCode">TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program.</li>
<li><a name="wp1049387"> </a>The server accepts the conversation with the <code class="cCode">cmaccp</code> request. The conversation id returned on the request in <code class="cCode">convid</code> is used for all other requests on this conversation.</li>
<li><a name="wp1049388"> </a>The <code class="cCode">cmrcv</code> requests receives the indicator that control has been granted to the server. </li>
<li><a name="wp1049389"> </a>The <code class="cCode">cmsend</code> request returns its <code class="cCode">obuffer</code> contents into the first client <code class="cCode">tprecv</code> <code class="cCode">odata</code> buffer. The data may not immediately be sent.</li>
<li><a name="wp1049390"> </a>The <code class="cCode">cmsend</code> request returns its <code class="cCode">obuffer </code>contents into the second client <code class="cCode">tprecv odata</code> buffer. The data may not immediately be sent.</li>
<li><a name="wp1049391"> </a>The <code class="cCode">cmptr</code> request flushes the data to the client, and grants control to the client.</li>
<li><a name="wp1049392"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">tpsend</code> <code class="cCode">idata</code> buffer contents for processing. The <code class="cCode">TPRECVONLY</code> is passed to the <code class="cCode">tprecv</code>, relinquishing control of the conversation.</li>
<li><a name="wp1049393"> </a>The <code class="cCode">cmdeal</code> indicates a successful completion of the conversation to the <code class="cCode">tprecv</code>; no data is passed.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049394"> </a>
Host CPI-C to ATMI Asynchronous Request/Response Server with No Reply
</h3>
<p class="pGraphic"><a name="wp1049485"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-26.gif" height="526" width="505" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049396"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049487"> </a>The CPI-C application program <code class="cCode">MIRRCPIC</code> is invoked using environment start-up specifications.</li>
<li><a name="wp1049488"> </a>The <code class="cCode">MIRRCPIC</code> client requests <code class="cCode">cminit</code> to establish conversation attributes and receive a conversation ID that will be used on all other requests on this conversation. The remote server and service are named in the CPI-C side information entry <code class="cCode">MIRRSIDE</code>.</li>
<li><a name="wp1049489"> </a>The <code class="cCode">cmallc</code> request initiates the advertised service mapped to <code class="cCode">MIRRORSERV</code> in the DM_LOCAL_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1049490"> </a>The <code class="cCode">cmsend</code> request sends the contents of <code class="cCode">obuffer</code> to the ATMI service in the <code class="cCode">tpsvcinfo-&gt;data</code> buffer. </li>
<li><a name="wp1049491"> </a>The <code class="cCode">cmdeal</code> request flushes the data, and indicates the conversation is finished with the TPNOREPLY in the <code class="cCode">tpsvcinfo-&gt;flag</code> field. </li>
<li><a name="wp1049492"> </a>The service completes with the <code class="cCode">tpreturn</code>. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049493"> </a>
Host CPI-C to ATMI Server Request/Response
</h3>
<p class="pGraphic"><a name="wp1049586"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-27.gif" height="526" width="529" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049495"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049588"> </a>The CPI-C application program MIRRCPIC is invoked using environment start-up specifications.</li>
<li><a name="wp1049589"> </a>The <code class="cCode">MIRRCPIC</code> client requests <code class="cCode">cmini</code>t to establish conversation attributes and receive a conversation id that will be used on all other requests on this conversation. The remote server and service are named in the CPI-C side information entry <code class="cCode">MIRRSIDE</code>.</li>
<li><a name="wp1049590"> </a>The <code class="cCode">cmallc</code> request initiates the advertised service mapped to <code class="cCode">MIRRORSERV</code> in the DM_LOCAL_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1049591"> </a>The <code class="cCode">cmsst</code> request prepares the next send request by setting the send type to <code class="cCode">CM_SEND_AND_PREP_TO_RECEIVE</code>. </li>
<li><a name="wp1049592"> </a>The <code class="cCode">cmsend</code> request immediately sends the contents of <code class="cCode">obuffer</code> to the ATMI service in the <code class="cCode">tpsvcinfo-&gt;data</code> buffer and relinquishes control to the <code class="cCode">mirrorserv</code> service. </li>
<li><a name="wp1049593"> </a>The <code class="cCode">cmrcv</code> request receives the contents of the <code class="cCode">odata</code> returned on the ATMI <code class="cCode">tpreturn</code> service, and notification that the conversation has ended with the return code value of <code class="cCode">CM_DEALLOCATED_NORMAL</code>. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049594"> </a>
Host CPI-C to ATMI Conversational Service, Client Retains Control
</h3>
<p class="pGraphic"><a name="wp1049683"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-28.gif" height="526" width="499" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049596"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049685"> </a>The CPI-C application program MIRRCPIC is invoked using environment start-up specifications.</li>
<li><a name="wp1049686"> </a>The <code class="cCode">MIRRCPIC</code> client requests <code class="cCode">cminit</code> to establish conversation attributes and receive a conversation id that will be used on all other requests on this conversation. The remote server and service are named in the CPI-C side information entry <code class="cCode">MIRRSIDE</code>.</li>
<li><a name="wp1049687"> </a>The <code class="cCode">cmallc</code> request initiates the advertised service mapped to <code class="cCode">MIRRORSERV</code> in the DM_LOCAL_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1049688"> </a>The <code class="cCode">cmsend</code> request sends the contents of <code class="cCode">obuffer</code> to the ATMI service in the <code class="cCode">tpsvcinfo-&gt;data </code>buffer. </li>
<li><a name="wp1049689"> </a>The <code class="cCode">cmdeal</code> request flushes the data and ends the conversation, as indicated by <code class="cCode">TPNOREPLY</code> in the <code class="cCode">tpsvcinfo-&gt;flag</code> field. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049690"> </a>
Host CPI-C ATMI to Conversational Service, Client Grants Control
</h3>
<p class="pGraphic"><a name="wp1049788"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-29.gif" height="526" width="499" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049692"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049790"> </a>The CPI-C application program <code class="cCode">MIRRCPIC</code> is invoked using environment start-up specifications.</li>
<li><a name="wp1049791"> </a>The <code class="cCode">MIRRCPIC</code> client requests <code class="cCode">cminit</code> to establish conversation attributes and receive a conversation ID that will be used on all other requests on this conversation. The remote server and service are named in the CPI-C side information entry<code class="cCode"> MIRRSIDE</code>.</li>
<li><a name="wp1049792"> </a>The <code class="cCode">cmallc</code> request initiates the advertised service mapped to <code class="cCode">MIRROR</code> in the DM_LOCAL_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1049793"> </a>The <code class="cCode">cmptr</code> relinquishes control of the conversation to the ATMI service indicated as <code class="cCode">TPSENDONLY</code> in the <code class="cCode">tpsvcinfo-&gt;flag</code> field. No data is passed in the <code class="cCode">tpsvcinfo-&gt;data</code> field.</li>
<li><a name="wp1049794"> </a>The <code class="cCode">cmrcv</code> receives the contents of the <code class="cCode">tpsend odata</code> into the <code class="cCode">ibuffer</code>. The end of the conversation is passed from the <code class="cCode">tpreturn</code> service as return code value <code class="cCode">CM_DEALLOCATED_NORMAL</code>.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049796"> </a>
Transactional ATMI Client Request/Response to Host CPI-C
</h3>
<p class="pGraphic"><a name="wp1049904"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-30.gif" height="526" width="528" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049798"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1049906"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1049907"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpbegin</code> to start the transaction.</li>
<li><a name="wp1049908"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpcall</code> for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file. Data is sent from the <code class="cCode">idata</code> buffer on the <code class="cCode">tpconnect</code>.</li>
<li><a name="wp1049909"> </a>The remote service with <code class="cCode">tpname</code> <code class="cCode">TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program.</li>
<li><a name="wp1049910"> </a>The server accepts the conversation with the <code class="cCode">cmaccp</code> call. The conversation ID returned on the request in <code class="cCode">convid</code> is used for all other requests during this conversation.</li>
<li><a name="wp1049911"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">idata</code> buffer contents for processing.</li>
<li><a name="wp1049912"> </a>The <code class="cCode">cmsst</code> and <code class="cCode">cmsptr</code> prepare the next send request by setting the send type to <code class="cCode">CM_SEND_AND_PREP_TO_RECEIVE</code> and by setting the prepare-to-receive type to <code class="cCode">CM_PREP_TO_RECEIVE_CONFIRM</code>.</li>
<li><a name="wp1049913"> </a>The <code class="cCode">cmsend</code> request immediately returns the <code class="cCode">obuffer</code> contents into the client&#8217;s <code class="cCode">odata</code> buffer. The server relinquishes control to the server and indicates the end of the conversation with the <code class="cCode">CONFIRM</code> request.</li>
<li><a name="wp1049914"> </a>The <code class="cCode">toupsrv</code> issues the <code class="cCode">tpcommit</code> to successfully complete the transaction and commit all updated resources. The <code class="cCode">cmrcv</code> request receives the commit request, and responds explicitly to the request with the SAA Resource/Recovery commit call <code class="cCode">srrcmit</code>. The conversation is ended after the successful commit exchange.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1049916"> </a>
Transactional ATMI Conversational Client to Host CPI-C, Server Gets Control
</h3>
<p class="pGraphic"><a name="wp1050029"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-31.gif" height="526" width="504" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1049918"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1050031"> </a>ATMI client invokes <code class="cCode">toupsrv</code> service.</li>
<li><a name="wp1050032"> </a>The <code class="cCode">toupsrv</code> service issues <code class="cCode">tpbegin</code> to start the transaction.</li>
<li><a name="wp1050033"> </a>The <code class="cCode">toupsrv</code> service issues a <code class="cCode">tpconnect</code> service request for <code class="cCode">SIMPCPIC</code>, which is advertised in the DM_REMOTE_SERVICES section of the DMCONFIG file. Data is sent in the <code class="cCode">idata</code> buffer on the <code class="cCode">tpconnect</code>.</li>
<li><a name="wp1050034"> </a>The remote service with <code class="cCode">tpname</code> <code class="cCode">TPNCPIC</code> invokes <code class="cCode">TOUPCPIC</code> program.</li>
<li><a name="wp1050035"> </a>The server accepts the conversation with the <code class="cCode">cmaccp </code>call. The conversation ID returned on the request in <code class="cCode">convid</code> is used for all other requests during this conversation.</li>
<li><a name="wp1050036"> </a>The <code class="cCode">cmrcv</code> request receives the <code class="cCode">idata </code>buffer contents sent on the <code class="cCode">tpconnect</code> for processing.</li>
<li><a name="wp1050037"> </a>The <code class="cCode">TOUPCPIC</code> program processes the data.</li>
<li><a name="wp1050038"> </a>The <code class="cCode">cmsend</code> returns the <code class="cCode">obuffer</code> contents into the client&#8217;s <code class="cCode">tprecv</code> <code class="cCode">odata</code> buffer. The buffer contents may not be sent immediately.</li>
<li><a name="wp1050039"> </a>The <code class="cCode">cmsptr</code> prepares the prepare-to-receive request with <code class="cCode">CM_PREP_TO_RECEIVE_CONFIRM</code>. The <code class="cCode">cmptr</code> request with <code class="cCode">CONFIRM </code>indicates that the conversation is finished and is communicated to the <code class="cCode">tprecv</code> as <code class="cCode">TPEV_SVCSUCC</code>. </li>
<li><a name="wp1050040"> </a>The <code class="cCode">toupsrv</code> issues the <code class="cCode">tpcommit</code> to successfully complete the transaction and commit all updated resources. The <code class="cCode">cmrcv</code> request receives the commit request and responds explicitly to the request with the SAA Resource/Recovery commit call <code class="cCode">srrcmit</code>. The conversation is ended after the successful commit exchange.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1050042"> </a>
Transactional Host CPI-C to ATMI Conversational Server, Client Grants Control
</h3>
<p class="pGraphic"><a name="wp1050147"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-32.gif" height="526" width="507" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1050044"/></div><p class="pGraphic">

</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1050149"> </a>The CPI-C application program <code class="cCode">MIRRCPIC</code> is invoked using environment start-up specifications.</li>
<li><a name="wp1050150"> </a>The <code class="cCode">MIRRCPIC</code> client requests <code class="cCode">cminit </code>to establish conversation attributes and receive a conversation ID that will be used on all other requests on this conversation. The remote server and service are named in the CPI-C side information entry <code class="cCode">MIRRSIDE</code>.</li>
<li><a name="wp1050151"> </a>The <code class="cCode">cmssl</code> sets the conversation attributes to sync-level 2 with <code class="cCode">CM_SYNCPOINT</code>. This allows the ATMI service to participate in the transaction.</li>
<li><a name="wp1050152"> </a>The <code class="cCode">cmallc</code> request initiates the advertised service mapped to <code class="cCode">MIRRORSERV</code> in the DM_LOCAL_SERVICES section of the DMCONFIG file.</li>
<li><a name="wp1050153"> </a>The MIRRCPIC causes the client to relinquish control to the ATMI server with a prepare-to-receive request. The <code class="cCode">cmsptr</code> sets the prepare-to-receive type to CM_RECEIVE_AND_FLUSH. The <code class="cCode">cmptr</code> request immediately relinquishes control.</li>
<li><a name="wp1050154"> </a>The <code class="cCode">MIRROR</code> service sends the data contents of the <code class="cCode">odata</code> buffer to the <code class="cCode">cmrcv</code> <code class="cCode">ibuffer</code>. The <code class="cCode">cmrcv</code> receives a confirm request from the server indicating the conversation should be terminated. </li>
<li><a name="wp1050155"> </a>The client replies positively to the confirm request with <code class="cCode">cmcfmd</code>.</li>
<li><a name="wp1050156"> </a>The <code class="cCode">MIRRCPIC</code> client prepares to free the conversation with the <code class="cCode">cmdeal</code> request. The conversation in CM_DEALLOCATE_SYNC_LEVEL commits all updated resources in the transaction and waits for the SAA resource recovery verb, <code class="cCode">srrcmit</code>. After the <code class="cCode">commit</code> sequence has completed, the conversation terminates.</li>
</ol></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1024610"> </a>
CICS/ESA Mirror Transaction Examples
</h2><h3 class="pHeading2"><a name="wp1055442"> </a>
Implicit Attachment of TRANSID (Outbound Requests Only)
</h3>
<div class="pFigureTitle"><a name="wp1055885"> </a>
Figure&#160;2-1  Implicit Attachment of TRANSID (Outbound Requests Only)
</div>

 
 <p class="pGraphic"><a name="wp1055933"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-33.gif" height="367" width="532" alt="Implicit Attachment of TRANSID (Outbound Requests Only)" id="wp1055887"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1055527"> </a>
The following list describes the process for implicit attachment as illustrated in <a href="prog.html#wp1055885"><span class="cHyperlink">
Figure&#160;2-1</span></a>:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1055531"> </a>The ATMI service makes a request to the service <code class="cCode">TRN1DATA</code>, which is advertised as a remote service in the <code class="cCode">DMCONFIG</code> file. It is a DPL request to a program named <code class="cCode">SVC1</code> in the CICS/ESA region.</li>
<li><a name="wp1055532"> </a>The first four characters of the remote service tag name (<code class="cCode">TRN1</code>) are extracted and passed to the CICS/ESA region as the invoking <code class="cCode">TRANSID</code>. No CICS/ESA resource definition for the <code class="cCode">TRANSID</code> is required in the region.</li>
<li><a name="wp1055533"> </a>The mirror transaction CSMI is attached in the CICS/ESA region, starting the mirror program <code class="cCode">DFHMIRS</code>. The program performs the DTP requests for the service.</li>
<li><a name="wp1055534"> </a>The mirror program now attaches the invoking <code class="cCode">TRANSID</code> (<code class="cCode">TRN1</code>) and then invokes the application service program <code class="cCode">SVC1</code>.The program can interrogate the <code class="cCode">EIBTRNID</code> field to find this value. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1055455"> </a>
Explicit Attachment of TRANSID for Outbound Requests
</h3>
<div class="pFigureTitle"><a name="wp1055978"> </a>
Figure&#160;2-2  Explicit Attachment of TRANSID for Outbound Requests
</div>

 
 <p class="pGraphic"><a name="wp1056025"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-34.gif" height="367" width="532" alt="Explicit Attachment of TRANSID for Outbound Requests" id="wp1055980"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1055583"> </a>
The following list describes the process for explicit attachment as illustrated in <a href="prog.html#wp1055978"><span class="cHyperlink">
Figure&#160;2-2</span></a>:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1055587"> </a>The ATMI program makes a service request for <code class="cCode">SERVICE1</code>, which is advertised as a remote service in the <code class="cCode">DMCONFIG</code> file. The <code class="cCode">FUNCTION</code> option indicates the remote service is invoked as a DPL.</li>
<li><a name="wp1055588"> </a>The request extracts <code class="cCode">TRN1</code> as an alternate mirror transaction ID for the remote region, along with the remote program name <code class="cCode">SERVICE1</code>.</li>
<li><a name="wp1055589"> </a>The <code class="cCode">TRN1</code> ID is attached instead of the default mirror transaction, <code class="cCode">CSMI</code> or <code class="cCode">CVMI</code>. The <code class="cCode">TRN1</code> ID must be defined as a transaction resource in the remote region and must point to the mirror transaction program <code class="cCode">DFHMIRS</code>.</li>
<li><a name="wp1055590"> </a>The mirror program <code class="cCode">DFMMIRS</code> calls the server application program, passing the <code class="cCode">TRN1</code> ID in the <code class="cCode">EIBTRNID</code> field.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1055574"> </a>
Explicit Attachment of TRANSID for Inbound Requests
</h3>
<div class="pFigureTitle"><a name="wp1056056"> </a>
Figure&#160;2-3  Explicit Attachment of TRANSID for Inbound Requests
</div>

 
 <p class="pGraphic"><a name="wp1056092"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ref-2-1-35.gif" height="367" width="532" alt="Explicit Attachment of TRANSID for Inbound Requests" id="wp1056058"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1055670"> </a>
The following list describes the process for implicit attachment as illustrated in <a href="prog.html#wp1056056"><span class="cHyperlink">
Figure&#160;2-3</span></a>:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1055674"> </a>The CICS/ESA program makes a request to <code class="cCode">INSVC1</code>, which is a local ATMI service. The <code class="cCode">SYSID</code> and <code class="cCode">PROGRAM</code> values in the request identify the local system and the name of the local service. The <code class="cCode">TRANSID</code> option indicates the mirror transaction to be initiated.</li>
<li><a name="wp1055675"> </a>The <code class="cCode">PROGRAM</code> and mirror <code class="cCode">TRANSID</code> are extracted from the DPL request and are used to find an exact <code class="cCode">RNAME</code> match in the <code class="cCode">DM_LOCAL_SERVICES</code> section of the <code class="cCode">DMCONFIG</code> file.</li>
<li><a name="wp1055676"> </a>The service <code class="cCode">SERVICE1,</code> which is advertised locally in the ATMI platform application, is initiated.</li>
</ol></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1055434"> </a>
Additional Information
</h2><p class="pBody"><a name="wp1024611"> </a>
Additional information about CICS/ESA Intersystem Communications may be found in the following IBM publications:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1024612"> </a><span style="font-style: italic">CICS/ESA Intercommunication Guide</span>, IBM publication No. SC33-0657</li>
<li><a name="wp1024613"> </a><span style="font-style: italic">CICS/ESA Distributed Transaction Programming Guide</span>, IBM publication No. SC33-00783</li>
<li><a name="wp1024614"> </a><span style="font-style: italic">CICS/ESA Recovery and Restart Guide</span>, IBM publication No. SC33-0658</li>
</ul></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="prog.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="atmi.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq10" src="/global_resources/images/nexttop_disabled.gif" border="0" alt="Next" />
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
