<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41263" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux11gr1/trans/fm/gstrx.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="11/28/11 08:48:03" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Introducing Transactions</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Using CORBA Transactions
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="index.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="trxsvc.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/trans.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1068136"> </a>
Introducing Transactions
</h1>
<p class="pBody"><a name="wp1061592"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1033957"> </a><a href="gstrx.html#wp1018509">Overview of Transactions in Oracle Tuxedo CORBA Applications</a></li>
<li><a name="wp1033965"> </a><a href="gstrx.html#wp1034235">When to Use Transactions</a></li>
<li><a name="wp1018584"> </a><a href="gstrx.html#wp1030193">How to Use Transactions in Oracle Tuxedo CORBA Applications</a></li>
<li><a name="wp1018585"> </a><a href="gstrx.html#wp1018579">Writing a Transactions Sample Application</a></li>
</ul></div>
<a name="wp1068320"> </a><table class="Note">
<tr>
<td valign="top"><strong>Notes:</strong></td>
<td>The Oracle Tuxedo CORBA Java client and Oracle Tuxedo CORBA Java client ORB were deprecated in Tuxedo 8.1 and are no longer supported. All Oracle Tuxedo CORBA Java client and Oracle Tuxedo CORBA Java client ORB text references, associated code samples, should only be used to help implement/run third party Java ORB libraries, and for programmer reference only.</td></tr>
</table>

<a name="wp1068321"> </a><table class="Note">
<tr>
<td valign="top"><b class="texthide">Note:</b></td>
<td>Technical support for third party CORBA Java ORBs should be provided by their respective vendors. Oracle Tuxedo does not provide any technical support or documentation for third party CORBA Java ORBs.</td>
</tr>
</table>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1018509"> </a>
Overview of Transactions in Oracle Tuxedo CORBA Applications
</h2><p class="pBody"><a name="wp1033216"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1038035"> </a><a href="gstrx.html#wp1038034">ACID Properties of Transactions</a></li>
<li><a name="wp1066916"> </a><a href="gstrx.html#wp1066616">Resource Manager</a></li>
<li><a name="wp1038073"> </a><a href="gstrx.html#wp1066620">Supported Programming Model</a></li>
<li><a name="wp1038093"> </a><a href="gstrx.html#wp1032948">Supported API Model</a></li>
<li><a name="wp1038108"> </a><a href="gstrx.html#wp1019350">Support for Business Transactions</a></li>
<li><a name="wp1038121"> </a><a href="gstrx.html#wp1034232">Distributed Transactions and the Two-Phase Commit Protocol</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1038034"> </a>
ACID Properties of Transactions 
</h3>
<p class="pBody"><a name="wp1038029"> </a>
One of the most fundamental features of the Oracle Tuxedo system is transaction management. Transactions are a means to guarantee that database transactions are completed accurately and that they take on all the ACID properties (atomicity, consistency, isolation, and durability) of a high-performance transaction. Oracle Tuxedo protects the integrity of your transactions by providing a complete infrastructure for ensuring that database updates are done accurately, even across a variety of resource managers (RMs). If any one of the operations fails, the entire set of operations is rolled back.
</p>
<h3 class="pHeading2"><a name="wp1066616"> </a>
Resource Manager
</h3>
<p class="pBody"><a name="wp1066790"> </a>
A Resource Manager (RM) is a data repository, such as a database management system or the Oracle Tuxedo system&#8217;s Application Queuing Manager, with tools for accessing the data. The Oracle Tuxedo system uses one or more RMs to maintain the state of an application. For example, bank records in which account balances are maintained are kept in an RM. When the state of the application changes through a service that allows a customer to withdraw money from an account, the new balance in the account is recorded in the appropriate RM.
</p>
<p class="pBody"><a name="wp1066794"> </a>
The Oracle Tuxedo system helps you manage transactions involving resource managers that support the XA interface. To coordinate all the operations performed and all the modules affected by a transaction, the Oracle Tuxedo system plays the role of the Transaction Manager (TM).
</p>
<p class="pBody"><a name="wp1066796"> </a>
The TM coordinates global transactions involving system-wide resources. Local resource managers (RMs) are responsible for individual resources. The Transaction Manager Server (TMS) begins, commits, and aborts transactions involving multiple resources. The application code uses the normal embedded SQL interface to the RM to perform reads and updates. The TMS uses the XA interface to the RM to perform the work of a global transaction. 
</p>
<h3 class="pHeading2"><a name="wp1066620"> </a>
Supported Programming Model
</h3>
<p class="pBody"><a name="wp1066624"> </a>
Oracle Tuxedo supports the Object Management Group Common Object Request Broker (CORBA) in C++, in compliance with the <em class="cEmphasis">The Common Object Request Broker: Architecture and Specification</em>, Revision 2.4.2, January 2001.
</p>
<h3 class="pHeading2"><a name="wp1032948"> </a>
Supported API Model
</h3>
<p class="pBody"><a name="wp1025010"> </a>
Oracle Tuxedo supports the CORBA services Object Transaction Service (OTS). Oracle Tuxedo provides a C++ interface to the OTS and is based on the OTS. The OTS is accessed through the <code class="cCode">org.omg.CosTransactions.Current</code> environmental object. For information about using the <code class="cCode">TransactionCurrent</code> environmental object, see the &#8220;CORBA Bootstrapping Programming Reference&#8221; in the <span style="font-style: italic"><a href="../CORBA_ref/index.html"></span><em class="cEmphasis">CORBA Programming Reference</em><span class="cHyperlink">
</a></span>.
</p>
<a name="wp1065953"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Oracle Tuxedo also supports use of the CORBA Interoperable Naming Service (INS) bootstrapping mechanism. For information on INS, see the &#8220;CORBA Bootstrapping Programming Reference&#8221; in the <span style="font-style: italic"><a href="../CORBA_ref/index.html"></span><em class="cEmphasis">CORBA Programming Reference</em></a>.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1019350"> </a>
Support for Business Transactions
</h3>
<p class="pBody"><a name="wp1032978"> </a>
OTS provides the following support for your business transactions:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018980"> </a>Creates a global transaction identifier when a client application initiates a transaction.</li>
<li><a name="wp1018981"> </a>Works with the Oracle Tuxedo infrastructure to track objects that are involved in a transaction and, therefore, need to be coordinated when the transaction is ready to commit.</li>
<li><a name="wp1018982"> </a>Notifies the resource managers&#8212;which are, most often, databases&#8212;when they are accessed on behalf of a transaction. Resource managers then lock the accessed records until the end of the transaction.</li>
<li><a name="wp1018983"> </a>Orchestrates the two-phase commit when the transaction completes, which ensures that all the participants in the transaction commit their updates simultaneously. It coordinates the commit with any databases that are being updated using Open Group&#8217;s XA protocol. Almost all relational databases support this standard.</li>
<li><a name="wp1018984"> </a>Executes the rollback procedure when the transaction must be stopped.</li>
<li><a name="wp1034231"> </a>Executes a recovery procedure when failures occur. It determines which transactions were active in the machine at the time of the crash, and then determines whether the transaction should be rolled back or committed.</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1034232"> </a>
Distributed Transactions and the Two-Phase Commit Protocol
</h3>
<p class="pBody"><a name="wp1034233"> </a>
Oracle Tuxedo CORBA supports distributed transactions and the two-phase commit protocol for enterprise applications. A <span style="font-style: italic">distributed transaction</span> is a transaction that updates multiple resource managers (such as databases) in a coordinated manner. The <span style="font-style: italic">two-phase commit protocol (2PC)</span> is a method of coordinating a single transaction across one or more resource managers. It guarantees data integrity by ensuring that transactional updates are committed in all of the participating databases, or are fully rolled back out of all the databases, reverting to the state prior to the start of the transaction.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1034235"> </a>
When to Use Transactions
</h2><p class="pBody"><a name="wp1034238"> </a>
Transactions are appropriate in the situations described in the following list. Each situation describes a transaction model supported by Oracle Tuxedo CORBA.
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018883"> </a>The client application needs to make invocations on several objects, which may involve write operations to one or more databases. If any one invocation is unsuccessful, any state that is written (either in memory or, more typically, to a database) must be rolled back.</li>
<p class="pBodyRelative"><a name="wp1018884"> </a>
For example, consider a travel agent application. The client application needs to arrange for a journey to a distant location; for example, from Strasbourg, France, to Alice Springs, Australia. Such a journey would inevitably require multiple individual flight reservations. The client application works by reserving each individual segment of the journey in sequential order; for example, Strasbourg to Paris, Paris to New York, New York to Los Angeles. However, if any individual flight reservation cannot be made, the client application needs a way to cancel all the flight reservations made up to that point.
</p>
<li><a name="wp1018885"> </a>The client application needs a conversation with an object managed by the server application, and the client application needs to make multiple invocations on a specific object instance. The conversation may be characterized by one or more of the following:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1018886"> </a>Data is cached in memory or written to a database during or after each successive invocation.</li>
<li><a name="wp1018887"> </a>Data is written to a database at the end of the conversation.</li>
<li><a name="wp1018888"> </a>The client application needs the object to maintain an in-memory context between each invocation; that is, each successive invocation uses the data that is being maintained in memory across the conversation.</li>
<li><a name="wp1018889"> </a>At the end of the conversation, the client application needs the ability to cancel all database write operations that may have occurred during or at the end of the conversation.</li>
<p class="pBodyRelative"><a name="wp1018890"> </a>
For example, consider an Internet-based online shopping cart application. Users of the client application browse through an online catalog and make multiple purchase selections. When the users are done choosing all the items they want to buy, they proceed to check out and enter their credit card information to make the purchase. If the credit card check fails, the shopping application needs a way to cancel all the pending purchase selections in the shopping cart, or roll back any purchase transactions made during the conversation.
</p>
</ul></div>
<li><a name="wp1018891"> </a>Within the scope of a single client invocation on an object, the object performs multiple edits to data in a database. If one of the edits fails, the object needs a mechanism to roll back all the edits. (In this situation, the individual database edits are not necessarily CORBA.)</li>
<p class="pBodyRelative"><a name="wp1018892"> </a>
For example, consider a banking application. The client invokes the transfer operation on a teller object. The transfer operation requires the teller object to make the following invocations on the bank database:
</p>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1018893"> </a>Invoking the debit method on one account.</li>
<li><a name="wp1018894"> </a>Invoking the credit method on another account.</li>
<p class="pBodyRelative"><a name="wp1019129"> </a>
If the credit invocation on the bank database fails, the banking application needs a way to roll back the previous debit invocation.
</p>
</ul></div>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1030193"> </a>
How to Use Transactions in Oracle Tuxedo CORBA Applications
</h2><p class="pBody"><a name="wp1030210"> </a>
<a href="gstrx.html#wp1030195">Figure&#160;1-1</a> illustrates transactions in an Oracle CORBA application.
</p>
<div class="pFigureTitle"><a name="wp1030195"> </a>
Figure&#160;1-1  Transactions in an Oracle Tuxedo CORBA Application 
</div>

 
 <p class="pGraphic"><a name="wp1030030"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/trxcrbap.gif" height="298" width="552" alt="Transactions in an Oracle Tuxedo CORBA Application " id="wp1030028"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1026580"> </a>
The way you use transactions differs depending on whether you use the Oracle bootstrapping mechanism or the Interoperable Naming Service (INS) bootstrapping mechanism. 
</p>
<a name="wp1065980"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>You should use the Oracle bootstrapping mechanism if you are using Oracle Tuxedo CORBA client software. You should use the INS bootstrapping mechanism if you are using a third-party client.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1063689"> </a>
How to Use Transactions When Using the Oracle Bootstrapping Mechanism
</h3>
<p class="pBody"><a name="wp1063682"> </a>
When the Oracle proprietary Bootstrapping mechanism is used, you use a basic transaction in the following way: 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1019324"> </a>The client application uses the Bootstrap object to return an object reference to the TransactionCurrent object for the Oracle Tuxedo domain.</li>
<li><a name="wp1029294"> </a>A client application begins a transaction using the <code class="cCode">Tobj::TransactionCurrent::begin()</code> operation, and issues a request to the CORBA interface through the TP Framework. All operations on the CORBA interface execute within the scope of a transaction.</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1022493"> </a>If a call to any of these operations raises an exception (either explicitly or as a result of a communication failure), the exception can be caught.</li>
<li><a name="wp1066434"> </a>If all the changes that need to occur have taken place successfully, and the state of the database (or objects) is consistent, then the transaction should be committed; otherwise, the transaction should be rolled back.</li>
<li><a name="wp1019326"> </a>The client application commits the current transaction using the <code class="cCode">Tobj::TransactionCurrent::commit()</code> operation. This operation ends the transaction and starts the processing of the operation. The&#160;transaction is committed only if all of the participants in the transaction agree to commit. </li>
</ul></div>
<li><a name="wp1024188"> </a>The <code class="cCode">Tobj::TransactionCurrent:commit()</code> operation causes the TP Framework to call the transaction manager to complete the transaction.</li>
<li><a name="wp1030330"> </a>The transaction manager is responsible for coordinating with the resource managers to update the database.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1065192"> </a>
How to Use Transactions When Using the INS Bootstrapping Mechanism
</h3>
<p class="pBody"><a name="wp1065193"> </a>
When you use CORBA services Interoperable Naming Service (INS) bootstrapping mechanism is used, you use a basic transaction in the following way:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1065194"> </a>The client application uses the <code class="cCode">ORB::resolve_initial_references()</code> operation to get a FactoryFinder object for the Oracle Tuxedo domain.</li>
<li><a name="wp1065198"> </a>The client application uses the FactoryFinder to get a TransactionFactory. </li>
<a name="wp1065199"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The TransactionFactory returns objects that adhere to the standard CORBA Services Transaction Service interfaces instead of the Oracle delegated interfaces. This means that a third-party client can use their ORB&#8217;s <code class="cCode">resolve_initial_references()</code> function to get the TransactionFactory from an Oracle Tuxedo CORBA server and use stubs generated from standard OMG IDL to act on the instances returned.</td>
</tr>
</table>

<li><a name="wp1065203"> </a>The client application then uses the <code class="cCode">create()</code> operation on the TransactionFactory to begin a transaction and issues a request to the CORBA interface through the TP Framework. </li>
<li><a name="wp1065204"> </a>From the Control object returned from the <code class="cCode">create()</code> operation, the client application uses the <code class="cCode">get_terminator()</code> operation to get the transaction Terminator interface.</li>
<li><a name="wp1065205"> </a>The client application then uses the <code class="cCode">commit()</code> or <code class="cCode">rollback()</code> operation on the Terminator interface to end or abort the transaction. The <code class="cCode">commit()</code> operation causes the TP Framework to call the transaction manager to complete the transaction.</li>
<li><a name="wp1065206"> </a>The transaction manager is responsible for coordinating with the resource managers to update the database.</li>
</ol></div>
<a name="wp1065207"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>All operations on the CORBA interface execute within the scope of a transaction.</td>
</tr>
</table>

<div class="pSmartList1NoteBullet"><ul>
<li><a name="wp1065208"> </a>If a call to any of these operations raises an exception (either explicitly or as a result of a communication failure), the exception can be caught.</li>
<li><a name="wp1066453"> </a>If all the changes that need to occur have taken place successfully, and the state of the database (or objects) is consistent, then the transaction should be committed; otherwise, the transaction should be rolled back.</li>
<li><a name="wp1065209"> </a>The client application commits the current transaction using the <code class="cCode">Terminator::commit()</code> operation. This operation ends the transaction and starts the processing of the operation. The&#160;transaction is committed only if all of the participants in the transaction agree to commit. </li>
</ul></div>
<a name="wp1065995"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>For more information on INS, see the &#8220;CORBA Bootstrapping Programming Reference&#8221; in the <a href="../CORBA_ref/index.html">CORBA Programming Reference</a></a>. </td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1018579"> </a>
Writing a Transactions Sample Application
</h2><p class="pBody"><a name="wp1030554"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1030583"> </a><a href="gstrx.html#wp1038231">Workflow for the Transactions Sample Application</a></li>
<li><a name="wp1063370"> </a><a href="gstrx.html#wp1020129">Development Steps</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1038231"> </a>
Workflow for the Transactions Sample Application
</h3>
<p class="pBody"><a name="wp1063150"> </a>
In the Transactions sample CORBA application, the operation of registering for courses is executed within the scope of a transaction. The transaction model used in the Transactions sample application is a combination of the conversational model and the model in which a single client invocation makes multiple individual operations on a database.
</p>
<p class="pBody"><a name="wp1063148"> </a>
The Transactions sample application works in the following way:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1020233"> </a>Students submit a list of courses for which they want to be registered.</li>
<li><a name="wp1020234"> </a>For each course in the list, the server application checks whether:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1020235"> </a>The course is in the database.</li>
<li><a name="wp1020236"> </a>The student is already registered for a course.</li>
<li><a name="wp1020237"> </a>The student exceeds the maximum number of credits the student can take.</li>
</ul></div>
<li><a name="wp1020238"> </a>One of the following occurs:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1020239"> </a>If the course meets all the criteria, the server application registers the student for the course.</li>
<li><a name="wp1020240"> </a>If the course is not in the database or if the student is already registered for the course, the server application adds the course to a list of courses for which the student could not be registered. After processing all the registration requests, the server application returns the list of courses for which registration failed. The client application can then choose to either commit the transaction (thereby registering the student for the courses for which registration request succeeded) or to roll back the transaction (thus, not registering the student for any of the courses).</li>
<li><a name="wp1020242"> </a>If the student exceeds the maximum number of credits the student can take, the server application returns a <code class="cCode">TooManyCredits</code> user exception to the client application. The client application provides a brief message explaining that the request was rejected. The client application then rolls back the transaction. </li>
</ul></div>
</ol></div>
<p class="pBody"><a name="wp1020247"> </a>
<a href="gstrx.html#wp1020825">Figure&#160;1-2</a> illustrates how the Transactions sample application works. 
</p>
<div class="pFigureTitle"><a name="wp1020825"> </a>
Figure&#160;1-2  Transactions Sample Application
</div>

 
 <p class="pGraphic"><a name="wp1023732"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/trxcrbsm.gif" height="298" width="554" alt="Transactions Sample Application" id="wp1023735"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1025426"> </a>
The Transactions sample application shows two ways in which a transaction can be rolled back:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1025636"> </a><span style="font-weight: bold">Nonfatal</span>. If the registration for a course fails because the course is not in the database, or because the student is already registered for the course, the server application returns the numbers of those courses to the client application. The decision to roll back the transaction lies with the user of the client application (and the Transaction client application code rolls back the transaction automatically in this case).</li>
<li><a name="wp1025637"> </a><span style="font-weight: bold">Fatal</span>. If the registration for a course fails because the student exceeds the maximum number of credits he or she can take, the server application generates a CORBA exception and returns it to the client. The decision to roll back the transaction also lies with the client application.</li>
<p class="pBodyRelative"><a name="wp1025638"> </a>
Thus, the Transactions sample application also shows how to implement user-defined CORBA exceptions. For example, if the student tries to register for a course that would exceed the maximum number of courses for which the student can register, the server application returns the <code class="cCode">TooManyCredits</code> exception. When the client application receives this exception, the client application rolls back the transaction automatically.
</p>
</ul></div>
<a name="wp1023177"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>For information about how transactions are implemented in Oracle Tuxedo CORBA applications, see the <span style="font-style: italic"><a href=""></span>Transactions Sample<span style="font-style: italic"></a></span> in the Oracle Tuxedo online documentation.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1020129"> </a>
Development Steps 
</h3>
<p class="pBody"><a name="wp1019162"> </a>
This topic describes the following development steps for writing an Oracle Tuxedo application that contains transaction processing code:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1030486"> </a><a href="gstrx.html#wp1021901">Step 1: Writing the OMG IDL</a></li>
<li><a name="wp1030497"> </a><a href="gstrx.html#wp1052200">Step 2: Defining Transaction Policies for the Interfaces</a></li>
<li><a name="wp1045253"> </a><a href="gstrx.html#wp1051878">Step 3: Writing the Server Application</a></li>
<li><a name="wp1030531"> </a><a href="gstrx.html#wp1066017">Step 4: Writing the Client Application</a></li>
<li><a name="wp1030421"> </a><a href="gstrx.html#wp1023471">Step 5: Creating a Configuration File</a></li>
</ul></div>
<p class="pBody"><a name="wp1038181"> </a>
The Transactions sample application is used to demonstrate these development steps. The source files for the Transactions sample application are located in the <code class="cCode">\samples\corba\university </code>directory of the Oracle Tuxedo software. For information about building and running the Transactions sample application, see the <span style="font-style: italic"><a href=""></span>Transactions Sample<span style="font-style: italic"></a></span> in the Oracle Tuxedo online documentation. 
</p>
<h4 class="pHeading3"><a name="wp1021901"> </a>
Step 1: Writing the OMG IDL 
</h4>
<p class="pBody"><a name="wp1019173"> </a>
You need to specify interfaces involved in transactions in Object Management Group (OMG) Interface Definition Language (IDL) just as you would any other CORBA interface. You must also specify any user exceptions that might occur from using the interface.
</p>
<p class="pBody"><a name="wp1020305"> </a>
For the Transactions sample application, you would define in OMG IDL the <code class="cCode">Registrar</code> interface and the <code class="cCode">register_for_courses()</code> operation. The <code class="cCode">register_for_courses()</code> operation has a parameter, <code class="cCode">NotRegisteredList</code>, which returns to the client application the list of courses for which registration failed. If the value of <code class="cCode">NotRegisteredList</code> is empty, then the client application commits the transaction. You also need to define the <code class="cCode">TooManyCredits</code> user exception.
</p>
<p class="pBody"><a name="wp1021089"> </a>
<a href="gstrx.html#wp1021105">Listing&#160;1-1</a> includes the OMG IDL for the Transactions sample application.
</p>
<div class="pCodeTitle"><a name="wp1021105"> </a>
Listing&#160;1-1	   OMG IDL for the Transactions Sample Application 
</div> <a name="wp1022770"> </a><div class="pPreformatted"><pre>#pragma prefix &quot;beasys.com&quot;<br />module UniversityT</pre></div><a name="wp1022771"> </a><div class="pPreformatted"><pre>{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;typedef unsigned long CourseNumber;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;typedef sequence&lt;CourseNumber&gt; CourseNumberList;<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct CourseSynopsis<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CourseNumber   course_number;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string         title;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;typedef sequence&lt;CourseSynopsis&gt; CourseSynopsisList;<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;interface CourseSynopsisEnumerator<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;//Returns a list of length 0 if there are no more entries<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;CourseSynopsisList get_next_n(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in  unsigned long number_to_get, // 0 = return all<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;out unsigned long number_remaining<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;);<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;void destroy();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;typedef unsigned short Days;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;const Days MONDAY    =  1;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;const Days TUESDAY   =  2;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;const Days WEDNESDAY =  4;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;const Days THURSDAY  =  8;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;const Days FRIDAY    = 16;<br />}<br />//Classes restricted to same time block on all scheduled days, <br />//starting on the hour</pre></div><a name="wp1068624"> </a><div class="pPreformatted"><pre>struct ClassSchedule<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;Days           class_days; // bitmask of days<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;unsigned short start_hour; // whole hours in military time<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;unsigned short duration;   // minutes<br />};<br />struct CourseDetails<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;CourseNumber   course_number;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;double         cost;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;unsigned short number_of_credits;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;ClassSchedule  class_schedule;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;unsigned short number_of_seats;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;string         title;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;string         professor;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;string         description;<br />};<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;typedef sequence&lt;CourseDetails&gt; CourseDetailsList;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;typedef unsigned long StudentId;</pre></div><a name="wp1022775"> </a><div class="pPreformatted"><pre>struct StudentDetails<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;StudentId         student_id;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;string            name;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;CourseDetailsList registered_courses;<br />};<br />enum NotRegisteredReason<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;AlreadyRegistered,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;NoSuchCourse<br />};<br />struct NotRegistered<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;CourseNumber        course_number;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;NotRegisteredReason not_registered_reason;<br />};<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;typedef sequence&lt;NotRegistered&gt; NotRegisteredList;</pre></div><a name="wp1068706"> </a><div class="pPreformatted"><pre>exception TooManyCredits<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;unsigned short maximum_credits;<br />};<br />//The Registrar interface is the main interface that allows<br />//students to access the database.<br />interface Registrar<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;CourseSynopsisList<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;get_courses_synopsis(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in string                    search_criteria,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in unsigned long             number_to_get,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;out unsigned long            number_remaining,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;out CourseSynopsisEnumerator rest<br />);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;CourseDetailsList get_courses_details(in CourseNumberList<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;courses);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;StudentDetails get_student_details(in StudentId student);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;NotRegisteredList register_for_courses(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in StudentId        student,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in CourseNumberList courses<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;raises (<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TooManyCredits<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;);<br />};<br />// The RegistrarFactory interface finds Registrar interfaces.<br />interface RegistrarFactory<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;Registrar find_registrar(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;);<br />};</pre></div><h4 class="pHeading3"><a name="wp1052200"> </a>
Step 2: Defining Transaction Policies for the Interfaces
</h4>
<p class="pBody"><a name="wp1052201"> </a>
Transaction policies are used on a per-interface basis. During design, it is decided which interfaces within an Oracle Tuxedo application will handle transactions.<span style="font-weight: bold"> </span><a href="gstrx.html#wp1030935">Table&#160;1-1</a> describes the CORBA transaction policies. 
</p>
<p class="pGraphic"><a name="wp1021250"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1030935table1021263"><caption><a name="wp1030935"> </a>
Table 1-1  <span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">CORBA Transaction Policies&#160;</span>

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1021265"> </a>
Transaction Policy
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1021267"> </a>
Description
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023879"> </a>
<code class="cCode">always</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023881"> </a>
The interface must always be part of a transaction. If the interface is not part of a transaction, a transaction will be automatically started by the TP Framework.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023901"> </a>
<code class="cCode">ignore</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023903"> </a>
The interface is not transactional. However, requests made to this interface within a scope of a transaction are allowed. The AUTOTRAN parameter, specified in the UBBCONFIG file for this interface, is ignored. 
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021269"> </a>
<code class="cCode">never</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021271"> </a>
The interface is not transactional. Objects created for this interface can never be involved in a transaction. The Oracle Tuxedo system generates an exception (<code class="cCode">INVALID_TRANSACTION</code>) if an interface with this policy is involved in a transaction.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021273"> </a>
<code class="cCode">optional</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021275"> </a>
The interface may be transactional. Objects can be involved in a transaction if the request is transactional. This transaction policy is the default.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1020907"> </a>
During development, you decide which interfaces will execute in a transaction by assigning transaction policies. You specify transaction policies in the Implementation Configuration File (ICF). A template ICF file is created by the <code class="cCode">genicf </code>command. For more information about the ICFs, see &#8220;Implementation Configuration File (ICF)&#8221; in the<a href="../CORBA_ref/index.html"> <span style="font-style: italic"><a href=""></span><em class="cEmphasis">CORBA Programming Reference</em><span class="cHyperlink">
</a></span>.
</p>
<p class="pBody"><a name="wp1051874"> </a>
In the Transactions sample application, the transaction policy of the <code class="cCode">Registrar </code>interface is set to <code class="cCode">always</code>.
</p>
<h4 class="pHeading3"><a name="wp1051878"> </a>
Step 3: Writing the Server Application 
</h4>
<p class="pBody"><a name="wp1051879"> </a>
When using transactions in server applications, you need to write methods that implement the interface&#8217;s operations. In the Transactions sample application, you would write a method implementation for the <code class="cCode">register_for_courses()</code> operation.
</p>
<p class="pBody"><a name="wp1022115"> </a>
If your Oracle Tuxedo application uses a database, you need to include in the server application code that opens and closes an XA resource manager. These operations are included in the <code class="cCode">Server::initialize()</code> and <code class="cCode">Server::release()</code> operations of the Server object. <a href="gstrx.html#wp1063540">Listing&#160;1-2</a> shows the portion of the code for the Server object in the Transactions sample application that opens and closes the XA resource manager. 
</p>
<a name="wp1063527"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>For a complete example of a CORBA server application that implements transactions, see the <span style="font-style: italic"><a href=""></span>Transactions Sample<span style="font-style: italic"></a></span> in the Oracle Tuxedo online documentation.</td>
</tr>
</table>

<div class="pCodeTitle"><a name="wp1063540"> </a>
Listing&#160;1-2	   C++ Server Object in Transactions Sample Application 
</div> <a name="wp1023470"> </a><div class="pPreformatted"><pre>CORBA::Boolean Server::initialize(int argc, char* argv[])<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TRACE_METHOD(&quot;Server::initialize&quot;);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;try {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;open_database();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;begin_transactional();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;register_fact();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return CORBA_TRUE;<br />}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;catch (CORBA::Exception&amp; e) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LOG(&#8220;CORBA exception : &#8220; &lt;&lt;e);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;catch (SamplesDBException&amp; e) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LOG(&#8220;Can&#8217;t connect to database&#8221;);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;catch (...) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LOG(&#8220;Unexpected database error : &#8220; &lt;&lt;e);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;catch (...) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LOG(&#8220;Unexpected exception&#8221;);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;cleanup();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;return CORBA_FALSE;<br />}<br /><br />void Server::release()<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TRACE_METHOD(&#8220;Server::release&#8221;);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;cleanup();<br />}<br />static void cleanup()<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;unregister_factory();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;end_transactional();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;close_database();<br />}<br />//Utilities to manage transaction resource manager<br /><br />CORBA::Boolean s_became_transactional = CORBA_FALSE;<br />static void begin_transactional()<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TP::open_xa_rm();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;s_became_transactional = CORBA_TRUE;<br />}<br />static void end_transactional()<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;if(!s_became_transactional){<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;return//cleanup not necessary<br />}<br />try {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TP::close_xa_rm ();<br />}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;catch (CORBA::Exception&amp; e) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LOG(&#8220;CORBA Exception : &#8220; &lt;&lt; e);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;catch (...) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LOG(&#8220;unexpected exception&#8221;);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;s_became_transactional = CORBA_FALSE;<br />}</pre></div><h4 class="pHeading3"><a name="wp1066017"> </a>
Step 4: Writing the Client Application 
</h4>
<p class="pBody"><a name="wp1045372"> </a>
The client application needs code that performs the following tasks:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1045373"> </a>Obtains a reference to the TransactionCurrent object from the Bootstrap object.</li>
<li><a name="wp1045374"> </a>Begins a transaction by invoking the <code class="cCode">Tobj::TransactionCurrent::begin()</code> operation on the TransactionCurrent object.</li>
<li><a name="wp1045375"> </a>Invokes operations on the object. In the Transactions sample application, the client application invokes the <code class="cCode">register_for_courses()</code> operation on the Registrar object, passing a list of courses.</li>
</ol></div>
<p class="pBody"><a name="wp1045379"> </a>
<a href="gstrx.html#wp1045389">Listing&#160;1-3</a> shows the portion of the CORBA C++ client applications in the Transactions sample application that illustrates the development steps for transactions. 
</p>
<a name="wp1066027"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The sample code shown in <a href="gstrx.html#wp1045389">Listing&#160;1-3</a> illustrates how to use the Oracle bootstrapping mechanism. For information on how to use the INS bootstrapping mechanism, see the &#8220;CORBA Bootstrapping Programming Reference&#8221; in the <a href="../CORBA_ref/index.html">CORBA Programming Reference</a>.</td>
</tr>
</table>

<div class="pCodeTitle"><a name="wp1045389"> </a>
Listing&#160;1-3	   <b class="cBold">Transactions Code for CORBA C++ Client Applications </b>
</div> <a name="wp1069018"> </a><div class="pPreformatted"><pre>CORBA::Object_var var_transaction_current_oref =  <br />&#160;&#160;&#160;&#160;&#160;Bootstrap.resolve_initial_references(&#8220;TransactionCurrent&#8221;);<br />CosTransactions::Current_var transaction_current_oref=<br />&#160;&#160;&#160;&#160;&#160;CosTransactions::Current::_narrow(var_transaction_current_oref.in());<br /><code class="cCode">//Begin the transaction<br />var_transaction_current_oref-&gt;begin();<br />try {<br />//Perform the operation inside the transaction<br />&#160;&#160;&#160;&#160;pointer_Registar_ref-&gt;register_for_courses(student_id, course_number_list);<br /></code>&#160;&#160;&#160;&#160;&#160;<code class="cCode">...<br />//If operation executes with no errors, commit the transaction:<br /></code>&#160;&#160;&#160;&#160;&#160;<code class="cCode">CORBA::Boolean report_heuristics = CORBA_TRUE;<br /></code>&#160;&#160;&#160;&#160;&#160;<code class="cCode">var_transaction_current_ref-&gt;commit(report_heuristics);<br /></code>&#160;&#160;&#160;&#160;<code class="cCode">}<br />catch (...) {<br />//If the operation has problems executing, rollback the <br />//transaction. Then throw the original exception again.<br />//If the rollback fails, ignore the exception and throw the<br />//original exception again.        <br />try {<br /></code>&#160;&#160;&#160;&#160;<code class="cCode">&#160;var_transaction_current_ref-&gt;rollback();<br /></code>&#160;&#160;&#160;&#160;<code class="cCode">}<br />catch (...) {<br /></code>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<code class="cCode">TP::userlog(&quot;rollback failed&quot;);<br /></code>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<code class="cCode">}<br />throw;<br />}</code></pre></div><h4 class="pHeading3"><a name="wp1023471"> </a>
Step 5: Creating a Configuration File
</h4>
<p class="pBody"><a name="wp1019207"> </a>
You need to add the following information to the configuration file for a transactional Oracle Tuxedo application:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1022278"> </a>In the <code class="cCode">GROUPS</code> section:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1040926"> </a>In the <code class="cCode">OPENINFO</code> parameter, include the information needed to open the resource manager for the database. You obtain this information from the product documentation for your database. Note that the default version of the <code class="cCode">com.beasys.Tobj.Server.initialize</code> method automatically opens the resource manager.</li>
<li><a name="wp1045481"> </a>In the <code class="cCode">CLOSEINFO</code> parameter, include the information needed to close the resource manager for the database. By default, the <code class="cCode">CLOSEINFO</code> parameter is empty.</li>
<li><a name="wp1040949"> </a>Specify the <code class="cCode">TMSNAME</code> and <code class="cCode">TMSCOUNT</code> parameters to associate the XA resource manager with a specified server group.</li>
</ul></div>
<li><a name="wp1040989"> </a>In the <code class="cCode">SERVERS</code> section, define a server group that includes both the server application that includes the interface and the server application that manages the database. This server group needs to be specified as transactional.</li>
<li><a name="wp1019214"> </a>Include the pathname to the transaction log (<code class="cCode">TLOG</code>) in the <code class="cCode">TLOGDEVICE</code> parameter. For more information about the transaction log, see <a href="admtrx.html">Administering Transactions.</a> </li>
</ul></div>
<p class="pBody"><a name="wp1019215"> </a>
<a href="gstrx.html#wp1022290">Listing&#160;1-4</a> includes the portions of the configuration file that define this information for the Transactions sample application.
</p>
<div class="pCodeTitle"><a name="wp1022290"> </a>
Listing&#160;1-4	   Configuration File for Transactions Sample Application 
</div> <a name="wp1045476"> </a><div class="pPreformatted"><pre>*RESOURCES<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;IPCKEY    55432<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;DOMAINID  university<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;MASTER    SITE1<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;MODEL     SHM<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;LDBAL     N<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;SECURITY  APP_PW		</pre></div><a name="wp1045477"> </a><div class="pPreformatted"><pre>*MACHINES<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;BLOTTO<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;LMID = SITE1<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;APPDIR = C:\TRANSACTION_SAMPLE<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TUXCONFIG=C:\TRANSACTION_SAMPLE\tuxconfig<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TLOGDEVICE=C:\APP_DIR\TLOG<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TLOGNAME=TLOG<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TUXDIR=&quot;C:\tuxdir&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAXWSCLIENTS=10</pre></div><a name="wp1022954"> </a><div class="pPreformatted"><pre>*GROUPS<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;SYS_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LMID      = SITE1<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GRPNO     = 1<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;ORA_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LMID      = SITE1<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GRPNO     = 2</pre></div><a name="wp1022955"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;OPENINFO  = &quot;ORACLE_XA:Oracle_XA+SqlNet=ORCL+Acc=P<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;/scott/tiger+SesTm=100+LogDir=.+MaxCur=5&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;CLOSEINFO = &quot;&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TMSNAME   = &quot;TMS_ORA&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TMSCOUNT  = 2</pre></div><a name="wp1022956"> </a><div class="pPreformatted"><pre>*SERVERS<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;DEFAULT:<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;RESTART = Y<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAXGEN  = 5<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;TMSYSEVT<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVGRP  = SYS_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVID   = 1</pre></div><a name="wp1022957"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;TMFFNAME<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVGRP  = SYS_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVID   = 2<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CLOPT   = &quot;-A -- -N -M&quot;</pre></div><a name="wp1022958"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;TMFFNAME<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVGRP  = SYS_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVID   = 3<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CLOPT   = &quot;-A -- -N&quot;</pre></div><a name="wp1022959"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;TMFFNAME<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVGRP  = SYS_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVID   = 4<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CLOPT   = &quot;-A -- -F&quot;</pre></div><a name="wp1022960"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;TMIFRSVR<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; SRVGRP  = SYS_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVID   = 5<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;UNIVT_SERVER<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVGRP  = ORA_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVID   = 1<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;RESTART = N</pre></div><a name="wp1022961"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;ISL<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVGRP  = SYS_GRP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SRVID   = 6<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CLOPT   = -A -- -n //MACHINENAME:2500</pre></div><a name="wp1022962"> </a><div class="pPreformatted"><pre>*SERVICES</pre></div><p class="pBody"><a name="wp1033720"> </a>
For information about the transaction log and defining parameters in the Configuration file, see <a href="admtrx.html">Administering Transactions.</a>
</p>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="gstrx.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="index.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="trxsvc.html"><img id="LongDescNotReq10" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
