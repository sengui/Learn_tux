<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41263" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux11gr1/trans/fm/trxcrbsr.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="11/28/11 08:48:05" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Transactions in CORBA Server Applications</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Using CORBA Transactions
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="trxsvc.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="trxcrbcl.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/trans.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1051344"> </a>
Transactions in CORBA Server Applications
</h1>
<p class="pBody"><a name="wp1027820"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018513"> </a><a href="trxcrbsr.html#wp1024435">Integrating Transactions in an Oracle Tuxedo Client and Server Application</a></li>
<li><a name="wp1019567"> </a><a href="trxcrbsr.html#wp1018702">Transactions and Object State Management</a></li>
<li><a name="wp1024426"> </a><a href="trxcrbsr.html#wp1022159">User-defined Exceptions</a></li>
</ul></div>
<p class="pBody"><a name="wp1024430"> </a>
These sections describe how to integrate transactions into an Oracle Tuxedo server application. Before you begin, you should read <a href="gstrx.html">Introducing Transactions.</a>
</p>
<a name="wp1051452"> </a><table class="Note">
<tr>
<td valign="top"><strong>Notes:</strong></td>
<td>The Oracle Tuxedo CORBA Java client and Oracle Tuxedo CORBA Java client ORB were deprecated in Tuxedo 8.1 and are no longer supported. All Oracle Tuxedo CORBA Java client and Oracle Tuxedo CORBA Java client ORB text references, associated code samples, should only be used to help implement/run third party Java ORB libraries, and for programmer reference only.</td></tr>
</table>

<a name="wp1051453"> </a><table class="Note">
<tr>
<td valign="top"><b class="texthide">Note:</b></td>
<td>Technical support for third party CORBA Java ORBs should be provided by their respective vendors. Oracle Tuxedo does not provide any technical support or documentation for third party CORBA Java ORBs.</td>
</tr>
</table>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1024435"> </a>
Integrating Transactions in an Oracle Tuxedo Client and Server Application
</h2><p class="pBody"><a name="wp1027836"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1027845"> </a><a href="trxcrbsr.html#wp1027837">Transaction Support in CORBA Applications</a></li>
<li><a name="wp1027916"> </a><a href="trxcrbsr.html#wp1018583">Making an Object Automatically Transactional</a></li>
<li><a name="wp1027917"> </a><a href="trxcrbsr.html#wp1018614">Enabling an Object to Participate in a Transaction</a></li>
<li><a name="wp1027938"> </a><a href="trxcrbsr.html#wp1018638">Preventing an Object from Being Invoked While a Transaction Is Scoped</a></li>
<li><a name="wp1027939"> </a><a href="trxcrbsr.html#wp1018656">Excluding an Object from an Ongoing Transaction</a></li>
<li><a name="wp1027957"> </a><a href="trxcrbsr.html#wp1018674">Assigning Policies</a></li>
<li><a name="wp1027973"> </a><a href="trxcrbsr.html#wp1043982">Using an XA Resource Manager</a></li>
<li><a name="wp1027982"> </a><a href="trxcrbsr.html#wp1018691">Opening an XA Resource Manager</a></li>
<li><a name="wp1027993"> </a><a href="trxcrbsr.html#wp1018698">Closing an XA Resource Manager</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1027837"> </a>
Transaction Support in CORBA Applications
</h3>
<p class="pBody"><a name="wp1018559"> </a>
Oracle Tuxedo supports transactions in the following ways:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018560"> </a>The client or the server application can begin and end transactions explicitly by using calls on the TransactionCurrent object. For details about the TransactionCurrent object, see <a href="trxcrbcl.html">Transactions in CORBA Client Applications.</a></li>
<li><a name="wp1018564"> </a>You can assign transactional policies to an object&#8217;s interface so that when the object is invoked, the Oracle Tuxedo<span style="font-style: normal"> </span>system can start a transaction automatically for that object, if a transaction has not already been started, and commit or roll back the transaction when the method invocation is complete. You use transactional policies on objects in conjunction with an XA resource manager and database when you want to delegate all the transaction commit and rollback responsibilities to that resource manager.</li>
<li><a name="wp1018568"> </a>Objects involved in a transaction can force a transaction to be rolled back. That is, after an object has been invoked within the scope of a transaction, the object can invoke <code class="cCode">rollback_only()</code> on the TransactionCurrent object to mark the transaction for rollback only. This prevents the current transaction from being committed. An object may need to mark a transaction for rollback if an entity, typically a database, is otherwise at risk of being updated with corrupt or inaccurate data.</li>
<li><a name="wp1018569"> </a>Objects involved in a transaction can be kept in memory from the time they are first invoked until the moment when the transaction is ready to be committed or rolled back. In the case of a transaction that is about to be committed, these objects are polled by the Oracle Tuxedo system immediately before the resource managers prepare to commit the transaction. In this sense, polling means invoking the object&#8217;s <code class="cCode">Tobj_ServantBase::deactivate_object()</code> operation and passing a reason value.</li>
<p class="pBodyRelative"><a name="wp1018573"> </a>
When an object is polled, the object may veto the current transaction by invoking <code class="cCode">rollback_only()</code> on the TransactionCurrent object. In addition, if the current transaction is to be rolled back, objects have an opportunity to skip any writes to a database. If no object vetoes the current transaction, the transaction is committed.
</p>
</ul></div>
<p class="pBody"><a name="wp1018574"> </a>
The following sections explain how you can use object activation policies and transaction policies to determine the transactional behavior you want in your objects. Note that these policies apply to an interface and, therefore, to all operations on all objects implementing that interface.
</p>
<a name="wp1018575"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If a server application manages an object that you want to be able to participate in a transaction, the Server object for that application must invoke the <code class="cCode">TP::open_xa_rm()</code> and <code class="cCode">TP::close_xa_rm()</code> operations. For more information about database connections, see <a href="trxcrbsr.html#wp1018691">Opening an XA Resource Manager</a>.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1018583"> </a>
Making an Object Automatically Transactional 
</h3>
<p class="pBody"><a name="wp1018586"> </a>
The Oracle Tuxedo system provides the <code class="cCode">always</code> transactional policy, which you can define on an object&#8217;s interface to have the Oracle Tuxedo system start a transaction automatically when that object is invoked and a transaction has not already been scoped. When an invocation on that object is completed, the Oracle Tuxedo system commits or rolls back the transaction automatically. Neither the server application, nor the object implementation, needs to invoke the TransactionCurrent object in this situation; the Oracle Tuxedo system automatically invokes the TransactionCurrent object on behalf of the server application.
</p>
<p class="pBody"><a name="wp1018597"> </a>
Assign the <code class="cCode">always</code> transactional policy to an object&#8217;s interface when:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018598"> </a>The object writes to a database and you want all the database commit or rollback responsibilities delegated to an XA resource manager whenever this object is invoked.</li>
<li><a name="wp1018599"> </a>You want to give the client application the opportunity to include the object in a larger transaction that encompasses invocations on multiple objects, and the invocations must all succeed or be rolled back if any one invocation fails.</li>
</ul></div>
<p class="pBody"><a name="wp1018600"> </a>
If you want an object to be automatically transactional, assign the following policies to that object&#8217;s interface in the Implementation Configuration File:
</p>
<p class="pGraphic"><a name="wp1018610"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1018603table1018601">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1018603"> </a>
<span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">Activation Policies</span>
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1018605"> </a>
Transaction Policy
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1018607"> </a><code class="cCode">process</code></li>
<li><a name="wp1036024"> </a><code class="cCode">method</code></li>
<li><a name="wp1036029"> </a><code class="cCode">transaction</code></li>
</ul></div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018609"> </a>
<code class="cCode">always</code>
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<a name="wp1021235"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Database cursors cannot span transactions. However, in C++, the CourseSynopsisEnumerator object in the Oracle Tuxedo University sample applications uses a database cursor to find matching course synopses from the University database. Because database cursors cannot span transactions, the <code class="cCode">activate_object()</code> operation on the CourseSynopsisEnumerator object reads all matching course synopses into memory. Note that the cursor is managed by an iterator class and is thus not visible to the CourseSynopsisEnumerator object.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1018614"> </a>
Enabling an Object to Participate in a Transaction 
</h3>
<p class="pBody"><a name="wp1018615"> </a>
If you want an object to be able to be invoked within the scope of a transaction, you can assign the <code class="cCode">optional</code> transaction policies to that object&#8217;s interface. The <code class="cCode">optional</code> transaction policy may be appropriate for an object that does not perform any database write operations, but that you want to have the ability to be invoked during a transaction.
</p>
<p class="pBody"><a name="wp1018616"> </a>
You can use the following policies, when they are specified in the Implementation Configuration File for that object&#8217;s interface, to make an object optionally transactional:
</p>
<p class="pGraphic"><a name="wp1018626"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1018619table1018617">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1018619"> </a>
Activation Policies
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1018621"> </a>
Transaction Policy
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1018623"> </a><code class="cCode">process</code></li>
<li><a name="wp1036039"> </a><code class="cCode">method</code></li>
<li><a name="wp1036044"> </a><code class="cCode">transaction</code></li>
</ul></div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018625"> </a>
<code class="cCode">optional</code>
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1018627"> </a>
When the transaction policy is <code class="cCode">optional</code>, if the <code class="cCode">AUTOTRAN</code> parameter is enabled in the application&#8217;s <code class="cCode">UBBCONFIG</code> file, the implementation is transactional. Servers containing transactional objects must be configured within a group associated with an XA-compliant resource manager.
</p>
<p class="pBody"><a name="wp1018628"> </a>
If the object does perform database write operations, and you want the object to be able to participate in a transaction, assigning the <code class="cCode">always</code> transactional policy is generally a better choice. However, if you prefer, you can use the <code class="cCode">optional</code> policy and encapsulate any write operations within invocations on the TransactionCurrent object. That is, within your operations that write data, scope a transaction around the write statements by invoking the TransactionCurrent object to, respectively, begin and commit or roll back the transaction, if the object is not already scoped within a transaction. This ensures that any database write operations are handled transactionally. This also introduces a performance efficiency: if the object is not invoked within the scope of a transaction, all the database read operations are nontransactional, and, therefore, more streamlined.
</p>
<a name="wp1018631"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>When choosing the transaction policies to assign to your objects, make sure you are familiar with the requirements of the XA resource manager you are using. For example, some XA resource managers (such as the Oracle 7 Transaction Manager Server) require that any object participating in a transaction scope their database read operations, in addition to write operations, within a transaction (you can still scope your own transactions, however). Other resource managers, such as Oracle8i, do not require a transaction context for read and write operations. If an application attempts a write operation without a transaction context, Oracle8i will start a local transaction implicitly, in which case the application needs to commit the local transaction explicitly.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1018638"> </a>
Preventing an Object from Being Invoked While a Transaction Is Scoped   
</h3>
<p class="pBody"><a name="wp1018639"> </a>
In many cases, it may be critical to exclude an object from a transaction. If such an object is invoked during a transaction, the object returns an exception, which may cause the transaction to be rolled back. Oracle Tuxedo CORBA provides the <code class="cCode">never</code> transaction policy, which you can assign to an object&#8217;s interface to specifically prevent that object from being invoked within the course of a transaction, even if the current transaction is suspended.
</p>
<p class="pBody"><a name="wp1018643"> </a>
This transaction policy is appropriate for objects that write durable state to disk that cannot be rolled back, such as for an object that writes data to a disk that is not managed by an XA resource manager. Having this capability in your client/server application is crucial if the client application does not or cannot know if some of its invocations are causing a transaction to be scoped. Therefore, if a transaction is scoped, and an object with this policy is invoked, the transaction can be rolled back.
</p>
<p class="pBody"><a name="wp1018644"> </a>
To prevent an object from being invoked while a transaction is scoped, assign the following policies to that object&#8217;s interface in the Implementation Configuration File:
</p>
<p class="pGraphic"><a name="wp1018654"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1018647table1018645">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1018647"> </a>
Activation Policies
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1018649"> </a>
Transaction Policy
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1018651"> </a><code class="cCode">process</code></li>
<li><a name="wp1036049"> </a><code class="cCode">method</code></li>
</ul></div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018653"> </a>
<code class="cCode">never</code>
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1018656"> </a>
Excluding an Object from an Ongoing Transaction
</h3>
<p class="pBody"><a name="wp1018657"> </a>
In some cases, it may be appropriate to permit an object to be invoked during the course of a transaction but also keep that object from being a part of the transaction. If such an object is invoked during a transaction, the transaction is automatically suspended. After the invocation on the object is completed, the transaction is automatically resumed. Oracle Tuxedo CORBA provides the <code class="cCode">ignore</code> transaction policy for this purpose.
</p>
<p class="pBody"><a name="wp1018661"> </a>
The <code class="cCode">ignore</code> transaction policy may be appropriate for an object such as a factory that typically does not write data to disk. By excluding the factory from the transaction, the factory can be available to other client invocations during the course of a transaction. In addition, using this policy can introduce an efficiency into your server application because it minimizes the overhead of invoking objects transactionally.
</p>
<p class="pBody"><a name="wp1018662"> </a>
To prevent any transaction from being propagated to an object, assign the following policies to that object&#8217;s interface in the Implementation Configuration File:
</p>
<p class="pGraphic"><a name="wp1018672"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1018665table1018663">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1018665"> </a>
Activation Policies
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1018667"> </a>
Transaction Policy
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1018669"> </a><code class="cCode">process</code></li>
<li><a name="wp1036062"> </a><code class="cCode">method</code></li>
</ul></div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018671"> </a>
<code class="cCode">ignore</code>
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1018674"> </a>
Assigning Policies 
</h3>
<p class="pBody"><a name="wp1043974"> </a>
For information about how to create an Implementation Configuration File and specify policies on objects, see &#8220;Step 4: Define the in-memory behavior of objects&#8221; in &#8220;Steps for Creating an Oracle Tuxedo CORBA Server Application&#8221; in the <span style="font-style: italic"><a href="../CORBA_ref/index.html"></span><em class="cEmphasis">CORBA Programming Reference</em><span class="cHyperlink">
</a></span>.
</p>
<h3 class="pHeading2"><a name="wp1043982"> </a>
Using an XA Resource Manager 
</h3>
<p class="pBody"><a name="wp1034963"> </a>
The Transaction Manager Server (TMS) handles object state data automatically. For an example, the University sample C++ application in the <code class="cCode">drive:\TUX8\samples\corba\university\transactions</code> directory uses the Oracle TMS as an example of a relational database management service (RDBMS).
</p>
<p class="pBody"><a name="wp1034985"> </a>
Using any XA resource manager imposes specific requirements on how different objects managed by the server application may read and write data to that database, including the following:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018685"> </a>Some XA resource managers, such as Oracle7, require that all database operations be scoped within a transaction. This means that all method invocations on the DBaccess object need to be scoped within a transaction because this object reads from a database. The transaction can be started either by the client or by the Oracle Tuxedo system.</li>
<p class="pBodyRelative"><a name="wp1040367"> </a>
Other XA resource managers, such as Oracle8i, do not require a transaction context for read and write operations. If&#160;an application attempts a write operation without a transaction context, Oracle8i will start a local transaction implicitly, in which case the application needs to commit the local transaction explicitly.
</p>
<li><a name="wp1018686"> </a>When a transaction is committed or rolled back, the XA resource manager automatically handles the durable state implied by the commit or rollback. That is, if the transaction is committed, the XA resource manager ensures that all database updates are made permanent. Likewise, if there is a rollback, the XA resource manager automatically restores the database to its state prior to the beginning of the transaction. </li>
<p class="pBodyRelative"><a name="wp1018687"> </a>
This characteristic of XA resource managers actually makes the design problems associated with handling object state data in the event of a rollback much simpler. Transactional objects can always delegate the commit and rollback responsibilities to the XA resource manager, which greatly simplifies the task of implementing a server application.
</p>
</ul></div>
<h3 class="pHeading2"><a name="wp1018691"> </a>
Opening an XA Resource Manager 
</h3>
<p class="pBody"><a name="wp1021675"> </a>
If an object&#8217;s interface has the <code class="cCode">always</code> or <code class="cCode">optional</code> transaction policy, you must invoke the <code class="cCode">TP::open_xa_rm()</code> operation in the <code class="cCode">Server::initialize()</code> operation in the Server object. The resource manager is opened using the information provided in the <code class="cCode">OPENINFO</code> parameter, which is in the <code class="cCode">GROUPS</code> section of the <code class="cCode">UBBCONFIG</code> file. Note that the default version of the <code class="cCode">Server::initialize()</code> operation automatically opens the resource manager.
</p>
<p class="pBody"><a name="wp1021676"> </a>
If you have an object that does not write data to disk and that participates in a transaction&#8212;the object typically has the <code class="cCode">optional</code> transaction policy&#8212;you still need to include an invocation to the <code class="cCode">TP::open_xa_rm()</code> operation. In that invocation, specify the NULL resource manager.
</p>
<h3 class="pHeading2"><a name="wp1018698"> </a>
Closing an XA Resource Manager 
</h3>
<p class="pBody"><a name="wp1021723"> </a>
If your Server object&#8217;s <code class="cCode">Server::initialize()</code> operation opens an XA resource manager, you must include the following invocation in the <code class="cCode">Server::release()</code> operation:
</p>
<a name="wp1021831"> </a><div class="pPreformatted"><pre>TP::close_xa_rm();</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1018702"> </a>
Transactions and Object State Management 
</h2><p class="pBody"><a name="wp1028531"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1028535"> </a><a href="trxcrbsr.html#wp1018709">Delegating Object State Management to an XA Resource Manager</a></li>
<li><a name="wp1028539"> </a><a href="trxcrbsr.html#wp1018715">Waiting Until Transaction Work Is Complete Before Writing to the Database</a></li>
</ul></div>
<p class="pBody"><a name="wp1043178"> </a>
If you need transactions in your Oracle Tuxedo CORBA client and server application, you can integrate transactions with object state management in a few different ways. In general, Oracle Tuxedo CORBA can automatically scope the transaction for the duration of an operation invocation without requiring you to make any changes to your application&#8217;s logic or the way in which the object writes durable state to disk.
</p>
<h3 class="pHeading2"><a name="wp1018709"> </a>
Delegating Object State Management to an XA Resource Manager 
</h3>
<p class="pBody"><a name="wp1018710"> </a>
Using an XA resource manager, such as Oracle, generally simplifies the design problems associated with handling object state data in the event of a rollback. (The Oracle resource manager is used in the Oracle Tuxedo CORBA University sample C++ applications). Transactional objects can always delegate the commit and rollback responsibilities to the XA resource manager, which greatly simplifies the task of implementing a server application. This means that process- or method-bound objects involved in a transaction can write to a database during transactions, and can depend on the resource manager to undo any data written to the database in the event of a transaction rollback.
</p>
<h3 class="pHeading2"><a name="wp1018715"> </a>
Waiting Until Transaction Work Is Complete Before Writing to the Database 
</h3>
<p class="pBody"><a name="wp1018716"> </a>
The <code class="cCode">transaction</code> activation policy is a good choice for objects that maintain state in memory that you do not want written, or that cannot be written, to disk until the transaction work is complete. When you assign the <code class="cCode">transaction</code> activation policy to an object, the object:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1046219"> </a>Is brought into memory when it is first invoked within the scope of a transaction.</li>
<li><a name="wp1046220"> </a>Remains in memory until the transaction is either committed or rolled back.</li>
</ul></div>
<p class="pBody"><a name="wp1046224"> </a>
When the transaction work is complete, Oracle Tuxedo CORBA invokes each transaction-bound object&#8217;s <code class="cCode">Tobj_ServantBase::deactivate_object()</code> operation passing a <code class="cCode">reason</code> code that can be either <code class="cCode">DR_TRANS_COMMITTING</code> or <code class="cCode">DR_TRANS_ABORTED</code>. If the variable is <code class="cCode">DR_TRANS_COMMITTING</code>, the object can invoke its database write operations. If the variable is <code class="cCode">DR_TRANS_ABORTED</code>, the object skips its write operations.
</p>
<h4 class="pHeading3"><a name="wp1039971"> </a>
When to Assign the Transaction Activation Policy
</h4>
<p class="pBody"><a name="wp1039974"> </a>
Assigning the <code class="cCode">transaction</code> activation policy to an object may be appropriate in the following situations:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018724"> </a>You want the object to write its persistent state to disk at the time that the transaction work is complete.</li>
<p class="pBodyRelative"><a name="wp1018725"> </a>
This introduces a performance efficiency because it reduces the number of database write operations that may need to be rolled back.
</p>
<li><a name="wp1018726"> </a>You want to provide the object with the ability to veto a transaction that is about to be committed.</li>
<p class="pBodyRelative"><a name="wp1018729"> </a>
If Oracle Tuxedo CORBA passes the reason <code class="cCode">DR_TRANS_COMMITTING</code>, the object can, if necessary, invoke <code class="cCode">rollback_only()</code> on the TransactionCurrent object. Note that if you do make an invocation to <code class="cCode">rollback_only()</code> from within the <code class="cCode">Tobj_ServantBase::deactivate_object()</code> operation, then <code class="cCode">deactivate_object()</code> is not invoked again.
</p>
<li><a name="wp1018731"> </a>You want to provide the object with the ability to perform batch updates.</li>
<li><a name="wp1035070"> </a>You have an object that is likely to be invoked multiple times during the course of a single transaction, and you want to avoid the overhead of continually activating and deactivating the object during that transaction.</li>
</ul></div>
<h4 class="pHeading3"><a name="wp1018732"> </a>
Transaction Policies to Use with the Transaction Activation Policy
</h4>
<p class="pBody"><a name="wp1039983"> </a>
To give an object the ability to wait until the transaction is committing before writing to a database, assign the following policies to that object&#8217;s interface in the Implementation Configuration File:
</p>
<p class="pGraphic"><a name="wp1018742"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1018735table1018733">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1018735"> </a>
Activation Policy
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1018737"> </a>
Transaction Policy
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018739"> </a>
<code class="cCode">transaction</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018741"> </a>
<code class="cCode">always</code> or <code class="cCode">optional</code>
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<a name="wp1018743"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Transaction-bound objects cannot start a transaction or invoke other objects from inside the <code class="cCode">Tobj_ServantBase::deactivate_object()</code> operation. The only valid invocations transaction-bound objects can make inside <code class="cCode">deactivate_object()</code> are write operations to the database.</td>
</tr>
</table>

<a name="wp1018744"> </a><table class="Note">
<tr>
<td valign="top"><b class="texthide">Note:</b></td>
<td>Also, if you have an object that is involved in a transaction, the Server object that manages that object must include invocations to open and close the XA resource manager, even if the object does not write any data to disk. (If you have a transactional object that does not write data to disk, you specify the NULL resource manager.) For more information about opening and closing an XA resource manager, see <a href="trxcrbsr.html#wp1018691">Opening an XA Resource Manager</a> and <a href="trxcrbsr.html#wp1018698">Closing an XA Resource Manager</a>.</td>
</tr>
</table>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1022159"> </a>
User-defined Exceptions 
</h2><p class="pBody"><a name="wp1028179"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1028262"> </a><a href="trxcrbsr.html#wp1022160">About User-defined Exceptions</a></li>
<li><a name="wp1028212"> </a><a href="trxcrbsr.html#wp1022172">Defining the Exception</a></li>
<li><a name="wp1028219"> </a><a href="trxcrbsr.html#wp1022178">Throwing the Exception</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1022160"> </a>
About User-defined Exceptions
</h3>
<p class="pBody"><a name="wp1022167"> </a>
Including a user-defined exception in an Oracle Tuxedo CORBA client/server application involves the following steps:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1022168"> </a>In your OMG IDL file, define the exception and specify the operations that can use it.</li>
<li><a name="wp1022169"> </a>In the implementation file, include code that throws the exception.</li>
<li><a name="wp1022170"> </a>In the client application source file, include code that catches and handles the exception.</li>
</ol></div>
<p class="pBody"><a name="wp1034872"> </a>
For example, the Transactions sample C++ application includes an instance of a user-defined exception, <code class="cCode">TooManyCredits</code>. This exception is thrown by the server application when the client application tries to register a student for a course, and the student has exceeded the maximum number of courses for which he or she can register. When the client application catches this exception, the client application rolls back the transaction that registers a student for a course. This section explains how you can define and implement user-defined exceptions in your Oracle Tuxedo CORBA client/server application, using the <code class="cCode">TooManyCredits</code> exception as an example.
</p>
<h3 class="pHeading2"><a name="wp1022172"> </a>
Defining the Exception
</h3>
<p class="pBody"><a name="wp1022173"> </a>
In the OMG IDL file for your client/server application:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1022174"> </a>Define the exception and define the data sent with the exception. For example, the <code class="cCode">TooManyCredits</code> exception is defined to pass a short integer representing the maximum number of credits for which a student can register. Therefore, the definition for the <code class="cCode">TooManyCredits</code> exception contains the following OMG IDL statements:</li>
<a name="wp1022175"> </a><div class="pPreformattedRelative"><pre>exception TooManyCredits<br />{<br />    unsigned short maximum_credits;<br />};</pre></div><li><a name="wp1022176"> </a>In the definition of the operations that throw the exception, include the exception. The following example shows the OMG IDL statements for the <code class="cCode">register_for_courses()</code> operation on the <code class="cCode">Registrar</code> interface:</li>
<a name="wp1022177"> </a><div class="pPreformattedRelative"><pre>NotRegisteredList register_for_courses(<br />    in StudentId        student,<br />    in CourseNumberList courses<br />) raises (<br />    TooManyCredits<br />);</pre></div></ol></div>
<h3 class="pHeading2"><a name="wp1022178"> </a>
Throwing the Exception
</h3>
<p class="pBody"><a name="wp1022179"> </a>
In the implementation of the operation that uses the exception, write the code that throws the exception, as in the following C++ example.
</p>
<a name="wp1022180"> </a><div class="pPreformatted"><pre>if ( ... ) {<br />    UniversityZ::TooManyCredits e;<br />    e.maximum_credits = 18;<br />    throw e;</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1020674"> </a>
How the Transactions University Sample Application Works
</h2><p class="pBody"><a name="wp1028301"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1028335"> </a><a href="trxcrbsr.html#wp1028295">About the Transactions University Sample Application</a></li>
<li><a name="wp1028380"> </a><a href="trxcrbsr.html#wp1020692">Transactional Model Used by the Transactions University Sample Application</a></li>
<li><a name="wp1028408"> </a><a href="trxcrbsr.html#wp1020703">Object State Considerations for the University Server Application</a></li>
<li><a name="wp1028424"> </a><a href="trxcrbsr.html#wp1020746">Configuration Requirements for the Transactions Sample Application</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1028295"> </a>
About the Transactions University Sample Application
</h3>
<p class="pBody"><a name="wp1020675"> </a>
To implement the student registration process, the Transactions sample application does the following:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1020676"> </a>The client application obtains a reference to the TransactionCurrent object from the Bootstrap object.</li>
<li><a name="wp1020677"> </a>When the student submits the list of courses for which he or she wants to register, the client application:</li>
<div class="pSmartList2"><ol type="a" class="pSmartList2">
<li><a name="wp1020678"> </a>Begins a transaction by invoking the <code class="cCode">Current::begin()</code> operation on the TransactionCurrent object.</li>
<li><a name="wp1020679"> </a>Invokes the <code class="cCode">register_for_courses()</code> operation on the Registrar object, passing a list of courses.</li>
</ol></div>
<li><a name="wp1020680"> </a>The <code class="cCode">register_for_courses()</code> operation on the Registrar object processes the registration request by executing a loop that does the following iteratively for each course in the list:</li>
<div class="pSmartList2"><ol type="a" class="pSmartList2">
<li><a name="wp1020681"> </a>Checks to see how many credits the student is already registered for.</li>
<li><a name="wp1020682"> </a>Adds the course to the list of courses for which the student is registered.</li>
<p class="pBodyRelative"><a name="wp1020683"> </a>
The Registrar object checks for the following potential problems, which prevent the transaction from being committed:
</p>
</ol></div>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1020684"> </a>The student is already registered for the course.</li>
<li><a name="wp1020685"> </a>A course in the list does not exist.</li>
<li><a name="wp1020686"> </a>The student exceeds the maximum credits allowed.</li>
</ul></div>
<li><a name="wp1020687"> </a>As defined in the application&#8217;s OMG IDL, the <code class="cCode">register_for_courses()</code> operation returns a parameter to the client application, <code class="cCode">NotRegisteredList</code>, which contains a list of the courses for which the registration failed. </li>
<p class="pBodyRelative"><a name="wp1020688"> </a>
If the <code class="cCode">NotRegisteredList</code> value is empty, the client application commits the transaction.
</p>
<p class="pBodyRelative"><a name="wp1020689"> </a>
If the <code class="cCode">NotRegisteredList</code> value contains any courses, the client application queries the student to indicate whether he or she wants to complete the registration process for the courses for which the registration succeeded. If the user chooses to complete the registration, the client application commits the transaction. If the user chooses to cancel the registration, the client application rolls back the transaction.
</p>
<li><a name="wp1020690"> </a>If the registration for a course has failed because the student exceeds the maximum number of credits he or she can take, the Registrar object returns a <code class="cCode">TooManyCredits</code> exception to the client application, and the client application rolls back the entire transaction.</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1020692"> </a>
Transactional Model Used by the Transactions University Sample Application
</h3>
<p class="pBody"><a name="wp1020693"> </a>
The basic design rationale for the Transactions sample application is to handle course registrations in groups, as opposed to one at a time. This design helps to minimize the number of remote invocations on the Registrar object.
</p>
<p class="pBody"><a name="wp1020694"> </a>
In implementing this design, the Transactions sample application shows one model of the use of transactions, which were described in <a href="trxcrbsr.html#wp1024435">Integrating Transactions in an Oracle Tuxedo Client and Server Application</a>. The model is as follows:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1020698"> </a>The client begins a transaction by invoking the <code class="cCode">begin()</code> operation on the TransactionCurrent object, followed by making an invocation to the <code class="cCode">register_for_courses()</code> operation on the Registrar object. </li>
<p class="pBodyRelative"><a name="wp1020699"> </a>
The Registrar object registers the student for the courses for which it can, and then returns a list of courses for which the registration process was unsuccessful. The client application can choose to commit the transaction or roll it back. The transaction encapsulates this conversation between the client and the server application.
</p>
<li><a name="wp1020700"> </a>The <code class="cCode">register_for_courses()</code> operation performs multiple checks of the University database. If any one of those checks fail, the transaction can be rolled back.</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1020703"> </a>
Object State Considerations for the University Server Application 
</h3>
<p class="pBody"><a name="wp1020704"> </a>
Because the Transactions University sample application is transactional, the University server application generally needs to consider the implications on object state, particularly in the event of a rollback. In cases where there is a rollback, the server application must ensure that all affected objects have their durable state restored to the proper state.
</p>
<p class="pBody"><a name="wp1020705"> </a>
Because the Registrar object is being used for database transactions, a good design choice for this object is to make it transactional (assign the <code class="cCode">always</code> transaction policy to this object&#8217;s interface). If a transaction has not already been scoped when this object is invoked, the Oracle Tuxedo system will start a transaction automatically. 
</p>
<p class="pBody"><a name="wp1020709"> </a>
By making the Registrar object automatically transactional, all database write operations performed by this object will always be done within the scope of a transaction, regardless of whether the client application starts one. Since the server application uses an XA resource manager, and since the object is guaranteed to be in a transaction when the object writes to a database, the object does not have any rollback or commit responsibilities because the XA resource manager takes responsibility for these database operations on behalf of the object.
</p>
<p class="pBody"><a name="wp1020710"> </a>
The RegistrarFactory object, however, can be excluded from transactions because this object does not manage data that is used during the course of a transaction. By excluding this object from transactions, you minimize the processing overhead implied by transactions.
</p>
<h4 class="pHeading3"><a name="wp1020712"> </a>
Object Policies Defined for the Registrar Object
</h4>
<p class="pBody"><a name="wp1020713"> </a>
To make the Registrar object transactional, the ICF file specifies the <code class="cCode">always</code> transaction policy for the <code class="cCode">Registrar</code> interface. Therefore, in the Transaction sample application, the ICF file specifies the following object policies for the <code class="cCode">Registrar</code> interface:
</p>
<p class="pGraphic"><a name="wp1020723"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1020716table1020714">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1020716"> </a>
Activation Policy
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1020718"> </a>
Transaction Policy
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1020720"> </a>
<code class="cCode">process</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1020722"> </a>
<code class="cCode">always</code>
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h4 class="pHeading3"><a name="wp1020724"> </a>
Object Policies Defined for the RegistrarFactory Object
</h4>
<p class="pBody"><a name="wp1020725"> </a>
To exclude the RegistrarFactory object from transactions, the ICF file specifies the <code class="cCode">ignore</code> transaction policy for the <code class="cCode">Registrar</code> interface. Therefore, in the Transaction sample application, the ICF file specifies the following object policies for the <code class="cCode">RegistrarFactory</code> interface:
</p>
<p class="pGraphic"><a name="wp1020735"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1020728table1020726">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1020728"> </a>
Activation Policy
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1020730"> </a>
Transaction Policy
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1020732"> </a>
<code class="cCode">process</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1020734"> </a>
<code class="cCode">ignore</code>
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h4 class="pHeading3"><a name="wp1020739"> </a>
Using an XA Resource Manager in the Transactions Sample Application 
</h4>
<p class="pBody"><a name="wp1020740"> </a>
The Transactions sample application uses the Oracle Transaction Manager Server (TMS), which handles object state data automatically. Using any XA resource manager imposes specific requirements on how different objects managed by the server application may read and write data to that database, including the following:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1020741"> </a>Some XA resource managers, such as Oracle7, require that all database operations be scoped within a transaction. This means that the CourseSynopsisEnumerator object needs to be scoped within a transaction because this object reads from a database.</li>
<li><a name="wp1020742"> </a>When a transaction is committed or rolled back, the XA resource manager automatically handles the durable state implied by the commit or rollback. That is, if the transaction is committed, the XA resource manager ensures that all database updates are made permanent. Likewise, if there is a rollback, the XA resource manager automatically restores the database to its state prior to the beginning of the transaction. </li>
<p class="pBodyRelative"><a name="wp1020743"> </a>
This characteristic of XA resource managers actually makes the design problems associated with handling object state data in the event of a rollback much simpler. Transactional objects can always delegate the commit and rollback responsibilities to the XA resource manager, which greatly simplifies the task of implementing a server application.
</p>
</ul></div>
<h3 class="pHeading2"><a name="wp1020746"> </a>
Configuration Requirements for the Transactions Sample Application 
</h3>
<p class="pBody"><a name="wp1020747"> </a>
The University sample applications use an Oracle Transaction Manager Server (TMS). To use the Oracle database, you must include specific Oracle-provided files in the server application build process. For more information about building, configuring, and running the Transactions sample application, see <span style="font-style: italic">The Transaction Sample Application</a></span> in the Oracle Tuxedo online documentation. For more information about the configurable settings in the <code class="cCode">UBBCONFIG</code> file, see <a href="admtrx.html#wp1041654">Modifying the UBBCONFIG File to Accommodate Transactions</a>.
</p>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="trxcrbsr.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="trxsvc.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="trxcrbcl.html"><img id="LongDescNotReq10" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
