<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41263" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux11gr1/pcb/fm/pberr.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="11/28/11 08:23:30" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Managing Errors</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Programming an Oracle Tuxedo Application Using COBOL
</h1>
<!-- page title end -->

    <table id="SummaryNotReq2" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="pbthr.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="pgbind.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
&nbsp;
<a href="../pdf/pcb.pdf" target="pdf"><img id="LongDescNotReq5" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq6" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1407503"> </a>
Managing Errors
</h1>
<p class="pBody"><a name="wp1358400"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155408"> </a><a href="pberr.html#wp1155434">System Errors</a></li>
<li><a name="wp1155412"> </a><a href="pberr.html#wp1155665">Application Errors</a></li>
<li><a name="wp1155416"> </a><a href="pberr.html#wp1155677">Handling Errors</a></li>
<li><a name="wp1155420"> </a><a href="pberr.html#wp1155712">Transaction Considerations</a></li>
<li><a name="wp1155424"> </a><a href="pberr.html#wp1155876">Central Event Log</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155434"> </a>
System Errors
</h2><p class="pBody"><a name="wp1155435"> </a>
The Oracle Tuxedo system uses <code class="cCode">TP-STATUS IN TPSTATUS-REC</code> to supply information to a process when a routine fails. All ATMI calls set <code class="cCode">TP-STATUS</code> to a value that describes the nature of the error. When a call does not return to its caller, as in the case of <code class="cCode">TPRETURN</code> or <code class="cCode">TPFORWAR</code>, which are used to terminate a service routine, the only way the system can communicate success or failure is through <code class="cCode">TP-STATUS</code> in the requester.
</p>
<p class="pBody"><a name="wp1155440"> </a>
<code class="cCode">APPL-RETURN-CODE</code> is used to communicate user-defined conditions only. The system sets the value of <code class="cCode">APPL-RETURN-CODE</code> to the value of <code class="cCode">APPL-CODE IN TPSVCRET-REC</code> during <code class="cCode">TPRETURN</code>. The system sets <code class="cCode">APPL-RETURN-CODE</code>, regardless of the value of <code class="cCode">APPL-RETURN-CODE IN TPSTATUS-REC</code> during <code class="cCode">TPRETURN</code>, unless an error is encountered by <code class="cCode">TPRETURN</code> or a transaction timeout occurs.
</p>
<p class="pBody"><a name="wp1260332"> </a>
The codes returned in <code class="cCode">TP-STATUS</code> represent categories of errors, which are listed in <a href="pberr.html#wp223924">Table&#160;11-1</a>. 
</p>
<p class="pGraphic"><a name="wp1260407"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp223924table1260333"><caption><a name="wp223924"> </a>
Table 11-1  <span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">TP-STATUS Error Categories</span>

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1260335"> </a>
Error Category
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1260337"> </a>
TP-STATUS Values
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260339"> </a>
Abort
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260341"> </a>
<code class="cCode">TPEABORT</code><sup class="cSuperscript">2</sup>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260343"> </a>
Oracle Tuxedo system<sup class="cSuperscript">1</sup>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260345"> </a>
<code class="cCode">TPESYSTEM</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260347"> </a>
Communication handle
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260349"> </a>
<code class="cCode">TPELIMIT</code> and <code class="cCode">TPEBADDESC</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260351"> </a>
Conversational
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260353"> </a>
<code class="cCode">TPEVENT</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266604"> </a>
Duplicate operation
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266606"> </a>
<code class="cCode">TPEMATCH</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260355"> </a>
General communication
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260357"> </a>
<code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPESVCERR</code>, <code class="cCode">TPEBLOCK</code>, and <code class="cCode">TPGOTSIG</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260359"> </a>
Heuristic decision
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260361"> </a>
<code class="cCode">TPEHAZARD</code><sup class="cSuperscript">2</sup><sup class="cSuperscript"> </sup>and <code class="cCode">TPEHEURISTIC</code><sup class="cSuperscript">2</sup>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260363"> </a>
Invalid argument<sup class="cSuperscript">1</sup>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260365"> </a>
<code class="cCode">TPEINVAL</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266545"> </a>
MIB
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266547"> </a>
<code class="cCode">TPEMIB</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260367"> </a>
No entry
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260369"> </a>
<code class="cCode">TPENOENT</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260371"> </a>
Operating system<sup class="cSuperscript">1</sup>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260373"> </a>
<code class="cCode">TPEOS</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260375"> </a>
Permission
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260377"> </a>
<code class="cCode">TPEPERM</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260382"> </a>
Protocol<a href="#wp1260381" title="Footnote 1"><sup class="Footnote">1</sup></a>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260384"> </a>
<code class="cCode">TPEPROTO</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266534"> </a>
Queueing
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266536"> </a>
<code class="cCode">TPEDIAGNOSTIC</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266519"> </a>
Release compatibility
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266521"> </a>
<code class="cCode">TPERELEASE</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260386"> </a>
Resource manager
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260388"> </a>
<code class="cCode">TPERMERR</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260390"> </a>
Timeout
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260392"> </a>
<code class="cCode">TPETIME</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260394"> </a>
Transaction
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260402"> </a>
<code class="cCode">TPETRAN<a href="#wp1260401" title="Footnote 2"><sup class="Footnote">2</sup></a></code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260404"> </a>
Typed record mismatch
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260406"> </a>
<code class="cCode">TPEITYPE</code> and <code class="cCode">TPEOTYPE</code>
</div>
</td>
</tr>
</table>

<table class="footnote" id="SummaryNotReq1">  <tr>
    <td><p class="pTableFootnote"><a name="wp1260381"> </a>
<a href="#wp1260382" title="Footnote 1"><sup class="Footnote">1</sup></a>Applicable to all ATMI calls for which failure is reported by the value returned in <code class="cCode">TP-STATUS</code>.
</p>

<p class="pTableFootnote"><a name="wp1260401"> </a>
<a href="#wp1260402" title="Footnote 2"><sup class="Footnote">2</sup></a>Refer to <a href="pberr.html#wp1155758">Fatal Transaction Errors</a> for more information on this error category.
</p>

</td>
  </tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1260408"> </a>
As footnote 1 shows, four categories of errors are reported by <code class="cCode">TP-STATUS</code> and are applicable to all ATMI calls. The remaining categories are used only for specific ATMI calls.The following sections describe some error categories in detail.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155518"> </a>
Abort Errors
</h2><p class="pBody"><a name="wp1155521"> </a>
For information on the errors that lead to abort, refer to <a href="pberr.html#wp1155758">Fatal Transaction Errors</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155523"> </a>
Oracle Tuxedo System Errors
</h2><p class="pBody"><a name="wp1155524"> </a>
Oracle Tuxedo system errors indicate problems at the <em class="cEmphasis">system level</em>, rather than at the application level. When Oracle Tuxedo system errors occur, the system writes messages explaining the exact nature of the errors to the central event log, and returns <code class="cCode">TPESYSTEM</code> in <code class="cCode">TP-STATUS</code>. For more information, refer to the <a href="pberr.html#wp1155876">Central Event Log</a>. Because these errors occur in the system, rather than in the application, you may need to consult the system administrator to correct them.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155528"> </a>
Communication Handle Errors
</h2><p class="pBody"><a name="wp1155529"> </a>
Communication handle errors occur as a result of exceeding the maximum limit of communication handles or referencing an invalid value. Asynchronous and conversational calls return <code class="cCode">TPELIMIT</code> when the maximum number of outstanding communication handles has been exceeded. <code class="cCode">TPEBADDESC</code> is returned when an invalid communication handle value is specified for an operation.
</p>
<p class="pBody"><a name="wp1155530"> </a>
Communication handle errors occur only during asynchronous calls or conversational calls. (Call descriptors are not used for synchronous calls.) Asynchronous calls depend on communication handles to associate replies with the corresponding requests. Conversational send and receive routines depend on communication handles to identify the connection; the call that initiates the connection depends on the availability of a communication handle. 
</p>
<p class="pBody"><a name="wp1155531"> </a>
Communication handle errors can be done by checking for specific errors at the application level.
</p>
<h3 class="pHeading2"><a name="wp1155532"> </a>
Limit Errors
</h3>
<p class="pBody"><a name="wp1155533"> </a>
The system allows up to 50 outstanding communication handles (replies) per context (or Oracle Tuxedo application association). This limit is enforced by the system; it cannot be redefined by your application.
</p>
<p class="pBody"><a name="wp1155534"> </a>
The limit for communication handles for simultaneous conversational connections is more flexible than the limit for replies. The application administrator defines the limit in the configuration file. When the application is not running, the administrator can modify the <code class="cCode">MAXCONV</code> parameter in the <code class="cCode">RESOURCES</code> section of the configuration file. When the application is running, the administrator can modify the <code class="cCode">MACHINES</code> section dynamically. Refer to <a href="../rfcm/rfcmd.html">tmconfig, wtmconfig(1)</a> in the <em class="cEmphasis">Oracle Tuxedo Command Reference</em> for more information.
</p>
<h3 class="pHeading2"><a name="wp1155538"> </a>
Invalid Descriptor Errors
</h3>
<p class="pBody"><a name="wp1155539"> </a>
A communication handle can become invalid and, if referenced, cause an error to be returned to <code class="cCode">TP-STATUS</code> in either of two situations:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155540"> </a>A communication handle is used to retrieve a message, which may be a failed message (<code class="cCode">TPEBADDESC</code>).</li>
<li><a name="wp1155541"> </a>An attempt is made to reuse a stale communication handle (<code class="cCode">TPEBADDESC</code>). </li>
</ul></div>
<p class="pBody"><a name="wp1155542"> </a>
A communication handle might become stale, for example, in the following circumstances:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155543"> </a>When the application calls <code class="cCode">TPABORT</code> or <code class="cCode">TPCOMMIT</code> and transaction replies (sent without <code class="cCode">TPNOTRAN</code>) remain to be retrieved. </li>
<li><a name="wp1155544"> </a>A transaction times out. When the timeout is reported by a call to <code class="cCode">TPGETRPLY</code>, no message is retrieved using the specified handle and the handle becomes stale. </li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1259219"> </a>
Conversational Errors
</h2><p class="pBody"><a name="wp1259220"> </a>
When an unknown handle is specified for conversational services, the <code class="cCode">TPSEND</code>, <code class="cCode">TPRECV</code>, and <code class="cCode">TPDISCON</code> routines return <code class="cCode">TPEBADDESC</code>.
</p>
<p class="pBody"><a name="wp1155547"> </a>
When <code class="cCode">TPSEND</code> and <code class="cCode">TPRECV</code> fail with a <code class="cCode">TPEEVENT</code> error after a conversational connection is established, an event has occurred. Data may or may not be sent by <code class="cCode">TPSEND</code>, depending on the event. The system returns <code class="cCode">TPEEVENT</code> in the <code class="cCode">TPEVENT</code> member of <code class="cCode">TPSTATUS-REC</code> and the course of action is dictated by the particular event.
</p>
<p class="pBody"><a name="wp1155550"> </a>
For a complete description of conversational events, refer to <span class="cHyperlink">
<a href="../pgc/pgconv.html">&#8220;Understanding Conversational Communication Events&#8221; </a></span>in <em class="cEmphasis">Programming Oracle Tuxedo ATMI Applications Using C</em>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1267083"> </a>
Duplicate Object Error
</h2><p class="pBody"><a name="wp1268950"> </a>
The <code class="cCode">TPEMATCH</code> error code is returned in <code class="cCode">TP-STATUS</code> when an attempt is made to perform an operation that results in a duplicate object. The following table lists the routines that may return the <code class="cCode">TPEMATCH</code> error code and the associated cause.
</p>
<p class="pGraphic"><a name="wp1409616"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1269152table1269150">
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellHeading"><a name="wp1269152"> </a>
Routine
</div>
</td>
    <td class="table" scope="row"><div class="pCellHeading"><a name="wp1269154"> </a>
Cause
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269156"> </a>
<code class="cCode">TPADVERTISE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269158"> </a>
The <code class="cCodeEmphasis">svcname</code> specified is already advertised for the server but with a function other than <code class="cCodeEmphasis">func</code>. Although the function fails, <code class="cCodeEmphasis">svcname</code> remains advertised with its current function (that is, <code class="cCodeEmphasis">func</code> does not replace the current function name).
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269224"> </a>
<code class="cCode">TPRESUME</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269227"> </a>
The <code class="cCodeEmphasis">tranid</code> points to a transaction identifier that another process has already resumed. In this case, the caller&#8217;s state with respect to the transaction is not changed.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269207"> </a>
<code class="cCode">TPSUBSCRIBE</code><span class="cHyperlink">
 </span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269210"> </a>
The specified subscription information has already been listed with the EventBroker.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1269246"> </a>
For more information on these routines, refer to the <em class="cEmphasis">Oracle Tuxedo ATMI COBOL Function Reference</em>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1266623"> </a>
General Communication Call Errors
</h2><p class="pBody"><a name="wp1155553"> </a>
General communication call errors can occur during any communication calls, regardless of whether those calls are synchronous or asynchronous. Any of the following errors may be returned in <code class="cCode">TP-STATUS</code>: <code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPESVCERR</code>, <code class="cCode">TPEBLOCK</code>, or <code class="cCode">TPGOTSIG.</code>
</p>
<h3 class="pHeading2"><a name="wp1155554"> </a>
TPESVCFAIL and TPESVCERR Errors
</h3>
<p class="pBody"><a name="wp1259501"> </a>
If the reply portion of a communication fails as a result of a call to <code class="cCode">TPCALL</code> or <code class="cCode">TPGETRPLY</code>, the system returns <code class="cCode">TPESVCERR</code> or <code class="cCode">TPSEVCFAIL</code> to <code class="cCode">TP-STATUS</code>. The system determines the error by the arguments that are passed to <code class="cCode">TPRETURN</code> and the processing that is performed by this call. 
</p>
<p class="pBody"><a name="wp1155556"> </a>
If <code class="cCode">TPRETURN</code> encounters an error in processing or handling arguments, the system returns an error to the original requester and sets <code class="cCode">TP-STATUS</code> to <code class="cCode">TPESVCERR</code>. The receiver determines that an error has occurred by checking the value of <code class="cCode">TP-STATUS</code>. The system does not send the data from the <code class="cCode">TPRETURN</code> call, and if the failure occurred on <code class="cCode">TPGETRPLY</code>, it renders the call handle invalid. 
</p>
<p class="pBody"><a name="wp1155557"> </a>
If <code class="cCode">TPRETURN</code> does not encounter the <code class="cCode">TPESVCERR</code> error, then the value returned in <code class="cCode">TP-RETURN-VAL</code> determines the success or failure of the call. If the application specifies <code class="cCode">TPFAIL</code> in the <code class="cCode">TP-RETURN-VAL</code>, the system returns <code class="cCode">TPESVCFAIL</code> in <code class="cCode">TP-STATUS</code> and sends the data message to the caller. If <code class="cCode">TP-RETURN-VAL</code> is set to <code class="cCode">TPSUCCESS</code>, the system returns successfully to the caller, <code class="cCode">TP-STATUS</code> is not set, and the caller receives the data.
</p>
<h3 class="pHeading2"><a name="wp1155558"> </a>
TPEBLOCK and TPGOTSIG Errors
</h3>
<p class="pBody"><a name="wp1155559"> </a>
The <code class="cCode">TPEBLOCK</code> and <code class="cCode">TPGOTSIG</code> error codes may be returned at the request or the reply end of a message and, as a result, can be returned for all communication calls. 
</p>
<p class="pBody"><a name="wp1155560"> </a>
The system returns <code class="cCode">TPEBLOCK</code> when a blocking condition exists and the process sending a request (synchronously or asynchronously) indicates, by setting <code class="cCode">TPPNOBLOCK</code> that it does not want to wait on a blocking condition. A blocking condition can exist when a request is being sent if, for example, all the system queues are full. 
</p>
<p class="pBody"><a name="wp1155561"> </a>
When <code class="cCode">TPCALL</code> indicates a no blocking condition, only the sending part of the communication is affected. If a call successfully sends a request, the system does not return <code class="cCode">TPEBLOCK</code>, regardless of any blocking situation that may exist while the call waits for the reply. 
</p>
<p class="pBody"><a name="wp1155562"> </a>
The system returns <code class="cCode">TPEBLOCK</code> for <code class="cCode">TPGETRPLY</code> when a call is made <code class="cCode">TPNOBLOCK</code> and a blocking condition is encountered while <code class="cCode">TPGETRPLY</code> is awaiting the reply. This may occur, for example, if a message is not currently available.
</p>
<p class="pBody"><a name="wp1155563"> </a>
The <code class="cCode">TPGOTSIG</code> error indicates an interruption of a system call by a signal; this situation is not actually an error condition. If <code class="cCode">TPSIGRSTRT</code> is set, the calls do not fail and the system does not return the <code class="cCode">TPGOTSIG</code> error code in <code class="cCode">TP-STATUS</code>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155564"> </a>
Invalid Argument Errors
</h2><p class="pBody"><a name="wp1155565"> </a>
Invalid argument errors indicate that an invalid argument was passed to a routine. Any ATMI call that takes arguments can fail if you pass it arguments that are invalid. In the case of a call that returns to the caller, the call fails and causes <code class="cCode">TP-STATUS</code> to be set to <code class="cCode">TPEINVAL</code>. In the case of <code class="cCode">TPRETURN</code> or <code class="cCode">TPFORWAR</code>, the system sets <code class="cCode">TP-STATUS</code> to <code class="cCode">TPESVCERR</code> for either the <code class="cCode">TPCALL</code> or <code class="cCode">TPGETRPLY</code> call that initiated the request and is waiting for results to be returned.
</p>
<p class="pBody"><a name="wp1155566"> </a>
You can correct an invalid argument error at the <em class="cEmphasis">application level</em> by ensuring that you pass only valid arguments to routines. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155567"> </a>
No Entry Errors
</h2><p class="pBody"><a name="wp1155568"> </a>
No entry errors result from a lack of entries in the system tables or the data structure used to identify record types. The meaning of the no entry type error, <code class="cCode">TPENOENT</code>, depends on the call that is returning it. <a href="pberr.html#wp223964">Table&#160;11-2</a> lists the calls that return this error and describes various causes of error. 
</p>
<p class="pGraphic"><a name="wp1155616"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp223964table1155569"><caption><a name="wp223964"> </a>
Table 11-2  No Entry Errors

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1155571"> </a>
Call
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1155573"> </a>
Cause
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155583"> </a>
<code class="cCode">TPINITIALIZE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155585"> </a>
The calling process cannot join the application because there is no space left in the bulletin board to make an entry for it. Check with the system administrator.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155587"> </a>
 <code class="cCode">TPCALL <br />TPACALL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155589"> </a>
The calling process references a service called <code class="cCode">SERVICE-NAME IN TPSVCDEF-REC</code> that is not known to the system since there is no entry for it in the bulletin board. On an application level, ensure that you have referenced the service correctly; otherwise, check with the system administrator.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155591"> </a>
<code class="cCode">TPCONNECT</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155593"> </a>
The system cannot connect to the specified name because the service named does not exist or it is not a conversational service.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155595"> </a>
<code class="cCode">TPGPRIO</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155597"> </a>
The calling process seeks a request priority when no request has been made. This is an application-level error.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155599"> </a>
<code class="cCode">TPUNADVERTISE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155601"> </a>
The system cannot unadvertise <code class="cCode">SERVICE-NAME IN TPSVCDEF-REC</code> because the name is not currently advertised by the calling process.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155617"> </a>
Operating System Errors
</h2><p class="pBody"><a name="wp1155618"> </a>
Operating system errors indicate that an operating system call has failed. The system returns <code class="cCode">TPEOS</code> in <code class="cCode">TP-STATUS</code>. On UNIX systems, the system returns a numeric value identifying the failed system call in the global variable <code class="cCode">Uunixerr</code>. To resolve operating system errors, you may need to consult your system administrator.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155619"> </a>
Permission Errors
</h2><p class="pBody"><a name="wp1155620"> </a>
If a calling process does not have the correct permissions to join the application, the <code class="cCode">TPINITIALIZE</code> call fails, returning <code class="cCode">TPEPERM</code> in <code class="cCode">TP-STATUS</code>. Permissions are set in the configuration file, outside of the application. If you encounter this error, check with the application administrator to make sure the necessary permissions are set in the configuration file.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155621"> </a>
Protocol Errors
</h2><p class="pBody"><a name="wp1155622"> </a>
Protocol errors occur when an ATMI call is invoked, either in the wrong order or using an incorrect process. For example, a client may try to begin communicating with a server before joining the application. Or <code class="cCode">TPCOMMIT</code> may be called by a transaction participant instead of the initiator.
</p>
<p class="pBody"><a name="wp1155623"> </a>
You can correct a protocol error at the <em class="cEmphasis">application level</em> by enforcing the rules of order and proper usage of ATMI calls. 
</p>
<p class="pBody"><a name="wp1155624"> </a>
To determine the cause of a protocol error, answer the following questions:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155625"> </a>Is the call being made in the correct order?</li>
<li><a name="wp1155626"> </a>Is the call being made by the correct process?</li>
</ul></div>
<p class="pBody"><a name="wp1155627"> </a>
Protocol errors return the <code class="cCode">TPEPROTO</code> value in <code class="cCode">TP-STATUS</code>.
</p>
<p class="pBody"><a name="wp1155633"> </a>
Refer to &#8220;Introduction to the COBOL Application-Transaction Monitor Interface&#8221; in the <em class="cEmphasis">Oracle Tuxedo ATMI COBOL Function Reference</em> for more information. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1268098"> </a>
Queuing Error
</h2><p class="pBody"><a name="wp1268105"> </a>
The TPENQUE<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>UE(3cbl)</span> or TPDEQUEU<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>E(3cbl)</span> routine returns <code class="cCode">TPEDIAGNOSTIC</code> in <code class="cCode">TP-STATUS</code> if the enqueuing or dequeuing on a specified queue fails. The reason for failure can be determined by the diagnostic returned via the <code class="cCodeEmphasis">ctl</code> record. For a list of valid <code class="cCodeEmphasis">ctl</code> flags, refer to TPENQUEU<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>E(3cbl)</span> or TPDEQU<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>EUE(3cbl)</span> in the <em class="cEmphasis">Oracle Tuxedo ATMI COBOL Function Reference</em>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1268224"> </a>
Release Compatibility Error
</h2><p class="pBody"><a name="wp1268310"> </a>
The Oracle Tuxedo system returns <code class="cCode">TPERELEASE</code> in <code class="cCode">TP-STATUS</code> if a compatibility issue exists between multiple releases of an Oracle Tuxedo system participating in an application domain. 
</p>
<p class="pBody"><a name="wp1268661"> </a>
For example, the <code class="cCode">TPERELEASE</code> error may be returned if the <code class="cCode">TPACK</code> flag is set when issuing the TPNOT<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>IFY(3cbl)</span> routine (indicating that the caller blocks until an acknowledgment message is received from the target client), but the target client is using an earlier release of the Oracle Tuxedo system that does not support the <code class="cCode">TPACK</code> acknowledgement protocol. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155635"> </a>
Resource Manager Errors
</h2><p class="pBody"><a name="wp1155636"> </a>
Resource manager errors can occur with calls to TPOPE<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>N(3cbl)</span> and TPC<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>OSE(3cbl)</span>, in which case the system returns the value of <code class="cCode">TPERMERR</code> in <code class="cCode">TP-STATUS</code>. This error code is returned for <code class="cCode">TPOPEN</code> when the resource manager fails to open correctly. Similarly, this error code is returned for <code class="cCode">TPCLOSE</code> when the resource manager fails to close correctly. To maintain portability, the Oracle Tuxedo system does not return a more detailed explanation of this type of failure. To determine the exact nature of a resource manager error, you must interrogate the resource manager.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155637"> </a>
Timeout Errors
</h2><p class="pBody"><a name="wp1155638"> </a>
The Oracle Tuxedo system supports timeout errors to establish a limit on the amount of time that the application waits for a service request or transaction. The Oracle Tuxedo system supports two types of configurable timeout mechanisms: blocking and transaction.
</p>
<p class="pBody"><a name="wp1155639"> </a>
A <em class="cEmphasis">blocking timeout</em> specifies the maximum amount of time that an application waits for a reply to a service request. The application administrator defines the blocking timeout for the system in the configuration file. 
</p>
<p class="pBody"><a name="wp1155640"> </a>
A <em class="cEmphasis">transaction timeout</em> defines the duration of a transaction, which may involve several service requests. To define the transaction timeout for an application, pass the <code class="cCode">T-OUT</code> argument to <code class="cCode">TPBEGIN</code>.
</p>
<p class="pBody"><a name="wp1155641"> </a>
The system may return timeout errors on communication calls for either blocking or transaction timeouts, and on <code class="cCode">TPCOMMIT</code> for transaction timeouts only. In each case, if a process is in transaction mode and the system returns <code class="cCode">TPETIME</code> on a failed call, a transaction timeout has occurred.
</p>
<p class="pBody"><a name="wp1155642"> </a>
By default, if a process is not in transaction mode, the system performs blocking timeouts. 
</p>
<p class="pBody"><a name="wp1155643"> </a>
If a process is not in transaction mode and a blocking timeout occurs on an asynchronous call, the communication call that blocked fails, but the call descriptor is still valid and may be used on a reissued call. Other communication is not affected.
</p>
<p class="pBody"><a name="wp1155644"> </a>
When a transaction timeout occurs, the communication handle to an asynchronous transaction reply (specified without <code class="cCode">TPNOTRAN</code>) becomes stale and may no longer be referenced. 
</p>
<p class="pBody"><a name="wp1155645"> </a>
<code class="cCode">TPETIME</code> indicates a blocking timeout on a communication call if the call was not made in transaction mode or if <code class="cCode">TPNOBLOCK</code> was not set.
</p>
<a name="wp1155646"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If you set <code class="cCode">TPNOBLOCK</code>, a blocking timeout cannot occur because the call returns immediately if a blocking condition exists.</td>
</tr>
</table>

<p class="pBody"><a name="wp1155649"> </a>
For additional information on handling timeout errors, refer to <a href="pberr.html#wp1155712">Transaction Considerations</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155651"> </a>
Transaction Errors
</h2><p class="pBody"><a name="wp1155652"> </a>
For information on transactions and the non-fatal and fatal errors that can occur, refer to <a href="pberr.html#wp1155712">Transaction Considerations</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1400207"> </a>
Typed Record Errors
</h2><p class="pBody"><a name="wp1155657"> </a>
Typed record errors are returned when requests or replies to processes are sent in records of an unknown type. The <code class="cCode">TPCALL</code> and <code class="cCode">TPACALL</code> calls return <code class="cCode">TPEITYPE</code> when a request data record is sent to a service that does not recognize the type of the record.
</p>
<p class="pBody"><a name="wp1155658"> </a>
Processes recognize record types that are identified in both the configuration file and the Oracle Tuxedo system libraries that are linked into the process. These libraries define and initialize a data structure that identifies the typed records that the process recognizes. You can tailor the library to each process, or an application can supply its own copy of a file that defines the record types. An application can set up the record type data structure (referred to as a record type switch) on a process-specific basis. For more information, see <a href="../rf5/rf5.html">tuxtypes(5)</a>and <a href="../rf5/rf5.html">typesw(5)</a> in the <em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em>. 
</p>
<p class="pBody"><a name="wp1155662"> </a>
The <code class="cCode">TPCALL</code> and <code class="cCode">TPGETRPLY</code> calls return <code class="cCode">TPEOTYPE</code> when a reply message is sent in a record that is not recognized or not allowed by the caller. In the latter case, the record type is included in the type switch, but the type returned does not match the record that was allocated to receive the reply and a change in record type is not allowed by the caller. The caller indicates this preference by setting <code class="cCode">TPNOCHANGE</code>. In this case, strong type checking is enforced; the system returns <code class="cCode">TPEOTYPE</code> when it is violated. By default, weak type checking is used. In this case, a record type other than the type originally allocated may be returned, as long as that type is recognized by the caller. The rules for sending replies are that the reply record must be recognized by the caller and, if strong type checking has been indicated, you must observe it.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155665"> </a>
Application Errors
</h2><p class="pBody"><a name="wp1155666"> </a>
Within an application, you can pass information about user-defined errors to calling programs using the <code class="cCodeEmphasis">rcode</code> argument of <code class="cCode">TPRETURN</code>. Also, the system sets the value of <code class="cCode">APPL-RETURN-CODE</code> to the value of <code class="cCode">APPL-CODE IN TPSVCRET-REC</code> during <code class="cCode">TPRETURN</code>. For more information about TPRETURN(<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>3cbl)</span>, refer to the <em class="cEmphasis">Oracle Tuxedo ATMI COBOL Function Reference</em>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155677"> </a>
Handling Errors
</h2><p class="pBody"><a name="wp1155678"> </a>
Your application logic should test for error conditions for the calls that have return values, and take appropriate action when an error occurs. 
</p>
<p class="pBody"><a name="wp1400722"> </a>
The following example shows a typical method of handling errors. The term <code class="cCode">ATMICALL</code>(3) is used in this example to represent a generic ATMI call.
</p>
<div class="pCodeTitle"><a name="wp1400724"> </a>
Listing&#160;11-1	   Handling Errors
</div> <a name="wp1400725"> </a><div class="pPreformatted"><pre>. . .<br />CALL &quot;TPINITIALIZE&quot; USING TPINFDEF-REC<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USR-DATA-REC<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TPSTATUS-REC.<br />IF NOT TPOK<br />&#160;&#160;&#160;<em class="cEmphasis">error message</em>, EXIT PROGRAM<br />CALL &quot;TPBEGIN&quot; USING TPTRXDEF-REC<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TPSTATUS-REC.<br />IF NOT TPOK<br />&#160;&#160;&#160;<em class="cEmphasis">error message</em>, EXIT PROGRAM<br /><br />&#160;&#160;&#160;<em class="cEmphasis">Make atmi calls<br /></em>&#160;&#160;&#160;<em class="cEmphasis">Check return values<br /></em><br />IF  TPEINVAL<br />&#160;&#160;&#160;&#160;&#160;&#160;DISPLAY &quot;Invalid arguments were given.&quot;<br />IF  TPEPROTO<br />&#160;&#160;&#160;&#160;&#160;&#160;DISPLAY &quot;A call was made in an improper context.&quot;<br />. . .<br />&#160;&#160;&#160;<em class="cEmphasis">Include all error cases described in the ATMICALL(3) <br />&#160;&#160;&#160;reference page. Other return codes are not possible,<br />&#160;&#160;&#160;so there is no need to test them.<br /></em>. . .<br />&#160;&#160;&#160;<em class="cEmphasis">continue</em></pre></div><p class="pBody"><a name="wp1155698"> </a>
The values of <code class="cCode">TP-STATUS</code> provide details about the nature of each problem and suggest the level at which it can be corrected. If your application defines a list of error conditions specific to your processing, the same can be said for the values of <code class="cCode">APPL-RETURN-CODE IN TPSTATUS-REC</code>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155712"> </a>
Transaction Considerations
</h2><p class="pBody"><a name="wp1155713"> </a>
The following sections describe how various programming features work when used in transaction mode. The first section provides rules of basic communication etiquette that should be observed in code written for transaction mode.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155714"> </a>
Communication Etiquette
</h2><p class="pBody"><a name="wp1155715"> </a>
When writing code to be run in transaction mode, you must observe the following rules of basic communication etiquette:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155716"> </a>Processes that are participants in the same transaction must require replies for all requests. To include a request that requires no reply, set <code class="cCode">TPACALL</code> to <code class="cCode">TPNOTRAN</code> or <code class="cCode">TPNOREPLY</code>.</li>
<li><a name="wp1155717"> </a>A service must retrieve all asynchronous transaction replies before calling <code class="cCode">TPRETURN</code> or <code class="cCode">TPFORWAR</code>. This rule must be observed regardless of whether the code is running in transaction mode.</li>
<li><a name="wp1155718"> </a>The initiator must retrieve all asynchronous transaction replies (made without <code class="cCode">TPNOTRAN</code>) before calling <code class="cCode">TPCOMMIT</code>.</li>
<li><a name="wp1276052"> </a>Replies must be retrieved for asynchronous calls that expect replies from non-participants of the transaction, that is, replies to requests made with <code class="cCode">TPACALL</code> in which the transaction, but not the reply, is suppressed.</li>
<li><a name="wp1276053"> </a>If a transaction has not timed out but is marked &#8220;abort-only,&#8221; any further communication should be performed with <code class="cCode">TPNOTRAN</code> set so that the results of the communication are preserved after the transaction is rolled back.</li>
<li><a name="wp1155721"> </a>If a transaction has timed out:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1155722"> </a>The handle for the timed-out call becomes stale and any further reference to it returns <code class="cCode">TPEBADDESC</code>.</li>
<li><a name="wp1155723"> </a>Further calls to <code class="cCode">TPGETRPLY</code> or <code class="cCode">TPRECV</code> for any outstanding handles return a global state of transaction timeout; the system sets <code class="cCode">TP-STATUS</code> to <code class="cCode">TPETIME</code>.</li>
<li><a name="wp1155724"> </a>Asynchronous calls can be made with <code class="cCode">TPACALL</code> set to <code class="cCode">TPNOREPLY</code>, <code class="cCode">TPNOBLOCK</code>, or <code class="cCode">TPNOTRAN</code>.</li>
</ul></div>
<li><a name="wp1155725"> </a>Once a transaction has been marked &#8220;abort-only&#8221; for reasons other than timeout, a call to <code class="cCode">TPGETRPLY</code> returns whatever value represents the local state of the call; that is, it returns either success or an error code that reflects the local condition.</li>
<li><a name="wp1260132"> </a>Once a handle is used with <code class="cCode">TPGETRPLY</code> to retrieve a reply, or with <code class="cCode">TPSEND</code> or <code class="cCode">TPRECV</code> to report an error condition, it becomes invalid and any further reference to it returns <code class="cCode">TPEBADDESC</code>. This rule is always observed, regardless of whether the code is running in transaction mode.</li>
<li><a name="wp1155727"> </a>Once a transaction is aborted, all outstanding transaction call handles (made without <code class="cCode">TPNOTRAN</code>) become stale, and any further references to them return <code class="cCode">TPEBADDESC</code>.</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155729"> </a>
Transaction Errors
</h2><p class="pBody"><a name="wp1155730"> </a>
The following sections describe transaction-related errors. 
</p>
<h3 class="pHeading2"><a name="wp1155731"> </a>
Non-fatal Transaction Errors
</h3>
<p class="pBody"><a name="wp1155732"> </a>
When transaction errors occur, the system returns <code class="cCode">TPETRAN</code> in <code class="cCode">TP-STATUS</code>. The precise meaning of such an error, however, depends on the call that is returning it. <a href="pberr.html#wp224000">Table&#160;11-3</a> lists the calls that return transaction errors and describes possible causes of them. 
</p>
<p class="pGraphic"><a name="wp1155756"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp224000table1155733"><caption><a name="wp224000"> </a>
Table 11-3  Transaction Errors

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1155735"> </a>
Call
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1155737"> </a>
Cause
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155739"> </a>
<code class="cCode">TPBEGIN</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155741"> </a>
Usually caused by a transient system error that occur during an attempt to start the transaction. The problem may clear up with a repeated call.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155743"> </a>
<code class="cCode">TPCANCEL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155745"> </a>
Returns <code class="cCode">TPETRAN</code> when called from a transaction.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155747"> </a>
<code class="cCode">TPRESUME</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155749"> </a>
The Oracle Tuxedo system is unable to resume a global transaction because the caller is currently participating in work outside the global transaction with one or more resource managers. All such work must be completed before the global transaction can be resumed. The caller&#8217;s state with respect to the local transaction is unchanged.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155751"> </a>
<code class="cCode">TPCONNECT</code>, <code class="cCode">TPCALL</code>, and <code class="cCode">TPACALL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155753"> </a>
A call was made in transaction mode to a service that does not support transactions. Some services belong to server groups that access a database management system (DBMS) that, in turn, support transactions. Other services, however, do not belong to such groups. In addition, some services that support transactions may require interoperation with software that does not. For example, a service that prints a form may work with a printer that does not support transactions. Services that do not support transactions may not function as participants in a transaction. 
</div>
<div class="pCellBody"><a name="wp1155754"> </a>
The grouping of services into servers and server groups is an administrative task. In order to determine which services support transactions, check with your application administrator. 
</div>
<div class="pCellBody"><a name="wp1155755"> </a>
You can correct transaction-level errors at the application level by enabling the setting <code class="cCode">TPSVCDEF-REF</code> or by accessing the service for which an error was returned outside of the transaction. 
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1155758"> </a>
Fatal Transaction Errors
</h3>
<p class="pBody"><a name="wp1155759"> </a>
When a fatal transaction error occurs, the application should explicitly abort the transaction by having the initiator call <code class="cCode">TPABORT</code>. Therefore, it is important to understand the errors that are fatal to transactions. Three conditions cause a transaction to fail:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155760"> </a>The initiator or a participant in the transaction causes it to be marked &#8220;abort-only&#8221; for one of the following reasons:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1155761"> </a> <code class="cCode">TPRETURN</code> encounters an error while processing its arguments; <code class="cCode">TP-STATUS</code> is set to <code class="cCode">TPESVCERR</code>.</li>
<li><a name="wp1155762"> </a>The <code class="cCode">TP-RETURN-VAL</code> to <code class="cCode">TPRETURN</code> was set to <code class="cCode">TPFAIL</code>; <code class="cCode">TP-STATUS</code> is set to <code class="cCode">TPESVCFAIL</code>.</li>
<li><a name="wp1155763"> </a>The type of the reply record is not known or not allowed by the caller and, as a result, success or failure cannot be determined; <code class="cCode">TP-STATUS</code> is set to <code class="cCode">TPEOTYPE</code>.</li>
</ul></div>
<li><a name="wp1155764"> </a>The transaction times out; <code class="cCode">TP-STATUS</code> is set to <code class="cCode">TPETIME</code>.</li>
<li><a name="wp1155765"> </a><code class="cCode">TPCOMMIT</code> is called by a participant rather than by the originator of a transaction; <code class="cCode">TP-STATUS</code> is set to <code class="cCode">TPEPROTO</code>.</li>
</ul></div>
<p class="pBody"><a name="wp1155766"> </a>
The only protocol error that is fatal to transactions is calling <code class="cCode">TPCOMMIT</code> from the wrong participant in a transaction. This error can be corrected in the application during the development phase.
</p>
<p class="pBody"><a name="wp1155767"> </a>
If <code class="cCode">TPCOMMIT</code> is called after an initiator/participant failure or transaction timeout, the result is an implicit abort error. Then, because the commit failed, the transaction should be aborted.
</p>
<p class="pBody"><a name="wp1155768"> </a>
If the system returns <code class="cCode">TPESVCERR</code>, <code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPEOTYPE</code>, or <code class="cCode">TPETIME</code> for any communication call, the transaction should be aborted explicitly with a call to <code class="cCode">TPABORT</code>. You need not wait for outstanding communication handles before explicitly aborting the transaction. However, because these communication handles are considered stale after the call is aborted, any attempt to access them after the transaction is terminated returns <code class="cCode">TPEBADDESC</code>.
</p>
<p class="pBody"><a name="wp1155769"> </a>
In the case of <code class="cCode">TPESVCERR</code>, <code class="cCode">TPESVCFAIL</code>, and <code class="cCode">TPEOTYPE</code>, communication calls continue to be allowed as long as the transaction has not timed out. When these errors are returned, the transaction is marked abort-only. To preserve the results of any further work, you should call any communication functions with <code class="cCode">TPNOTRAN</code>. By setting this flag, you ensure that the work performed for the transaction marked &#8220;abort-only&#8221; will not be rolled back when the transaction is aborted.
</p>
<p class="pBody"><a name="wp1155770"> </a>
When a transaction timeout occurs, communication can continue, but communication requests cannot:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155771"> </a>Require replies</li>
<li><a name="wp1155772"> </a>Block</li>
<li><a name="wp1155773"> </a>Be performed on behalf of the caller&#8217;s transaction</li>
</ul></div>
<p class="pBody"><a name="wp1155774"> </a>
Therefore, to make asynchronous calls, you must set <code class="cCode">TPNOREPLY</code>, <code class="cCode">TPNOBLOCK</code>, or <code class="cCode">TPNOTRAN</code>.
</p>
<h3 class="pHeading2"><a name="wp1155775"> </a>
Heuristic Decision Errors
</h3>
<p class="pBody"><a name="wp1155776"> </a>
The <code class="cCode">TPCOMMIT</code> call may return <code class="cCode">TPEHAZARD</code> or <code class="cCode">TPEHEURISTIC</code>, depending on how <code class="cCode">TP-COMMIT-CONTROL</code> is set. 
</p>
<p class="pBody"><a name="wp1155777"> </a>
If you set <code class="cCode">TP-COMMIT-CONTROL</code> to <code class="cCode">TP-CMT-LOGGED</code>, the application obtains control before the second phase of a two-phase commit is performed. In this case, the application may not be aware of a heuristic decision that occurs during the second phase. 
</p>
<p class="pBody"><a name="wp1155778"> </a>
<code class="cCode">TPEHAZARD</code> or <code class="cCode">TPEHEURISTIC</code> can be returned in a one-phase commit, however, if a single resource manager is involved in the transaction and it returns a heuristic decision or a hazard indication during a one-phase commit.
</p>
<p class="pBody"><a name="wp1155779"> </a>
If you set <code class="cCode">TP_COMMIT_CONTROL</code> to <code class="cCode">TP_CMT_COMPLETE</code>, then the system returns <code class="cCode">TPEHEURISTIC</code> if any resource manager reports a heuristic decision, and <code class="cCode">TPEHAZARD</code> if any resource manager reports a hazard. <code class="cCode">TPEHAZARD</code> specifies that a participant failed during the second phase of commit (or during a one-phase commit) and that it is not known whether a transaction completed successfully.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155780"> </a>
Transaction Timeouts
</h2><p class="pBody"><a name="wp1155784"> </a>
As described in <a href="pberr.html#wp1155729">Transaction Errors</a>, two types of timeouts can occur in an Oracle Tuxedo application: blocking and transaction. The following sections describe how various programming features are affected by transaction timeouts. Refer to <a href="pberr.html#wp1155729">Transaction Errors</a> for more information on timeouts.
</p>
<h4 class="pHeading3"><a name="wp1401716"> </a>
TPCOMMIT Call
</h4>
<p class="pBody"><a name="wp1155790"> </a>
What is the state of a transaction if a timeout occurs after a call to <code class="cCode">TPCOMMIT</code>? If the transaction timed out and the system knows that it was aborted, the system reports these events by setting <code class="cCode">TP-STATUS</code> to <code class="cCode">TPEABORT</code>. If the status of the transaction is unknown, the system sets the error code to <code class="cCode">TPETIME</code>. 
</p>
<p class="pBody"><a name="wp1155791"> </a>
When the state of a transaction is in doubt, you must query the resource manager. First, verify whether or not any of the changes that were part of the transaction were applied. Then you can determine whether the transaction was committed or aborted.
</p>
<h3 class="pHeading2"><a name="wp1155792"> </a>
TPNOTRAN
</h3>
<p class="pBody"><a name="wp1155793"> </a>
When a process is in transaction mode and makes a communication call with <code class="cCode">TPNOTRAN</code>, it prohibits the called service from becoming a participant in the current transaction. Whether the service request succeeds or fails has no impact on the outcome of the transaction. The transaction can still timeout while waiting for a reply that is due from a service, whether it is part of the transaction or not.
</p>
<p class="pBody"><a name="wp1155796"> </a>
For additional information on using <code class="cCode">TPNOTRAN</code>, refer to <a href="pberr.html#wp1401863">TPRETURN and TPFORWAR Calls</a>.
</p>
<h3 class="pHeading2"><a name="wp1401863"> </a>
TPRETURN and TPFORWAR Calls
</h3>
<p class="pBody"><a name="wp1155806"> </a>
If you call a process while running in transaction mode, <code class="cCode">TPRETURN</code> and <code class="cCode">TPFORWAR</code> place the service portion of the transaction in a state that allows it to be either committed or aborted when the transaction completes. You can call a service several times on behalf of the same transaction. The system does not fully commit or abort the transaction until the initiator of the transaction calls <code class="cCode">TPCOMMIT</code> or <code class="cCode">TPABORT</code>.
</p>
<p class="pBody"><a name="wp1155807"> </a>
Neither <code class="cCode">TPRETURN</code> nor <code class="cCode">TPFORWAR</code> should be called until all outstanding handles for the communication calls made within the service have been retrieved. If you call <code class="cCode">TPRETURN</code> with outstanding handles for which <code class="cCode">TP-RETURN-VAL</code> is set to <code class="cCode">TPSUCCESS</code>, the system encounters a protocol error and returns <code class="cCode">TPESVCERR</code> to the process waiting on <code class="cCode">TPGETRPLY</code>. If the process is in transaction mode, the system marks the caller as &#8220;abort-only.&#8221; Even if the initiator of the transaction calls <code class="cCode">TPCOMMIT</code>, the system implicitly aborts the transaction. If you call <code class="cCode">TPRETURN</code> with outstanding handles for which <code class="cCode">TP-RETURN-VAL</code> is set to <code class="cCode">TPFAIL</code>, the system returns <code class="cCode">TPESVCFAIL</code> to the process waiting on <code class="cCode">TPGETRPLY</code>. The effect on the transaction is the same.
</p>
<p class="pBody"><a name="wp1155808"> </a>
When you call <code class="cCode">TPRETURN</code> while running in transaction mode, this function can affect the result of the transaction by the processing errors that it encounters or that are retrieved from the value placed in <code class="cCode">TP-RETURN-VAL</code> by the application. 
</p>
<p class="pBody"><a name="wp1155809"> </a>
You can use <code class="cCode">TPFORWAR</code> to indicate that success has been achieved up to a particular point in the processing of a request. If no application errors have been detected, the system invokes <code class="cCode">TPFORWAR</code>; otherwise, the system invokes <code class="cCode">TPRETURN</code> with <code class="cCode">TPFAIL</code>. If you call <code class="cCode">TPFORWAR</code> improperly, the system considers the call a processing error and returns a failed message to the requester.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155810"> </a>
tpterm( ) Function
</h2><p class="pBody"><a name="wp1155811"> </a>
Use the <code class="cCode">TPTERM</code> call to remove a client context from an application. 
</p>
<p class="pBody"><a name="wp1155812"> </a>
If the client context is in transaction mode, the call fails with <code class="cCode">TPEPROTO</code> returned in <code class="cCode">TP-STATUS</code>, and the client context remains part of the application and in transaction mode. 
</p>
<p class="pBody"><a name="wp1155813"> </a>
When the call is successful, the client context is allowed no further communication or participation in transactions because the current thread of execution is no longer part of the application.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155814"> </a>
Resource Managers
</h2><p class="pBody"><a name="wp1155815"> </a>
When you use an ATMI call to define transactions, the Oracle Tuxedo system executes an internal call to pass any global transaction information to each resource manager participating in the transaction. When you call <code class="cCode">TPCOMMIT</code> or <code class="cCode">TPABORT</code>, for example, the system makes internal calls to direct each resource manager to commit or abort the work it did on behalf of the caller&#8217;s global transaction. 
</p>
<p class="pBody"><a name="wp1155816"> </a>
When a global transaction has been initiated, either explicitly or implicitly, you should not make explicit calls to the resource manager&#8217;s transaction calls in your application code. Failure to follow this transaction rule causes indeterminate results. You can use the <code class="cCode">TPGETLEV</code> call to determine whether a process is already in a global transaction before calling the resource manager&#8217;s transaction call.
</p>
<p class="pBody"><a name="wp1155817"> </a>
Some resource managers allow programmers to configure certain parameters (such as the transaction consistency level) by specifying options available in the interface to the resource managers themselves. Such options are made available in two forms:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155818"> </a>Resource manager-specific function calls that can be used by programmers of distributed applications to configure options.</li>
<li><a name="wp1155819"> </a>Hard-coded options incorporated in the transaction interface supplied by the provider of the resource manager.</li>
</ul></div>
<p class="pBody"><a name="wp1155820"> </a>
Consult the documentation for your resource managers for additional information.
</p>
<p class="pBody"><a name="wp1155821"> </a>
The method of setting options varies for each resource manager. In the Oracle Tuxedo System SQL resource manager, for example, the <code class="cCode">set transaction</code> statement is used to negotiate specific options (consistency level and access mode) for a transaction that has already been started by the Oracle Tuxedo system.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155822"> </a>
Sample Transaction Scenarios
</h2><p class="pBody"><a name="wp1155823"> </a>
The following sections provide some considerations for the following transaction scenarios:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155827"> </a><a href="pberr.html#wp1155837">Called Service in Same Transaction as Caller</a></li>
<li><a name="wp1155831"> </a><a href="pberr.html#wp1155844">Called Service in Different Transaction with AUTOTRAN Set</a></li>
<li><a name="wp1155835"> </a><a href="pberr.html#wp1155862">Called Service That Starts a New Explicit Transaction</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1155837"> </a>
Called Service in Same Transaction as Caller
</h3>
<p class="pBody"><a name="wp1155838"> </a>
When a caller in transaction mode calls another service to participate in the current transaction, the following facts apply:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155839"> </a> <code class="cCode">TPRETURN</code> and <code class="cCode">TPFORWAR</code>, when called by the participating service, place that service&#8217;s portion of the transaction in a state from which it can be either aborted or committed by the initiator.</li>
<li><a name="wp1155840"> </a>The success or failure of the called process affects the current transaction. If any fatal transaction errors are encountered by the participant, the current transaction is marked &#8220;abort-only.&#8221;</li>
<li><a name="wp1155841"> </a>Whether or not the tasks performed by a successful participant are applied depends on the fate of the transaction. In other words, if the transaction is aborted, the work of all participants is reversed.</li>
<li><a name="wp1155842"> </a><code class="cCode">TPNOREPLY</code> cannot be used when calling another service to participate in the current transaction.</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1155844"> </a>
Called Service in Different Transaction with AUTOTRAN Set
</h3>
<p class="pBody"><a name="wp1155845"> </a>
If you issue a communication call with <code class="cCode">TPNOTRAN</code> set and the called service is configured such that a transaction automatically starts when the service is called, the system places both the calling and called processes in transaction mode, but the two constitute different transactions. In this situation, the following facts apply:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155846"> </a> <code class="cCode">TPRETURN</code> plays the initiator&#8217;s transaction role: it terminates the transaction in the service in which the transaction was automatically started. Alternatively, if the transaction is automatically started in a service that terminates with <code class="cCode">TPFORWAR</code>, the <code class="cCode">TPRETURN</code> call issued in the last service in the forward chain plays the initiator&#8217;s transaction role: it terminates the transaction. (For an example, refer to the figure called <a href="pberr.html#wp1405731">Transaction Roles of TPFORWAR and TPRETURN with AUTOTRAN</a>.)</li>
<li><a name="wp1155850"> </a>Because it is in transaction mode, <code class="cCode">TPRETURN</code> is vulnerable to the failure of any participant in the transaction, as well as to transaction timeouts. In this scenario, the system is more likely to return a failed message.</li>
<li><a name="wp1155851"> </a>The state of the caller&#8217;s transaction is not affected by any failed messages or application failures returned to the caller.</li>
<li><a name="wp1155852"> </a>The caller&#8217;s own transaction may timeout as the caller waits for a reply.</li>
<li><a name="wp1155853"> </a>If no reply is expected, the caller&#8217;s transaction cannot be affected in any way by the communication call.</li>
<div class="pFigureTitle"><a name="wp1405731"> </a>
Figure&#160;11-1  Transaction Roles of TPFORWAR and TPRETURN with AUTOTRAN
</div>

 
 <p class="pGraphic"><a name="wp1405735"> </a>
<br />
<img src="wwimages/transaction%7e1.gif" alt="Transaction Roles of TPFORWAR and TPRETURN with AUTOTRAN" id="wp1405733"/><br />

</p>
</ul></div>
<h3 class="pHeading2"><a name="wp1155862"> </a>
Called Service That Starts a New Explicit Transaction
</h3>
<p class="pBody"><a name="wp1259842"> </a>
If a communication call is made with <code class="cCode">TPNOTRAN</code>, and the called service is not automatically placed in transaction mode by a configuration option, the service can define multiple transactions using explicit calls to <code class="cCode">TPBEGIN</code>, <code class="cCode">TPCOMMIT</code>, and <code class="cCode">TPABORT</code>. As a result, the transaction can be completed before a call is issued to <code class="cCode">TPRETURN</code>.
</p>
<p class="pBody"><a name="wp1155864"> </a>
In this situation, the following facts apply:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155865"> </a><code class="cCode">TPRETURN</code> plays no transaction role; that is, the role of <code class="cCode">TPRETURN</code> is always the same, regardless of whether transactions are explicitly defined in the service routine.</li>
<li><a name="wp1155866"> </a> <code class="cCode">TPRETURN</code> can return any value in <code class="cCode">TP-RETURN-VAL</code>, regardless of the outcome of the transaction.</li>
<li><a name="wp1155867"> </a>Typically, the system returns processing errors, record type errors, or application failure, and follows the normal rules for <code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPEITYPE</code>/<code class="cCode">TPEOTYPE</code>, and <code class="cCode">TPESVCERR</code>.</li>
<li><a name="wp1155868"> </a>The state of the caller&#8217;s transaction is not affected by any failed messages or application failures returned to the caller.</li>
<li><a name="wp1155869"> </a>The caller is vulnerable to the possibility that its own transaction may time out as it waits for its reply.</li>
<li><a name="wp1155870"> </a>If no reply is expected, the caller&#8217;s transaction cannot be affected in any way by the communication call.</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155871"> </a>
Oracle TUXEDO System-supplied Subroutines
</h2><p class="pBody"><a name="wp1160979"> </a>
The Oracle Tuxedo system-supplied subroutines, <code class="cCode">TPSVRINIT</code> and <code class="cCode">TPSVRDONE</code>, must follow certain rules when used in transactions.
</p>
<p class="pBody"><a name="wp1155873"> </a>
The Oracle Tuxedo system server calls <code class="cCode">TPSVRINIT</code> during initialization. Specifically, <code class="cCode">TPSVRINIT</code> is called after the calling process becomes a server but before it starts handling service requests. If <code class="cCode">TPSVRINIT</code> performs any asynchronous communication, all replies must be retrieved before the function returns; otherwise, the system ignores all pending replies and the server exits. If <code class="cCode">TPSVRINIT</code> defines any transactions, they must be completed with all asynchronous replies retrieved before the function returns; otherwise, the system aborts the transaction and ignores all outstanding replies. In this case, the server exits gracefully.
</p>
<p class="pBody"><a name="wp1155874"> </a>
The Oracle Tuxedo system server abstraction calls <code class="cCode">TPSVRDONE</code> after it finishes processing service requests but before it exits. At this point, the server&#8217;s services are no longer advertised, but the server has not yet left the application. If <code class="cCode">TPSVRDONE</code> initiates communication, it must retrieve all outstanding replies before it returns; otherwise, pending replies are ignored by the system and the server exits. If a transaction is started within <code class="cCode">TPSVRDONE</code>, it must be completed with all replies retrieved; otherwise, the system aborts the transaction and ignores the replies. In this case, too, the server exits.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155876"> </a>
Central Event Log
</h2><p class="pBody"><a name="wp1155877"> </a>
The central event log is a record of significant events in your Oracle Tuxedo application. Messages about these events are sent to the log by your application clients and services via the USERLO<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>G(3cbl)</span> routine. 
</p>
<p class="pBody"><a name="wp1155878"> </a>
Any analysis of the central event log must be provided by the application. You should establish strict guidelines for the events that are to be recorded in the USERL<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>OG(3cbl)</span>. Application debugging can be simplified by eliminating trivial messages.
</p>
<p class="pBody"><a name="wp1358049"> </a>
For information on configuring the central event log on the Windows 2003 platform, refer to <em class="cEmphasis">Using Oracle Tuxedo ATMI on Windows</em>.
</p>
<h3 class="pHeading2"><a name="wp1358053"> </a>
Log Name
</h3>
<p class="pBody"><a name="wp1155880"> </a>
The application administrator defines (in the configuration file) the absolute pathname that is used as the prefix of the name of the error message file on each machine. The USER<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>LOG(3cbl)</span> routine creates a date&#8212;in the form <code class="cCodeEmphasis">mmddyy</code>, representing the month, day, and year&#8212;and adds this date to the pathname prefix, forming the full filename of the central event log. A new file is created daily. Thus, if a process sends messages to the central event log on succeeding days, the messages are written into different files.
</p>
<h3 class="pHeading2"><a name="wp1155881"> </a>
Log Entry Format
</h3>
<p class="pBody"><a name="wp1155882"> </a>
Entries in the log consist of the following components:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155883"> </a>Tag consisting of:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1155884"> </a>Time of day (<code class="cCodeEmphasis">hhmmss</code>)</li>
<li><a name="wp1155885"> </a>Machine name (for example, the name returned by the <code class="cCode">uname</code>(1) command on a UNIX system)</li>
<li><a name="wp1155886"> </a>Name, process ID, and thread ID (which is 0 on platforms that do not support threads) of the thread calling USE<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>RLOG(3cbl)</span></li>
<li><a name="wp1155887"> </a>Context ID of the thread calling USER<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>LOG(3cbl)</span></li>
</ul></div>
<li><a name="wp1155888"> </a>Message text</li>
<p class="pBodyRelative"><a name="wp1155889"> </a>
The text of each message is preceded by the catalog name and number of that message.
</p>
</ul></div>
<p class="pBody"><a name="wp1155891"> </a>
For example, suppose that a security program executes the following call at <code class="cCode">4:22:14pm</code> on a UNIX machine called <code class="cCode">mach1</code> (as returned by the <code class="cCode">uname</code> command): 
</p>
<a name="wp1403269"> </a><div class="pPreformattedRelative"><pre>01 <em class="cEmphasis">LOG-REC</em> PIC X(15) VALUE &quot;UNKNOWN USER &quot;.<br />01 <em class="cEmphasis">LOGREC-LEN</em> PIC S9(9) VALUES IS 13.<br />CALL &quot;USERLOG&quot; USING <em class="cEmphasis">LOG-REC LOGREC-LEN TPSTATUS-REC</em>.</pre></div><p class="pBody"><a name="wp1155894"> </a>
The resulting log entry appears as follows: 
</p>
<a name="wp1155895"> </a><div class="pPreformattedRelative"><pre>162214.mach1!security.23451: UNKNOWN USER</pre></div><p class="pBody"><a name="wp1155896"> </a>
In this example, the process ID for security is <code class="cCode">23451</code>.
</p>
<p class="pBody"><a name="wp1155897"> </a>
If the preceding message was generated by the Oracle Tuxedo system (rather than by the application), it might appear as follows: 
</p>
<a name="wp1155898"> </a><div class="pPreformattedRelative"><pre>162214.mach1!security.23451: COBAPI_CAT: 999: UNKNOWN USER</pre></div><p class="pBody"><a name="wp1155899"> </a>
In this case, the message catalog name is <code class="cCode">COBAPI_CAT </code>and the message number is <code class="cCode">999</code>.
</p>
<p class="pBody"><a name="wp1155900"> </a>
If the message is sent to the central event log while the process is in transaction mode, other components are added to the tag in the user log entry. These components consist of the literal string <code class="cCode">gtrid</code> followed by three long hexadecimal integers. The integers uniquely identify the global transaction and make up what is referred to as the global transaction identifier, that is, the <code class="cCode">gtrid</code>. This identifier is used mainly for administrative purposes, but it also appears in the tag that prefixes the messages in the central event log. If the system writes the message to the central event log in transaction mode, the resulting log entry appears as follows: 
</p>
<a name="wp1155901"> </a><div class="pPreformattedRelative"><pre>162214.mach1!security.23451: gtrid x2 x24e1b803 x239:<br />   UNKNOWN USER</pre></div><h3 class="pHeading2"><a name="wp1155902"> </a>
Writing to the Event Log
</h3>
<p class="pBody"><a name="wp1155903"> </a>
To write a message to the event log, you must perform the following steps:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155904"> </a>Assign the error message you wish to write to the log to a record and use the record name as the argument to the call.</li>
<li><a name="wp1155905"> </a>Specify the literal text of the message within double quotes, as the argument to the USER<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>LOG(3cbl)</span> call, as shown in the following example:</li>
<a name="wp1403450"> </a><div class="pPreformatted"><pre>01 TPSTATUS-REC.<br />   COPY TPSTATUS.<br />01 LOGMSG     PIC X(50).<br />01 LOGMSG-LEN PIC S9(9) COMP-5. <br />. . .<br />CALL &quot;TPOPEN&quot; USING TPSTSTUS-REC.<br />IF NOT TPOK<br />        MOVE &quot;TPSVRINIT: Cannot Open Data Base&quot; TO LOGMSG<br />        MOVE 43 LOGMSG-LEN<br />        CALL &quot;USERLOG&quot; USING LOGMSG<br />                       LOGMSG-LEN<br />                       TPSTATUS-REC.<br />. . .</pre></div></ul></div>
<p class="pBody"><a name="wp1155908"> </a>
In this example, the message is sent to the central event log if TPO<span class="cHyperlink">
<a href="../rf3cbl/rf3cbl.html"></a>PEN(3cbl)</span> returns <code class="cCode">-1</code>.
</p>
<p class="pBody"><a name="wp1155942"> </a>
 
</p>
 
<br/>
    <table id="SummaryNotReq3" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="pberr.html"><img id="LongDescNotReq7" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="pbthr.html"><img id="LongDescNotReq8" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="pgbind.html"><img id="LongDescNotReq9" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
