<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="11" />
<meta name="LOC_US_CHANGE" content="42015" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux12c/ads/fm/adtrn.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="06/29/12 11:10:25" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>About Transactions</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Setting Up an Oracle Tuxedo Application
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="adfig.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="adtran.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/ads.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1042235"> </a>
About Transactions
</h1>
<p class="pBody"><a name="wp1011477"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1041143"> </a><a href="adtrn.html#wp1038681">What Is a Transaction?</a></li>
<li><a name="wp1039657"> </a><a href="adtrn.html#wp1042663">Benefits of Using Transactions</a></li>
<li><a name="wp1039658"> </a><a href="adtrn.html#wp1038957">Example of a Global Transaction</a></li>
<li><a name="wp1039659"> </a><a href="adtrn.html#wp1038469">What Is the Oracle Tuxedo Transaction Manager (TM)?</a></li>
<li><a name="wp1039660"> </a><a href="adtrn.html#wp1032828">How the System Tracks Distributed Transaction Processing</a></li>
<li><a name="wp1039675"> </a><a href="adtrn.html#wp1028457">How the System Uses a Two-Phase Commit to Commit Transactions</a></li>
</ul></div>
<a name="wp1041171"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>For information about using transactions in an Oracle Tuxedo CORBA environment, refer to <em class="cEmphasis">Using CORBA Transactions</em>.</td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1038681"> </a>
What Is a Transaction?
</h2><p class="pBody"><a name="wp1028449"> </a>
A <em class="cEmphasis">transaction</em> is a set of related actions. A <em class="cEmphasis">global transaction</em> is a set of related actions that span multiple programs and resource managers. In this topic, whenever we use the term transaction, we are referring to a global transaction.
</p>
<p class="pBody"><a name="wp1040410"> </a>
A simple example of a transaction is a withdrawal from a bank account, which can be described as a set of actions that changes the state of an account balance (by reducing it). For this transaction, the system must execute a procedure that consists of three operations:
</p>
<p class="pGraphic"><a name="wp1043390"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1036226table1036220">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1036226"> </a>
Procedure for Any Transaction
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1036228"> </a>
Procedure for Bank Withdrawal Example
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1036230"> </a>
1. Verify the activity to be performed
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1036232"> </a>
1. Verify that a withdrawal will be made
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1036234"> </a>
2. Perform the work of the transaction
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1036236"> </a>
2. Withdraw a specified amount from the account
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1036238"> </a>
3. Create a permanent record of the completed work
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1036240"> </a>
3. Update the record of the balance of the account
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1030816"> </a>
These steps are performed by a discrete software module created expressly for the purpose of executing this transaction. The module must also include or use code that launches and ends the transaction. If the code sections that launch and end the transaction are not part of the main transaction software module, then they are usually packaged together in a separate module.
</p>
<p class="pBody"><a name="wp1031007"> </a>
A <em class="cEmphasis">transaction coordinator</em> is a software module that executes the logic to manage a transaction among all participating resources.
</p>
<h3 class="pHeading2"><a name="wp1036680"> </a>
What Are the ACID Properties?
</h3>
<p class="pBody"><a name="wp1038726"> </a>
When a transaction such as a bank withdrawal is performed, it is imperative that all its constituent operations either succeed or fail together. Consider the problems that can occur if one operation in a transaction succeeds while another operation in the same transaction fails: a bank that allows a customer to withdraw money without recording the reduced balance in an updated account record will not stay in business for long!
</p>
<p class="pBody"><a name="wp1038727"> </a>
A transaction that adheres to the rule that all constituent operations either succeed or fail is characterized by <em class="cEmphasis">atomicity</em>. The Oracle Tuxedo system requires all transactions to be characterized by atomicity and three related attributes: <em class="cEmphasis">consistency</em>, <em class="cEmphasis">isolation</em>, and <em class="cEmphasis">durability</em>. These four attributes are known collectively as the <em class="cEmphasis">ACID properties</em> of transactions performed within the Oracle Tuxedo system.
</p>
<p class="pBody"><a name="wp1043082"> </a>
<a href="adtrn.html#wp1042588">Table&#160;3-1</a> shows the ACID of Oracle Tuxedo Transactions.
</p>
<p class="pGraphic"><a name="wp1038749"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1042588table1038728"><caption><a name="wp1042588"> </a>
Table 3-1  ACID Properties of Oracle Tuxedo Transactions

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1042568"> </a>
This Property . . . 
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1042570"> </a>
Means That . . .
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042572"> </a>
Atomicity
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042574"> </a>
A transaction is a discrete unit of work: all constituent operations must either succeed or fail. These operations may include queuing messages, updating databases, and displaying the results of a transaction on a screen. 
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042576"> </a>
Consistency
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042578"> </a>
A transaction must either (a) leave the system in a correct state or (b) abort. If a transaction cannot achieve a stable state, it must return to its initial state. 
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042580"> </a>
Isolation
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042582"> </a>
The behavior of a transaction is not affected by other transactions being executed simultaneously. A transaction must serialize all access to shared resources and guarantee that concurrent programs do not corrupt each other&#8217;s operations. 
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042584"> </a>
Durability
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042586"> </a>
The effects of a committed transaction are permanent. Even if the system fails, the changes resulting from a transaction are permanent and durable.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1042645"> </a>
How a Transaction Succeeds or Fails
</h3>
<p class="pBody"><a name="wp1042661"> </a>
Whether a transaction succeeds or fails depends on the requirements of atomicity.
</p>
<p class="pGraphic"><a name="wp1042766"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1042813table1042811">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1042813"> </a>
If . . .
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1042815"> </a>
Then . . .
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042817"> </a>
Any operation within the transaction fails for any reason
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1042819"> </a>The transaction <em class="cEmphasis">aborts</em>, that is, it terminates abruptly.</li>
<li><a name="wp1042820"> </a>The transaction <em class="cEmphasis">rolls back</em>, that is, it undoes its own work and restores the state of the enterprise to its pre-transaction state. For example, after an attempt to withdraw money from a bank account fails and is rolled back, the bank account contains the same amount of money it contained before the transaction, and the record of the account balance shows the same amount that it showed before the transaction.</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042822"> </a>
All operations within the transaction succeed
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1042824"> </a>
The client <em class="cEmphasis">commits</em> the transaction. In other words, it formally signals that it is ready to terminate and the effects of the transaction should be preserved: the order database is updated permanently and the order sent to the shipping department is kept as a permanent record in that department&#8217;s queue.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1042663"> </a>
Benefits of Using Transactions
</h2><p class="pBody"><a name="wp1039033"> </a>
The Oracle Tuxedo system, including its communication APIs and protocols, is designed to support the use of transactions. The Oracle Tuxedo communication calls, which make it easy to create transactions, are indispensable tools for writing distributed applications.
</p>
<p class="pBody"><a name="wp1039034"> </a>
By using transactions you can:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1039035"> </a>Create distributed applications easily</li>
<li><a name="wp1039036"> </a>Commit the effects of your communications as a single unit</li>
<li><a name="wp1039037"> </a>Quickly manage potential problems that may occur in a distributed environment, such as machine, program, or network failures</li>
<li><a name="wp1039038"> </a>Undo work, when errors occur, in a simple, programmatic way</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1038957"> </a>
Example of a Global Transaction
</h2><p class="pBody"><a name="wp1038243"> </a>
An e-retailer uses a service called <code class="cCode">CUST_ORDER</code>. When a customer places an order through the company&#8217;s Web site, the <code class="cCode">CUST_ORDER</code> service performs two operations:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1038244"> </a>It updates the company&#8217;s database of orders.</li>
<li><a name="wp1038245"> </a>It sends the new order to the shipping department, where it is put on a queue, awaiting fulfillment.</li>
</ul></div>
<p class="pBody"><a name="wp1038246"> </a>
The company wants to be sure that the <code class="cCode">CUST_ORDER</code> service adheres to the principle of atomicity: whenever <code class="cCode">CUST_ORDER</code> is executed, both the database update and the enqueueing of the customer request on the shipping department queue must be completed successfully. To make sure that the <code class="cCode">CUST_ORDER</code> service always handles customer orders with atomicity, the client that invokes <code class="cCode">CUST_ORDER</code> associates its request with a <em class="cEmphasis">global transaction</em>.
</p>
<p class="pBody"><a name="wp1038247"> </a>
To associate a service with a global transaction, a client:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1038248"> </a>Calls <code class="cCode">tpbegin()</code> to begin the transaction </li>
<li><a name="wp1038249"> </a>Issues a service request</li>
<li><a name="wp1038250"> </a>Calls <code class="cCode">tpcommit()</code> to end the transaction</li>
</ol></div>
<p class="pBody"><a name="wp1037552"> </a>
As part of a global transaction, the operation is performed as a single unit of work. When the <code class="cCode">CUST_ORDER</code> service is invoked, the server is propagated with the client&#8217;s transaction. The two resulting operations, accessing the order database and enqueuing the order to the shipping queue, become part of the client&#8217;s transaction.
</p>
<p class="pBody"><a name="wp1039937"> </a>
If either operation fails for any reason, whether due to a system error or an application error, the work of the transaction is undone or <em class="cEmphasis">rolled back</em>. In other words, the transaction is returned to its initial state.
</p>
<p class="pBody"><a name="wp1039969"> </a>
If both operations succeed, however, the client <em class="cEmphasis">commits</em> the transaction. In other words, it formally signals that the effects of the transaction should be made permanent: the order database is updated permanently and the order sent to the shipping department is kept in that department&#8217;s queue.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1038469"> </a>
What Is the Oracle Tuxedo Transaction Manager (TM)?
</h2><p class="pBody"><a name="wp1038560"> </a>
A <em class="cEmphasis">resource manager</em> (RM) is a data repository, such as a database management system or the Application Queuing Manager, with tools for accessing the data. The Oracle Tuxedo system uses one or more RMs to maintain the state of an application. For example, bank records in which account balances are maintained are kept in an RM. When the state of the application changes through a service that allows a customer to withdraw money from an account, the new balance in the account is recorded in the appropriate RM.
</p>
<p class="pBody"><a name="wp1038561"> </a>
The Oracle Tuxedo system helps you manage transactions involving resource managers that support the XA interface. To coordinate all the operations performed and all the modules affected by a transaction, the Oracle Tuxedo system plays the role of the Transaction Manager (TM).
</p>
<p class="pBody"><a name="wp1039336"> </a>
The TM coordinates global transactions involving system-wide resources. Local resource managers (RMs) are responsible for individual resources. The Transaction Manager Server (TMS) begins, commits, and aborts transactions involving multiple resources. The application code uses the normal embedded SQL interface to the RM to perform reads and updates. The TMS uses the XA interface to the RM to perform the work of a global transaction.
</p>
<p class="pBody"><a name="wp1038506"> </a>
<a href="adtrn.html#wp1039279">Table&#160;3-2</a> summarizes the actions taken by the Transaction Manager on behalf of each transaction.
</p>
<p class="pGraphic"><a name="wp1042864"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1039279table1038473"><caption><a name="wp1039279"> </a>
Table 3-2  <span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">Actions Performed by the Transaction Manager </span>

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1039283"> </a>
When . . .
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1039285"> </a>
The Transaction Manager . . .
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039287"> </a>
The application launches a transaction
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039289"> </a>
Assigns a global transaction identifier (<code class="cCode">GTRID</code>) to the transaction.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039291"> </a>
Other processes communicate with the process that launched the transaction
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039293"> </a>
Tracks those <em style="font-style: italic" class="cEmphasis">communication partners</em><span style="font-style: normal">.</span>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039295"> </a>
The RM is accessed as part of the work of the transaction
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039297"> </a>
Passes the appropriate <code class="cCode">GTRID</code> to the RM so the RM can monitor which database records are being accessed for the transaction.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039299"> </a>
The application signals that a transaction is to be committed
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039301"> </a>
Performs a two-phase commit protocol. Specifically, it:<br />(a) contacts communication partners during Phase 1, (b) logs the successful outcome of Phase 1, and <br />(c) contacts partners in Phase 2.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039303"> </a>
The application indicates that the transaction is to be aborted
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039305"> </a>
Executes a rollback procedure. 
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039307"> </a>
A failure occurs
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1039309"> </a>
Executes a recovery procedure.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1032828"> </a>
How the System Tracks Distributed Transaction Processing
</h2><p class="pBody"><a name="wp1032750"> </a>
Oracle Tuxedo transactions can be used in a distributed architecture: a local machine involved in a transaction can communicate with a remote machine which may, in turn, communicate with another remote machine. The work of transactions executed in this type of arrangement is referred to as <em class="cEmphasis">distributed transaction processing</em>.
</p>
<p class="pBody"><a name="wp1037912"> </a>
Because the system must constantly maintain enough information about a transaction to be able to roll it back (that is, to restore it to its initial state) at any moment, tracking distributed transaction processing (DTP) can be a complex task. To perform this task successfully, the Oracle Tuxedo system stores tracking information about all the participants in a transaction in a dedicated file called a <em class="cEmphasis">transaction log</em>, or <code class="cCode">TLOG</code>.
</p>
<p class="pBody"><a name="wp1034584"> </a>
<a href="adtrn.html#wp1029292">Figure&#160;3-1</a> shows an application in which two Transaction Managers (TMs) are being used. Both TMs record tracking data in the same <code class="cCode">TLOG</code>.
</p>
<div class="pFigureTitle"><a name="wp1029292"> </a>
Figure&#160;3-1  Transaction Management
</div>

 
 <p class="pGraphic"><a name="wp1029296"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/commit.gif" alt="Transaction Management" id="wp1029294"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1039468"> </a>
Before committing a transaction, the TM must repeatedly answer the question of whether to proceed. If necessary, the TM makes the decision to roll back.
</p>
<h3 class="pHeading2"><a name="wp1039478"> </a>
How the System Uses Global Transaction Identifiers (GTRIDs) for Tracking
</h3>
<p class="pBody"><a name="wp1039526"> </a>
The Oracle Tuxedo system tracks the flow of all transactions being executed within a distributed system, including those being executed concurrently. When it is time to commit a transaction, the coordinator must know which RMs have participated in the transaction and, therefore, needs to be able to distinguish among transactions. For this reason the Oracle Tuxedo system assigns a <em class="cEmphasis">global transaction identifier, </em>or <code class="cCode">GTRID</code> to each transaction. 
</p>
<p class="pBody"><a name="wp1039488"> </a>
The Oracle Tuxedo system communicates with any RM accessed by an application through the XA interface. The RMs track transactions by assigning local transaction identifiers, and map global identifiers to local identifiers.
</p>
<h3 class="pHeading2"><a name="wp1039470"> </a>
How the System Uses a Transaction Log (TLOG) for Tracking
</h3>
<p class="pBody"><a name="wp1035295"> </a>
A global transaction is recorded in the transaction log (<code class="cCode">TLOG</code>) only when it is in the process of being committed. At the end of the first phase of a two-phase commit protocol, the <code class="cCode">TLOG</code> records the reply from the global transaction participants.
</p>
<p class="pBody"><a name="wp1035297"> </a>
The existence of a <code class="cCode">TLOG</code> record indicates that a global transaction should be committed; no <code class="cCode">TLOG</code> records are written for transactions that are to be rolled back.
</p>
<p class="pBody"><a name="wp1033160"> </a>
In the first &#8220;pre-commit&#8221; phase, each resource manager must commit to performing the transaction request. If all parties commit, transaction management performs the second phase: it commits and completes the transaction. If either task fails because of an application or system failure, both tasks fail and the work performed is undone or &#8220;rolled back&#8221; to its initial state.
</p>
<p class="pBody"><a name="wp1029300"> </a>
The <code class="cCode">TMS</code> that coordinates global transactions uses the <code class="cCode">TLOG</code> file. Each machine should have its own <code class="cCode">TLOG</code>.
</p>
<p class="pBody"><a name="wp1029287"> </a>
If you are using the Domains component in your application, keep in mind that the Domains gateway performs the functions of the <code class="cCode">TMS</code> in Domains groups. However, Domains uses its own transaction log containing information similar to that recorded in the <code class="cCode">TLOG</code>, in addition to Domains-specific information.
</p>
<h4 class="pHeading3"><a name="wp1043188"> </a>
Writing TLOG to an Oracle Database
</h4>
<p class="pBody"><a name="wp1043189"> </a>
If you want to write <code class="cCode">tlog</code> into an Oracle database, you must do the following steps:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1043190"> </a>Install Oracle database 10g client (or later), create link <code class="cCode">libclntsh.so</code> for <code class="cCode">libclntsh.so.x.x</code> (for example,<code class="cCode"> libclntsh.so.10.1</code>) and set <code class="cCode">LD_LIBRARY_PATH</code> for link<code class="cCode"> libclntsh.so</code> on Linux platform.</li>
<li><a name="wp1043205"> </a>Set <code class="cCode">UBBCONFIG(5) TLOGDEVICE</code> or <code class="cCode">DMCONFIG(5) DMTLOGDEV </code>using the following format: &quot;<code class="cCode">DB:Oracle_XA: …</code>.&quot;.</li>
<li><a name="wp1043191"> </a>Create <code class="cCode">tlog</code> using the<code class="cCode"> tmadmin</code> and <code class="cCode">dmadmin</code> commands.</li>
</ol></div>
<a name="wp1043177"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>You can only write <code class="cCode">tlog</code> to an Oracle database. Third party databases are not supported.</td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1028457"> </a>
How the System Uses a Two-Phase Commit to Commit Transactions
</h2><p class="pBody"><a name="wp1028458"> </a>
A <em class="cEmphasis">two-phase commit </em>is an algorithm used to ensure the integrity of a committing transaction.
</p>
<p class="pBody"><a name="wp1035801"> </a>
To understand how this algorithm works, consider the following sample scenario. A group of six friends wants to rent a house for a one-week vacation. No member of the group can afford to pay more than one sixth of the rent; if any of the six cannot participate, then the house cannot be rented.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1033246"> </a>In Phase 1 of this project, the organizer of the vacation contacts each person to verify availability and collect a sixth of the rent. If the organizer learns that even one person cannot participate, she contacts every member of the group, individually, to notify him or her that the house cannot be rented. If, however, each member of the group confirms availability and pays one sixth of the rent, the Phase 1 concludes successfully.</li>
<li><a name="wp1033252"> </a>In Phase 2 of the project, the organizer notifies each member of the group that the vacation will take place as planned.</li>
</ol></div>
<p class="pBody"><a name="wp1028460"> </a>
A two-phase transaction commit works in much the same way as the vacation planning project. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1035845"> </a>In Phase 1, the transaction coordinator contacts potential participants in the transaction. The participants all agree to make the results of the transaction permanent, but do not do so immediately. The participants log information to disk to ensure they can complete Phase 2. If all the participants agree to commit, the coordinator logs that agreement and the outcome is decided. The recording of this agreement in the log ends Phase 1.</li>
<li><a name="wp1035850"> </a>In Phase 2, the coordinator informs each participant of the decision, and they permanently update their resources.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1030559"> </a>
How the System Handles Transaction Infection
</h3>
<p class="pBody"><a name="wp1030570"> </a>
Any application module called by another module to participate in a transaction is said to be <em class="cEmphasis">transactionally</em> <em class="cEmphasis">infected. </em>Once an application module is infected, the Oracle Tuxedo system tracks all participants to determine which of them should be involved in the two-phase commit. <a href="adtrn.html#wp1030623">Figure&#160;3-2</a> shows how the system tracks participants.
</p>
<div class="pFigureTitle"><a name="wp1030623"> </a>
Figure&#160;3-2  Transactional Infection
</div>

 
 <p class="pGraphic"><a name="wp1030635"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/infect.gif" alt="Transactional Infection" id="wp1030640"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1030573"> </a>
In the preceding figure, Client 1 begins the transaction and calls three services: A, B, and C. Because they have been called into the transaction, Services A, B, and C are transactionally infected. All work performed by servers A, B, and C is part of the transaction begun by Client 1. All work is performed as one unit; either it is performed together and is successful, or it fails and is rolled back by calling <code class="cCode">tpabort</code>. If the transaction fails, it returns to its initial state and its effects of the transaction on resource managers are undone. (Resource managers that are not transactionally aware and those that are accessed from outside the transaction cannot be rolled back.)
</p>
<h3 class="pHeading2"><a name="wp1030651"> </a>
How the ATMI Protects a Transaction&#8217;s Integrity Before a Two-Phase Commit
</h3>
<p class="pBody"><a name="wp1030577"> </a>
All work performed by each resource involved in a transaction must be completed before a two-phase commit is begun. The ATMI ensures that all the work of the transaction is stopped when it is time for the two-phase commit protocol to begin.
</p>
<p class="pBody"><a name="wp1030715"> </a>
The following step-by-step description of a transaction shows how the ATMI stops a transaction process before a two-phase commit.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1033522"> </a>Client_1 initiates (with <code class="cCode">tpbegin()</code>) a transaction.</li>
<li><a name="wp1033523"> </a>Client_1 invokes (with <code class="cCode">tpcall()</code>) Service_A, which:</li>
<div class="pSmartList2"><ol type="a" class="pSmartList2">
<li><a name="wp1033656"> </a>Is <em class="cEmphasis">infected</em> with the transaction</li>
<li><a name="wp1033657"> </a>Executes its operations</li>
<li><a name="wp1033685"> </a>Calls <code class="cCode">tpreturn()</code></li>
<li><a name="wp1033710"> </a>Completes its work for the transaction</li>
</ol></div>
<li><a name="wp1033631"> </a>Client_1 invokes (with <code class="cCode">tpcall()</code>) Service_B, which:</li>
<div class="pSmartList2"><ol type="a" class="pSmartList2">
<li><a name="wp1040280"> </a>Is <em class="cEmphasis">infected</em> with the transaction</li>
<li><a name="wp1040281"> </a>Executes its operations</li>
<li><a name="wp1040282"> </a>Calls <code class="cCode">tpreturn()</code></li>
<li><a name="wp1040283"> </a>Completes its work for the transaction</li>
</ol></div>
<li><a name="wp1033748"> </a>Client_1 invokes (with <code class="cCode">tpcall()</code>) Service_C, which:</li>
<div class="pSmartList2"><ol type="a" class="pSmartList2">
<li><a name="wp1040296"> </a>Is <em class="cEmphasis">infected</em> with the transaction</li>
<li><a name="wp1040297"> </a>Executes its operations</li>
<li><a name="wp1040298"> </a>Calls <code class="cCode">tpreturn()</code></li>
<li><a name="wp1040299"> </a>Completes its work for the transaction</li>
</ol></div>
<li><a name="wp1033524"> </a>Client_1 initiates (with <code class="cCode">tpcommit()</code>) the commitment process.</li>
</ol></div>
<p class="pBody"><a name="wp1030728"> </a>
If, during the transaction, an invoked service is performing another service, or is involved in an open conversation, the ATMI tracks that activity and prevents the application from proceeding to the commitment process until the activity is complete.
</p>
<p class="pBody"><a name="wp1036030"> </a>
The ATMI guarantees that the transaction is committed only if all invoked services have performed their transaction work successfully. When all work has been performed successfully, the Transaction Manager informs the resource managers that all updates made during the transaction are permanent.
</p>
<h3 class="pHeading2"><a name="wp1020535"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1028791"> </a><a href="adtran.html#wp1015807">Modifying the UBBCONFIG File to Accommodate ATMI Transactions</a></li>
<li><a name="wp1028794"> </a><a href="adtran.html#wp1015416">Modifying the Domains Configuration File to Support Transactions</a></li>
<li><a name="wp1028795"> </a><a href="adtran.html#wp1030202">Example: A Distributed Application with Transactions</a></li>
<li><a name="wp1028796"> </a><span class="cHyperlink">
&#8220;Writing G</span><a href="../pgc/pgglob.html"></a>lobal Transactions&#8221; in <em class="cEmphasis">Programming Oracle Tuxedo ATMI Applications Using C</em></li>
<li><a name="wp1028797"> </a><span class="cHyperlink">
&#8220;What You Can Do</span><a href="../int/intatm.html"></a> Using the ATMI&#8221; in <em class="cEmphasis">Introducing Oracle Tuxedo ATMI</em></li>
<li><a name="wp1041152"> </a>For more information about using transactions in a Oracle Tuxedo CORBA environment, refer to <em class="cEmphasis">Using CORBA Transactions</em></li>
</ul></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="adtrn.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="adfig.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="adtran.html"><img id="LongDescNotReq10" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
