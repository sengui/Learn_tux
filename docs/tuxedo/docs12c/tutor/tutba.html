<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41263" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux11gr1/tutor/fm/tutba.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="11/28/11 08:50:30" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Tutorial for bankapp, a Full C Application</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Tutorials for Developing Oracle Tuxedo ATMI Applications
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="tutsi.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="tutcs.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
&nbsp;
<a href="../pdf/tutor.pdf" target="pdf"><img id="LongDescNotReq5" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq6" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1321084"> </a>
Tutorial for bankapp, a Full C Application
</h1>
<p class="pBody"><a name="wp1313026"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1119612"> </a><a href="tutba.html#wp1051738">What Is bankapp?</a></li>
<li><a name="wp1292750"> </a><a href="tutba.html#wp1122284">Familiarizing Yourself with bankapp</a></li>
<li><a name="wp1292770"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
<li><a name="wp1302952"> </a><a href="tutba.html#wp1128299">Running bankapp</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1051738"> </a>
What Is bankapp?
</h2><p class="pBody"><a name="wp1051739"> </a>
<code class="cCode">bankapp</code> is a sample ATMI banking application that is provided with the Oracle Tuxedo software. The application performs the following banking functions: opens and closes accounts, retrieves account balances, deposits or withdraws money from an account, and transfers monies from one account to another.
</p>
<h3 class="pHeading2"><a name="wp1156631"> </a>
About This Tutorial
</h3>
<p class="pBody"><a name="wp1302953"> </a>
This tutorial leads you, step-by-step, through the procedure you must perform to develop the <code class="cCode">bankapp</code> application. Once you have &#8220;developed&#8221; <code class="cCode">bankapp</code> through this tutorial, you will be ready to start developing applications of your own. 
</p>
<p class="pBody"><a name="wp1122214"> </a>
The <code class="cCode">bankapp</code> tutorial is presented in three sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1122217"> </a><a href="tutba.html#wp1122284">Familiarizing Yourself with bankapp</a></li>
<li><a name="wp1122256"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
<li><a name="wp1122275"> </a><a href="tutba.html#wp1128299">Running bankapp</a></li>
</ul></div>
<a name="wp1156633"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>This information has been written for UNIX and Windows 2003 system users with some experience in application development, administration, or system programming. We assume some familiarity with the Oracle Tuxedo software.</td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1122284"> </a>
Familiarizing Yourself with bankapp
</h2><p class="pBody"><a name="wp1257793"> </a>
Instructions in this sample application are automated for your convenience through shell scripts that work in a UNIX or Windows 2003 environment: <code class="cCode">RUNME.sh</code> and <code class="cCode">RUNME.cmd</code>. The associated <code class="cCode">readme</code> files discuss how to run these files. Go through these files to understand the procedure more thoroughly and then follow these step-by-step instructions to help you set up and manage a distributed application.
</p>
<p class="pBody"><a name="wp1257907"> </a>
<code class="cCode">bankapp</code> uses a demo relational database delivered with the software that enables you to use the sample application. Various commands and SQL code within the sample application (included for demo purposes only) provide access to the database.
</p>
<p class="pBody"><a name="wp1257902"> </a>
This documentation provides a tour of the files, client, and services that make up the <code class="cCode">bankapp</code> application. Click on any of the following activities for more information about that part of the tour.
</p>
<p class="pGraphic"><a name="wp1122569"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/tour.gif" height="202" width="453" usemap="#tour_gif" id="wp1122579"/>
<map name="tour_gif">
<area href="tutba.html#wp1122345" shape="rect" coords="159,17,294,58" />
<area href="tutba.html#wp1124781" shape="rect" coords="159,80,294,120" />
<area href="tutba.html#wp1304359" shape="rect" coords="159,142,294,183" />
</map>
</div><p class="pGraphic">

</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1122345"> </a>
Learning About the bankapp Files
</h2><p class="pBody"><a name="wp1124106"> </a>
The files that make up the <code class="cCode">bankapp</code> application are delivered in a directory called <code class="cCode">bankapp</code>, which is positioned as follows:
</p>
<p class="pGraphic"><a name="wp1124111"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/bankapp.gif" id="wp1124109"/></div><p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1124113"> </a>
Exploring the Banking Application Files
</h3>
<p class="pBody"><a name="wp1158445"> </a>
The <code class="cCode">bankapp</code> directory contains the following files:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1158446"> </a>Five source files for service subroutines using embedded SQL statements</li>
<li><a name="wp1158447"> </a>Eight C source files</li>
<li><a name="wp1158448"> </a>One request/response client program (<code class="cCode">audit</code>)</li>
<li><a name="wp1158449"> </a>One conversational server (<code class="cCode">AUDIT</code>)</li>
<li><a name="wp1158450"> </a>One conversational client (<code class="cCode">auditcon</code>)</li>
<li><a name="wp1158451"> </a>Three servers (or files associated with servers)</li>
<li><a name="wp1158452"> </a>Two files that generate data or transactions for the application</li>
<li><a name="wp1158453"> </a>Miscellaneous files</li>
<li><a name="wp1158454"> </a>Generic Oracle Tuxedo application files (that is, files needed in any Oracle Tuxedo application)</li>
<li><a name="wp1158455"> </a>Makefile for various add-ons</li>
<li><a name="wp1158607"> </a>Files provided to facilitate the use of <code class="cCode">bankapp</code> as an example</li>
</ul></div>
<p class="pBody"><a name="wp1158424"> </a>
The following table lists the files of the banking application. The table lists the source files delivered with the Oracle Tuxedo software, files that are generated when the <code class="cCode">bankapp.mk</code> is run, and a summary of the contents of each file. 
</p>
<p class="pGraphic"><a name="wp1124377"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp767938table1124118"><caption><a name="wp767938"> </a>
Table 3-1  Description of the Banking Application Files

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1124120"> </a>
Source File
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1124122"> </a>
Generated File
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1124124"> </a>
Contents
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124126"> </a>
<code class="cCode">ACCT.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124128"> </a>
<code class="cCode">ACCT.c, ACCT.o, ACCT</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124130"> </a>
Contains two services: <code class="cCode">OPEN_ACCT</code> and <code class="cCode">CLOSE_ACCT</code> to open and close accounts.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124132"> </a>
<code class="cCode">ACCTMGR.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124134"> </a>
<code class="cCode">ACCTMGR</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124136"> </a>
A server that subscribes to events and logs notifications. Contains <code class="cCode">WATCHDOG</code> and <code class="cCode">Q_OPENACCT_LOG</code> services.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124138"> </a>
<code class="cCode">AUDITC.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124140"> </a>
<code class="cCode">AUDITC</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124142"> </a>
Contains a conversational server that handles service requests from the client <code class="cCode">auditcon</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124144"> </a>
<code class="cCode">BAL.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124146"> </a>
<code class="cCode">BAL.c, BAL.o, BAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124148"> </a>
Contains a set of services: <code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABAL_BID</code>, and <code class="cCode">TBAL_BID</code> that allow the audit client to obtain bank-wide or branch-wide account or teller balances.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124150"> </a>
<code class="cCode">BALC.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124152"> </a>
<code class="cCode">BALC.c, BALC.o, BALC</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124154"> </a>
Contains two services: <code class="cCode">ABALC_BID</code>, and <code class="cCode">TBALC_BID</code>. These services are the same as <code class="cCode">TBAL_BID</code> and <code class="cCode">ABAL_BID</code>, except that <code class="cCode">TPSUCCESS</code> is returned when a branch ID is not found, which allows <code class="cCode">auditcon</code> to continue running.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124156"> </a>
<code class="cCode">bankmgr.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124158"> </a>
<code class="cCode">bankmgr</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124160"> </a>
A client program that subscribes to events of special interest.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124162"> </a>
<code class="cCode">BTADD.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124164"> </a>
<code class="cCode">BTADD.c, BTADD.o, BTADD</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124166"> </a>
Contains two services: <code class="cCode">BR_ADD</code> and <code class="cCode">TLR_ADD</code> for adding branches and tellers to the database.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124168"> </a>
<code class="cCode">cracl.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124170"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124172"> </a>
A shell script that creates access control lists (ACL) to demonstrate the access control security level.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124174"> </a>
<code class="cCode">crqueue.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124176"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124178"> </a>
A shell script that creates application queues for use in event notification.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124180"> </a>
<code class="cCode">crusers.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124182"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124184"> </a>
A shell script that creates groups and users to demonstrate the authentication security level.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124186"> </a>
<code class="cCode">event.flds</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124188"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124190"> </a>
A field table file used in the event feature.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124192"> </a>
<code class="cCode">FILES</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124194"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124196"> </a>
A descriptive list of all the files in <code class="cCode">bankapp</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124198"> </a>
<code class="cCode">README</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124200"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124202"> </a>
Installation and boot procedures for all platforms except Windows 2003.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124204"> </a>
<code class="cCode">README.nt</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124206"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124208"> </a>
Installation and boot procedures for the Windows 2003 platform.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124210"> </a>
<code class="cCode">README2</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124212"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124214"> </a>
Documentation of additions to <code class="cCode">bankapp</code> that demonstrate new features. The file is located in the <code class="cCode">samples/atmi/bankapp</code> directory.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124216"> </a>
<code class="cCode">README2.nt</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124218"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124220"> </a>
Documentation of additions to <code class="cCode">bankapp</code> that demonstrate new features for the Windows 2003 platform. The file is located in the <code class="cCode">samples\atmi\bankapp</code> directory.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1302120"> </a>
<code class="cCode">RUNME.cmd</code>
</div>
</td>
    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1302124"> </a>
An interactive script to build, configure, boot, and shut down the application for Windows 2003.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124222"> </a>
<code class="cCode">RUNME.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124224"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124226"> </a>
An interactive script to build, configure, boot, and shut down the application for UNIX.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124228"> </a>
<code class="cCode">showq.sh!</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124230"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124232"> </a>
A shell script that displays the status and contents of a message queue.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124234"> </a>
<code class="cCode">TLR.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124236"> </a>
<code class="cCode">TLR.c, TLR.o, TLR</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124238"> </a>
Contains three services: <code class="cCode">WITHDRAWAL</code>, <code class="cCode">DEPOSIT</code>, and <code class="cCode">INQUIRY</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124240"> </a>
<code class="cCode">usrevtf.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124242"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124244"> </a>
A shell script that creates an <code class="cCode">ENVFILE</code> for the Oracle Tuxedo server <code class="cCode">TMUSREVT.</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124246"> </a>
<code class="cCode">XFER.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124248"> </a>
<code class="cCode">XFER.o, XFER</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124250"> </a>
Contains <code class="cCode">TRANSFER</code> service.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124252"> </a>
<code class="cCode">aud.v</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124254"> </a>
<code class="cCode">aud.V, aud.h</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124256"> </a>
An FML view used to define the structure passed between the audit client and the <code class="cCode">BAL</code> server.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124258"> </a>
<code class="cCode">appinit.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124260"> </a>
<code class="cCode">appinit.o</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124262"> </a>
Contains customized versions of <code class="cCode">tpsvrinit()</code> and <code class="cCode">tpsvrdone()</code> for all servers other than TLR.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124264"> </a>
<code class="cCode">audit.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124266"> </a>
<code class="cCode">audit.o, audit</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124268"> </a>
A client that obtains bank-wide or branch-wide account and teller balances via the <code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABAL_BID</code>, and <code class="cCode">TBAL_BID</code> services.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124270"> </a>
<code class="cCode">auditcon.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124272"> </a>
<code class="cCode">auditcon</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124274"> </a>
An interactive version of audit that uses conversations and four services: <code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABALC_BID</code>, and <code class="cCode">TBALC_BID</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124276"> </a>
<code class="cCode">bankapp.mk</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124278"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124280"> </a>
An application makefile for UNIX.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124282"> </a>
<code class="cCode">bankapp.nt</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124284"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124286"> </a>
An application makefile for Windows 2003.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124288"> </a>
<code class="cCode">bank.flds</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124290"> </a>
<code class="cCode">bank.flds.h</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124292"> </a>
A field table file containing bank database fields and auxiliary FML fields used by servers.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124294"> </a>
<code class="cCode">bank.h</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124296"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124298"> </a>
Contains data definitions pertinent to multiple C programs in the application.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124300"> </a>
<code class="cCode">bankvar</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124302"> </a>
<code class="cCode">-</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124304"> </a>
Contains some environment variables for <code class="cCode">bankapp</code>. Other environment variables are defined in <code class="cCode">ENVFILE</code>, but because <code class="cCode">ENVFILE</code> is set from within <code class="cCode">bankvar</code>, you can control the entire environment for your application through <code class="cCode">bankvar</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124306"> </a>
<code class="cCode">crbank.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124308"> </a>
<code class="cCode">crbank</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124310"> </a>
A shell script that creates databases for all banks when <code class="cCode">bankapp</code> is run in SHM mode.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124312"> </a>
<code class="cCode">crbankdb.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124314"> </a>
<code class="cCode">crbankdb</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124316"> </a>
A shell script that creates a database for one server group.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124318"> </a>
<code class="cCode">crtlog.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124320"> </a>
<code class="cCode">crtlog, TLOG</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124322"> </a>
A shell script that creates a <code class="cCode">UDL</code> and a <code class="cCode">TLOG</code> on the master site and a <code class="cCode">UDL</code> on the non-master sites.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124324"> </a>
<code class="cCode">driver.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124326"> </a>
<code class="cCode">driver</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124328"> </a>
A shell script that drives the application by piping FML buffers with transaction requests through <code class="cCode">ud(1)</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124330"> </a>
<code class="cCode">envfile.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124332"> </a>
<code class="cCode">envfile, ENVFILE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124334"> </a>
A shell script that creates <code class="cCode">ENVFILE</code> for use by <code class="cCode">tmloadcf</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124336"> </a>
<code class="cCode">gendata.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124338"> </a>
<code class="cCode">gendata</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124340"> </a>
A program that generates <code class="cCode">ud</code>-readable requests to add ten branches, thirty tellers, and two hundred accounts.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124342"> </a>
<code class="cCode">gentran.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124344"> </a>
<code class="cCode">gentran</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124346"> </a>
A program that generates <code class="cCode">ud</code>-readable transaction requests from four services: <code class="cCode">DEPOSIT</code>, <code class="cCode">WITHDRAWAL</code>, <code class="cCode">TRANSFER</code>, and <code class="cCode">INQUIRY</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124348"> </a>
<code class="cCode">populate.sh</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124350"> </a>
<code class="cCode">populate</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124352"> </a>
A shell script that populates the database by piping FML buffers with requests to add branches, tellers, and accounts through <code class="cCode">ud(1)</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124354"> </a>
<code class="cCode">ubbmp</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124356"> </a>
<code class="cCode">TUXCONFIG</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124358"> </a>
A sample <code class="cCode">UBBCONFIG</code> file for use in an MP mode configuration.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124360"> </a>
<code class="cCode">ubbshm</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124362"> </a>
<code class="cCode">TUXCONFIG</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124364"> </a>
A sample <code class="cCode">UBBCONFIG</code> file for use in a <code class="cCode">SHM</code>-mode configuration.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124366"> </a>
<code class="cCode">util.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124368"> </a>
<code class="cCode"> util.o</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124370"> </a>
A set of functions, such as <code class="cCode">getstrl()</code>, that are commonly used by services.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124372"> </a>
<code class="cCode">bankclt.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124374"> </a>
<code class="cCode">bankclt</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1124376"> </a>
Client for <code class="cCode">bankapp</code>.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1151139"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1151144"> </a><a href="tutba.html#wp1122284">Familiarizing Yourself with bankapp</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1124781"> </a>
Examining the bankapp Clients
</h2><h3 class="pHeading2"><a name="wp1126105"> </a>
What Is the bankclt.c File?
</h3>
<p class="pBody"><a name="wp1126106"> </a>
The<code class="cCode"> bankclt</code> file contains the client program that requests Oracle Tuxedo services from the <code class="cCode">bankapp</code> application. This client program is text-based and provides the following options:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1126107"> </a>Balance Inquiry</li>
<li><a name="wp1126108"> </a>Withdrawal</li>
<li><a name="wp1126109"> </a>Deposit</li>
<li><a name="wp1126110"> </a>Transfer</li>
<li><a name="wp1126111"> </a>Open Account</li>
<li><a name="wp1126112"> </a>Close Account</li>
<li><a name="wp1126113"> </a>Exit Application</li>
</ul></div>
<p class="pBody"><a name="wp1126114"> </a>
Each of these options, except <em class="cEmphasis">Exit Application</em>, calls a subroutine that performs the following tasks:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1126115"> </a>Obtains the user input from the keyboard using the <code class="cCode">get_account()</code>, <code class="cCode">get_amount()</code>, <code class="cCode">get_socsec()</code>, <code class="cCode">get_phone()</code>, and the <code class="cCode">get_val()</code> functions.</li>
<li><a name="wp1126116"> </a>Puts the values into a global FML buffer (*<code class="cCode">fbfr</code>). (Some functions add more fields than others. This is dependent on the information needed by the servers.)</li>
<li><a name="wp1126117"> </a>Enables routines that make a request to the Oracle Tuxedo system through the <code class="cCode">do_tpcall()</code> function to invoke the required service. The following table lists the functions and the services they invoke.</li>
<p class="pGraphic"><a name="wp1126176"> </a>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp768028table1126119"><caption><a name="wp768028"> </a>
Table 3-2  Services Called by Function

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1126121"> </a>
Function Name
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1126123"> </a>
Input FML Fields		
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1126125"> </a>
Output FML Fields			
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1126127"> </a>
Service Name
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126129"> </a>
<code class="cCode">BALANCE()</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126131"> </a>
<code class="cCode">ACCOUNT_ID						</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126133"> </a>
<code class="cCode">SBALANCE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126135"> </a>
<code class="cCode">INQUIRY</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126137"> </a>
<code class="cCode">WITHDRAWAL()</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126139"> </a>
<code class="cCode">ACCOUNT_ID SAMOUNT								</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126141"> </a>
<code class="cCode">SBALANCE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126143"> </a>
<code class="cCode">WITHDRAWAL</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126145"> </a>
<code class="cCode">DEPOSIT()</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126147"> </a>
<code class="cCode">ACCOUNT_ID SAMOUNT								</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126149"> </a>
<code class="cCode">SBALANCE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126151"> </a>
<code class="cCode">DEPOSIT</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126153"> </a>
<code class="cCode">TRANSFER()</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126155"> </a>
<code class="cCode">ACCOUNT_ID (0)</code><sup class="cSuperscript">1</sup><code class="cCode"> ACCOUNT_ID (1) <br />SAMOUNT </code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126157"> </a>
<code class="cCode">SBALANCE (0)<br />SBALANCE (1)</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126159"> </a>
<code class="cCode">TRANSFER		</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126161"> </a>
<code class="cCode">OPEN_ACCT()</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126163"> </a>
<code class="cCode">LAST_NAME FIRST_NAME MID_INIT<br />SSN<br />ADDRESS<br />PHONE<br />ACCT_TYPE BRANCH_ID SAMOUNT							</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126165"> </a>
<code class="cCode">ACCOUNT_ID SBALANCE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126167"> </a>
<code class="cCode">OPEN_ACCT</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126169"> </a>
<code class="cCode">CLOSE_ACCT()</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126171"> </a>
<code class="cCode">ACCOUNT_ID				</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126173"> </a>
<code class="cCode">SBALANCE</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1126175"> </a>
<code class="cCode">CLOSE_ACCT</code>
</div>
</td>
</tr>
</table>
</div>

</p>
</ol></div>
<p class="pBody"><a name="wp1126177"> </a>
<sup class="cSuperscript">1</sup>The number in parentheses is the FML occurrence number for that field.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1126178"> </a>After the call completes successfully, each function gets the fields it needs from the returned FML buffer and prints the results.</li>
</ol></div>
<p class="pBody"><a name="wp1219555"> </a>
The <code class="cCode">do_tpcall()</code> function (that begins on line 447 in <code class="cCode">bankclt.c</code>) follows:
</p>
<div class="pCodeTitle"><a name="wp1219818"> </a>
Listing&#160;3-1	   do_tpcall()<code class="cCodeBold"> </code>in bankclt.c
</div> <a name="wp1303293"> </a><div class="pPreformatted"><pre>/*<br /> * This function does the tpcall to Tuxedo.<br /> */<br />static int<br />do_tpcall(char *service)</pre></div><a name="wp1220929"> </a><div class="pPreformatted"><pre>{<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;long len;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;char *server_status;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Begin a Global transaction */<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (tpbegin(30, 0) == -1) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void)fprintf(stderr, &quot;ERROR: tpbegin failed (%s)\n&quot;,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpstrerror(tperrno));<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return(-1);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Request the service with the user data */<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (tpcall(service, (char *)fbfr, 0, (char **)&amp;fbfr, &amp;len,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0) == -1) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if(tperrno== TPESVCFAIL &amp;&amp; fbfr != NULL &amp;&amp;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(server_status=Ffind(fbfr,STATLIN,0,0)) != 0) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Server returned failure */<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void)fprintf(stderr, &quot;%s returns failure<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(%s)\n&quot;,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;service,server_status);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void)fprintf(stderr,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;ERROR: %s failed (%s)\n&quot;, service,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpstrerror(tperrno));<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Abort the transaction */<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void) tpabort(0);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return(-1);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Commit the transaction */<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;if(tpcommit(0) &lt; 0) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void)fprintf(stderr, &quot;ERROR: tpcommit failed<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(%s)\n&quot;,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpstrerror(tperrno));<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return(-1);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;return(0);<br />}<br /></pre></div><p class="pBody"><a name="wp1223065"> </a>
The <code class="cCode">do_tpcall() </code>function performs the following tasks:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1126182"> </a>Begins a global transaction by calling <code class="cCode">tpbegin()</code>, which ensures that all work is done as a single unit.</li>
<li><a name="wp1126183"> </a>Calls <code class="cCode">tpcall()</code> with the requested service name (<code class="cCode">char *service</code>) and the supplied FML buffer (the global *<code class="cCode">fbfr</code> pointer).</li>
<li><a name="wp1126184"> </a>If <code class="cCode">tpcall()</code> fails with a server-indicated failure (<code class="cCode">TPSVCERR</code>), it prints the message from the server in the <code class="cCode">STATLIN</code> FML field. The transaction is rolled back with <code class="cCode">tpabort()</code> and it returns -1.</li>
<li><a name="wp1126185"> </a>If <code class="cCode">tpcall()</code> fails with any other error, it prints the error message and rolls back the transaction with <code class="cCode">tpabort()</code> and returns -1.</li>
<li><a name="wp1126186"> </a>If <code class="cCode">tpcall()</code> succeeds, it commits the transaction using <code class="cCode">tpcommit()</code> and returns 0.</li>
</ul></div>
<a name="wp1126188"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The <code class="cCode">unsolfcn()</code> function is invoked if there is an unsolicited message to the client. It only supports <code class="cCode">STRING</code> buffer types and prints the message.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1126189"> </a>
How ud(1) Is Used in bankapp
</h3>
<p class="pBody"><a name="wp1126190"> </a>
<code class="cCode">bankapp</code> uses the Oracle Tuxedo program <code class="cCode">ud(1)</code>, which allows fielded buffers to be read from standard input and sent to a service. In the sample application, <code class="cCode">ud</code> is used by both the populate and driver programs:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1160323"> </a>In populate, a program called <code class="cCode">gendata</code> passes service requests to <code class="cCode">ud</code> with customer account information to be entered in the <code class="cCode">bankapp</code> database.</li>
<li><a name="wp1160324"> </a>In driver, the data flow is similar, but the program is <code class="cCode">gentran</code> and the purpose is to pass transactions to the application to simulate an active system. </li>
</ul></div>
<h3 class="pHeading2"><a name="wp1126191"> </a>
A Request/Response Client: audit.c
</h3>
<p class="pBody"><a name="wp1126192"> </a>
<code class="cCode">audit</code> is a request/response client program that makes branch-wide or bank-wide balance inquiries, using the services: <code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABAL_BID</code>, and <code class="cCode">TBAL_BID</code>. You can invoke it in two ways: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1126193"> </a><code class="cCode">audit [-a | -t]</code>&#8212;prints the bank-wide total value of all accounts, or bank-wide cash supply of all tellers. Option <code class="cCode">-a</code> or <code class="cCode">-t</code> must be specified to indicate whether account balances or teller balances are to be tallied. </li>
<li><a name="wp1126194"> </a><code class="cCode">audit [-a | -t] branch_ID</code>&#8212;prints the branch-wide total value of all accounts, or branch-wide cash supply of all tellers, for branch denoted by <code class="cCode">branch_ID</code>. Option <code class="cCode">-a</code> or <code class="cCode">-t</code> must be specified to indicate whether account balances or teller balances are to be tallied.</li>
</ul></div>
<p class="pBody"><a name="wp1160846"> </a>
The source code for audit contains two major parts: <code class="cCode">main()</code> and a subroutine called <code class="cCode">sum_bal()</code>. Oracle Tuxedo ATMI functions are used in both parts. The program uses a <code class="cCode">VIEW</code> typed buffer and a structure that is defined in the <code class="cCode">aud.h</code> header file. The source code for the structure can be found in the view description file, <code class="cCode">aud.v</code>.
</p>
<p class="pBody"><a name="wp1126195"> </a>
The following pseudo-code shows the algorithm for the program.
</p>
<div class="pCodeTitle"><a name="wp1126196"> </a>
Listing&#160;3-2	   audit Pseudo-code 
</div> <a name="wp1126197"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;main()<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Parse command-line options with getopt();      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Join application with tpinit();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Begin global transaction with tpbegin();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;If (branch_ID specified) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Allocate buffer for service requests with tpalloc();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Place branch_ID into the aud structure;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Do tpcall() to &quot;ABAL_BID&quot; or &quot;TBAL_BID&quot;;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Print balance for branch_ID;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Free buffer with tpfree();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else /* branch_ID not specified */<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;all subroutine sum_bal();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Commit global transaction with tpcommit();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Leave application with tpterm();<br />&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;sum_bal()<br />&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Allocate buffer for service requests with tpalloc();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;For (each of several representative branch_ID&#39;s,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;one for each site)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Do tpacall() to &quot;ABAL&quot; or &quot;TBAL&quot;;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;For (each representative branch_ID) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Do tpgetrply() wtith TPGETANY flag set<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;to retrieve replies;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Add balance to total;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Print total balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Free buffer with tpfree();<br />&#160;&#160;&#160;&#160;}</pre></div><p class="pBody"><a name="wp1126230"> </a>
Following is a summary of the two main parts of the <code class="cCode">audit</code> source code.
</p>
<p class="pBody"><a name="wp1126231"> </a>
In the programs <code class="cCode">main()</code>: 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1126232"> </a>    /* Join application */</li>
<li><a name="wp1160349"> </a>    /* Start global transaction */</li>
<li><a name="wp1160380"> </a>    /* Create buffer and set data pointer */</li>
<li><a name="wp1160411"> </a>    /* Do tpcall */</li>
<li><a name="wp1160442"> </a>    /* Commit global transaction */</li>
<li><a name="wp1160455"> </a>    /* Leave application /*</li>
</ol></div>
<p class="pBody"><a name="wp1126238"> </a>
In the subroutine <code class="cCode">sum_bal</code>: 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1126239"> </a>    /* Create buffer and set data pointer */</li>
<li><a name="wp1160458"> </a>    /* Do <code class="cCode">tpacall</code> */</li>
<li><a name="wp1160461"> </a>    /* Do <code class="cCode">tpgetrply</code> to retrieve answers to questions */</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1126243"> </a>
A Conversational Client: auditcon.c
</h3>
<p class="pBody"><a name="wp1160713"> </a>
<code class="cCode">auditcon</code> is a conversational version of the <code class="cCode">audit</code> program. The source code for <code class="cCode">auditcon</code> uses the ATMI functions for conversational communication: <code class="cCode">tpconnect()</code> to establish the connection between the client and service, <code class="cCode">tpsend()</code> to send a message, and <code class="cCode">tprecv()</code> to receive a message.
</p>
<p class="pBody"><a name="wp1160714"> </a>
The following pseudo-code shows the algorithm for the program.
</p>
<div class="pCodeTitle"><a name="wp1160715"> </a>
Listing&#160;3-3	   auditcon Pseudo-code 
</div> <a name="wp1126247"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;main()<br />&#160;&#160;&#160;&#160;{</pre></div><a name="wp1126249"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Join the application<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Begin a transaction<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Open a connection to conversational service AUDITC<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Do until user says to quit: {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Query user for input<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Send service request<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Receive response<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Print response on user&#39;s terminal<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Prompt for further input<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}</pre></div><a name="wp1126259"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Commit transaction<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Leave the application<br />&#160;&#160;&#160;&#160;}</pre></div><h3 class="pHeading2"><a name="wp1126265"> </a>
A Client that Monitors Events: bankmgr.c
</h3>
<p class="pBody"><a name="wp1126266"> </a>
<code class="cCode">bankmgr</code> is included with <code class="cCode">bankapp</code> as an example of a client that is designed to run constantly. It subscribes to application-defined events of special interest, such as the opening of a new account or a withdrawal above $10,000. (The <code class="cCode">bankmgr.c</code> client is more fully described in the <code class="cCode">README2</code> file of <code class="cCode">bankapp</code> and in the <code class="cCode">bankmgr.c</code> code itself.) 
</p>
<h3 class="pHeading2"><a name="wp1126267"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1126271"> </a><a href="tutba.html#wp1122284">Familiarizing Yourself with bankapp</a></li>
<li><a name="wp1293872"> </a><span class="cHyperlink">
&#8220;What You Can</span><a href="../int/intatm.html"></a> Do Using the ATMI&#8221; in <em class="cEmphasis">Introducing Oracle Tuxedo ATMI</em></li>
<li><a name="wp1151176"> </a><span class="cHyperlink">
&#8220;What Are the Oracle </span><a href="../int/intatm.html"></a>Tuxedo ATMI Messaging Paradigms?&#8221; in <em class="cEmphasis">Introducing Oracle Tuxedo ATMI</em></li>
<li><a name="wp1126279"> </a><a href="tutba.html#wp1051738">What Is bankapp?</a></li>
<li><a name="wp1293881"> </a><span class="cHyperlink">
&#8220;What Are Typed </span><a href="../int/intatm.html"></a>Buffers?&#8221; in <em class="cEmphasis">Introducing Oracle Tuxedo ATMI</em></li>
<li><a name="wp1300139"> </a><a href="tutov.html#wp1112295">Using Event-based Communication</a></li>
<li><a name="wp1307144"> </a><em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
<li><a name="wp1300151"> </a><em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1304359"> </a>
Examining the bankapp Servers and Services
</h2><p class="pBody"><a name="wp1127649"> </a>
This topic provides the following information:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1160912"> </a>A description of the servers and services delivered with <code class="cCode">bankapp</code>.</li>
<li><a name="wp1160917"> </a>A description of how the services are link-edited into servers.</li>
<li><a name="wp1161008"> </a>Pseudo-code for each service that is either accessed by the Oracle Tuxedo     <code class="cCode">bankclt.c</code>, or the application client, <code class="cCode">audit.c</code>.</li>
<li><a name="wp1161009"> </a>Descriptions of the relationships between the <code class="cCode">bankapp</code> services and servers.</li>
<li><a name="wp1161010"> </a>Descriptions of the <code class="cCode">buildserver(1)</code> command options used to compile and build each server with the <code class="cCode">main()</code> defined by the Oracle Tuxedo system.</li>
<li><a name="wp1160936"> </a>An alternative method for structuring servers.</li>
</ul></div>
<p class="pBody"><a name="wp1127650"> </a>
Servers are executable processes that offer one or more services. In the Oracle Tuxedo system, they continually accept requests (from processes acting as clients) and dispatch them to the appropriate services. Services are subroutines of C language code written specifically for an application. Oracle Tuxedo&#8217;s applications are written to make services available and capable of accessing resource managers. Service routines must be written by Oracle Tuxedo application programmers. 
</p>
<p class="pBody"><a name="wp1127651"> </a>
All <code class="cCode">bankapp</code> services are coded in C with embedded SQL except for the <code class="cCode">TRANSFER</code> service, which does not interact directly with the database. The <code class="cCode">TRANSFER</code> service is offered by the <code class="cCode">XFER</code> server and is a C program (that is, its source file is a <code class="cCode">.c</code> file rather than a <code class="cCode">.ec</code> file). 
</p>
<p class="pBody"><a name="wp1127652"> </a>
All <code class="cCode">bankapp</code> services of <code class="cCode">bankapp</code> use functions provided in the Application-to-Transaction Management Interface (ATMI) for performing the following tasks:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1127653"> </a>Managing typed buffers</li>
<li><a name="wp1127654"> </a>Communicating synchronously or asynchronously with other services </li>
<li><a name="wp1127655"> </a>Defining global transactions </li>
<li><a name="wp1127656"> </a>Generically accessing a resource manager </li>
<li><a name="wp1127657"> </a>Sending replies back to clients </li>
</ul></div>
<h3 class="pHeading2"><a name="wp1127664"> </a>
bankapp Request/Response Servers
</h3>
<p class="pBody"><a name="wp1127665"> </a>
Five <code class="cCode">bankapp</code> servers operate in request/response mode. Four of the five use embedded SQL statements to access a resource manager; the names of the source files for these servers (located in the <code class="cCode">bankapp</code> sample application subdirectory), include a <code class="cCode">.ec</code> filename extension.
</p>
<p class="pBody"><a name="wp1161138"> </a>
The fifth server, <code class="cCode">XFER</code>, for transfer, makes no calls to the resource manager itself; it calls the <code class="cCode">WITHDRAWAL</code> and <code class="cCode">DEPOSIT</code> services (offered by the <code class="cCode">TLR</code> server) to transfer funds between accounts. The source file for <code class="cCode">XFER</code> is a <code class="cCode">.c</code> file, because <code class="cCode">XFER</code> makes no resource manager calls and contains no embedded SQL statements. 
</p>
<p class="pGraphic"><a name="wp1161143"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1161147table1161145">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1161147"> </a>
This Server
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1161149"> </a>
Provides this Functionality
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161151"> </a>
<code class="cCode">BTADD.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161153"> </a>
Allows branch and teller records to be added to the appropriate database from any site.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161155"> </a>
<code class="cCode">ACCT.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161157"> </a>
Provides customer representative services, namely the opening and closing of accounts (<code class="cCode">OPEN_ACCT</code> and <code class="cCode">CLOSE_ACCT</code>).
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161159"> </a>
<code class="cCode">TLR.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161161"> </a>
Provides teller services, namely <code class="cCode">WITHDRAWAL</code>, <code class="cCode">DEPOSIT</code>, and <code class="cCode">INQUIRY</code>. Each <code class="cCode">TLR</code> process identifies itself as an actual teller in the <code class="cCode">TELLER</code> file, via the user-defined <code class="cCode">-T </code>option on the server&#8217;s command line.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161163"> </a>
<code class="cCode">XFER.c</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161165"> </a>
Provides fund transfers for accounts anywhere in the database.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161167"> </a>
<code class="cCode">BAL.ec</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1161169"> </a>
Calculates the account for all branches of the database or for a specified branch.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1127676"> </a>
bankapp Conversational Server
</h3>
<p class="pBody"><a name="wp1127677"> </a>
<code class="cCode">AUDITC</code> is an example of a conversational server. It offers one service, which is also called <code class="cCode">AUDITC</code>. The conversational client, <code class="cCode">auditcon</code>, establishes a connection to <code class="cCode">AUDITC</code> and sends it requests for auditing information.
</p>
<p class="pBody"><a name="wp1127678"> </a>
<code class="cCode">AUDITC</code> evaluates requests and calls an appropriate service (<code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABAL_BID</code>, or <code class="cCode">TBAL_BID</code>) to get the appropriate information. When a reply is received from the service called, <code class="cCode">AUDITC</code> sends it back to <code class="cCode">auditcon</code>. A service in a conversational server can make calls to request/response services. It can also initiate connections to other conversational servers, but this functionality is not provided by <code class="cCode">AUDITC</code>.
</p>
<h3 class="pHeading2"><a name="wp1127679"> </a>
bankapp Services
</h3>
<p class="pBody"><a name="wp1127680"> </a>
<code class="cCode">bankapp</code> offers 12 request/response services. The name of each <code class="cCode">bankapp</code> service matches the name of a C function in the source code of a server. 
</p>
<p class="pGraphic"><a name="wp1163410"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1163414table1163412">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1163414"> </a>
This Service
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1163416"> </a>
Offered by this Server
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1163761"> </a>
With this Input
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1163763"> </a>
Performs this Function
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163418"> </a>
<code class="cCode">BR_ADD</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163420"> </a>
<code class="cCode">BTADD</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163765"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1163767"> </a>Adds a new branch record</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163422"> </a>
<code class="cCode">TLR_ADD</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163424"> </a>
<code class="cCode">BTADD</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163769"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1163771"> </a>Adds a new teller record</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163426"> </a>
<code class="cCode">OPEN_ACCT</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163428"> </a>
<code class="cCode">ACCT</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163773"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1163775"> </a>Inserts a record into the <code class="cCode">ACCOUNT</code> file and calls <code class="cCode">DEPOSIT</code> to add the initial balance</li>
<li><a name="wp1165136"> </a>Chooses an <code class="cCode">ACCOUNT_ID</code> for a new account based on the <code class="cCodeEmphasis">BRANCH_ID</code> of the teller involved</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163430"> </a>
<code class="cCode">CLOSE_ACCT</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163432"> </a>
<code class="cCode">ACCT</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163777"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1163779"> </a>Deletes an <code class="cCode">ACCOUNT</code> record</li>
<li><a name="wp1165398"> </a>Validates <code class="cCode">ACCOUNT_ID</code></li>
<li><a name="wp1165436"> </a>Calls <code class="cCode">WITHDRAWAL</code> to remove the final balance</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163434"> </a>
<code class="cCode">WITHDRAWAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163436"> </a>
<code class="cCode">TLR</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1163781"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1163783"> </a>Subtracts an amount from the specified branch, teller, and account balance</li>
<li><a name="wp1165701"> </a>Validates the <code class="cCode">ACCOUNT_ID</code> and <code class="cCode">SAMOUNT</code> fields</li>
<li><a name="wp1165702"> </a>Checks that funds are available from account and tell</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165531"> </a>
<code class="cCode">DEPOSIT</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165533"> </a>
<code class="cCode">TLR</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165535"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1165537"> </a>Adds an amount to specified branch, teller, and account balances</li>
<li><a name="wp1165745"> </a>Validates the <code class="cCode">ACCOUNT_ID</code> and <code class="cCode">SAMOUNT</code> fields</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165523"> </a>
<code class="cCode">INQUIRY</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165525"> </a>
<code class="cCode">TLR</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165527"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1165529"> </a>Retrieves an account balance</li>
<li><a name="wp1165774"> </a>Validates <code class="cCode">ACCOUNT_ID</code></li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165515"> </a>
<code class="cCode">TRANSFER</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165517"> </a>
<code class="cCode">XFER</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165519"> </a>
FML buffer
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1165521"> </a>Issues a <code class="cCode">tpcall()</code> requesting <code class="cCode">WITHDRAWAL</code> followed by one requesting <code class="cCode">DEPOSIT</code></li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165798"> </a>
<code class="cCode">ABAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165800"> </a>
<code class="cCode">BAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165802"> </a>
<code class="cCode">VIEW</code> buffer of aud.v
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1165804"> </a>Calculates account balances for all branches on a given site</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165790"> </a>
<code class="cCode">TBAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165792"> </a>
<code class="cCode">BAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165794"> </a>
<code class="cCode">VIEW</code> buffer of aud.v as input
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1165796"> </a>Calculates the teller balances for all branches on a given site</li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165898"> </a>
<code class="cCode">ABAL_BID</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165900"> </a>
<code class="cCode">BAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165902"> </a>
VIEW buffer of aud.v as input
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1165904"> </a>Calculates the account balances for a specific <code class="cCode">BRANCH_ID</code></li>
</ul></div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165890"> </a>
<code class="cCode">TBAL_BID</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165892"> </a>
<code class="cCode">BAL</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1165894"> </a>
VIEW buffer of aud.v as input
</div>
</td>
    <td class="table" scope="row"><div class="pSmartList1TableBullet"><ul class="SmartList1TableBullet">
<li><a name="wp1165896"> </a>Calculates the teller balances for a specific <code class="cCode">BRANCH_ID</code></li>
</ul></div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h4 class="pHeading3"><a name="wp1127705"> </a>
Algorithms of bankapp Services
</h4>
<p class="pBody"><a name="wp1127706"> </a>
The following listings show pseudo-code for the algorithms used for the <code class="cCode">bankapp</code> services: <code class="cCode">BR_ADD</code>, <code class="cCode">TLR_ADD</code>, <code class="cCode">OPEN_ACCT</code>, <code class="cCode">CLOSE_ACCT</code>, <code class="cCode">WITHDRAWAL</code>, <code class="cCode">DEPOSIT</code>, <code class="cCode">INQUIRY</code>, <code class="cCode">TRANSFER</code>, <code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABAL_BID</code>, and <code class="cCode">TBAL_BID</code>. You can use them as road maps through the source code of the <code class="cCode">bankapp</code> servers. 
</p>
<div class="pCodeTitle"><a name="wp1127707"> </a>
Listing&#160;3-4	    BR_ADD Pseudo-code 
</div> <a name="wp1127708"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void BR_ADD (TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-set pointer to TPSVCINFO data buffer;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-get all values for service request from field buffer;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-insert record into BRANCH;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-tpreturn() with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127710"> </a>
Listing&#160;3-5	   TLR_ADD Pseudo-code 
</div> <a name="wp1326096"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void TLR_ADD (TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-set pointer to TPSVCINFO data buffer;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-get all values for service request from fielded buffer;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-get TELLER_ID by reading branch&#39;s LAST_ACCT;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-insert teller record;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-update BRANCH with new LAST_TELLER;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-tpreturn() with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127713"> </a>
Listing&#160;3-6	    OPEN_ACCT Pseudo-code 
</div> <a name="wp1309476"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void OPEN_ACCT(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Extract all values for service request from fielded buffer using Fget()<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and Fvall();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that initial deposit is positive amount and tpreturn() with <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;failure if not;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that branch ID is a legal value and tpreturn() with failure if it <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;is not;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read/write;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve BRANCH record to choose new account based on branch&#39;s LAST_ACCT<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;field;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Insert new account record into ACCOUNT file;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Update BRANCH record with new value for LAST_ACCT;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Create deposit request buffer with tpalloc(); initialize it for FML with<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Finit();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Fill deposit buffer with values for DEPOSIT service request;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Increase priority of coming DEPOSIT request since call is from a service;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Do tpcall() to DEPOSIT service to add amount of initial balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Prepare return buffer with necessary information;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Free deposit request buffer with tpfree();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn() with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127716"> </a>
Listing&#160;3-7	    CLOSE_ACCT Pseudo-code 
</div> <a name="wp1127717"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void CLOSE_ACCT(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Extract account ID from fielded buffer using Fvall();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that account ID is a legal value and tpreturn() with failure if it<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;is not;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read/write;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve ACCOUNT record to determine amount of final withdrawal;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Create withdrawal request buffer with tpalloc(); initialize it for FML<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;with Finit();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Fill withdrawal buffer with values for WITHDRAWAL service request;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Increase priority of coming WITHDRAWAL request since call is from<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a service;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Do tpcall() to WITHDRAWAL service to withdraw balance of account;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Delete ACCOUNT record;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Prepare return buffer with necessary information;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Free withdrawal request buffer with tpfree();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127720"> </a>
Listing&#160;3-8	    WITHDRAWAL Pseudo-code 
</div> <a name="wp1326371"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void WITHDRAWAL(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Extract account id and amount from fielded buffer using Fvall() and Fget();<br />&#160;&#160;&#160;&#160;&#160;&#160;-Check that account id is a legal value and tpreturn() with failure if not;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that withdraw amount (amt) is positive and tpreturn() with failure          <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read/write;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve ACCOUNT record to get account balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that amount of withdrawal does not exceed ACCOUNT balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve TELLER record to get teller&#39;s balance and branch id;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that amount of withdrawal does not exceed TELLER balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve BRANCH record to get branch balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that amount of withdrawal does not exceed BRANCH balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Subtract amt to obtain new account balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Update ACCOUNT record with new account balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Subtract amt to obtain new teller balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Update TELLER record with new teller balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Subtract amt to obtain new branch balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Update BRANCH record with new branch balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Insert new HISTORY record with transaction information;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Prepare return buffer with necessary information;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127723"> </a>
Listing&#160;3-9	    DEPOSIT Pseudo-code 
</div> <a name="wp1127724"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void DEPOSIT(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Extract account id and amount from fielded buffer using Fvall() and Fget();<br />&#160;&#160;&#160;&#160;&#160;&#160;-Check that account ID is a legal value and tpreturn() with failure if not;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Check that deposit amount (amt) is positive and tpreturn() with failure if<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;not;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read/write;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve ACCOUNT record to get account balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve TELLER record to get teller&#39;s balance and branch ID;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve BRANCH record to get branch balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Add amt to obtain new account balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Update ACCOUNT record with new account balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Add amt to obtain new teller balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Update TELLER record with new teller balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Add amt to obtain new branch balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Update BRANCH record with new branch balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Insert new HISTORY record with transaction information;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Prepare return buffer with necessary information;<br />&#160;&#160;&#160;&#160;&#160;&#160;tpreturn() with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127726"> </a>
Listing&#160;3-10	    INQUIRY Pseudo-code 
</div> <a name="wp1127727"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void INQUIRY(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;-Extract account ID from fielded buffer using Fvall();<br />&#160;&#160;&#160;&#160;&#160;&#160;-Check that account ID is a legal value and tpreturn() with failure if not;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read only;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve ACCOUNT record to get account balance;<br />&#160;&#160;&#160;&#160;&#160;&#160;-Prepare return buffer with necessary information;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn() with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127729"> </a>
Listing&#160;3-11	    TRANSFER Pseudo-code 
</div> <a name="wp1127730"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void TRANSFER(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Extract account ID&#39;s and amount from fielded buffer using Fvall() <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and Fget();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that both account IDs are legal values and tpreturn() with <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;failure if not;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Check that transfer amount is positive and tpreturn() with failure if <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;it is not;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Create withdrawal request buffer with tpalloc(); initialize it for <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FML with<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Finit();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Fill withdrawal request buffer with values for WITHDRAWAL service request;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Increase priority of coming WITHDRAWAL request since call is from<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a service;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Do tpcall() to WITHDRAWAL service;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Get information from returned request buffer;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Reinitialize withdrawal request buffer for use as deposit request buffer<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;with Finit();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Fill deposit request buffer with values for DEPOSIT service request;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Increase priority of coming DEPOSIT request;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Do tpcall() to DEPOSIT service;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Prepare return buffer with necessary information;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Free withdrawal/deposit request buffer with tpfree();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn() with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127732"> </a>
Listing&#160;3-12	    ABAL Pseudo-code 
</div> <a name="wp1127733"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void ABAL(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read only;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve sum of all ACCOUNT file BALANCE values for the<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;database of this server group (A single ESQL<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;statement is sufficient);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Place sum into return buffer data structure;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn( ) with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127735"> </a>
Listing&#160;3-13	    TBAL Pseudo-code 
</div> <a name="wp1127736"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void TBAL(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read only;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve sum of all TELLER file BALANCE values for the<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;database of this server group (A single ESQL<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;statement is sufficient);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Place sum into return buffer data structure;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn( ) with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127738"> </a>
Listing&#160;3-14	    ABAL_BID Pseudo-code 
</div> <a name="wp1127739"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void ABAL_BID(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read only;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set branch_ID based on transb buffer;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve sum of all ACCOUNT file BALANCE values for records<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;having BRANCH_ID = branch_ID (A single ESQL<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;statement is sufficient);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Place sum into return buffer data structure;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn( ) with success;<br />&#160;&#160;&#160;&#160;}</pre></div><div class="pCodeTitle"><a name="wp1127741"> </a>
Listing&#160;3-15	    TBAL_BID Pseudo-code 
</div> <a name="wp1127742"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;void TBAL_BID(TPSVCINFO *transb)<br />&#160;&#160;&#160;&#160;{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set transaction consistency level to read only;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Set branch_ID based on transb buffer;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Retrieve sum of all TELLER file BALANCE values for records<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;having BRANCH_ID = branch_ID (A single ESQL<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;statement is sufficient);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;-Place sum into return buffer data structure;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;tpreturn( ) with success;<br />&#160;&#160;&#160;&#160;}</pre></div><h3 class="pHeading2"><a name="wp1127744"> </a>
Utilities Incorporated into Servers
</h3>
<p class="pBody"><a name="wp1127745"> </a>
Two C subroutines are included among the source files for <code class="cCode">bankapp</code>: <code class="cCode">appinit.c</code> and <code class="cCode">util.c</code>: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1127746"> </a><code class="cCode">appinit.c</code> contains application-specific versions of the <code class="cCode">tpsvrinit()</code> and <code class="cCode">tpsvrdone()</code> subroutines. <code class="cCode">tpsvrinit()</code> and <code class="cCode">tpsvrdone()</code> are subroutines included in the standard Oracle Tuxedo ATMI <code class="cCode">main()</code>. The default version of <code class="cCode">tpsvrinit()</code> calls two functions: <code class="cCode">tpopen()</code>, to open the resource manager, and <code class="cCode">userlog()</code>, to post a message that the server has started. The default version of <code class="cCode">tpsvrdone()</code> also calls two functions: <code class="cCode">tpclose()</code>, to close the resource manager, and <code class="cCode">userlog()</code>, to post a message that the server is about to shut down. Any application subroutines named <code class="cCode">tpsvrinit()</code> and <code class="cCode">tpsvrdone()</code> can be used in place of the default subroutines, thus enabling an application to provide initialization and pre-shutdown procedures of its own. </li>
<li><a name="wp1127747"> </a><code class="cCode">util.c</code> contains a subroutine called <code class="cCode">getstr()</code>, which is used in <code class="cCode">bankapp</code> to process SQL error messages. </li>
</ul></div>
<h3 class="pHeading2"><a name="wp1127786"> </a>
Alternative Way to Code Services
</h3>
<p class="pBody"><a name="wp1127787"> </a>
In the <code class="cCode">bankapp</code> source files all the services were incorporated into files that are referred to as the source code for servers. These files have the same names as the <code class="cCode">bankapp</code> servers, but are not really servers because they do not contain a <code class="cCode">main()</code> section. A standard <code class="cCode">main()</code> is provided by Oracle Tuxedo ATMI at <code class="cCode">buildserver</code> time.
</p>
<p class="pBody"><a name="wp1127788"> </a>
An alternative organization for an Oracle Tuxedo system application is to keep each service subroutine in a separate file. Suppose, for example, that you want to use this alternative structure for the <code class="cCode">TLR</code> server. The <code class="cCode">TLR.ec </code>file contains three services that you maintain in three separate .<code class="cCode">ec</code> files: <code class="cCode">INQUIRY.ec</code>, <code class="cCode">WITHDRAW.ec</code>, and <code class="cCode">DEPOSIT.ec</code>. Follow these steps.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1168121"> </a>Compile each .<code class="cCode">ec</code> file into a .<code class="cCode">o</code> file.</li>
<li><a name="wp1168122"> </a>Run the <code class="cCode">buildserver</code> command specifying each .<code class="cCode">o</code> file with a separate invocation of the <code class="cCode">-f</code> option.</li>
<a name="wp1127789"> </a><div class="pPreformattedRelative"><pre>    buildserver -r TUXEDO/SQL \<br />                -s DEPOSIT -s WITHDRAWAL -s INQUIRY \<br />                -o TLR \<br />                -f DEPOSIT.o -f WITHDRAW.o -f INQUIRY.o \<br />                -f util.o -f -lm</pre></div><a name="wp1127790"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The backslash in the preceding command-line entry is a documentation convention that indicates a line break for presentation purposes only. You should enter the command and options on one line</td>
</tr>
</table>

</ol></div>
<p class="pBody"><a name="wp1303361"> </a>
As this example illustrates, you do not need to code all the service functions in a single source file. In other words, a server does not need to exist as a source program file at all. It can be derived from various source files and exist as a server executable through the files specified on the <code class="cCode">buildserver</code> command line. This can give you greater flexibility in building servers. 
</p>
<h3 class="pHeading2"><a name="wp1127791"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1127795"> </a><a href="tutba.html#wp1122284">Familiarizing Yourself with bankapp</a></li>
<li><a name="wp1293895"> </a><span class="cHyperlink">
&#8220;What You </span><a href="../int/intatm.html"></a>Can Do Using the ATMI&#8221; in <em class="cEmphasis">Introducing Oracle Tuxedo ATMI</em></li>
<li><a name="wp1127796"> </a>buildserver(1) in the <em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
<li><a name="wp1128157"> </a><em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1122904"> </a>
Preparing bankapp Files and Resources
</h2><p class="pBody"><a name="wp1297231"> </a>
This documentation leads you through the procedures you must complete to create the files and other resources you need to run <code class="cCode">bankapp</code>.
</p>
<p class="pBody"><a name="wp1302705"> </a>
Click on each task for instructions on completing that task.
</p>
<p class="pGraphic"><a name="wp1298724"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/tour1.gif" height="414" width="519" usemap="#tour1_gif" id="wp1298987"/>
<map name="tour1_gif">
<area href="tutba.html#wp1297976" shape="rect" coords="145,8,375,56" />
<area href="tutba.html#wp1187540" shape="rect" coords="144,62,374,95" />
<area href="tutba.html#wp1187460" shape="rect" coords="145,100,374,134" />
<area href="tutba.html#wp1129239" shape="rect" coords="145,139,374,171" />
<area href="tutba.html#wp1130000" shape="rect" coords="145,176,374,225" />
<area href="tutba.html#wp1129468" shape="rect" coords="145,231,374,265" />
<area href="tutba.html#wp1129511" shape="rect" coords="145,268,376,314" />
<area href="tutba.html#wp1129511" shape="rect" coords="145,323,376,355" />
<area href="tutba.html#wp1129728" shape="rect" coords="145,361,377,404" />
</map>
</div><p class="pGraphic">

</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1297976"> </a>
Step 1: How to Set the Environment Variables
</h2><p class="pBody"><a name="wp1295659"> </a>
The environment variables are defined in the <code class="cCode">bankvar</code> file. The file is large (approximately 185 lines) because it includes extensive comments. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1189221"> </a>In a text editor, familiarize yourself with the <code class="cCode">bankvar</code> file. </li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1131336"> </a>The first key line checks whether <code class="cCode">TUXDIR</code> is set. If it is not set, execution of the file fails with the following message: </li>
<a name="wp1131337"> </a><div class="pPreformattedRelative"><pre>TUXDIR: parameter null or not set</pre></div></ul></div>
<li><a name="wp1131338"> </a>Set <code class="cCode">TUXDIR</code> to the root directory of your Oracle Tuxedo system directory structure, and export it. </li>
<li><a name="wp1182092"> </a>Another line in <code class="cCode">bankvar</code> sets <code class="cCode">APPDIR</code> to the directory <code class="cCode">${TUXDIR}/samples/atmi/bankapp</code>, which is the directory where <code class="cCode">bankapp</code> source files are located. <code class="cCode">APPDIR</code> is a directory where the Oracle Tuxedo system looks for your application-specific files. You may prefer to copy the <code class="cCode">bankapp</code> files to a different directory to safeguard the original source files. If you do, enter the directory there. It does not have to be under <code class="cCode">TUXDIR</code>. </li>
<li><a name="wp1131340"> </a>Set a value for <code class="cCode">DIPCKEY</code>. This is an <code class="cCode">IPCKEY</code> for an Oracle Tuxedo system database. The value of <code class="cCode">DIPCKEY</code> must be different from the value of the Oracle Tuxedo system <code class="cCode">IPCKEY</code> specified in the <code class="cCode">UBBCONFIG</code> file. </li>
<a name="wp1131341"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Other variables specified in <code class="cCode">bankvar</code> play various roles in the sample application; you need to be aware of them when you are developing your own application. By including them all in <code class="cCode">bankvar</code>, we provide you with a &#8220;template&#8221; that you may want to adapt at a later time for use with a real application. </td>
</tr>
</table>

<li><a name="wp1158939"> </a>When you have made all the required changes to <code class="cCode">bankvar</code>, execute <code class="cCode">bankvar</code> as follows: </li>
<a name="wp1131342"> </a><div class="pPreformattedRelative"><pre>. ./bankvar</pre></div><div class="pCodeTitle"><a name="wp1131343"> </a>
Listing&#160;3-16	   bankvar: Environment Variables for bankapp 
</div> <a name="wp1226367"> </a><div class="pPreformatted"><pre># Copyright (c) 1997, 1996 BEA Systems, Inc.<br /># Copyright (c) 1995, 1994 Novell, Inc.<br /># Copyright (c) 1993, 1992, 1991, 1990 Unix System Laboratories, Inc.<br /># All rights reserved<br /># <br /># This file sets all the environment variables needed by the TUXEDO software<br /># to run the bankapp<br />#<br /># This directory contains all the TUXEDO software<br /># System administrator must set this variable<br />#<br />if [ -z &quot;${TUXDIR}&quot; ] ; then<br /> if [ ! -z &quot;${ROOTDIR}&quot; ] ; then<br />  TUXDIR=$ROOTDIR<br />  export TUXDIR<br /> fi<br /> fi<br />TUXDIR=${TUXDIR:?}<br />#<br /># Reset LANG if necessary<br />#<br />if [ ! -d ${TUXDIR}/locale/C -a -d ${TUXDIR}/locale/english_us ] ; then<br /> export LANG<br /> LANG=english_us.ascii<br />fi<br />#<br /># This directory contains all the user written code<br />#<br /># Contains the full path name of the directory that the application<br /># generator should place the files it creates<br />#<br />APPDIR=${TUXDIR}/apps/bankapp<br />#<br /># This path contains the shared objects that are dynamically linked at<br /># runtime in certain environments, e.g., SVR4.<br />#<br />LD_LIBRARY_PATH=${TUXDIR}/lib:${LD_LIBRARY_PATH}<br />#<br /># Set the path to shared objects in HP-UX<br />#<br />SHLIB_PATH=${TUXDIR}/lib:${SHLIB_PATH}<br />#<br /># Set the path to shared objects in AIX<br />#<br />LIBPATH=${TUXDIR}/lib:/usr/lib:${LIBPATH}<br />#<br /># Logical block size; Database Administrator must set this variable<br />#<br />BLKSIZE=512<br />#<br /># Set default name of the database to be used by database utilities<br /># and database creation scripts<br />#<br />DBNAME=bankdb<br />#<br /># Indicate whether database is to be opened in share or private mode<br />#<br />DBPRIVATE=no<br />#          <br /># Set Ipc Key for the database; this MUST differ from the UBBCONFIG<br /># *RESOURCES IPCKEY parameter<br />#<br />DIPCKEY=80953<br />#<br /># Environment file to be used by tmloadcf<br />#<br />ENVFILE=${APPDIR}/ENVFILE<br />#<br /># List of field table files to be used by mc, viewc, tmloadcf, etc.<br />#<br />FIELDTBLS=Usysflds,bankflds,creditflds,eventflds<br />#<br />FIELDTBLS32=Usysfl32,evt_mib,tpadm<br />#<br /># List of directories to search to find field table files<br />#<br />FLDTBLDIR=${TUXDIR}/udataobj:${APPDIR}<br />#<br />FLDTBLDIR32=${TUXDIR}/udataobj:${APPDIR}<br />#<br /># Universal Device List for database<br />#<br />FSCONFIG=${APPDIR}/bankdl1<br />#<br /># Network address, used in MENU script<br />#<br />NADDR=<br />#<br /># Network device name<br />#<br />NDEVICE=<br />#<br /># Network listener address, used in MENU script<br />#<br />NLSADDR=<br />#<br /># Make sure TERM is set<br />#<br />TERM=${TERM:?}<br />#<br /># Set device for the transaction log; this should match the TLOGDEVICE<br /># parameter under this site&#39;s LMID in the *MACHINES section of the<br /># UBBCONFIG file<br />#<br />TLOGDEVICE=${APPDIR}/TLOG<br />#<br /># Device for binary file that gives the BEA Tuxedo system all its information<br />#<br />TUXCONFIG=${APPDIR}/tuxconfig<br />#<br /># Set the prefix of the file which is to contain the central user log;<br /># this should match the ULOGPFX parameter under this site&#39;s LMID in the<br /># *MACHINES section of the UBBCONFIG file<br />#<br />ULOGPFX=${APPDIR}/ULOG<br />#<br /># System name, used by RUNME.sh<br />#<br />UNAME=<br />#<br /># List of view files to be used by viewc, tmloadcf, etc.<br />#<br />VIEWFILES=aud.V<br />#<br />VIEWFILES32=mib_views,tmib_views<br />#<br /># List of directories to search to find view files<br />#<br />VIEWDIR=${TUXDIR}/udataobj:${APPDIR}<br />#<br />VIEWDIR32=${TUXDIR}/udataobj:${APPDIR}<br />#<br /># Specify the Q device (if events included in demo)<br />#<br />QMCONFIG=${APPDIR}/qdevice<br />#<br /># Export all variables just set<br />#<br />export TUXDIR APPDIR BLKSIZE DBNAME DBPRIVATE DIPCKEY ENVFILE<br />export LD_LIBRARY_PATH SHLIB_PATH LIBPATH<br />export FIELDTBLS FLDTBLDIR FSCONFIG MASKPATH OKXACTS TERM<br />export FIELDTBLS32 FLDTBLDIR32<br />export TLOGDEVICE TUXCONFIG ULOGPFX<br />export VIEWDIR VIEWFILES<br />export VIEWDIR32 VIEWFILES32<br />export QMCONFIG<br />#<br /># Add TUXDIR/bin to PATH if not already there<br />#<br />a=&quot;`echo $PATH | grep ${TUXDIR}/bin`&quot;<br />if [ x&quot;$a&quot; = x ]<br />then<br /> PATH=${TUXDIR}/bin:${PATH}<br /> export PATH<br />fi<br />#<br /># Add APPDIR to PATH if not already there<br />#<br />a=&quot;`echo $PATH | grep ${APPDIR}`&quot;<br />if [ x&quot;$a&quot; = x ]<br />then<br /> PATH=${PATH}:${APPDIR}<br /> export PATH<br />fi<br /><br />#<br /># Check for other machine types bin directories<br />#<br />for DIR in /usr/5bin /usr/ccs/bin /opt/SUNWspro/bin<br />do<br />	if [ -d ${DIR} ] ; then<br /> PATH=&quot;${DIR}:${PATH}&quot;<br />fi<br />done</pre></div></ol></div>
<a name="wp1131346"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If your operating system is Sun Solaris, you must do two things: use <code class="cCode">/bin/sh</code> rather than <code class="cCode">csh</code> for your shell place; and specify <code class="cCode">/usr/5bin</code> at the beginning of your <code class="cCode">PATH</code>, as follows.</td>
</tr>
</table>

<p class="pBodyRelative"><a name="wp1129956"> </a>
<code class="cCode">PATH=/usr/5bin:$PATH;export PATH</code>
</p>
<h3 class="pHeading2"><a name="wp1151200"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1151227"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1187540"> </a>
Step 2: Building Servers in bankapp
</h2><p class="pBody"><a name="wp1187541"> </a>
<code class="cCode">buildserver</code>(1) puts together an executable ATMI server built on the Oracle Tuxedo ATMI <code class="cCode">main()</code>. Options identify the names of the output file, the input files provided by the application, and various libraries that permit you to run an Oracle Tuxedo system application in a variety of ways. 
</p>
<p class="pBody"><a name="wp1187542"> </a>
<code class="cCode">buildserver</code> invokes the <code class="cCode">cc</code> command. The environment variables <code class="cCode">CC</code> and <code class="cCode">CFLAGS</code> can be set to name an alternative compile command and to set flags for the compile and link edit phases. The <code class="cCode">buildserver</code> command is used in <code class="cCode">bankapp.mk</code> to compile and build each server in the banking application. The following sections describe the six <code class="cCode">bankapp</code> servers:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1187543"> </a><a href="tutba.html#wp1187549">How to Build ACCT Server</a></li>
<li><a name="wp1187544"> </a><a href="tutba.html#wp1187569">How to Build the BAL Server</a></li>
<li><a name="wp1187545"> </a><a href="tutba.html#wp1187573">How to Build the BTADD Server</a></li>
<li><a name="wp1187546"> </a><a href="tutba.html#wp1187580">How to Build the TLR Server</a></li>
<li><a name="wp1187547"> </a><a href="tutba.html#wp1187589">How to Build the XFER Server</a></li>
<li><a name="wp1187548"> </a><a href="tutba.html#wp1187460">Step 3: Editing the bankapp Makefile</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1187549"> </a>
How to Build ACCT Server
</h3>
<p class="pBody"><a name="wp1187550"> </a>
The <code class="cCode">ACCT</code> server is derived from a file called <code class="cCode">ACCT.ec</code> that contains the code for the <code class="cCode">OPEN_ACCT</code> and <code class="cCode">CLOSE_ACCT</code> functions. It is created in two steps. <code class="cCode">ACCT.ec</code> is first compiled to an <code class="cCode">ACCT.o</code> file, which is then specified to the <code class="cCode">buildserver</code> command so that any compile-time errors can be identified and resolved. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1188988"> </a>Create the <code class="cCode">ACCT.o</code> file (performed for you in <code class="cCode">bankapp.mk</code>): </li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1187551"> </a>The <code class="cCode">.c</code> file is generated as follows: <code class="cCode">esql ACCT.ec</code>.</li>
<li><a name="wp1187552"> </a>The <code class="cCode">.o</code> file is generated as follows: <code class="cCode">cc -I $TUXDIR/include -c ACCT.c</code>.</li>
<li><a name="wp1187553"> </a>The <code class="cCode">ACCT</code> server is created by running the following <code class="cCode">buildserver</code> command line. </li>
<a name="wp1187554"> </a><div class="pPreformattedRelative"><pre>    buildserver -r TUXEDO/SQL \<br />                -s OPEN_ACCT -s CLOSE_ACCT \<br />                -o ACCT \<br />                -f ACCT.o -f appinit.o -f util.o</pre></div><a name="wp1285712"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The backslash in the preceding command-line entry is a documentation convention that indicates a line break for presentation purposes only. You should enter the command and options on one line.</td>
</tr>
</table>

</ul></div>
</ol></div>
<p class="pBody"><a name="wp1187558"> </a>
Following is an explanation of the <code class="cCode">buildserver</code> command-line options:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1187559"> </a>The <code class="cCode">-r</code> option is used to specify which resource manager access libraries should be link edited with the executable server. The choice is specified with the string <code class="cCode">TUXEDO/SQL</code>.</li>
<li><a name="wp1187560"> </a>The <code class="cCode">-s</code> option is used to specify the names of the services in the server that are available to be advertised when the server is booted. If the name of a function that performs a service is different from the corresponding service name, the function name becomes part of the argument to the <code class="cCode">-s</code> option. <br />In <code class="cCode">bankapp</code>, the function name is always the same as the name of the corresponding service so only the service names themselves need to be specified. It is our convention to spell all service names in all uppercase. For example, the <code class="cCode">OPEN_ACCT</code> service is processed by the function <code class="cCode">OPEN_ACCT()</code>. However, the <code class="cCode">-s</code> option to <code class="cCode">buildserver</code> does allow you to specify an arbitrary name for the processing function for a service within a server. Refer to the <code class="cCode">buildserver</code>(1) reference page for details. It is also possible for an administrator to specify that only a subset of the services used to create the server with the <code class="cCode">buildserver</code> command is to be available when the server is booted. </li>
<li><a name="wp1187561"> </a>The <code class="cCode">-o</code> option is used to assign a name to the executable output file. If no name is provided, the file is named <code class="cCode">SERVER</code>. </li>
<li><a name="wp1187562"> </a>The <code class="cCode">-f </code>option specifies the files that are used in the link-edit phase. (For related information, see the description of the <code class="cCode">-l</code> option on the <code class="cCode">buildserver</code>(1) reference page.) The order in which the files are listed depends on function references and the libraries in which those references are resolved. Source modules should be listed before libraries that might be used to resolve their references. If these are <code class="cCode">.c</code> files, they are first compiled. (In the example above, <code class="cCode">appinit.o</code> and <code class="cCode">util.o</code> have been already compiled.) Object files can be either separate <code class="cCode">.o</code> files or groups of files in archive (<code class="cCode">.a</code>) files. If more than one filename is given as an argument to the <code class="cCode">-f</code> option, the list must be enclosed in double quotation marks. Although the <code class="cCode">-f </code>option takes only one file or one list of files (enclosed in double quotation marks) as an argument, you can include the <code class="cCode">-f</code> option as many times as necessary on a single command line.</li>
</ul></div>
<p class="pBody"><a name="wp1187563"> </a>
To summarize, the options specified on the <code class="cCode">buildserver</code> command line used to create the ACCT server performed the following functions:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1187564"> </a>The <code class="cCode">-r</code> option specifies the Oracle Tuxedo system SQL resource manager.</li>
<li><a name="wp1187565"> </a>The <code class="cCode">-s</code> option names the <code class="cCode">OPEN_ACCT</code> and <code class="cCode">CLOSE_ACCT</code> services (which are defined by functions of the same name in the <code class="cCode">ACCT.ec</code> file) to be the services that make up the <code class="cCode">ACCT</code> server.</li>
<li><a name="wp1187566"> </a> The <code class="cCode">-o</code> option assigns the name <code class="cCode">ACCT</code> to the executable output file.</li>
<li><a name="wp1187567"> </a>The <code class="cCode">-f </code>option specifies that the <code class="cCode">ACCT.o</code>, <code class="cCode">appinit.o</code>, and <code class="cCode">util.o</code> files are to be used in the link-edit phase of the build. </li>
<a name="wp1187568"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The <code class="cCode">appinit.c</code> file contains the system-supplied <code class="cCode">tpsvrinit()</code> and <code class="cCode">tpsvrdone()</code>. (Refer to <code class="cCode">tpservice</code>(3c) reference pages for an explanation of how these routines are used.) </td>
</tr>
</table>

</ul></div>
<h3 class="pHeading2"><a name="wp1187569"> </a>
How to Build the BAL Server
</h3>
<p class="pBody"><a name="wp1187570"> </a>
The <code class="cCode">BAL</code> server is derived from a file called <code class="cCode">BAL.ec</code> that contains the code for the <code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABAL_BID</code>, and <code class="cCode">TBAL_BID</code> functions. As with <code class="cCode">ACCT.ec</code>, the <code class="cCode">BAL.ec</code> is first compiled to a <code class="cCode">BAL.o</code> file before being supplied to the <code class="cCode">buildserver</code> command so that any compile-time errors can be identified and resolved. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1210893"> </a>Modify the <code class="cCode">buildserver</code> command used to create the <code class="cCode">BAL</code> server as follows:</li>
<a name="wp1285818"> </a><div class="pPreformattedRelative"><pre>    buildserver -r TUXEDO/SQL \<br />                -s ABAL -s TBAL -s ABAL_BID -s TBAL_BID\<br />                -o BAL \<br />                -f BAL.o -f appinit.o</pre></div><a name="wp1285839"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The backslash in the preceding command-line entry is a documentation convention that indicates a line break for presentation purposes only. You should enter the command and options on one line.</td>
</tr>
</table>

<div class="pSmartList2Bullet"><ul>
<li><a name="wp1285819"> </a>Use the <code class="cCode">-r</code> option to specify the Oracle Tuxedo system SQL resource manager.</li>
<li><a name="wp1285820"> </a>Use the <code class="cCode">-s</code> option to name the <code class="cCode">ABAL</code>, <code class="cCode">TBAL</code>, <code class="cCode">ABAL_BID</code>, <code class="cCode">TBAL_BID</code> services that make up the <code class="cCode">BAL</code> server. The functions in the <code class="cCode">BAL.ec</code> file that define these services have identical names.</li>
<li><a name="wp1210917"> </a>Use the <code class="cCode">-o</code> option to assign the name <code class="cCode">BAL</code> to the executable server.</li>
<li><a name="wp1210938"> </a>Use the <code class="cCode">-f</code> option to specify that the <code class="cCode">BAL.o</code> and the <code class="cCode">appinit.o</code> files are to be used in the link-edit phase. </li>
</ul></div>
</ol></div>
<h3 class="pHeading2"><a name="wp1187573"> </a>
How to Build the BTADD Server
</h3>
<p class="pBody"><a name="wp1187574"> </a>
The <code class="cCode">BTADD</code> server is derived from a file called <code class="cCode">BTADD.ec</code> that contains the code for the <code class="cCode">BR_ADD</code> and <code class="cCode">TLR_ADD</code> functions. The <code class="cCode">BTADD.ec</code> is compiled to a <code class="cCode">BTADD.o</code> file before being supplied to the <code class="cCode">buildserver</code> command. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1188950"> </a>Modify the <code class="cCode">buildserver</code> command used to create the <code class="cCode">BTADD</code> server as follows:</li>
<a name="wp1187575"> </a><div class="pPreformattedRelative"><pre>    buildserver -r TUXEDO/SQL \<br />                -s BR_ADD -s TLR_ADD \<br />                -o BTADD \<br />                -f BTADD.o -f appinit.o</pre></div><a name="wp1285856"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The backslash in the preceding command-line entry is a documentation convention that indicates a line break for presentation purposes only. You should enter the command and options on one line.</td>
</tr>
</table>

<div class="pSmartList2Bullet"><ul>
<li><a name="wp1187576"> </a>Use the<code class="cCode"> -r</code> option to specify the Oracle Tuxedo system SQL resource manager.</li>
<li><a name="wp1187577"> </a>Use the <code class="cCode">-s</code> option to name the <code class="cCode">BR_ADD</code> and <code class="cCode">TLR_ADD</code> services that make up the <code class="cCode">BTADD</code> server. The functions in the <code class="cCode">BTADD.ec</code> file that define these services have identical names.</li>
<li><a name="wp1187578"> </a>Use the <code class="cCode">-o</code> option to assign the name <code class="cCode">BTADD</code> to the executable server.</li>
<li><a name="wp1187579"> </a>Use the <code class="cCode">-f</code> option to specify that the <code class="cCode">BTADD.o</code> and <code class="cCode">appinit.o</code> files are to be used in the link-edit phase. </li>
</ul></div>
</ol></div>
<h3 class="pHeading2"><a name="wp1187580"> </a>
How to Build the TLR Server
</h3>
<p class="pBody"><a name="wp1187581"> </a>
The <code class="cCode">TLR</code> server is derived from a file called <code class="cCode">TLR.ec</code> that contains the code for the <code class="cCode">DEPOSIT</code>, <code class="cCode">WITHDRAWAL</code>, and <code class="cCode">INQUIRY</code> functions. The <code class="cCode">TLR.ec</code> is also compiled to a <code class="cCode">TLR.o</code> file before being supplied to the <code class="cCode">buildserver</code> command.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1188831"> </a>Modify the <code class="cCode">buildserver</code> command used to create the <code class="cCode">TLR</code> server as follows:</li>
<a name="wp1187582"> </a><div class="pPreformattedRelative"><pre>    buildserver -r TUXEDO/SQL \<br />                -s DEPOSIT -s WITHDRAWAL -s INQUIRY \<br />                -o TLR \<br />                -f TLR.o -f util.o -f -lm</pre></div><a name="wp1285900"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The backslash in the preceding command-line entry is a documentation convention that indicates a line break for presentation purposes only. You should enter the command and options on one line.</td>
</tr>
</table>

<div class="pSmartList2Bullet"><ul>
<li><a name="wp1187583"> </a>Use the <code class="cCode">-r</code><code class="cCodeBold"> </code>option to specify the Oracle Tuxedo system SQL resource manager.</li>
<li><a name="wp1187584"> </a>Use the <code class="cCode">-s</code> option to name the <code class="cCode">DEPOSIT</code>, <code class="cCode">WITHDRAWAL</code>, and <code class="cCode">INQUIRY</code> services that make up the <code class="cCode">TLR</code> server. The functions in the <code class="cCode">TLR.ec</code> file that define these services have identical names.</li>
<li><a name="wp1187585"> </a>Use the <code class="cCode">-o</code> option to assign the name <code class="cCode">TLR</code> to the executable server.</li>
<li><a name="wp1187586"> </a>Use the <code class="cCode">-f</code> option to specify that the <code class="cCode">TLR.o</code> and the <code class="cCode">util.o</code> files are to be used in the link-edit phase. </li>
<a name="wp1187587"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>In this example, the <code class="cCode">-f</code> option is used to pass an option (<code class="cCode">-lm</code>) to the <code class="cCode">cc</code> command, which is invoked by <code class="cCode">buildserver</code>. The <code class="cCode">-lm</code> argument to <code class="cCode">-f</code> causes the math libraries to be linked in at compile time.</td>
</tr>
</table>

</ul></div>
</ol></div>
<p class="pBody"><a name="wp1187588"> </a>
(Refer to <code class="cCode">cc</code>(1) in the <em class="cEmphasis">UNIX System V User&#39;s Reference Manual</em> for a complete list of compile-time options.)
</p>
<h3 class="pHeading2"><a name="wp1187589"> </a>
How to Build the XFER Server
</h3>
<p class="pBody"><a name="wp1187590"> </a>
The <code class="cCode">XFER</code> server is derived from a file called <code class="cCode">XFER.c</code> that contains the code for the <code class="cCode">TRANSFER</code> function. The <code class="cCode">XFER.c</code> is also compiled to an <code class="cCode">XFER.o</code> file before being supplied to the <code class="cCode">buildserver</code> command. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1188745"> </a>Modify the <code class="cCode">buildserver</code> command used to create the <code class="cCode">XFER</code> server as follows:</li>
<a name="wp1285950"> </a><div class="pPreformattedRelative"><pre>    buildserver -r TUXEDO/SQL \<br />                -s TRANSFER \<br />                -o XFER \<br />                -f XFER.o -f appinit.o</pre></div><a name="wp1285951"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The backslash in the preceding command-line entry is a documentation convention that indicates a line break for presentation purposes only. You should enter the command and options on one line.</td>
</tr>
</table>

<div class="pSmartList2Bullet"><ul>
<li><a name="wp1285952"> </a>Use the <code class="cCode">-r</code> option to specify the Oracle Tuxedo system SQL resource manager.</li>
<li><a name="wp1187593"> </a>Use the <code class="cCode">-s</code> option to name the <code class="cCode">TRANSFER</code> service that makes up the <code class="cCode">XFER</code> server. The function in the <code class="cCode">XFER.c</code> file that defines the <code class="cCode">TRANSFER</code> service has the identical name.</li>
<li><a name="wp1187594"> </a>Use the <code class="cCode">-o</code> option to assign the name <code class="cCode">XFER</code> to the executable server.</li>
<li><a name="wp1187595"> </a>Use the <code class="cCode">-f</code> option to specify that the <code class="cCode">XFER.o</code> and the <code class="cCode">appinit.o</code> files are to be used in the link-edit phase.</li>
</ul></div>
</ol></div>
<h3 class="pHeading2"><a name="wp1187596"> </a>
Servers Built in the bankapp.mk File
</h3>
<p class="pBody"><a name="wp1128453"> </a>
The topics on creating the <code class="cCode">bankapp</code> servers are important to your understanding of how the <code class="cCode">buildserver</code> command is specified. However, in actual practice you are apt to incorporate the build into a makefile; that is the way it is done in <code class="cCode">bankapp</code>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1187460"> </a>
Step 3: Editing the bankapp Makefile
</h2><p class="pBody"><a name="wp1132950"> </a>
<code class="cCode">bankapp</code> includes a makefile that makes all scripts executable, converts the view description file to binary format, and does all the precompiles, compiles, and builds necessary to create application servers. It can also be used to clean up when you want to make a fresh start. 
</p>
<p class="pBody"><a name="wp1132951"> </a>
As <code class="cCode">bankapp.mk</code> is delivered, there are a few fields you may want to edit, and some others that may benefit from some explanation. 
</p>
<h3 class="pHeading2"><a name="wp1151328"> </a>
How to Edit the TUXDIR Parameter
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1132953"> </a>Review <code class="cCode">bankapp.mk</code>, about 40 lines into the file, where you come to the following comment and the <code class="cCode">TUXDIR</code> parameter: </li>
<a name="wp1132954"> </a><div class="pPreformatted"><pre>    #<br />    # Root directory of TUXEDO System. This file must either be edited to set<br />    # this value correctly, or the correct value must be passed via &quot;make -f<br />    # bankapp.mk TUXDIR=/correct/tuxdir&quot;, or the build of bankapp will fail.<br />    #<br />    TUXDIR=../..</pre></div><li><a name="wp1132955"> </a>Set the <code class="cCode">TUXDIR</code> parameter to the absolute pathname of the root directory of your Oracle Tuxedo system installation. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1132956"> </a>
How to Edit the APPDIR Parameter
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1132957"> </a>Review the setting of the <code class="cCode">APPDIR</code> parameter. As <code class="cCode">bankapp</code> is delivered, <code class="cCode">APPDIR</code> is set to the directory in which the <code class="cCode">bankapp</code> files are located, relative to <code class="cCode">TUXDIR</code>. The following section of <code class="cCode">bankapp.mk</code> defines and describes the setting of <code class="cCode">APPDIR</code>. </li>
<a name="wp1132958"> </a><div class="pPreformatted"><pre>    #<br />    # Directory where the bankapp application source and executables reside.<br />    # This file must either be edited to set this value correctly, or the<br />    # correct value must be passed via &quot;make -f bankapp.mk<br />    # APPDIR=/correct/appdir&quot;, or the build of bankapp will fail.<br />    #<br />    APPDIR=$(TUXDIR)/<code class="cCode">samples/atmi</code>/bankapp<br />    #</pre></div><li><a name="wp1132959"> </a>If you copied the files to another directory, as suggested in the <code class="cCode">README</code> file, you should set <code class="cCode">APPDIR</code> to the name of the directory to which you copied the files. When you run the makefile, the application is built in this directory. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1132960"> </a>
How to Set the Resource Manager Parameters
</h3>
<p class="pBody"><a name="wp1132961"> </a>
By default, <code class="cCode">bankapp</code> is set up to use the Oracle Tuxedo/SQL as the database resource manager. This arrangement is based on the assumption that you have the Oracle Tuxedo system database on your system. If this is not the case, you should set the RM parameter to the name of your resource manager as listed in <code class="cCode">TUXDIR/udataobj/RM</code>. 
</p>
<a name="wp1151481"> </a><div class="pPreformatted"><pre>    #<br />    # Resource Manager<br />    #<br />    RM=TUXEDO/SQL<br />    #</pre></div><a name="wp1210973"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The Oracle Tuxedo SQL resource manager is included for demonstration purposes only.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1151483"> </a>
How to Run the bankapp.mk File
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1132964"> </a>When you have completed the changes you wish to make to <code class="cCode">bankapp.mk</code>, run it with the following command line:</li>
<a name="wp1132965"> </a><div class="pPreformattedRelative"><pre>    nohup make -f bankapp.mk &amp;</pre></div><li><a name="wp1129969"> </a>Check the <code class="cCode">nohup.out </code>file to make sure the process completed successfully.</li>
<a name="wp1168436"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td><code class="cCode">bankvar</code> sets a number of parameters that are referenced when <code class="cCode">bankapp.mk</code> is run. </td>
</tr>
</table>

</ol></div>
<h3 class="pHeading2"><a name="wp1152016"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1151998"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1129239"> </a>
Step 4: Creating the bankapp Database
</h2><p class="pBody"><a name="wp1134084"> </a>
This documentation describes the interface between <code class="cCode">bankapp</code> and a resource manager, typically a database management system, and how to create the database for <code class="cCode">bankapp</code>. <code class="cCode">bankapp</code> is designed to use the Oracle Tuxedo/SQL facilities of the Oracle Tuxedo system database, which is an XA-compliant resource manager. 
</p>
<a name="wp1211053"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The Oracle Tuxedo SQL resource manager is included for demonstration purposes only.</td>
</tr>
</table>

<p class="pBody"><a name="wp1134088"> </a>
How you create the <code class="cCode">bankapp</code> database depends on whether you bring up the application on a single processor (SHM mode) or on a network of more than one processor (MP mode). 
</p>
<h3 class="pHeading2"><a name="wp1134089"> </a>
How to Create the Database in SHM Mode
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1134090"> </a>Set the environment by typing the following: </li>
<a name="wp1134091"> </a><div class="pPreformattedRelative"><pre>    . ./bankvar</pre></div><li><a name="wp1134093"> </a>Execute <code class="cCode">crbank</code>. <code class="cCode">crbank</code> calls <code class="cCode">crbankdb</code> three times, changing some environment variables each time, so that you end up with three database files on a single machine. As a result, you can simulate the multi-machine environment of the Oracle Tuxedo system without a network of machines. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1134094"> </a>
How to Create the Database in MP Mode
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1134095"> </a>Set the environment by typing the following: </li>
<a name="wp1134096"> </a><div class="pPreformattedRelative"><pre>    . ./bankvar</pre></div><a name="wp1134097"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>You may have already set your environment variables. For detailed instructions, see &#8220;How to Set Environment Variables.&#8221;</td>
</tr>
</table>

<li><a name="wp1134098"> </a>Run <code class="cCode">crbankdb</code> to create the database for this site.</li>
<li><a name="wp1134099"> </a>On each additional machine in your Oracle Tuxedo system network, edit     <code class="cCode">bankvar</code> to provide the pathname for the <code class="cCode">FSCONFIG</code> variable that is used for that site in the configuration file, <code class="cCode">ubbmp</code>. Then repeat steps 1 and 2.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1152051"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1152049"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1130000"> </a>
Step 5: Preparing for an XA-Compliant Resource Manager
</h2><p class="pBody"><a name="wp1135785"> </a>
To run <code class="cCode">bankapp</code> with an alternative XA-compliant resource manager, you must modify various files. This section describes the following:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1168605"> </a><a href="tutba.html#wp1135786">How to Change the bankvar File</a></li>
<li><a name="wp1168845"> </a><a href="tutba.html#wp1135790">How to Change the bankapp Services</a></li>
<li><a name="wp1168858"> </a><a href="tutba.html#wp1135792">How to Change the bankapp.mk File</a></li>
<li><a name="wp1168871"> </a><a href="tutba.html#wp1135795">How to Change crbank and crbankdb</a></li>
<li><a name="wp1168883"> </a><a href="tutba.html#wp1275505">How to Change the Configuration File</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1135786"> </a>
How to Change the bankvar File
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1135787"> </a>Review the following environment variables that are assigned the values shown here, by default, to create the Oracle Tuxedo system database: </li>
<a name="wp1135788"> </a><div class="pPreformatted"><pre>    BLKSIZE=512<br />    DBNAME=bankdb<br />    DBPRIVATE=no<br />    DIPCKEY=80953<br />    FSCONFIG=${APPDIR}/bankdl1</pre></div><a name="wp1301360"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>These environment variables pertain to the Oracle Tuxedo system only; you may need to set different environment variables or other mechanisms depending on your specific database management system requirements.</td>
</tr>
</table>

<li><a name="wp1135789"> </a>Change the value of these variables as needed to create the database for your resource manager. </li>
</ol></div>
<h3 class="pHeading2"><a name="wp1135790"> </a>
How to Change the bankapp Services
</h3>
<p class="pBody"><a name="wp1135791"> </a>
Because all database access in <code class="cCode">bankapp</code> is performed with embedded SQL statements, if your new resource manager supports SQL, you should have no problem. The utility <code class="cCode">appinit.c</code> includes calls to <code class="cCode">tpopen()</code> and <code class="cCode">tpclose()</code>. 
</p>
<h3 class="pHeading2"><a name="wp1135792"> </a>
How to Change the bankapp.mk File
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1135793"> </a>Edit the RM parameter in <code class="cCode">bankapp.mk</code> to name the new resource manager.</li>
<li><a name="wp1245041"> </a>Ensure that the following entry is in the RM file.</li>
<a name="wp1245048"> </a><div class="pPreformattedRelative"><pre><code class="cCode">$TUXDIR/udataobj/RM</code></pre></div><li><a name="wp1135794"> </a>If necessary, change the name of the SQL compiler and its options. The name of the source file may or may not include .<code class="cCode">ec</code>. You may have to specify a non-default for compiling the resulting <code class="cCode">.c</code> file.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1135795"> </a>
How to Change crbank and crbankdb
</h3>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1135796"> </a><code class="cCode">crbank</code> may be ignored by your alternate resource manager. Its only functions are to reset variables and to run <code class="cCode">crbankdb</code> three times.</li>
<li><a name="wp1135797"> </a><code class="cCode">crbankdb</code>, on the other hand, requires close attention. The following code listing is the beginning of the <code class="cCode">crbankdb</code> script. It is followed by an explanation of parts of the code that do not work with a resource manager that is not supplied with the Oracle Tuxedo system.</li>
<div class="pCodeTitle"><a name="wp1135798"> </a>
Listing&#160;3-17	   Excerpt from the crbankdb Script 
</div> <a name="wp1135799"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;#Copyright (c) BEA Systems, Inc.<br />&#160;&#160;&#160;&#160;#All rights reserved<br />&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;# Create device list<br />&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;dbadmin&lt;&lt;!<br />&#160;&#160;&#160;&#160;echo<br />&#160;&#160;&#160;&#160;crdl<br />&#160;&#160;&#160;&#160;# Replace the following line with your device zero entry <br />&#160;&#160;&#160;&#160;${FSCONFIG}        0         2560<br />&#160;&#160;&#160;&#160;!<br />&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;# Create database files, fields, and secondary indices<br />&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;sql&lt;&lt;!<br />&#160;&#160;&#160;&#160;echo<br />&#160;&#160;&#160;&#160;create database ${DBNAME} with (DEVNAME=&#39;${FSCONFIG}&#39;,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;IPCKEY=${DIPCKEY}, LOGBLOCKING=0, MAXDEV=1,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NBLKTBL=200,       NBLOCKS=2048,  NBUF=70,       NFIELDS=80,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NFILES=20,         NFLDNAMES=60,  NFREEPART=40,  NLCKTBL=200,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NLINKS=80,         NPREDS=10,     NPROCTBL=20,   NSKEYS=20,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NSWAP=50,          NTABLES=20,    NTRANTBL=20,   PERM=&#39;0666&#39;,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;STATISTICS=&#39;n&#39;<br />&#160;&#160;&#160;&#160;)<br /><br />&#160;&#160;&#160;&#160;create table BRANCH (<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BRANCH_ID             integer not null,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BALANCE               real,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LAST_ACCT             integer,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LAST_TELLER           integer,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PHONE                 char(14),<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ADDRESS               char(60),<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;primary key(BRANCH_ID)<br />&#160;&#160;&#160;&#160;) with (<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FILETYPE=&#39;hash&#39;,      ICF=&#39;PI&#39;,     FIELDED=&#39;FML&#39;,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BLOCKLEN=${BLKSIZE},  DBLKS=8,      OVBLKS=2<br />&#160;&#160;&#160;&#160;)<br />&#160;&#160;&#160;&#160;</pre></div></ol></div>
<p class="pBody"><a name="wp1135802"> </a>
The first 40 lines give you an idea of what needs to be changed and what may be kept unchanged. As you can see, <code class="cCode">crbankdb</code> is made up of two documents that provide input to the <code class="cCode">dbadmin</code> and <code class="cCode">sql</code> shell commands. The first <code class="cCode">here</code> file is passed to the Oracle Tuxedo system command <code class="cCode">dbadmin</code> to create a device list for the database. 
</p>
<p class="pBody"><a name="wp1275500"> </a>
This command does not work with non-Oracle Tuxedo resource managers. Other commands may be needed to create table spaces and/or grant the correct privileges.
</p>
<h3 class="pHeading2"><a name="wp1275505"> </a>
How to Change the Configuration File
</h3>
<p class="pBody"><a name="wp1130050"> </a>
In the <code class="cCode">GROUPS</code> section, specify appropriate values (that is, values that are recognized by your resource manager) for the <code class="cCode">TMSNAME</code> and <code class="cCode">OPENINFO</code> parameters.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1240665"> </a>
How to Integrate bankapp with Oracle (XA RM) for a Windows 2003 Platform
</h2><div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1262823"> </a>Edit the <code class="cCode">nt\bankvar.cmd </code>and supply suitable values for the following environment variables:</li>
<a name="wp1263657"> </a><div class="pPreformattedRelative"><pre><code class="cCode">TUXDIR</code> : Root directory for the BEA TUXEDO system installation</pre></div><a name="wp1263660"> </a><div class="pPreformattedRelative"><pre><code class="cCode">APPDIR</code> : Application directory in which <code class="cCode">bankapp</code> files are located</pre></div><a name="wp1263663"> </a><div class="pPreformattedRelative"><pre><code class="cCode">ORACLE_HOME</code> : Root directory of the Oracle8 installation</pre></div><a name="wp1263666"> </a><div class="pPreformattedRelative"><pre><code class="cCode">ORACLE_SID</code> : Oracle System ID</pre></div><a name="wp1263769"> </a><div class="pPreformattedRelative"><pre><code class="cCode">BLK_SIZE</code>: Logical block size</pre></div><a name="wp1263772"> </a><div class="pPreformattedRelative"><pre><code class="cCode">DBNAME</code>: default name of the database to be used by database utilities and database creation scripts</pre></div><a name="wp1263776"> </a><div class="pPreformattedRelative"><pre><code class="cCode">DBPRIVATE</code>: indicates whether database is to be opened in share or private mode (yes or no)</pre></div><a name="wp1263781"> </a><div class="pPreformattedRelative"><pre><code class="cCode">FSCONFIG</code>:Universal Device List for database</pre></div><a name="wp1263784"> </a><div class="pPreformattedRelative"><pre><code class="cCode">PATH=%TUXDIR%\bin;%TUXDIR%\include;%TUXDIR%\lib;%ORACLE_HOME%\bin;%PATH%</code></pre></div><a name="wp1263787"> </a><div class="pPreformattedRelative"><pre><code class="cCode">INCLUDE=%ORACLE_HOME%\rdbms80\xa; %ORACLE_HOME%\pro80\c\include;%include%</code></pre></div><a name="wp1263790"> </a><div class="pPreformattedRelative"><pre><code class="cCode">NLSPATH=%TUXDIR%\locale\C</code></pre></div><a name="wp1263813"> </a><div class="pPreformattedRelative"><pre><code class="cCode">PLATFORM=inwnt40</code></pre></div><a name="wp1263824"> </a><div class="pPreformattedRelative"><pre><code class="cCode">LIB=%TUXDIR%\lib; %ORACLE_HOME%\pro80\lib\msvc; %ORACLE_HOME%\rdbms80\xa; %lib%;</code></pre></div><li><a name="wp1262838"> </a>Run the script to set up the environment:</li>
<a name="wp1262839"> </a><div class="pPreformattedRelative"><pre>&gt;bankvar</pre></div><li><a name="wp1262843"> </a>Edit the <code class="cCode">TUXDIR\udataobj\RM</code> file as follows:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1263917"> </a>Append the following line to the <code class="cCode">$TUXDIR\udataobj\RM</code> file:</li>
<a name="wp1263932"> </a><div class="pPreformattedRelative"><pre>Oracle_XA;xaosw;<code class="cCode">%ORACLE_HOME</code>%\pro80\lib\msvc\sqllib80.lib <code class="cCode">%ORACLE_HOME</code>%\RDBMS80\XA\xa80.lib</pre></div><p class="pBodyRelative"><a name="wp1262846"> </a>
or if Oracle exists over the network:
</p>
<li><a name="wp1263957"> </a>Map the machine to a drive, for example, F.</li>
<li><a name="wp1263960"> </a>Append the following line to the <code class="cCode">$TUXDIR\udataobj\RM</code> file:</li>
<a name="wp1262850"> </a><div class="pPreformattedRelative"><pre>Oracle_XA;xaosw;f:\orant\pro80\lib\msvc\sqllib80.lib f:\orant\RDBMS80\XA\xa80.lib</pre></div><li><a name="wp1262852"> </a>Remove any previous entry of Oracle_XA in the <code class="cCode">RM</code> file&gt;</li>
</ul></div>
<li><a name="wp1262856"> </a>Build the Transaction Manager Server for Oracle8:</li>
<a name="wp1262857"> </a><div class="pPreformattedRelative"><pre>cd $APPDIR<br />buildtms -r Oracle_XA -o TMS_ORA</pre></div><li><a name="wp1262862"> </a>Edit the <code class="cCode">nt\bankapp.mak</code> file as indicated in the following table.</li>
<p class="pGraphic"><a name="wp1276877"> </a>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1277695table1276879">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1277695"> </a>
Task
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1277697"> </a>
Value
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277699"> </a>
Specify values for the following environment variables.
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277701"> </a>
<code class="cCode">TUXDIR=</code>Root directory for the Oracle Tuxedo system installation
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277705"> </a>
<code class="cCode">APPDIR=</code>Application directory in which <code class="cCode">bankapp</code> files are located
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277709"> </a>
<code class="cCode">RM=Oracle_XA</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277713"> </a>
<code class="cCode">ORACLE_LIBS=$(ORACLE_HOME)\PRO80\LIB</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277717"> </a>
<code class="cCode">RMNAME=Oracle_XA</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277721"> </a>
<code class="cCode">SQLPUBLIC=$(ORACLE_HOME)\PRO80\C\INCLUDE</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277725"> </a>
<code class="cCode">CFLAGS=$(HOST) -DNOWHAT=1 $(CGFLAGS) $(DFML32)</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1282362"> </a>
<code class="cCode">CGFLAGS=-DWIN32 -W3 -MD -nologo</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277729"> </a>
<code class="cCode">ORACLE_DIR=$(ORACLE_HOME)\bin</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277733"> </a>
<code class="cCode">INCDIR=$(TUXDIR)\include</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row">&#160;</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277737"> </a>
<code class="cCode">CC=cl</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277776"> </a>
In the <code class="cCode">.ec.c</code> section, <em class="cEmphasis">Edit rules for creating C programs from embedded SQL programs</em>, (use the proc compiler), set the following values.
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277778"> </a>
<code class="cCode">set TUXDIR=$(TUXDIR) &amp; $(ORACLE_DIR)\proc80 mode=ansi release_cursor=yes <br />include=$(SQLPUBLIC) include=$(INCDIR) $(SQL_PLATFORM_INC) -c iname=$*.ec</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277772"> </a>
In the <code class="cCode">.c.obj</code> section, <em class="cEmphasis">Edit rule for creating object files from C programs</em>, set the following values.
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1277774"> </a>
<code class="cCode">$(CC) -c $(CFLAGS) $(SQLPUBLIC) $(INCLUDE) $*.c</code>
</div>
</td>
</tr>
</table>
</div>

</p>
<li><a name="wp1262885"> </a>Update the <code class="cCode">*.ec</code> files. Use Oracle SQL commands.</li>
<li><a name="wp1282385"> </a>Run the makefile:</li>
<a name="wp1262886"> </a><div class="pPreformattedRelative"><pre>copy nt\bankapp.mak to %APPDIR%<br />nmake -f bankapp.mak</pre></div><li><a name="wp1262890"> </a>Edit <code class="cCode">nt\ubbshm</code> as follows:</li>
<a name="wp1262891"> </a><div class="pPreformattedRelative"><pre>USER_ID=0<br />GROUP_ID=0<br />UNAME_SITE1=nodename returned by hostname<br />TUXDIR=same as specified in bankvar<br />APPDIR=same as specified in bankvar</pre></div><li><a name="wp1262897"> </a>In the <code class="cCode">GROUPS</code> section of the configuration file, enter the following changes:</li>
<a name="wp1262898"> </a><div class="pPreformattedRelative"><pre>TMSNAME=TMS_ORA<br />BANKB1 	GRPNO=1         OPENINFO=&quot;Oracle_XA:Oracle_XA+Acc=P/user1/PaSsWd1+SesTm=0+LogDir=.&quot;<br />[<br />Oracle_XA +<br /> required fields:<br /> Acc=P/oracle_user_id/oracle_password +<br /> SesTm=Session_time_limit (maximum time a transaction can be inactive) +<br /> optional fields:<br /> LogDir=logdir (where XA library trace file is located) +<br /> MaxCur=maximum_#_of_open cursors +<br /> SqlNet=connect_string (if Oracle exists over the network)<br /> (eg. SqlNet=hqfin@NEWDB indicates the database with sid=NEWDB accessed at host hqfin by TCP/IP)<br />]<br />BANKB2 	GRPNO=2<br />	OPENINFO=&quot;Oracle_XA:Oracle_XA+Acc=P/user2/PaSsWd2+SesTm=0+LogDir=.&quot;<br />BANKB3 	GRPNO=3<br />OPENINFO=&quot;Oracle_XA:Oracle_XA+Acc=P/user3/PaSsWd3+SesTm=0+LogDir=.&quot;</pre></div><li><a name="wp1262920"> </a>Create the Oracle Tuxedo configuration binary file:</li>
<a name="wp1262921"> </a><div class="pPreformattedRelative"><pre>tmloadcf -y nt/ubbshm</pre></div><li><a name="wp1262924"> </a>Create the device list and the <code class="cCode">TLOG</code> device on the master machine:</li>
<a name="wp1262925"> </a><div class="pPreformattedRelative"><pre>crtlog -m</pre></div><li><a name="wp1262928"> </a>Start up the Oracle database instance if not already started.</li>
<li><a name="wp1267316"> </a>Boot the Oracle Tuxedo system servers:</li>
<a name="wp1262932"> </a><div class="pPreformattedRelative"><pre>tmboot -y</pre></div><li><a name="wp1262935"> </a>Ensure that the view <code class="cCode">v$XATRANS$</code> exists on the database. (The view <code class="cCode">V$XATRANS$</code> should have been created during the XA library installation.)</li>
<li><a name="wp1267395"> </a>If the <code class="cCode">v$XATRANS$</code> view has not been created, create it as follows:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1262937"> </a>Ensure that the environment variables <code class="cCode">ORACLE_HOME</code> and <code class="cCode">ORACLE_SID</code> are set.</li>
<li><a name="wp1267402"> </a>Log in to the database as user <code class="cCode">SYS</code>:</li>
<a name="wp1267405"> </a><div class="pPreformattedRelative"><pre>Execute the <code class="cCode">sql</code> script ${ORACLE_HOME}/RDBMS80/ADMIN/XAVIEW.sql</pre></div><li><a name="wp1267408"> </a>Grant select privileges to this view for all Oracle account applications that   will use the XA library.</li>
</ul></div>
<li><a name="wp1262943"> </a>Create the <code class="cCode">bankapp</code> database and database objects for Oracle RM:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1262944"> </a>Log in to any of the Oracle utilities SQL*plus or SQL*DBA as any Oracle user.</li>
<li><a name="wp1267437"> </a><code class="cCode">notepad crbank-ora8.sql</code></li>
<li><a name="wp1267440"> </a>When Oracle8 is installed, a sample database is created. You can use this database for the <code class="cCode">bankapp</code> application. The <code class="cCode">sql</code> script provided, creates a new tablespace in the database to hold all the database objects of <code class="cCode">bankapp</code>.The script prompts for the Oracle system user password as well as a full path name of a file to use as the new tablespace.</li>
<li><a name="wp1267465"> </a>Edit <code class="cCode">crbank-ora8.sql</code> as follows:</li>
<a name="wp1262950"> </a><div class="pPreformatted"><pre>WHENEVER OSERROR EXIT ;<br />/*Obtain the password for user &quot;system&quot; */<br />PROMPT<br />PROMPT<br />PROMPT -- Some of the operations require &quot;system&quot; user privileges<br />PROMPT -- Please specify the Oracle &quot;system&quot; user password<br />PROMPT<br />ACCEPT syspw CHAR PROMPT &#39;system passwd:&#39; HIDE ;<br />CONNECT system/&amp;syspw ;<br />SHOW user ;<br />PROMPT<br />/* Create a new tablespace in the default DB for use with &quot;bankapp&quot; */<br />DROP TABLESPACE bank1<br />    INCLUDING CONTENTS<br />CASCADE CONSTRAINTS;<br />PROMPT<br />PROMPT<br />PROMPT -- Will create a 3MB tablespace for bankapp ;<br />PROMPT -------- Please specify full pathname below for Datafile ;<br />PROMPT -------- Ex: %ORACLE_HOME%/dbs/bankapp.dbf<br />PROMPT<br />ACCEPT datafile CHAR PROMPT &#39;Datafile:&#39; ;</pre></div><a name="wp1262979"> </a><div class="pPreformatted"><pre>CREATE TABLESPACE bank1<br />    DATAFILE &#39;&amp;datafile&#39;  SIZE 3M REUSE<br />    DEFAULT STORAGE (INITIAL 10K   NEXT 50K<br />            MINEXTENTS 1           MAXEXTENTS 120<br />            PCTINCREASE 5)<br />    ONLINE;</pre></div><a name="wp1262987"> </a><div class="pPreformatted"><pre>/***************** Create a user called &quot;user1&quot; ***************/</pre></div><a name="wp1262988"> </a><div class="pPreformatted"><pre>DROP USER user1 CASCADE;<br /><br />PROMPT Creating user &quot;user1&quot;</pre></div><a name="wp1262992"> </a><div class="pPreformatted"><pre>CREATE USER user1 IDENTIFIED by PaSsWd1<br />    DEFAULT TABLESPACE bank1<br />    QUOTA UNLIMITED ON bank1 ;</pre></div><a name="wp1262996"> </a><div class="pPreformatted"><pre>GRANT CREATE SESSION TO user1 ;<br />GRANT CREATE TABLE TO user1 ;</pre></div><a name="wp1262999"> </a><div class="pPreformatted"><pre>CONNECT user1/PaSsWd1 ;<br />SHOW user ;</pre></div><a name="wp1263002"> </a><div class="pPreformatted"><pre>PROMPT Creating database objects for user &quot;user1&quot; ;<br />PROMPT Creating table &quot;branch&quot; ;</pre></div><a name="wp1263006"> </a><div class="pPreformatted"><pre>    CREATE TABLE branch (<br />          branch_id       NUMBER NOT NULL PRIMARY KEY,<br />          balance         NUMBER,<br />          last_acct       NUMBER,<br />          last_teller     NUMBER,<br />          phoneCHAR(14),<br />          address         CHAR(60)</pre></div><a name="wp1263013"> </a><div class="pPreformatted"><pre> )<br />          STORAGE         (INITIAL 5K   NEXT 2K<br />                          MINEXTENTS 1 MAXEXTENTS 5  PCTINCREASE 5) ;</pre></div><a name="wp1263018"> </a><div class="pPreformatted"><pre>PROMPT Creating table &quot;account&quot; ;</pre></div><a name="wp1268903"> </a><div class="pPreformatted"><pre>    CREATE TABLE account (<br />          account_id      NUMBER NOT NULL PRIMARY KEY,<br />          branch_id       NUMBER NOT NULL,<br />          ssn             CHAR(12) NOT NULL,<br />          balance         NUMBER,<br />          acct_type       CHAR,<br />          last_name       CHAR(20),<br />          first_name      CHAR(20),<br />          mid_init        CHAR,<br />          phoneCHAR(14),<br />          address         CHAR(60)</pre></div><a name="wp1270525"> </a><div class="pPreformatted"><pre> )<br />          STORAGE         (INITIAL 50K NEXT 25K<br />                          MINEXTENTS 1 MAXEXTENTS 50   PCTINCREASE 5) ;</pre></div><a name="wp1263036"> </a><div class="pPreformatted"><pre>PROMPT Creating table &quot;teller&quot; ;<br />     CREATE TABLE teller (<br />          teller_id       NUMBER NOT NULL PRIMARY KEY,<br />          branch_id       NUMBER NOT NULL,<br />          balance         NUMBER,<br />          last_name       CHAR(20),<br />          first_name      CHAR(20),<br />          mid_init        CHAR<br /> )<br />          STORAGE         (INITIAL 5K  NEXT 2K<br />                          MINEXTENTS 1  MAXEXTENTS 5    PCTINCREASE 5) ;<br />PROMPT Creating table &quot;history&quot; ;<br />    CREATE TABLE history (<br />          account_id      NUMBER NOT NULL,<br />          teller_id       NUMBER NOT NULL,<br />          branch_id       NUMBER NOT NULL,<br />          amount          NUMBER</pre></div><a name="wp1271036"> </a><div class="pPreformatted"><pre> )<br />          STORAGE         (INITIAL 400K   NEXT 200K<br />                          MINEXTENTS 1   MAXEXTENTS 5     PCTINCREASE 5) ;</pre></div></ul></div>
<li><a name="wp1271053"> </a>Write the code to create <em class="cEmphasis">user2</em> and <em class="cEmphasis">user3</em> with passwords <em class="cEmphasis">PaSsWd2</em> and <em class="cEmphasis">PaSsWd3</em>, respectively, following the method described in the above steps:</li>
<a name="wp1263063"> </a><div class="pPreformattedRelative"><pre>SQL*plus&gt; start $APPDIR/ crbank-ora8.sql</pre></div><li><a name="wp1263066"> </a>Populate the database:</li>
<a name="wp1263067"> </a><div class="pPreformattedRelative"><pre>nt\populate</pre></div><li><a name="wp1263070"> </a>Generate transactions against the database:</li>
<a name="wp1263071"> </a><div class="pPreformattedRelative"><pre>driver</pre></div><li><a name="wp1263074"> </a>Run the <code class="cCode">bankapp</code> client:</li>
<a name="wp1263075"> </a><div class="pPreformattedRelative"><pre>run</pre></div><li><a name="wp1263078"> </a>Shut down the application:</li>
<a name="wp1263079"> </a><div class="pPreformattedRelative"><pre>tmshutdown -y</pre></div></ol></div>
<h3 class="pHeading2"><a name="wp1152105"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1152077"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1129468"> </a>
Step 6: How to Edit the Configuration File
</h2><p class="pBody"><a name="wp1138643"> </a>
A configuration file defines how an application runs. <code class="cCode">bankapp</code> is delivered with two configuration files in the text format described in <code class="cCode">UBBCONFIG(5)</code>: <code class="cCode">ubbshm</code>, which defines an application on a single computer, and <code class="cCode">ubbmp</code>, which defines a networked application. 
</p>
<p class="pBody"><a name="wp1212022"> </a>
Initialization scripts are provided in the sample applications. In addition, you can generate completed configuration files by <code class="cCode">.sh</code> for any number up to 10 for your configuration and machines.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1194655"> </a>In a text editor, familiarize yourself with the <code class="cCode">ubbshm</code> and <code class="cCode">ubbmp</code> configuration files for <code class="cCode">bankapp</code>. </li>
<div class="pCodeTitle"><a name="wp1138647"> </a>
Listing&#160;3-18	   ubbmp Configuration File
</div> <a name="wp1327362"> </a><div class="pPreformatted"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#Copyright (c) 1999 BEA Systems, Inc.<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#All rights reserved<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*RESOURCES  <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;IPCKEY                80952<br />&#160;&#160;&#160;&#160;001  UID                   &lt;user id from id(1)&gt;<br />&#160;&#160;&#160;&#160;002  GID                   &lt;group id from id(1)&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PERM                  0660<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAXACCESSERS          40<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAXSERVERS            35<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAXSERVICES           75<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAXCONV               10<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAXGTT                20<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MASTER                SITE1,SITE2<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SCANUNIT              10<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SANITYSCAN            12<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BBLQUERY              180<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BLOCKTIME             30<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DBBLWAIT          6<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OPTIONS           LAN,MIGRATE<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MODEL             MP<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LDBAL             Y<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;##SECURITY        ACL<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*MACHINES<br />&#160;&#160;&#160;&#160;003  &lt;SITE1&#39;s uname&gt;  LMID=SITE1<br />&#160;&#160;&#160;&#160;004                   TUXDIR=&quot;&lt;TUXDIR&gt;&quot;<br />&#160;&#160;&#160;&#160;005                   APPDIR=&quot;&lt;APPDIR&gt;&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ENVFILE=&quot;&lt;APPDIR&gt;/ENVFILE&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TLOGDEVICE=&quot;&lt;APPDIR&gt;/TLOG&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TLOGNAME=TLOG<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TUXCONFIG=&quot;&lt;APPDIR&gt;/tuxconfig&quot;<br />&#160;&#160;&#160;&#160;006                   TYPE=&quot;&lt;machine type&gt;&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ULOGPFX=&quot;&lt;APPDIR&gt;/ULOG&quot;<br />&#160;&#160;&#160;&#160;007  &lt;SITE2&#39;s uname&gt;  LMID=SITE2<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TUXDIR=&quot;&lt;TUXDIR&gt;&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;APPDIR=&quot;&lt;APPDIR&gt;&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ENVFILE=&quot;&lt;APPDIR&gt;/ENVFILE&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TLOGDEVICE=&quot;&lt;APPDIR&gt;/TLOG&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TLOGNAME=TLOG<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TUXCONFIG=&quot;&lt;APPDIR&gt;/tuxconfig&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TYPE=&quot;&lt;machine type&gt;&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ULOGPFX=&quot;&lt;APPDIR&gt;/ULOG&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*GROUPS<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Group for Authentication Servers<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Group for Application Queue (/Q) Servers<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;##QGRP1      LMID=SITE1    GRP=102<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;##       TMSNAME=TMS_QM    TMSCOUNT=2<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;##       OPENINFO=&#8221;TUXEDO/QM:&lt;APPDIR&gt;/qdevice:QSP_BANKAPP&#8221;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Group for Event Broker Servers<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;##EVBGRP1     LMID=SITE1    GRPNO=104<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DEFAULT: TMSNAME=TMS_SQL   TMSCOUNT=2<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BANKB1   LMID=SITE1        GRPNO=1<br /><br />&#160;&#160;&#160;&#160;008  OPENINFO=&quot;TUXEDO/SQL:&lt;APPDIR&gt;/bankdl1:bankdb:readwrite&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BANKB2   LMID=SITE2         GRPNO=2<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OPENINFO=&quot;TUXEDO/SQL:&lt;APPDIR&gt;/bankdl2:bankdb:readwrite&quot;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*NETWORK<br />&#160;&#160;&#160;&#160;009  SITE1     NADDR=&quot;&lt;network address of SITE1&gt;&quot;<br />&#160;&#160;&#160;&#160;010            NLSADDR=&quot;&lt;network listener address of SITE1&gt;&quot;<br />&#160;&#160;&#160;&#160;011  SITE2     NADDR=&quot;&lt;network address of SITE2&gt;&quot;<br />&#160;&#160;&#160;&#160;012            NLSADDR=&quot;&lt;network listener address of SITE2&gt;&quot;</pre></div><li><a name="wp1174505"> </a>To enable the application password feature, add the following line to the <code class="cCode">RESOURCES</code> section of <code class="cCode">ubbshm</code> or <code class="cCode">ubbmp</code>: </li>
<a name="wp1138651"> </a><div class="pPreformattedRelative"><pre>    SECURITY       APP_PW</pre></div><li><a name="wp1174665"> </a>In both configuration files, you may notice that the values of some parameters are enclosed in angle brackets (&lt; &gt;). Values shown in angle brackets are generic; you need to replace them with values that pertain to your installation. All of these fields occur within the <code class="cCode">RESOURCES</code>, <code class="cCode">MACHINES</code>, and <code class="cCode">GROUPS</code> sections in both files. In <code class="cCode">ubbmp</code>, the <code class="cCode">NETWORK</code> section also has values you must replace. <a href="tutba.html#wp1313060">Table&#160;3-3</a> shows the <code class="cCode">ubbmp</code> through the <code class="cCode">NETWORK</code> section and illustrates all the changes you need to make in the <code class="cCode">RESOURCES</code>, <code class="cCode">MACHINES</code>, and <code class="cCode">GROUPS</code> sections if you are bringing up a single-machine application.</li>
<p class="pGraphic"><a name="wp1313057"> </a>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1313060table1313058"><caption><a name="wp1313060"> </a>
Table 3-3  <span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">Explanation of Values&#160;</span>

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1313100"> </a>
Line
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1313102"> </a>
String to Be Replaced
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1313104"> </a>
Description
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313175"> </a>
001
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313177"> </a>
<code class="cCode">UID</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313179"> </a>
The effective user ID (UID) for the owner of the bulletin board IPC structures. In a multiprocessor configuration, the value must be the same on all machines. To avoid problems, use the same UID as that of the owner of the Oracle Tuxedo system software.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313169"> </a>
002
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313171"> </a>
<code class="cCode">GID</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313173"> </a>
The effective group ID (GID) for the owner of the bulletin board IPC structures. In a multiprocessor configuration, the value must be the same on all machines. Users of the application should share this group ID.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313163"> </a>
003
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313165"> </a>
<code class="cCode">SITE1</code> name
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313167"> </a>
The name of the machine. (For UNIX platforms, use the value produced by the UNIX command: <code class="cCode">uname -n</code>)
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313157"> </a>
004
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313159"> </a>
<code class="cCode">TUXDIR</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313161"> </a>
The absolute path name of the root directory for the Oracle Tuxedo software. Replace all occurrences of &lt;<code class="cCodeEmphasis">TUXDIR</code>&gt; in the file with the specified path name.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313151"> </a>
005
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313153"> </a>
<code class="cCode">APPDIR</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313155"> </a>
The absolute path name of the directory in which the application runs. Make this a global change so that all occurrences of &lt;<code class="cCodeEmphasis">APPDIR</code>&gt; in the file are replaced by the specified path name.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313145"> </a>
006
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313147"> </a>
machine type 
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313149"> </a>
An identifying string used in networked applications that include machines of different types. The Oracle Tuxedo system checks the value of machine type for each machine communicating with another. If the system identifies two machines with different machine types trying to communicate, it invokes the message encode and decode routines to convert the data being transmitted to a form recognizable by both machines.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313139"> </a>
007
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313141"> </a>
<code class="cCode">SITE2</code> name
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313143"> </a>
The name of the second machine. (For UNIX platforms, use the value produced by the UNIX command:  <code class="cCode">uname -n</code>)
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313133"> </a>
008
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313135"> </a>
<code class="cCode">OPENINFO</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313137"> </a>
The statement here and in the following entry are in a format understood by Oracle Tuxedo system resource managers. They need to be changed (or removed) to meet the requirements of other resource managers.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313127"> </a>
009
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313129"> </a>
Network address of <code class="cCode">SITE1</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313131"> </a>
The full address of the network listener for the <code class="cCode">BRIDGE</code> process on this machine.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313121"> </a>
010
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313123"> </a>
Network listener address of <code class="cCode">SITE1</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313125"> </a>
The address of the network listener for the <code class="cCode">tlisten</code> process on this machine.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313115"> </a>
011
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313117"> </a>
Network address of <code class="cCode">SITE2</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313119"> </a>
The full address of the network listener for the <code class="cCode">BRIDGE</code> process on this machine. This value must be different on each machine.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313109"> </a>
012
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313111"> </a>
Network listener address of <code class="cCode">SITE2</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1313113"> </a>
The address of the network listener for the <code class="cCode">tlisten</code> process on this machine.
</div>
</td>
</tr>
</table>
</div>

</p>
</ol></div>
<h3 class="pHeading2"><a name="wp1138745"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1138746"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
<li><a name="wp1152181"> </a><a href="../rf5/rf5.html">UBBCONFIG(5)</a> in the <em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em></li>
<li><a name="wp1293913"> </a><span class="cHyperlink">
&#8220;What Is the </span><a href="../ads/adconf.html"></a>Configuration File?&#8221; in <em class="cEmphasis">Setting Up an Oracle Tuxedo Application</em></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1129511"> </a>
Steps 7 and 8: Creating a Binary Configuration File and Transaction Log File
</h2><h3 class="pHeading2"><a name="wp1139744"> </a>
Before Creating the Binary Configuration File
</h3>
<p class="pBody"><a name="wp1188000"> </a>
Before creating the binary configuration file, you need to be in the directory in which your <code class="cCode">bankapp</code> files are located and you must set the environment variables. Complete the following tasks.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1175038"> </a>Go to the directory in which your <code class="cCode">bankapp</code> files are located.</li>
<li><a name="wp1174998"> </a>Set the environment variables by entering</li>
<p class="pBodyRelative"><a name="wp1175033"> </a>
<code class="cCode">. ./bankvar</code>
</p>
</ol></div>
<a name="wp1174952"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If you bring up <code class="cCode">bankapp</code> in SHM mode, you do not have to create the <code class="cCode">tlisten</code> process or create a transaction log on another machine.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1139746"> </a>
How to Load the Configuration File
</h3>
<p class="pBody"><a name="wp1139747"> </a>
Once you have finished editing the configuration file, you must load it into a binary file on your <code class="cCode">MASTER</code> machine. The name of the binary configuration file is <code class="cCode">TUXCONFIG</code>; its path name is defined in the <code class="cCode">TUXCONFIG</code> environment variable. The file should be created by a person with the effective user ID and group ID of the Oracle Tuxedo system administrator, which should be the same as the <code class="cCode">UID</code> and <code class="cCode">GID</code> values in your configuration file. If this requirement is not met, you may have permission problems in running <code class="cCode">bankapp</code>. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1188017"> </a>To create <code class="cCode">TUXCONFIG</code>, enter the following command: </li>
<a name="wp1139748"> </a><div class="pPreformattedRelative"><pre>    tmloadcf ubbmp</pre></div><p class="pBodyRelative"><a name="wp1139749"> </a>
While the configuration file is being loaded, you are prompted several times to confirm that you want to install this configuration, even if doing so means an existing configuration file must be overwritten. If you want to suppress such prompts, include the <code class="cCode">-y</code> option on the command line.
</p>
<li><a name="wp1175072"> </a>If you want the amount of IPC resources needed by your application to be calculated by the Oracle Tuxedo system, include the <code class="cCode">-c</code> option on the command line.</li>
</ol></div>
<p class="pBody"><a name="wp1139750"> </a>
<code class="cCode">TUXCONFIG</code> can be installed only on the <code class="cCode">MASTER</code> machine; it is propagated to other machines by <code class="cCode">tmboot</code> when the application is booted. 
</p>
<p class="pBody"><a name="wp1139751"> </a>
If you have specified <code class="cCode">SECURITY</code> as an option for the configuration, <code class="cCode">tmloadcf</code> prompts you to enter an application password. The password you select can be up to 30 characters long. Client processes joining the application are required to supply the password.
</p>
<p class="pBody"><a name="wp1175115"> </a>
<code class="cCode">tmloadcf</code> parses the text configuration file (<code class="cCode">UBBCONFIG</code>) for syntax errors before it loads it, so if there are errors in the file, the job fails. 
</p>
<h3 class="pHeading2"><a name="wp1139752"> </a>
How to Create the Transaction Log (TLOG) File
</h3>
<p class="pBody"><a name="wp1139753"> </a>
The <code class="cCode">TLOG</code> is the transaction log used by the Oracle Tuxedo system in the management of global transactions. Before an application can be booted, an entry for the <code class="cCode">TLOG</code> must be created in every file on every machine in the application, and a file for the log itself must be created on the <code class="cCode">MASTER</code> machine.
</p>
<p class="pBody"><a name="wp1139755"> </a>
<code class="cCode">bankapp</code> provides a script called <code class="cCode">crtlog</code> that creates a device list and a <code class="cCode">TLOG</code> for you. The device list is created using the <code class="cCode">TLOGDEVICE</code> variable from <code class="cCode">bankvar</code>. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1188030"> </a>To create your <code class="cCode">TLOG</code> and device list, enter the command on the <code class="cCode">MASTER</code> machine as follows: </li>
<a name="wp1139756"> </a><div class="pPreformattedRelative"><pre>    crtlog -m</pre></div><a name="wp1139757"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>In a production environment, the device list may be the same as that used for the database.</td>
</tr>
</table>

<li><a name="wp1175146"> </a>On all other machines, do not specify <code class="cCode">-m</code>; when the system is booted, the BBL on each non-<code class="cCode">MASTER</code> machine creates the log. </li>
</ol></div>
<p class="pBody"><a name="wp1139758"> </a>
If you are using a non-XA resource manager, you do not need a transaction log. 
</p>
<h3 class="pHeading2"><a name="wp1152187"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1152185"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1129728"> </a>
Step 9: How to Create a Remote Service Connection on Each Machine
</h2><p class="pBody"><a name="wp1141294"> </a>
<code class="cCode">tlisten</code> is the listener process that provides a remote service connection for processes such as <code class="cCode">tmboot</code> between machines in an Oracle Tuxedo application. It must be installed on all the machines in your network as defined in the <code class="cCode">NETWORK</code> section of the configuration file. 
</p>
<p class="pBody"><a name="wp1141295"> </a>
Instructions for starting <code class="cCode">tlisten</code> are provided in the <span class="cHyperlink">
&#8220;Starting the t</span><a href="../install/inspin.html"></a>listen Process&#8221; in <em class="cEmphasis">Installing the Oracle Tuxedo System</em>. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1188091"> </a>We recommend starting a separate <code class="cCode">tlisten</code> process for <code class="cCode">bankapp</code>. To do so, enter the following command:</li>
<a name="wp1141296"> </a><div class="pPreformattedRelative"><pre>    tlisten -l nlsaddr</pre></div><p class="pBodyRelative"><a name="wp1175473"> </a>
The <code class="cCode">nlsaddr</code> value must be the same as that specified for the <code class="cCode">NLSADDR</code> parameter for this machine in your configuration file. Because this value changes from one machine to another, it is important that your <code class="cCode">tlisten</code> argument agrees with your configuration file specification.
</p>
<a name="wp1141300"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Detection of an error in this specification is not easy. <code class="cCode">tmloadcf</code> does not check for agreement between your configuration file and your <code class="cCode">tlisten</code> command. If the two addresses do not match, then the application will probably fail to boot on the machine with the mismatched value of <code class="cCode">nlsaddr</code> or on which the <code class="cCode">tlisten</code> process has not been started. </td>
</tr>
</table>

</ol></div>
<p class="pBody"><a name="wp1175655"> </a>
The log file used by <code class="cCode">tlisten</code> is separate from all other Oracle Tuxedo system log files, but one log can be used by more than one <code class="cCode">tlisten</code> process. The default filename is <code class="cCode">TUXDIR/udataobj/tlog</code>.
</p>
<h3 class="pHeading2"><a name="wp1141301"> </a>
How to Stop the Listener Process (tlisten)
</h3>
<p class="pBody"><a name="wp1141302"> </a>
<code class="cCode">tlisten</code> is designed to run as a daemon process. For suggestions about incorporating it in startup scripts or running it as a cron job, see <code class="cCode">tlisten(1)</code> in the <em class="cEmphasis">Oracle Tuxedo Reference Manual</em>. 
</p>
<p class="pBody"><a name="wp1175768"> </a>
For <code class="cCode">bankapp</code>, you may prefer simply to start it and bring it down as you need it. To bring it down, send it a <code class="cCode">SIGTERM</code> signal such as the following:
</p>
<p class="pBodyRelative"><a name="wp1141303"> </a>
    kill -15 <code class="cCodeEmphasis">pid</code>
</p>
<a name="wp1239765"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>In a Windows 2003 environment, you can start and stop the listener process in two ways: using the <code class="cCode">tlisten</code> on the command line or using the Control Panel.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1141304"> </a>
Sample tlisten Error Messages
</h3>
<p class="pBody"><a name="wp1141305"> </a>
If no remote <code class="cCode">tlisten</code> is running, the boot sequence is displayed on your screen as follows: 
</p>
<a name="wp1307638"> </a><div class="pPreformatted"><pre>    Booting admin processes<br />    exec DBBL -A :<br />          on MASTER -&gt; process id=17160Started.<br />    exec BBL -A :<br />          on MASTER -&gt; process id=17161Started.<br />    exec BBL -A :<br />          on NONMAST2 -&gt; CMDTUX_CAT:814: cannot propagate TUXCONFIG file<br />    tmboot: WARNING: No BBL available on site NONMAST2.<br />          Will not attempt to boot server processes on that site.<br />    exec BBL -A :<br />          on NONMAST1 -&gt; CMDTUX_CAT:814: cannot propagate TUXCONFIG file<br />    tmboot: WARNING: No BBL available on site NONMAST1.<br />          Will not attempt to boot server processes on that site.<br />    2 processes started.<br />    and messages such as these will be in the ULOG: <br />    133757.mach1!DBBL.17160: LIBTUX_CAT:262: std main starting<br />    133800.mach1!BBL.17161: LIBTUX_CAT:262: std main starting<br />    133804.mach1!BRIDGE.17162: LIBTUX_CAT:262: std main starting<br />    133805.mach1!tmboot.17159: LIBTUX_CAT:278: Could not contact NLS on NONMAST2<br />    133805.mach1!tmboot.17159: LIBTUX_CAT:276: No NLS available for remote<br />      machine NONMAST2<br />    133806.mach1!tmboot.17159: LIBTUX_CAT:276: No NLS available for remote<br />      machine NONMAST2<br />    133806.mach1!tmboot.17159: CMDTUX_CAT:850: Error sending TUXCONFIG<br />      propagation request to TAGENT on NONMAST2<br />    133806.mach1!tmboot.17159: WARNING: No BBL available on site NONMAST2.<br />           Will not attempt to boot server processes on that site.<br />    133806.mach1!tmboot.17159: LIBTUX_CAT:278: Could not contact NLS on NONMAST1<br />    133806.mach1!tmboot.17159: LIBTUX_CAT:276: No NLS available for<br />      remote machine NONMAST1<br />    133806.mach1!tmboot.17159: LIBTUX_CAT:276: No NLS available for<br />     remote machine NONMAST1<br />    133806.mach1!tmboot.17159: CMDTUX_CAT:850: Error sending TUXCONFIG<br />      propagation request to TAGENT on NONMAST1<br />    133806.mach1!tmboot.17159: WARNING: No BBL available on site NONMAST1.<br />            Will not attempt to boot server processes on that site.<br />If tlisten is started with the wrong machine address, the following messages<br />appear in the tlisten log. </pre></div><a name="wp1281867"> </a><div class="pPreformatted"><pre>    Mon Aug 26 10:51:56 1991; 14240; Oracle TUXEDO System Listener Process Started<br />    Mon Aug 26 10:51:56 1991; 14240; Could not establish listening endpoint<br />    Mon Aug 26 10:51:56 1991; 14240; Terminating listener process, SIGTERM</pre></div><h3 class="pHeading2"><a name="wp1141308"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1323391"> </a><a href="tutba.html#wp1122904">Preparing bankapp Files and Resources</a></li>
<li><a name="wp1323392"> </a><a href="../rfcm/rfcmd.html">tlisten(1)</a></li>
<li><a name="wp1323396"> </a><a href="../rfcm/rfcmd.html">tmadmin(1)</a></li>
<li><a name="wp1141516"> </a><a href="../rfcm/rfcmd.html">tmloadcf(1)</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1128299"> </a>
Running bankapp
</h2><p class="pBody"><a name="wp1122354"> </a>
This documentation leads you through the procedures for booting <code class="cCode">bankapp</code>, testing it by running various client programs and transactions, and shutting it down when you have finished. Click on any of the following tasks for instructions on completing that task.
</p>
<p class="pGraphic"><a name="wp1299838"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/tour2.gif" height="208" width="521" usemap="#tour2_gif" id="wp1299858"/>
<map name="tour2_gif">
<area href="tutba.html#wp1059559" shape="rect" coords="168,11,353,41" />
<area href="tutba.html#wp1144323" shape="rect" coords="168,51,350,81" />
<area href="tutba.html#wp1144803" shape="rect" coords="168,92,353,122" />
<area href="tutba.html#wp1304652" shape="rect" coords="168,128,351,161" />
<area href="tutba.html#wp1144930" shape="rect" coords="168,168,353,200" />
</map>
</div><p class="pGraphic">

</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1059559"> </a>
Step 1: How to Prepare to Boot
</h2><div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1146381"> </a>Before booting <code class="cCode">bankapp</code>, verify that your machine has enough IPC resources to support your application. To generate a report on IPC resources, run the <code class="cCode">tmboot</code> command with the <code class="cCode">-c</code> option.</li>
<a name="wp1212053"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Because insufficient IPC resources may lead to a boot failure, it is imperative that you ensure you have appropriate values specified for your configuration. </td>
</tr>
</table>

<div class="pCodeTitle"><a name="wp1146382"> </a>
Listing&#160;3-19	    IPC Report 
</div> <a name="wp1146383"> </a><div class="pPreformatted"><pre>    Ipc sizing (minimum /T values only)<br />                    Fixed Minimums Per Processor<br />    SHMMIN: 1<br />    SHMALL: 1<br />    SEMMAP: SEMMNI<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Variable Minimums Per Processor<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SEMUME,           A                             SHMMAX<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SEMMNU,           *                               *<br />    Node            SEMMNS  SEMMSL  SEMMSL  SEMMNI  MSGMNI  MSGMAP  SHMSEG<br />    ------          ------  ------  ------  ------  ------  ------  ------<br />    sfpup               60       1      60   A + 1      10      20     76K<br />    sfsup               63       5      63   A + 1      11      22     76K<br />    where 1 &lt;= A &lt;= 8.</pre></div><li><a name="wp1146385"> </a>Add the number of application clients used per processor to each <code class="cCode">MSGMNI</code> value. <code class="cCode">MSGMAP</code> should be twice <code class="cCode">MSGMNI</code>. </li>
<li><a name="wp1146236"> </a>Compare the minimum IPC requirements to the parameters set for your machine. The location of these parameter settings is platform-dependent:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1175819"> </a>On many UNIX system platforms, machine parameters are defined in <code class="cCode">/etc/conf/cf.d/mtune</code>.</li>
<li><a name="wp1175855"> </a>On Windows 2003 platforms, machine parameters are set and displayed through a control panel.</li>
</ul></div>
</ol></div>
<h3 class="pHeading2"><a name="wp1152242"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1152251"> </a><a href="tutba.html#wp1128299">Running bankapp</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1144323"> </a>
Step 2: How to Boot bankapp
</h2><div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1147805"> </a>Set the environment: </li>
<a name="wp1147806"> </a><div class="pPreformattedRelative"><pre>. ./bankvar </pre></div><li><a name="wp1147807"> </a>Boot the application by entering the following: </li>
<a name="wp1147808"> </a><div class="pPreformattedRelative"><pre>    tmboot</pre></div><p class="pBodyRelative"><a name="wp1147809"> </a>
The following prompt is displayed: 
</p>
<a name="wp1147810"> </a><div class="pPreformattedRelative"><pre>    Boot all admin and server processes? (y/n): y</pre></div><p class="pBodyRelative"><a name="wp1147811"> </a>
A running report such as the following is displayed:
</p>
<a name="wp1147812"> </a><div class="pPreformattedRelative"><pre>Booting all admin and server processes in /usr/me/appdir/tuxconfig<br />Booting all admin processes<br />exec BBL -A:<br />           process id=24223 Started.</pre></div></ol></div>
<p class="pBody"><a name="wp1147813"> </a>
The report continues until all servers in the configuration have been started. It ends with a count of the number of servers started. 
</p>
<p class="pBody"><a name="wp1147814"> </a>
If you prefer, you can boot only a portion of the configuration. For example, to boot only administrative servers, include the <code class="cCode">-A</code> option. If no options are specified, the entire application is booted. 
</p>
<p class="pBody"><a name="wp1147665"> </a>
In addition to reporting on the number of servers booted, <code class="cCode">tmboot</code> also sends messages to the <code class="cCode">ULOG</code>.
</p>
<h3 class="pHeading2"><a name="wp1152292"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1152296"> </a><a href="tutba.html#wp1128299">Running bankapp</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1144803"> </a>
Step 3: How to Populate the Database
</h2><p class="pBody"><a name="wp1148817"> </a>
The <code class="cCode">populate.sh</code> script is provided to put records into the database so you can run <code class="cCode">bankapp</code> and test its functionality. <code class="cCode">populate</code> is a one line script that pipes records from a program called <code class="cCode">gendata</code> to the system server, <code class="cCode">ud</code>. The <code class="cCode">gendata</code> program creates records for 10 branches, 30 tellers, and 200 accounts. A record of the files created is kept in <code class="cCode">pop.out</code>, so you can use values in the database when forming your sample service requests. 
</p>
<p class="pBody"><a name="wp1176040"> </a>
To run the script, enter <code class="cCode">populate</code>.
</p>
<a name="wp1148898"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The output file that was created by the populate script, <code class="cCode">pop.out</code>, can be used to provide account numbers, branch IDs, and other fields you can specify, so your service requests produce some output. </td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1148819"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1148820"> </a><a href="tutba.html#wp1128299">Running bankapp</a></li>
<li><a name="wp1152717"> </a><a href="../rfcm/rfcmd.html">tmboot(1)</a> in the <em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
<li><a name="wp1148821"> </a><a href="../rfcm/rfcmd.html">ud,&#160;wud(1)</a> in the <em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
<li><a name="wp1148822"> </a><a href="../rf3c/rf3c.html">userlog(3c)</a> in the <em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em></li>
<li><a name="wp1293932"> </a><span class="cHyperlink">
&#8220;What Is the User </span><a href="../ada/admon.html"></a>Log (ULOG)?&#8221; in <em class="cEmphasis">Administering an Oracle Tuxedo Application at Run Time</em></li>
<li><a name="wp1148830"> </a><span class="cHyperlink">
&#8220;How to Boot the </span><a href="../ada/adboot.html"></a>Application&#8221; in <em class="cEmphasis">Administering an Oracle Tuxedo Application at Run Time</em></li>
<li><a name="wp1304649"> </a><span class="cHyperlink">
&#8220;How to Shut Down Your Application&#8221;</span> in <em class="cEmphasis">Administering an Oracle Tuxedo Application at Run Time</em></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1304652"> </a>
Step 4: How to Test bankapp Services
</h2><div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1149737"> </a>If you are logging in cold to a running system, you must set your environment for <code class="cCode">bankapp</code>. To do so, enter the following command:</li>
<a name="wp1149738"> </a><div class="pPreformattedRelative"><pre>    . ./bankvar</pre></div><li><a name="wp1149530"> </a>Run the <code class="cCode">audit</code> client program. To execute the <code class="cCode">audit</code> client program, enter the following command:</li>
<a name="wp1149532"> </a><div class="pPreformattedRelative"><pre>    audit {-a | -t} [branch_id]</pre></div><p class="pBodyRelative"><a name="wp1149533"> </a>
specifying either <code class="cCode">-a</code> for account balances or <code class="cCode">-t</code> for teller balances. If you specify a <code class="cCode">branch_id</code>, the report is limited to the branch specified; if you do not, the report includes data for all branches. For sample account numbers, branch IDs, and other values that you can provide as input to audit, use values listed in <code class="cCode">pop.out</code>, the output of the populate program.
</p>
<li><a name="wp1149534"> </a>Run <code class="cCode">auditcon</code>. To start the conversational version of the audit program, enter the following command: </li>
<a name="wp1149536"> </a><div class="pPreformattedRelative"><pre>    auditcon</pre></div><p class="pBodyRelative"><a name="wp1149537"> </a>
The program displays the following message on your terminal: 
</p>
<a name="wp1149538"> </a><div class="pPreformattedRelative"><pre>    to request a TELLER or ACCOUNT balance for a branch,<br />    type the letter t or a, followed by the branch id,<br />    followed by &lt;return&gt;<br />    for ALL TELLER or ACCOUNT balances, type t or a &lt;return&gt;<br />    q &lt;return&gt; quits the program</pre></div><p class="pBodyRelative"><a name="wp1149539"> </a>
When you have typed your request and pressed return, the requested information is displayed on your terminal followed by the following message: 
</p>
<a name="wp1149540"> </a><div class="pPreformattedRelative"><pre>    another balance request ??</pre></div><li><a name="wp1149541"> </a>The program continues to offer you this service until you enter a <code class="cCode">q</code>. </li>
<li><a name="wp1188573"> </a>Use the driver program. By default, the driver program generates 300 transactions. You can change that number with the <code class="cCode">-n</code> option, as in the following example. The command</li>
<a name="wp1188574"> </a><div class="pPreformattedRelative"><pre>    driver -n1000</pre></div><p class="pBodyRelative"><a name="wp1149542"> </a>
specifies that the program should run for 1,000 loops.
</p>
<p class="pBodyRelative"><a name="wp1149543"> </a>
<code class="cCode">driver</code> is a script that generates a series of transactions to simulate activity on the system. It is included as part of <code class="cCode">bankapp</code> so you can get realistic-looking statistics by running <code class="cCode">tmadmin</code> commands. 
</p>
</ol></div>
<h3 class="pHeading2"><a name="wp1152748"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1152752"> </a><a href="tutba.html#wp1128299">Running bankapp</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1144930"> </a>
Step 5: How to Shut Down bankapp
</h2><p class="pBody"><a name="wp1150135"> </a>
To bring down <code class="cCode">bankapp</code>, enter the <code class="cCode">tmshutdown(1)</code> command with no arguments, from the <code class="cCode">MASTER</code> machine, as follows:
</p>
<a name="wp1212067"> </a><div class="pPreformatted"><pre>$ tmshutdown<br />Shutdown all server processes? (y/n): y<br />Shutting down all server processes in /usr/me/BANKAPP/TUXCONFIG<br />Shutting down server processes ...<br /><br />Server Id = 1 Group Id = BANKB1 Machine = Site1:  shutdown succeeded.</pre></div><p class="pBody"><a name="wp1150137"> </a>
Running this command (or the shutdown command of <code class="cCode">tmadmin</code>) causes the following results:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1176250"> </a>All application servers, gateway servers, TMS&#8217;s, and administrative servers, are shut down.</li>
<li><a name="wp1176251"> </a>All associated IPC resources are removed. </li>
</ul></div>
<h3 class="pHeading2"><a name="wp1150138"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1150139"> </a><a href="tutba.html#wp1128299">Running bankapp</a></li>
<li><a name="wp1152872"> </a><a href="../rfcm/rfcmd.html">tmadmin(1)</a> in the <em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
<li><a name="wp1150181"> </a><a href="../rfcm/rfcmd.html">tmshutdown(1)</a> in the <em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
</ul></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="tutba.html"><img id="LongDescNotReq7" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="tutsi.html"><img id="LongDescNotReq8" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="tutcs.html"><img id="LongDescNotReq9" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
