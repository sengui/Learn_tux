<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41263" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux11gr1/qgd/fm/qsimp.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="11/28/11 08:26:30" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>A Sample Application</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Using the ATMI /Q Component
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="qcblpgm.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next_grey1.gif" border="0" alt="Next" />&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
&nbsp;
<a href="../pdf/qgd.pdf" target="pdf"><img id="LongDescNotReq5" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq6" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1025983"> </a>
A Sample Application
</h1>
<p class="pBody"><a name="wp1025342"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1024164"> </a><a href="qsimp.html#wp1021088">Overview</a></li>
<li><a name="wp1024574"> </a><a href="qsimp.html#wp1021090">Prerequisites</a></li>
<li><a name="wp1024579"> </a><a href="qsimp.html#wp1021093">What Is qsample?</a></li>
<li><a name="wp1024617"> </a><a href="qsimp.html#wp1024519">Building qsample</a></li>
<li><a name="wp1024638"> </a><a href="qsimp.html#wp1021174">Suggestions for Further Exploration</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1021088"> </a>
Overview
</h2><p class="pBody"><a name="wp1021089"> </a>
The sample application in this topic contains a description of a one-client, one-server application using Oracle Tuxedo /Q called <code class="cCode">qsample</code>. An interactive form of this software is distributed with the Oracle Tuxedo software.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1021090"> </a>
Prerequisites
</h2><p class="pBody"><a name="wp1024483"> </a>
Before you can run the sample application, the Oracle Tuxedo software must be installed and built so that the files and commands referred to in this topic are available. If you are personally responsible for installing the Oracle Tuxedo software, consult the <em class="cEmphasis">Installing the Oracle Tuxedo System </em>for information about how to install the Oracle Tuxedo system.
</p>
<p class="pBody"><a name="wp1021092"> </a>
If the installation has already been done by someone else, you need to know the pathname of the root directory of the installed software. You also need to have read and execute permissions on the directories and files in the Oracle Tuxedo directory structure so you can copy <code class="cCode">qsample</code> files and execute Oracle Tuxedo commands. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1021093"> </a>
What Is qsample?
</h2><p class="pBody"><a name="wp1026190"> </a>
<code class="cCode">qsample</code> is a very basic Oracle Tuxedo application that uses Oracle Tuxedo /Q. It has one application client and server, and uses two system servers. <a href="../rf5/rf5.html">TMQUEUE(5)</a> and <a href="../rf5/rf5.html">TMQFORWARD(5)</a>. The client calls <code class="cCode">TMQUEUE</code> to enqueue a message in a queue space created for <code class="cCode">qsample</code>. The message is dequeued by <code class="cCode">TMQFORWARD</code> and passed to the application server. The server converts a string from lower case to upper case and returns to <code class="cCode">TMQFORWARD</code>. <code class="cCode">TMQFORWARD</code> enqueues the reply message. The client meanwhile has called <code class="cCode">TMQUEUE</code> to dequeue the reply. When the reply is received, the client displays it on the user&#39;s screen. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1024519"> </a>
Building qsample
</h2><p class="pBody"><a name="wp1021095"> </a>
The following procedure provides instructions on building and running the <code class="cCode">qsample</code> application. 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1021098"> </a>Make a directory for <code class="cCode">qsample</code> and <code class="cCode">cd</code> to it:</li>
<a name="wp1022051"> </a><div class="pPreformattedRelative"><pre>mkdir qsampdir<br />cd qsampdir</pre></div><p class="pBodyRelative"><a name="wp1021101"> </a>
This is suggested so you will be able to see clearly the <code class="cCode">qsample</code> files you have at the start and the additional files you create along the way. Use the standard shell (<code class="cCode">/bin/sh</code>) or the Korn shell; not the C shell (<code class="cCode">/bin/csh</code>). 
</p>
<li><a name="wp1021103"> </a>Copy the <code class="cCode">qsample</code> files.</li>
<a name="wp1022076"> </a><div class="pPreformattedRelative"><pre>cp $TUXDIR/apps/qsample/* .</pre></div><p class="pBodyRelative"><a name="wp1021105"> </a>
You will be editing some of the files and making them executable, so it is best to begin with a copy of the files rather than the originals delivered with the software. 
</p>
<li><a name="wp1021417"> </a>List the files. </li>
<a name="wp1022101"> </a><div class="pPreformattedRelative"><pre>$ ls<br />README<br />client.c<br />crlog<br />crque<br />makefile<br />rmipc<br />runsample<br />server.c<br />setenv<br />ubb.sample<br />$</pre></div><p class="pBodyRelative"><a name="wp1021943"> </a>
The files that make up the application are: 
</p>
</ol></div>
<div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1022181"> </a>
<code class="cCode">README</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022236"> </a>
A file that describes the application and how to configure and run it. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021650"> </a>
<code class="cCode">setenv</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022249"> </a>
A script that sets environment variables. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021685"> </a>
<code class="cCode">crlog</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022264"> </a>
A script that creates a <code class="cCode">TLOG</code> file. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021720"> </a>
<code class="cCode">crque</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022269"> </a>
A script that defines the queue space and queues for the application. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021789"> </a>
<code class="cCode">makefile</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022272"> </a>
A makefile that creates the executables for the application. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021792"> </a>
<code class="cCode">client.c</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022275"> </a>
The source code for the client program. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021827"> </a>
<code class="cCode">server.c</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022278"> </a>
The source code for the server program. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021862"> </a>
<code class="cCode">ubb.sample</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022349"> </a>
The ASCII form of the configuration file for the application. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021897"> </a>
<code class="cCode">runsample</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022360"> </a>
A script that calls all the necessary commands to build and run the sample application. 
</div><div class="pDefTerm2"><h4 class="pDefTerm2"><a name="wp1021932"> </a>
<code class="cCode">rmipc</code>
</h4></div>
<div class="pDefPara2"><a name="wp1022361"> </a>
A script that removes the IPC resources for the queue space. 
</div><div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1021132"> </a>Edit the <code class="cCode">setenv</code> file.</li>
<p class="pBodyRelative"><a name="wp1022955"> </a>
Open the <code class="cCode">setenv</code> file and modify the <code class="cCode">TUXDIR</code> value to the absolute path of the root directory of the Oracle Tuxedo system installation. Remove the angle bracket characters (<code class="cCode">&lt;</code> and <code class="cCode">&gt;</code>) when editing this value.
</p>
<li><a name="wp1021149"> </a>Run <code class="cCode">runsample</code>.</li>
<p class="pBodyRelative"><a name="wp1021150"> </a>
The <code class="cCode">runsample</code> script contains several commands; each command is preceded by a comment line that describes the purpose of the command. 
</p>
<a name="wp1023451"> </a><div class="pPreformattedRelative"><pre>#set the environment<br />. ./setenv<br />chmod +w ubb.sample<br />uname=&quot;`uname -n`&quot;<br />ed ubb.sample&lt;&lt;!<br />g;&lt;uname -n&gt;;s;;${uname};<br />g;&lt;full path of Tuxedo software&gt;;s;;${TUXDIR};<br />g;&lt;full path of APPDIR&gt;;s;;${APPDIR};<br />w<br />q<br />!<br />#build the client and server<br />make client server<br />#create the tuxconfig file<br />tmloadcf -y ubb.sample<br />#create the TLOG<br />./crlog<br />#create the QUE<br />./crque<br />#boot the application<br />tmboot -y<br />#run the client<br />client<br />#shutdown the application<br />tmshutdown -y<br />#remove the client and server<br />make clean<br />#remove the QUE ipc resources<br />./rmipc<br />#remove all files created<br />rm tuxconfig QUE stdout stderr TLOG ULOG*</pre></div><p class="pBodyRelative"><a name="wp1021170"> </a>
When you run this script you will see a series of messages on your screen that are generated by the various commands. Included among them are the following lines:
</p>
<a name="wp1021171"> </a><div class="pPreformattedRelative"><pre><code class="cCode">before: this is a q example<br />after: THIS IS A Q EXAMPLE</code></pre></div><p class="pBodyRelative"><a name="wp1021173"> </a>
The <code class="cCode">before:</code> line is a copy of the string that <code class="cCode">client</code> enqueues for processing by <code class="cCode">server</code>. The <code class="cCode">after:</code> line is what <code class="cCode">server</code> sends back. These two lines prove that the program worked successfully. 
</p>
</ol></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1021174"> </a>
Suggestions for Further Exploration
</h2><p class="pBody"><a name="wp1021175"> </a>
While it might prove interesting to build and run the sample application using <code class="cCode">runserver</code>, you will probably find it more instructive to examine the individual pieces of the application. In this topic, we suggest some things that we recommend you look at and try; you will undoubtedly be able to think of others as you explore the application more closely. 
</p>
<h3 class="pHeading2"><a name="wp1021176"> </a>
setenv: Set the Environment
</h3>
<p class="pBody"><a name="wp1021177"> </a>
The script <code class="cCode">setenv</code> is an example of a file often used in Oracle Tuxedo development. Three of the variables that are set (<code class="cCode">TUXDIR</code>, <code class="cCode">APPDIR</code>, and <code class="cCode">PATH</code>) are needed whenever you are working with the Oracle Tuxedo system. Notice that if you are running on a Sun machine, there is another <code class="cCode">bin</code> you must have at the beginning of your <code class="cCode">PATH</code> variable. <code class="cCode">LD_LIBRARY_PATH</code>, <code class="cCode">SHLIB_PATH</code>, or <code class="cCode">LIBPATH</code> are important if you are building the system with shared libraries. The correct variable to use depends on your operating system. <code class="cCode">TUXCONFIG</code> must be set before you can boot the system. <code class="cCode">QMADMIN</code> can be set in a variable or provided on the <a href="../rfcm/rfcmd.html">qmadmin(1)</a> command line. 
</p>
<p class="pBody"><a name="wp1021178"> </a>
Points to consider: should you plan to have such a file where you will be doing your Oracle Tuxedo /Q work? Should you have a command in your <code class="cCode">.profile</code> so that you set your environment as you log in?
</p>
<h3 class="pHeading2"><a name="wp1021179"> </a>
makefile: Make Your Application
</h3>
<p class="pBody"><a name="wp1021180"> </a>
Notice that the <code class="cCode">makefile</code> uses <a href="../rfcm/rfcmd.html">buildserver(1)</a> and <a href="../rfcm/rfcmd.html">buildclient(1)</a> to build the server and client, respectively. You can, of course, execute these commands individually or use the capability of <code class="cCode">make</code> to keep the application current.
</p>
<p class="pBody"><a name="wp1021181"> </a>
While we are on the subject of the <code class="cCode">makefile</code>, this might be a good time to look through the <code class="cCode">.c</code> files for the client and server programs. Of particular interest in connection with Oracle Tuxedo /Q are the <code class="cCode">tpenqueue</code> and <code class="cCode">tpdequeue</code> calls. Notice particularly the values for the <code class="cCodeEmphasis">qspace</code> and the <code class="cCodeEmphasis">qname</code> arguments. When we look at the configuration file, we will see where those values come from. 
</p>
<h3 class="pHeading2"><a name="wp1021182"> </a>
ubb.sample: The ASCII Configuration File
</h3>
<p class="pBody"><a name="wp1021183"> </a>
The three most pertinent entries in the configuration file are the <code class="cCode">CLOPT</code> parameters for the <code class="cCode">TMQUEUE</code> and <code class="cCode">TMQFORWARD</code> servers and the <code class="cCode">OPENINFO</code> parameter in the *<code class="cCode">GROUPS</code> entry. We will extract those items to call them to your attention here: 
</p>
<a name="wp1021184"> </a><div class="pPreformatted"><pre><code class="cCode"># First the CLOPT parameter from TMQUEUE:<br />        CLOPT = &quot;-s QSPACENAME:TMQUEUE --  &quot;<br /># Then the CLOPT parameter from TMQFORWARD:<br />        CLOPT=&quot;-- -i 2 -q STRING&quot;<br /># Finally, the OPENINFO parameter from the QUE1 group:<br />        OPENINFO = &quot;TUXEDO/QM:&lt;APPDIR pathname&gt;/QUE:QSPACE&quot;</code></pre></div><p class="pBody"><a name="wp1021190"> </a>
The <code class="cCode">CLOPT</code> parameter from <code class="cCode">TMQUEUE</code> specifies a service alias of <code class="cCode">QSPACENAME</code>. Look back again at <code class="cCode">client.c</code> and check the <code class="cCodeEmphasis">qspace</code> argument of <code class="cCode">tpenqueue</code> and <code class="cCode">tpdequeue</code>. The <code class="cCode">CLOPT</code> parameter for <code class="cCode">TMQFORWARD</code> specifies a service <code class="cCode">STRING</code> by means of the <code class="cCode">-q</code> option. This is also the name given to the queue where messages are enqueued for that service and is specified as the <code class="cCodeEmphasis">qname</code> argument of <code class="cCode">tpenqueue</code> in <code class="cCode">client.c</code>. 
</p>
<p class="pBody"><a name="wp1021191"> </a>
The <a href="../rfcm/rfcmd.html">tmloadcf(1)</a> command is used to compile the ASCII configuration file into a <code class="cCode">TUXCONFIG</code> file. 
</p>
<h3 class="pHeading2"><a name="wp1021192"> </a>
crlog: Create the Transaction Log
</h3>
<p class="pBody"><a name="wp1021193"> </a>
The script in <code class="cCode">crlog</code> invokes <a href="../rfcm/rfcmd.html">tmadmin(1)</a> to create a device list entry for the <code class="cCode">TLOG</code> and then create the log for the site specified in our configuration. Because all messages for the queued message facility are enqueued and dequeued within transactions, you must have a log in which to keep track of transactions managed by the <code class="cCode">TMS_QM</code> server. 
</p>
<h3 class="pHeading2"><a name="wp1021194"> </a>
crque: Create the Queue Space and Queues
</h3>
<p class="pBody"><a name="wp1021195"> </a>
The script in <code class="cCode">crque</code> invokes <a href="../rfcm/rfcmd.html">qmadmin(1)</a> to create the queue space and queues for the sample application. Notice that the queue space is named <code class="cCode">QSPACE</code> (that is also the name specified as the last argument of the <code class="cCode">OPENINFO</code> parameter in the configuration file). Queues named <code class="cCode">STRING</code> and <code class="cCode">RPLYQ</code> are created. In the <code class="cCode">qspacecreate</code> portion of the script an error queue is named, but the script does not include any <code class="cCode">qcreate</code> command to create that queue. That is a modification you might want to make later. 
</p>
<h3 class="pHeading2"><a name="wp1021196"> </a>
Boot, Run, and Shut Down the Application
</h3>
<p class="pBody"><a name="wp1021197"> </a>
After making the application programs, loading <code class="cCode">TUXCONFIG</code>, and creating the queue space and queues, the next step is to boot the application and run it. The command to boot is:
</p>
<a name="wp1021198"> </a><div class="pPreformatted"><pre><code class="cCode">tmboot -y</code></pre></div><p class="pBody"><a name="wp1021199"> </a>
The <code class="cCode">-y</code> option keeps <code class="cCode">tmboot</code> from prompting for an okay before booting. 
</p>
<p class="pBody"><a name="wp1022420"> </a>
The sample application is run simply by entering the command: 
</p>
<a name="wp1021200"> </a><div class="pPreformatted"><pre><code class="cCode">client</code></pre></div><p class="pBody"><a name="wp1021201"> </a>
The <code class="cCode">tmshutdown</code> command is used to bring the application down.
</p>
<h3 class="pHeading2"><a name="wp1021202"> </a>
Clean Up
</h3>
<p class="pBody"><a name="wp1021203"> </a>
The <code class="cCode">runsample</code> script includes three commands that restore the environment to the state it was in before the script was run. The <code class="cCode">make clean</code> command uses <code class="cCode">make</code> to remove the object and executable files for the client and server.
</p>
<p class="pBody"><a name="wp1021204"> </a>
The <code class="cCode">rmipc</code> command is included because the IPC resources for the queue space are not automatically removed by <code class="cCode">tmshutdown</code> (which does remove the Oracle Tuxedo IPC resources used by the application). If you look at <code class="cCode">rmipc</code>, you will find that it invokes <code class="cCode">qmadmin</code> and uses its version of the <code class="cCode">ipcrm</code> command naming <code class="cCode">QSPACE</code> to identify resources to be removed.
</p>
<p class="pBody"><a name="wp1021205"> </a>
The final command in the script is the <code class="cCode">rm</code> command, which removes a number of files that are generated by the application. There is no harm in leaving these files; in fact, as you work more with the sample application you will probably want to keep <code class="cCode">tuxconfig</code>, <code class="cCode">QUE</code>, and <code class="cCode">TLOG</code> to save having to recreate them.
</p>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="qsimp.html"><img id="LongDescNotReq7" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="qcblpgm.html"><img id="LongDescNotReq8" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq9" src="/global_resources/images/nexttop_disabled.gif" border="0" alt="Next" />
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
