<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41263" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux11gr1/qgd/fm/qadm.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="11/28/11 08:26:29" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Oracle Tuxedo /Q Administration</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Using the ATMI /Q Component
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="qoview.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="qpgm.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
&nbsp;
<a href="../pdf/qgd.pdf" target="pdf"><img id="LongDescNotReq5" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq6" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1018015"> </a>
Oracle Tuxedo /Q Administration
</h1>
<p class="pBody"><a name="wp1016118"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1010733"> </a><a href="qadm.html#wp1003606">Introduction</a></li>
<li><a name="wp1011304"> </a><a href="qadm.html#wp1003617">Configuration</a></li>
<li><a name="wp1011325"> </a><a href="qadm.html#wp1003787">Creating Queue Spaces and Queues</a></li>
<li><a name="wp1014948"> </a><a href="qadm.html#wp1014849">Handling Encrypted Message Buffers</a></li>
<li><a name="wp1013071"> </a><a href="qadm.html#wp1007039">Maintenance of the Oracle Tuxedo /Q Feature</a></li>
<li><a name="wp1011338"> </a><a href="qadm.html#wp1012894">Windows Standard I/O</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1003606"> </a>
Introduction
</h2><p class="pBody"><a name="wp1003607"> </a>
The Oracle Tuxedo /Q administrator has three primary areas of responsibility, which are: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1003609"> </a>Configuration of resources</li>
<li><a name="wp1004128"> </a>Creation of the queue space and queues </li>
<li><a name="wp1004131"> </a>Monitoring and maintenance of the facility</li>
</ul></div>
<p class="pBody"><a name="wp1003612"> </a>
Close cooperation with the application developers and programmers is a must; the configuration and the queue attributes must reflect the requirements of the application.
</p>
<h3 class="pHeading2"><a name="wp1003614"> </a>
Available Sample Program Called qsample
</h3>
<p class="pBody"><a name="wp1003615"> </a>
A brief example of the use of the queued message facility is distributed with the software and is described in <a href="qsimp.html">A Sample Application</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1003617"> </a>
Configuration
</h2><p class="pBody"><a name="wp1013258"> </a>
Three servers are provided with the Oracle Tuxedo /Q component. One is the Transaction Manager Server (TMS), <code class="cCode">TMS_QM</code>, for the Oracle Tuxedo /Q resource manager. That is, it manages global transactions for the queued message facility. It must be defined in the <code class="cCode">GROUPS</code> section of the configuration file. 
</p>
<p class="pBody"><a name="wp1003622"> </a>
The other two, <a href="../rf5/rf5.html">TMQUEUE(5)</a> and <a href="../rf5/rf5.html">TMQFORWARD(5)</a>, provide services to users. They must be defined in the <code class="cCode">SERVERS</code> section of the configuration file.
</p>
<p class="pBody"><a name="wp1003624"> </a>
The application can also create its own queue servers, if the functionality of <code class="cCode">TMQFORWARD</code> does not fully meet the needs of the application. For example, the administrator might want to have a special server to dequeue messages moved to the error queue.
</p>
<p class="pBody"><a name="wp1008412"> </a>
The application can also choose peer-to-peer communication. In this case, the application communicates with other applications, or a client communicates with other clients, by not using any forwarding server.
</p>
<h3 class="pHeading2"><a name="wp1003627"> </a>
Specifying the QM Server Group
</h3>
<p class="pBody"><a name="wp1003628"> </a>
In addition to the standard requirements of a group name tag and a value for <code class="cCode">GRPNO</code> (see <a href="../rf5/rf5.html">UBBCONFIG(5)</a> for details), there must be a server group defined for each queue space the application will use. The <code class="cCode">TMSNAME</code> and <code class="cCode">OPENINFO</code> parameters need to be set. Here are examples: 
</p>
<a name="wp1003631"> </a><div class="pPreformatted"><pre>TMSNAME=TMS_QM</pre></div><p class="pBody"><a name="wp1005726"> </a>
and
</p>
<a name="wp1005727"> </a><div class="pPreformatted"><pre>OPENINFO=&quot;TUXEDO/QM:&lt;<code class="cCodeEmphasis">device_name</code>:&lt;<code class="cCodeEmphasis">queue_space_name</code>&gt;&quot;</pre></div><p class="pBody"><a name="wp1003634"> </a>
<code class="cCode">TMS_QM</code> is the name for the transaction manager server for Oracle Tuxedo /Q. In the <code class="cCode">OPENINFO</code> parameter, <code class="cCode">TUXEDO/QM</code> is the literal name for the resource manager as it appears in <code class="cCode">$TUXDIR/udataobj/RM</code>. The values for &lt;<code class="cCodeEmphasis">device_name</code>&gt; and &lt;<code class="cCodeEmphasis">queue_space_name</code>&gt; are instance-specific and must be set to the pathname for the universal device list and the name associated with the queue space, respectively. These values are specified by the Oracle Tuxedo administrator using <a href="../rfcm/rfcmd.html">qmadmin(1)</a>.
</p>
<a name="wp1003640"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The chronological order of these specifications is not critical. The configuration file can be created either before or after the queue space is defined. The important thing is that the configuration must be defined and queue space and queues created before the facility can be used.</td>
</tr>
</table>

<p class="pBody"><a name="wp1003643"> </a>
There can be only one queue space per <code class="cCode">GROUPS</code> section entry. The <code class="cCode">CLOSEINFO</code> parameter is not used. 
</p>
<p class="pBody"><a name="wp1003645"> </a>
The following example is taken from the reference page for <a href="../rf5/rf5.html">TMQUEUE(5)</a>.
</p>
<a name="wp1003646"> </a><div class="pPreformatted"><pre>*GROUPS<br />TMQUEUEGRP1 GRPNO=1 TMSNAME=TMS_QM<br />        OPENINFO=&quot;TUXEDO/QM:/dev/device1:myqueuespace&quot;<br />TMQUEUEGRP2 GRPNO=2 TMSNAME=TMS_QM<br />        OPENINFO=&quot;TUXEDO/QM:/dev/device2:myqueuespace&quot;</pre></div><h3 class="pHeading2"><a name="wp1003651"> </a>
Specifying the Message Queue Server
</h3>
<p class="pBody"><a name="wp1003652"> </a>
The <a href="../rf5/rf5.html">TMQUEUE(5)</a> reference page gives a full description of the <code class="cCode">SERVERS</code> section of the configuration file, but there are some points worth additional emphasis here.
</p>
<h4 class="pHeading3"><a name="wp1003654"> </a>
Operation Timeout
</h4>
<p class="pBody"><a name="wp1003655"> </a>
<code class="cCode">TMQUEUE</code> recognizes a <code class="cCode">-t </code><code class="cCodeEmphasis">timeout</code> option when specified after the double dash (- -) in the <code class="cCode">CLOPT</code> parameter. This timeout value affects only operations begun within the server if it finds that a transaction is not in effect, in other words, either the client called <a href="../rf3c/rf3c.html">tpenqueue(3c)</a> or <a href="../rf3c/rf3c.html">tpdequeue(3c)</a> without first calling <a href="../rf3c/rf3c.html">tpbegin(3c)</a> or it began a transaction and called <code class="cCode">tpenqueue()</code> or <code class="cCode">tpdequeue()</code> with the <code class="cCode">TPNOTRAN</code> flag set to exclude the queue request from the client&#39;s transaction. The default for <code class="cCodeEmphasis">timeout</code> is 30 seconds. If a <code class="cCode">tpdequeue</code> request is received with the <code class="cCodeEmphasis">flags</code> set to <code class="cCode">TPQWAIT</code>, a <code class="cCode">TPETIME</code> error will be returned if the wait exceeds <code class="cCode">-t</code> <code class="cCodeEmphasis">timeout</code> seconds.
</p>
<a name="wp1003663"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td><code class="cCode">ctl</code> is a structure of type <code class="cCode">TPQCTL</code> used by <a href="../rf3c/rf3c.html">tpenqueue(3c)</a> and <a href="../rf3c/rf3c.html">tpdequeue(3c)</a> to pass parameters between the calling process and the system. <code class="cCode">TPQWAIT</code> is a flag setting available in <code class="cCode">tpdequeue</code> to indicate that the process wishes to wait for a reply message. The structure is explained in detail in <a href="qpgm.html#wp1003700">TPQCTL Structure</a> and <a href="qcblpgm.html#wp1003737">TPQUEDEF-REC Structure</a>. The COBOL equivalent is the <code class="cCode">TPQUEDEF-REC</code> record.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1003667"> </a>
Queue Space Names, Queue Names, and Service Names
</h3>
<p class="pBody"><a name="wp1003668"> </a>
There is potential confusion among queue space names, queue names, and service names. The first place you are apt to encounter the confusion is in the specification of the message queue server: <code class="cCode">TMQUEUE</code>. When specifying this server in the configuration file you can use the <code class="cCode">-s</code> flag of the <code class="cCode">CLOPT</code> parameter to name the queue space served by a given instance of the server, which is the same as saying it is a service advertised by the function: <code class="cCode">TMQUEUE</code>. In an application that uses only one queue space, it is not necessary to specify the <code class="cCode">CLOPT -s</code> option; it will default to <code class="cCode">-s</code> <code class="cCode">TMQUEUE:TMQUEUE</code>. If the application requires more than a single queue space, the names of the queue spaces are included as arguments to the <code class="cCode">-s</code> option in the <code class="cCode">SERVERS</code> section entry for the queued message server.
</p>
<p class="pBody"><a name="wp1003677"> </a>
An alternative way of making this specification is to rebuild the message queue server, using <a href="../rfcm/rfcmd.html">buildserver(1)</a>, and name the queue spaces with the similar sounding <code class="cCode">-s</code> option. This has the result of fixing, or <em class="cEmphasis">hardcoding</em>, the service names in the server executable.
</p>
<a name="wp1006228"> </a><div class="pPreformatted"><pre># The following two specifications are equivalent:<br /> <br />*SERVERS<br />TMQUEUE SRVGRP=&quot;TMQUEUEGRP1&quot; SRVID=1000 RESTART=Y GRACE=0 \<br />        CLOPT=&quot;-s myqueuespace:TMQUEUE&quot;<br />and<br /> <br />buildserver -o TMQUEUE -s myqueuespace:TMQUEUE -r TUXEDO/QM \<br />        -f ${TUXDIR}/lib/TMQUEUE.o<br />followed by<br /> ..<br /> ..<br /> ..<br />TMQUEUE SRVGRP=&quot;TMQUEUEGRP1&quot; SRVID=1000 RESTART=Y GRACE=0 \<br />        CLOPT=&quot;-A&quot;</pre></div><h4 class="pHeading3"><a name="wp1003693"> </a>
Data-dependent Routing
</h4>
<p class="pBody"><a name="wp1003694"> </a>
The preceding discussion described the specification of services (that is, queue space names) in the message queue server. This capability can be used to bring about data-dependent routing of queued messages such that the message is queued for processing by a service within a specific group depending on a value in a field of the message buffer. To do this the same queue space name is specified in two different groups and a routing specification is made part of the configuration file to govern the group where the message is queued. The following example is taken from the <a href="../rf5/rf5.html">TMQUEUE(5)</a> reference page (the queue space name has been changed). 
</p>
<a name="wp1003701"> </a><div class="pPreformatted"><pre>*GROUPS<br />TMQUEUEGRP1 GRPNO=1 TMSNAME=TMS_QM<br />        OPENINFO=&quot;TUXEDO/QM:/dev/device1:myqueuespace&quot;<br />TMQUEUEGRP2 GRPNO=2 TMSNAME=TMS_QM<br />        OPENINFO=&quot;TUXEDO/QM:/dev/device2:myqueuespace&quot;<br />*SERVERS<br />TMQUEUE SRVGRP=&quot;TMQUEUEGRP1&quot; SRVID=1000 RESTART=Y GRACE=0 \<br />        CLOPT=&quot;-s ACCOUNTING:TMQUEUE&quot;<br />TMQUEUE SRVGRP=&quot;TMQUEUEGRP2&quot; SRVID=1000 RESTART=Y GRACE=0 \<br />        CLOPT=&quot;-s ACCOUNTING:TMQUEUE&quot;<br />*SERVICES<br />ACCOUNTING  ROUTING=&quot;MYROUTING&quot;<br />*ROUTING<br />MYROUTING  FIELD=ACCOUNT BUFTYPE=&quot;FML&quot; \<br />        RANGES=&quot;MIN-60000:TMQUEUEGRP1,60001-MAX:TMQUEUEGRP2&quot;</pre></div><h4 class="pHeading3"><a name="wp1003716"> </a>
Customized Buffer Types
</h4>
<p class="pBody"><a name="wp1003717"> </a>
<code class="cCode">TMQUEUE</code> supports all of the standard ATMI buffer types. If your application needs to add other types, it can be done by copying <code class="cCode">$TUXDIR/tuxedo/tuxlib/types/tmsypesw.c</code>, adding an entry for your special buffer types, making sure to leave the final line null, and using the revised file as input to a <a href="../rfcm/rfcmd.html">buildserver(1)</a> command. An example of the <code class="cCode">buildserver</code> command is shown on the <a href="../rf5/rf5.html">TMQUEUE(5)</a> reference page. 
</p>
<p class="pBody"><a name="wp1003723"> </a>
You can also use the <code class="cCode">-s</code> option of the <code class="cCode">buildserver</code> command to associate additional service names with <code class="cCode">TMQUEUE</code> as an alternative to specifying them in the server <code class="cCode">CLOPT</code> parameter (see above). 
</p>
<h4 class="pHeading3"><a name="wp1008445"> </a>
Buffer Subtypes
</h4>
<p class="pBody"><a name="wp1008472"> </a>
You can assign a subtype to a buffer using the <a href="../rf3c/rf3c.html">tpalloc(3c)</a> subtype parameter and later extract the subtype using the <a href="../rf3c/rf3c.html">tptypes(3c)</a> function. This gives you the ability to assign a type to data without having to create an entirely new user-defined ATMI buffer type. This is especially useful for buffers containing character arrays (<code class="cCode">CARRAY</code>) or strings (<code class="cCode">STRING</code>).
</p>
<h3 class="pHeading2"><a name="wp1003726"> </a>
Specifying the Message Forwarding Server
</h3>
<p class="pBody"><a name="wp1003727"> </a>
The third system-supplied server included with the Oracle Tuxedo /Q component is <a href="../rf5/rf5.html">TMQFORWARD(5)</a>. This is the server that takes messages from specified queues, passes them along to Oracle Tuxedo servers via <a href="../rf3c/rf3c.html">tpcall(3c)</a>, and handles associated reply messages. The full description of how the server is defined in the configuration file can be found on the <a href="../rf5/rf5.html">TMQFORWARD(5)</a> reference page, but the topics that follow bring out some points that are worth additional emphasis.
</p>
<p class="pBody"><a name="wp1005948"> </a>
<code class="cCode">TMQFORWARD</code> is referred to as a server and each instance used by an application must be defined in the <code class="cCode">SERVERS</code> section of the configuration file, but it has characteristics that set it apart from ordinary servers. For example: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1004538"> </a>It is incorrect to specify services for <code class="cCode">TMQFORWARD</code>.</li>
<li><a name="wp1004557"> </a>A client process cannot post a message for <code class="cCode">TMQFORWARD</code> as you would expect in a normal request/response relationship.</li>
<li><a name="wp1004563"> </a><code class="cCode">TMQFORWARD</code> should not be defined as a member of an <code class="cCode">MSSQ</code> set.</li>
<li><a name="wp1004566"> </a><code class="cCode">TMQFORWARD</code> should never have a reply queue.</li>
</ul></div>
<p class="pBody"><a name="wp1003740"> </a>
An instance of <code class="cCode">TMQFORWARD</code> is tied to a queue space through the server group with which it is associated, specifically through the third field in the <code class="cCode">OPENINFO</code> statement for the group. In the topics that follow we will examine other key parameters, especially <code class="cCode">CLOPT</code> parameters that come after the double dash.
</p>
<h4 class="pHeading3"><a name="wp1003744"> </a>
Queue Names and Service Names: The -q option
</h4>
<p class="pBody"><a name="wp1003745"> </a>
A required parameter is <code class="cCode">-q&#160;</code><code class="cCodeEmphasis">queuename</code><code class="cCode">,</code><code class="cCodeEmphasis">queuename</code>. . . This parameter specifies the queue(s) to be checked by this instance of the server. <code class="cCodeEmphasis">queuename</code> is a NULL-terminated string of up to 127 characters; it is the same as the name of the application service that will process the message once it has been taken off the queue by <code class="cCode">TMQFORWARD</code>. It is also the name that a programmer specifies as the second argument of <a href="../rf3c/rf3c.html">tpenqueue(3c)</a> or <a href="../rf3c/rf3c.html">tpdequeue(3c)</a> when preparing to call the message queue server, <code class="cCode">TMQUEUE</code>.
</p>
<h4 class="pHeading3"><a name="wp1003751"> </a>
Controlling Transaction Timeout: The -t option
</h4>
<p class="pBody"><a name="wp1003752"> </a>
<code class="cCode">TMQFORWARD</code> does its work within a transaction that it begins and ends. The <code class="cCode">-t&#160;</code><code class="cCodeEmphasis">trantime</code> option is available to specify the length of time in seconds before the transaction is timed out. The transaction is begun when <code class="cCode">TMQFORWARD</code> finds a message on the queue it is checking; it is committed after a reply has been enqueued either to the reply queue or the failure queue, so the transaction encompasses calling the service that processes the message and receiving a reply. The default is 60 seconds.
</p>
<h4 class="pHeading3"><a name="wp1003758"> </a>
Controlling Idle Time: The -i option
</h4>
<p class="pBody"><a name="wp1003759"> </a>
Once <code class="cCode">TMQFORWARD</code> is booted it periodically checks the queue to which it is assigned. If it finds the queue empty, it pauses for <code class="cCode">-i&#160;</code><code class="cCodeEmphasis">idletime</code> seconds before checking again. If a value is not specified, the default is 30 seconds; a value of 0 says to keep checking the queue constantly, which can be wasteful of CPU resources if the queue is frequently empty. 
</p>
<h4 class="pHeading3"><a name="wp1003763"> </a>
Controlling Server Exit: The -e option
</h4>
<p class="pBody"><a name="wp1003764"> </a>
If the <code class="cCode">-e</code> option is specified, the server will shut itself down gracefully (and will create a user log message) when it finds the queue empty. This behavior may be used to your advantage in connection with the threshold command that you can specify for a queue. There is a more complete discussion about the <code class="cCode">-e</code> option and the threshold command in <a href="qadm.html#wp1003787">Creating Queue Spaces and Queues</a>.
</p>
<h4 class="pHeading3"><a name="wp1003768"> </a>
Delete Message After Service Failure: The -d option
</h4>
<p class="pBody"><a name="wp1003769"> </a>
When a service request fails after being called by <code class="cCode">TMQFORWARD</code>, the transaction is rolled back, and the message is put back on the queue for a later retry (up to a limit of retries specified for the queue). The <code class="cCode">-d</code> option adds the following refinement: if the failed service returns a non-NULL reply, the reply (and its associated <code class="cCodeEmphasis">tpurcode</code>) are put on a failure queue (if one is associated with the message and the queue exists) and the original request message is deleted. Also with the <code class="cCode">-d</code> option, if the original request message is to be deleted at the same time as the retry limit configured for the queue is reached, the original request message is put into the error queue.
</p>
<p class="pBody"><a name="wp1011496"> </a>
The rationale behind this option is that rather than blindly retrying, the originating client can be coded to examine the failure message and determine whether further attempts are reasonable. It provides a way of handling a failure that is due to some inherently reasonable condition (for example, a record is <em class="cEmphasis">not found</em> because the account does not exist).
</p>
<h4 class="pHeading3"><a name="wp1003778"> </a>
Customized Buffer Types
</h4>
<p class="pBody"><a name="wp1003779"> </a>
Customized application buffer types can be added to the type switch and incorporated into <code class="cCode">TMQFORWARD</code> with the <a href="../rfcm/rfcmd.html">buildserver(1)</a> command. It should be noted, however, that when you customize <code class="cCode">TMQFORWARD</code> it is an error to specify service names with a <code class="cCode">-s</code> option.
</p>
<h3 class="pHeading2"><a name="wp1003782"> </a>
Dynamic Configuration
</h3>
<p class="pBody"><a name="wp1003783"> </a>
We have described configuration parameters in terms of <code class="cCode">UBBCONFIG</code> parameters. However, it should be noted that the specifications in the <code class="cCode">GROUPS</code> and <code class="cCode">SERVERS</code> sections can also be added to the <code class="cCode">TUXCONFIG</code> file of a running application by using <code class="cCode">tmconfig(1)</code> (see <a href="../rfcm/rfcmd.html">tmconfig,&#160;wtmconfig(1)</a>). Of course, the group and the servers will have to be booted once they have been defined.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1003787"> </a>
Creating Queue Spaces and Queues
</h2><p class="pBody"><a name="wp1003788"> </a>
This topic covers three of the <a href="../rfcm/rfcmd.html">qmadmin(1)</a> commands that are used to establish the resources of the Oracle Tuxedo /Q component. The <code class="cCode">APPQ_MIB</code> Management Information Base provides an alternative method of administering Oracle Tuxedo /Q programmatically. See the <a href="../rf5/rf5.html">APPQ_MIB(5)</a> reference page for more information on the MIB.
</p>
<h3 class="pHeading2"><a name="wp1004735"> </a>
Working with qmadmin Commands
</h3>
<p class="pBody"><a name="wp1003791"> </a>
Most of the key commands of <code class="cCode">qmadmin</code> have positional parameters. If the positional parameters (those not specified with a dash (<code class="cCode">-</code>) preceding the option) are not specified on the command line when the command is invoked, <code class="cCode">qmadmin</code> prompts you for the required information.
</p>
<h3 class="pHeading2"><a name="wp1003795"> </a>
Creating an Entry in the Universal Device List: crdl
</h3>
<p class="pBody"><a name="wp1003796"> </a>
The universal device list (UDL) is a VTOC file under the control of the Oracle Tuxedo system. It maps the physical storage space on a machine where the Oracle Tuxedo system is run. An entry in the UDL points to the disk space where the queues and messages of a queue space are stored; the Oracle Tuxedo system manages the input and output for that space. If the queued message facility is installed as part of a new Oracle Tuxedo installation, the UDL is created by <a href="../rfcm/rfcmd.html">tmloadcf(1)</a> when the configuration file is first loaded.
</p>
<p class="pBody"><a name="wp1003804"> </a>
Before you create a queue space, you must create an entry for it in the UDL. The following is an example of the commands: 
</p>
<a name="wp1003806"> </a><div class="pPreformatted"><pre># First invoke the /Q administrative interface, qmadmin<br /># The QMCONFIG variable points to an existing device where the UDL<br /># either resides or will reside.<br />QMCONFIG=/dev/rawfs qmadmin<br /># Next create the device list entry<br />crdl /dev/rawfs 50 500<br /># The above command sets aside 500 physical pages beginning at block # 50<br /># If the UDL has no previous entries, offset (block number) 0 must # be used</pre></div><p class="pBody"><a name="wp1003814"> </a>
If you are going to add an entry to an existing Oracle Tuxedo UDL, the value for the <code class="cCode">QMCONFIG</code> variable must be the same pathname specified in <code class="cCode">TUXCONFIG</code>. Once you have invoked <code class="cCode">qmadmin</code>, it is recommend that you run a <code class="cCode">lidl</code> command to see where space is available before creating your new entry.
</p>
<h3 class="pHeading2"><a name="wp1003818"> </a>
Creating a Queue Space: qspacecreate
</h3>
<p class="pBody"><a name="wp1003819"> </a>
A queue space makes use of IPC resources; when you define a queue space you are allocating a shared memory segment and a semaphore. As noted above, the easiest way to use the command is to let it prompt you. (You can also use the <code class="cCode">T_APPQSPACE</code> class of the <a href="../rf5/rf5.html">APPQ_MIB(5)</a> to create a queue space.) The sequence looks like this:
</p>
<a name="wp1008680"> </a><div class="pPreformatted"><pre>&gt; qspacecreate <br />Queue space name: myqueuespace <br />IPC Key for queue space: 230458 <br />Size of queue space in disk pages: 200 <br />Number of queues in queue space: 3 <br />Number of concurrent transactions in queue space: 3 <br />Number of concurrent processes in queue space: 3 <br />Number of messages in queue space: 12 <br />Error queue name: errq <br />Initialize extents (y, n [default=n]): <br />Blocking factor [default=16]: 16</pre></div><p class="pBody"><a name="wp1008693"> </a>
The program insists that you provide values for all prompts except the final three. As you can see, there are defaults for the last two; while you will almost certainly want to name an error queue, you are not required to. If you provide a name here, you must create the error queue with the <code class="cCode">qcreate</code> command. If you choose not to name an error queue, bear in mind that messages that normally would be moved to the error queue (for example, when a retry limit is reached), are permanently lost.
</p>
<p class="pBody"><a name="wp1007780"> </a>
The program does not prompt you to specify the size of the area to reserve in shared memory for storing non-persistent messages for all queues in the queue space. When you require non-persistent (memory-based) messages, you must specify the size of the memory area on the qspacecreate command line with the <code class="cCode">-n</code> option.
</p>
<p class="pBody"><a name="wp1003839"> </a>
The value for the IPC key should be picked so as not to conflict with your other requirements for IPC resources. It should be a value greater than 32,768 and less than 262,143.
</p>
<p class="pBody"><a name="wp1003841"> </a>
The size of the queue space, the number of queues, and the number of messages that can be queued at one time all depend on the needs of your application. Of course, you cannot specify a size greater than the number of pages specified in your UDL entry. In connection with these parameters, you also need to look ahead to the queue capacity parameters for an individual queue within the queue space. Those parameters allow you to (a) set a limit on the number of messages that can be put on a queue, and (b) name a command to be executed when the number of enqueued messages on the queue reaches the threshold. If you specify a low number of concurrent messages for the queue space, you may create a situation where your threshold on a queue will never be reached.
</p>
<p class="pBody"><a name="wp1003850"> </a>
To calculate the number of concurrent transactions, count each of the following as one transaction:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008005"> </a>Each <code class="cCode">TMS_QM</code> server in the group that uses this queue space</li>
<li><a name="wp1008006"> </a>Each <code class="cCode">TMQUEUE</code> or <code class="cCode">TMQFORWARD</code> server in the group that uses this queue space</li>
<li><a name="wp1008007"> </a><code class="cCode">qmadmin</code></li>
</ul></div>
<p class="pBody"><a name="wp1008008"> </a>
If your client programs begin transactions before they call <code class="cCode">tpenqueue</code>, increase the count by the number of clients that might access the queue space concurrently. The worst case is that all clients access the queue space at the same time.
</p>
<p class="pBody"><a name="wp1003855"> </a>
For the number of concurrent processes count one for each <code class="cCode">TMS_QM,</code> <code class="cCode">TMQUEUE</code> or <code class="cCode">TMQFORWARD</code> server in the group that uses this queue space and one for a fudge factor.
</p>
<p class="pBody"><a name="wp1005997"> </a>
You can choose to initialize the queue space as you use the <code class="cCode">qspacecreate</code> command, or you can let it be done by the <code class="cCode">qopen</code> command when you first open the queue space.
</p>
<h3 class="pHeading2"><a name="wp1003859"> </a>
Creating a Queue: qcreate
</h3>
<p class="pBody"><a name="wp1003860"> </a>
Each queue that you intend to use must be created with the <code class="cCode">qmadmin</code> <code class="cCode">qcreate</code> command. You first have to open the queue space with the <code class="cCode">qopen</code> command. If you do not provide a queue space name, <code class="cCode">qopen</code> will prompt for it. (You can also use the <code class="cCode">T_APPQ</code> class of the <a href="../rf5/rf5.html">APPQ_MIB(5)</a> to create a queue.)
</p>
<p class="pBody"><a name="wp1004940"> </a>
The prompt sequence for <code class="cCode">qcreate</code> looks like the following:
</p>
<a name="wp1008703"> </a><div class="pPreformatted"><pre>&gt; qcreate <br />Queue name: service1 <br />Queue order (priority, time, fifo, lifo): fifo <br />Out-of-ordering enqueuing (top, msgid, [default=none]): none <br />Retries [default=0]: 2 <br />Retry delay in seconds [default=0]: 30 <br />High limit for queue capacity warning (b for bytes used, B for blocks used, <br />% for percent used, m for messages [default=100%]): 80% <br />Reset (low) limit for queue capacity warning [default=0%]: 0% <br />Queue capacity command: <br />No default queue capacity command <br />Queue &#39;service1&#39; created</pre></div><p class="pBody"><a name="wp1008747"> </a>
You can skip all of these prompts (except the prompt for the queue name); if you do not provide a name for the queue, the program displays a warning message and prompts again. For the other parameters, the program provides a default and displays a message that specifies the default. 
</p>
<p class="pBody"><a name="wp1007813"> </a>
The program does not prompt you for a default delivery policy and memory threshold options. The default delivery policy option allows you to specify whether messages with no specified delivery mode are delivered to persistent (disk-based) or non-persistent (memory-based) storage. The memory threshold option allows you to specify values used to trigger command execution when a non-persistent memory threshold is reached. To use these options, you must specify them on the qcreate command line with <code class="cCode">-d</code> and <code class="cCode">-n</code>, respectively.
</p>
<h4 class="pHeading3"><a name="wp1003880"> </a>
Specifying Queue Order
</h4>
<p class="pBody"><a name="wp1003881"> </a>
Messages are put into the queue based on the order specified by this parameter and dequeued from the top of the queue unless selection criteria are applied to the dequeuing operation. If <code class="cCode">priority</code>, expiration, and/or <code class="cCode">time</code> are chosen as queue order criteria, then messages are inserted into the queue according to values in the <code class="cCode">TPQCTL</code> structure. A combination of sort criteria may be specified with the most significant criteria specified first. Separate multiple criteria with commas (<code class="cCode">,</code>). If <code class="cCode">fifo</code> or <code class="cCode">lifo</code> (which are mutually exclusive) are specified, they must be the last value specified. The sequence in which parameters are specified determines the sort criteria for the queue. In other words, a specification of <code class="cCode">priority, fifo</code> would say that the queue should be arranged by message priority and that within messages of equal priority they should be dequeued on a first in, first out basis.
</p>
<h4 class="pHeading3"><a name="wp1003890"> </a>
Enabling Out-of-Order Enqueuing
</h4>
<p class="pBody"><a name="wp1003891"> </a>
If the administrator enables out-of-order enqueues; that is, if <code class="cCode">top</code> and/or <code class="cCode">msgid</code> are specified at the prompt, programmers can specify (via values in the <code class="cCode">TPQCTL</code> structure of a <code class="cCode">tpenqueue</code> call) that a message is to be put at the top of the queue or ahead of the message identified by <code class="cCode">msgid</code>. Give this option some thought; once the choice is made you have to destroy and recreate the queue to change it.
</p>
<h4 class="pHeading3"><a name="wp1003896"> </a>
Specifying Retry Parameters
</h4>
<p class="pBody"><a name="wp1003897"> </a>
Normal behavior for a queued message facility is to put a message back on the queue if the transaction that dequeues it is rolled back. It will be dequeued again when it reaches the top of the queue. You can specify the number of retries that should be attempted and also a time delay between retries. Note that when a dequeued message is put back on the queue for retry, queue order specifications are, in effect, suspended for <code class="cCodeEmphasis">Retry delay</code> seconds. During this time, the message is unavailable for any dequeuing operation.
</p>
<p class="pBody"><a name="wp1005075"> </a>
The default for the number of retries is 0, which means that no retries are attempted. When the retry limit is reached, the system moves the message to the error queue for the queue space, assuming an error queue has been named and created. If the error queue does not exist the message is discarded.
</p>
<p class="pBody"><a name="wp1003906"> </a>
The delay time is expressed in seconds. When message queues are lightly populated so that a message restored to the queue reaches the top almost immediately, you can save CPU cycles by building in a delay factor. Your general policy on retries should be based on the experience of your particular application. If you have a fair amount of contention for the service associated with a given queue, you may get a lot of transient problems. One way to deal with them is to specify a large number of retries. (The number is strictly subjective, as is the time between retries.) If the nature of your application is such that any rolled back transaction signals a failure that is never going to go away, you might want to specify 0 retries and move the message immediately to the error queue. (This is very much like what happens when you specify the -<code class="cCode">d</code> option for <code class="cCode">TMQFORWARD</code>; the only difference is that a non-zero length failure message must be received for <code class="cCode">TMQFORWARD</code> automatically to drop the message from the queue.)
</p>
<h4 class="pHeading3"><a name="wp1003917"> </a>
Using Queue Capacity Limits
</h4>
<p class="pBody"><a name="wp1003918"> </a>
There are three parameters of the <code class="cCode">qcreate</code> command that can be used to partially automate the management of a queue. The parameters set a high and low threshold figure (it can be expressed as bytes, blocks, messages or percent of queue capacity) and allow you to specify a command that is executed when the high threshold is reached. (Actually, the command is executed once when the high threshold is reached, but not again until the low threshold is reached first prior to the high threshold.)
</p>
<p class="pBody"><a name="wp1003923"> </a>
The following are two examples of ways the parameters can be used:
</p>
<a name="wp1009000"> </a><div class="pPreformatted"><pre>High limit for queue capacity warning (b for bytes used, B for blocks used, % for percent used, m for messages [default=100%]): 80% <br />Reset (low) limit for queue capacity warning [default=0%]: 10% <br />Queue capacity command: /usr/app/bin/mailme myqueuespace service1</pre></div><p class="pBody"><a name="wp1012275"> </a>
This sequence sets the upper threshold at 80% of disk-based queue capacity and specifies a command to be executed when the queue is 80% full. The command is a script you have created that sends you a mail message when the threshold is reached. (<code class="cCode">myqueuespace</code> and <code class="cCode">service1</code> are hypothetical arguments to your command.) Presumably, once you have been informed that the queue is filling up you can take action to ease the situation. You do not get the warning message again unless the queue load drops to 10% of capacity or below, and then rises again to 80%. You can also set thresholds and specify commands for the management of non-persistent (memory-based) queue capacity using the <code class="cCode">-n</code> option of the qcreate command.
</p>
<a name="wp1012381"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If you are working on a Windows machine, see <a href="qadm.html#wp1012894">Windows Standard I/O</a> for additional information about configuring commands within a <code class="cCode">qmadmin()</code> session.</td>
</tr>
</table>

<p class="pBody"><a name="wp1003934"> </a>
The second example is somewhat more automated and takes advantage of the -<code class="cCode">e</code> option of the <code class="cCode">TMQFORWARD</code> server.
</p>
<a name="wp1009026"> </a><div class="pPreformatted"><pre>High limit for queue capacity warning (b for bytes used, B for blocks used, % for percent used, m for messages [default=100%]): 90%<br />Reset (low) limit for queue capacity warning [default=0%]: 0% <br />Queue capacity command: tmboot -i 1002</pre></div><p class="pBody"><a name="wp1009036"> </a>
This sequence assumes that you have configured a reserve <code class="cCode">TMQFORWARD</code> server for the queue in question with <code class="cCode">SRVID=1002</code> and have included the -<code class="cCode">e</code> option in its <code class="cCode">CLOPT</code> parameter. (It also assumes that the server is not booted or, if booted, has shut itself down as a result of finding the queue empty.) When the queue reaches 90% capacity, the <code class="cCode">tmboot</code> command is executed to boot the reserve server. The -<code class="cCode">e</code> option causes the server to shut itself down when the queue is empty. You have set the low threshold to 0% so as not to kick off unnecessary <code class="cCode">tmboot</code> commands for a server that is already booted.
</p>
<p class="pBody"><a name="wp1003947"> </a>
The default values for the three options are 100%, 0%, and no command.
</p>
<h4 class="pHeading3"><a name="wp1003948"> </a>
Reply and Failure Queues
</h4>
<p class="pBody"><a name="wp1003949"> </a>
The discussion above about creating a queue and providing parameters for its operation was written from the viewpoint of creating a queue for messages to be processed by a service of the same name. A queue may also be used for other purposes as well, such as peer-to-peer communication. The parameters for creating a queue are the same regardless of its use. The <code class="cCode">TPQCTL</code> structure used when a message is enqueued to a service queue includes fields to specify a reply queue and a failure queue. <code class="cCode">TMQFORWARD</code> detects the success or failure of the <a href="../rf3c/rf3c.html">tpacall(3c)</a> it makes to the requested service and, if these queues have been created by the administrator, enqueues the reply accordingly. If no reply or failure queue exists, the success or failure response message from the service is dropped leaving the originating client with no information about the outcome of the queued request. Even if there is no reply message from the service, if a reply queue exists, a zero-length message is enqueued there by <code class="cCode">TMQFORWARD</code> to inform the originating client of the outcome.
</p>
<p class="pBody"><a name="wp1003960"> </a>
When creating a reply or a failure queue, bear in mind that in most cases messages are dequeued from these queues by a client process looking for information about an earlier enqueued request. Since the most common way of dequeuing such messages is by the <code class="cCode">msgid</code> (message identifier) or <code class="cCode">corrid</code> (correlation identifier) associated with the message&#8212;as opposed to taking a message off the top of the queue&#8212;the queue ordering criteria are less significant. In this case, <code class="cCode">fifo</code> is probably sufficient. The <code class="cCode">retries</code> and <code class="cCode">retry delay</code> parameters have no significance for reply queues; just take the defaults. The <code class="cCode">queue capacity</code> thresholds and commands are likely to be useful on reply queues, and the recommended usage is to alert the administrator so that he or she can intervene. 
</p>
<h4 class="pHeading3"><a name="wp1003969"> </a>
Error Queues
</h4>
<p class="pBody"><a name="wp1003970"> </a>
An error queue is a system queue. One of the <code class="cCode">qspacecreate</code> prompts asks for the name of the error queue for the queue space. When you have actually created an error queue of the name specified, the system uses it as a place to move messages from the service queue that have reached their retry limit. The management of the error queue is up to the administrator who can either handle the messages manually through commands of <code class="cCode">qmadmin</code> or can set up an automated way of handling them through the <code class="cCode">APPQ_MIB</code> MIB. The <code class="cCode">queue capacity</code> parameters can be used, but all of the other <code class="cCode">qcreate</code> parameters, with the exception of <code class="cCode">qname</code>, are not useful for the error queue. 
</p>
<a name="wp1005257"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>We recommend against using the same queue as both an error queue and a service failure queue; doing so makes it more difficult to cleanly manage the application and could lead to clients trying to access the administrator&#39;s area.</td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1014849"> </a>
Handling Encrypted Message Buffers
</h2><p class="pBody"><a name="wp1014850"> </a>
In general, <code class="cCode">TMQUEUE</code> and <code class="cCode">TMQFORWARD</code> handle <em class="cEmphasis">encrypted</em> message buffers without decrypting them. However, there are situations where the /Q component needs to decrypt enqueued message buffers, as described in <span class="cHyperlink">
&#8220;Compatibility/Interaction </span><a href="../sec/secovr.html"></a>with /Q&#8221; in <em class="cEmphasis">Using Security in ATMI Applications</em>.
</p>
<p class="pBody"><a name="wp1014857"> </a>
As mentioned in the &#8220;<span class="cHyperlink">
Compatibility/</span><a href="../sec/secovr.html"></a>Interaction with /Q&#8221; discussion, a non-transactional <code class="cCode">tpdequeue()</code> operation has the side effect of destroying an encrypted queued message if the invoking process does not hold a valid decryption key. Thus, application programmers need to open a decryption key for a process before the process calls <code class="cCode">tpdequeue()</code> to retrieve an encrypted message; otherwise, the message will be lost.<a href="../sec/secadm.html"></a>
</p>
<p class="pBody"><a name="wp1014860"> </a>
For information on opening a decryption key, see <span class="cHyperlink">
&#8220;Initializing Decryption Keys Through the Plug-ins&#8221; </span>and <span class="cHyperlink">
&#8220;Writing Code to Receive </span><a href="../sec/secpgm.html"></a>Encrypted Messages&#8221; in <em class="cEmphasis">Using Security in ATMI Applications</em>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1007039"> </a>
Maintenance of the Oracle Tuxedo /Q Feature
</h2><p class="pBody"><a name="wp1003982"> </a>
This topic covers some things the queue administrator may have to do from time to time to keep a queue space operating efficiently.
</p>
<h3 class="pHeading2"><a name="wp1003984"> </a>
Adding Extents to a Queue Space
</h3>
<p class="pBody"><a name="wp1003985"> </a>
If you find you need more disk storage for a queue space, you can add it with the <code class="cCode">qaddext</code> command of <a href="../rfcm/rfcmd.html">qmadmin(1)</a>. (You can also use the <code class="cCode">TA_MAXPAGES</code> attribute of the <code class="cCode">T_APPQSPACE</code> class of <a href="../rf5/rf5.html">APPQ_MIB(5)</a> to add extents.) The <code class="cCode">qmadmin</code> command takes the queue space name and a number of pages as arguments. The pages come from extents defined in the UDL for the device in your <code class="cCode">QMCONFIG</code> variable. The queue space must be inactive; you can use the exclamation point to execute a command outside of <code class="cCode">qmadmin</code> to shut down the associated server group. For example: 
</p>
<a name="wp1003990"> </a><div class="pPreformatted"><pre>&gt; !tmshutdown -g TMQUEUEGRP1</pre></div><p class="pBody"><a name="wp1006078"> </a>
followed by
</p>
<a name="wp1006103"> </a><div class="pPreformatted"><pre>&gt; qclose<br />&gt; qaddext myqueue 100</pre></div><p class="pBody"><a name="wp1005303"> </a>
The queue space must be closed; <code class="cCode">qmadmin</code> closes it for you if you try to add extents to it while it is open. All non-persistent messages currently in the queue space are lost when the <code class="cCode">qaddext</code> command is issued and completes successfully.
</p>
<h3 class="pHeading2"><a name="wp1003996"> </a>
Backing Up or Moving Queue Space
</h3>
<p class="pBody"><a name="wp1003997"> </a>
A convenient command to use to back up a queue space is the UNIX command <code class="cCode">dd</code>. Shut down the associated server group first. The command lines should look like this: 
</p>
<a name="wp1003999"> </a><div class="pPreformatted"><pre>tmshutdown -g TMQUEUEGRP1<br />dd if=&lt;qspace_device_file&gt; of=&lt;output_device_filename&gt;</pre></div><p class="pBody"><a name="wp1006176"> </a>
For other options, see <code class="cCode">dd</code>(1) in a UNIX system reference manual. 
</p>
<p class="pBody"><a name="wp1004002"> </a>
This same command can be used to migrate the queue space to a machine of the same architecture, although you may need to start the command sequence with a <code class="cCode">qmadmin</code> <code class="cCode">chdl</code> command to provide a new device name if the present name does not exist on the target machine.
</p>
<p class="pBody"><a name="wp1009475"> </a>
Similar archival techniques are available on server platforms that do not have the <code class="cCode">dd</code> command. First, shut down the group containing the queue space you want to back up or migrate. Then, use an archival tool to save the queue space device to a file or other medium that may then be used as a backup or used to move the queue space to another server.
</p>
<h3 class="pHeading2"><a name="wp1004005"> </a>
Moving the Queue Space to a Different Type of Machine
</h3>
<p class="pBody"><a name="wp1004006"> </a>
If you need to move a queue space to a machine with a different architecture (primarily byte order), the procedure is more complex. Create and run an application program to dequeue all messages from all queues in the queue space and write them out in machine-independent format. Then enqueue the messages in the new queue space.
</p>
<h3 class="pHeading2"><a name="wp1004010"> </a>
TMQFORWARD and Non-Global Transactions
</h3>
<p class="pBody"><a name="wp1004011"> </a>
Messages dequeued and forwarded using <code class="cCode">TMQFORWARD</code> are executed within a global transaction because the operation crosses group boundaries. If the messages are executed by servers that are not associated with an RM or that do not run within a global transaction, they should have a server group with <code class="cCode">TMSNAME=TMS</code> (for the NULL XA interface).
</p>
<h3 class="pHeading2"><a name="wp1004015"> </a>
TMQFORWARD and Commit Control
</h3>
<p class="pBody"><a name="wp1004016"> </a>
The global transaction begun by <code class="cCode">TMQFORWARD</code> when it dequeues a message for execution is terminated by a <code class="cCode">tpcommit</code>(). The administrator can set the <code class="cCode">CMTRET</code> parameter in the configuration file to control whether the transaction commits when it is logged or when it is complete. (See the discussion of <code class="cCode">CMTRET</code> in the <code class="cCode">RESOURCES</code> section of the <a href="../rf5/rf5.html">UBBCONFIG(5)</a> reference page.)
</p>
<h3 class="pHeading2"><a name="wp1004020"> </a>
Handling Transaction Timeout
</h3>
<p class="pBody"><a name="wp1004021"> </a>
Handling transaction timeout requires cooperation between the queue administrator and the programmer developing client programs that dequeue messages. When <a href="../rf3c/rf3c.html">tpdequeue(3c)</a> is called with the <code class="cCodeEmphasis">flags</code> argument set to include <code class="cCode">TPQWAIT</code>, the <code class="cCode">TMQUEUE</code> server will wait for a message to arrive on a queue before returning to the caller. The number of seconds before it times out is based on the following: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1004025"> </a>The <code class="cCode">timeout</code> specified in the <code class="cCode">tpbegin</code> call (if the transaction is started in the client) </li>
<li><a name="wp1009322"> </a>The <code class="cCode">-t</code> <code class="cCodeEmphasis">timeout</code> flag of the <code class="cCode">TMQUEUE</code> server (if the client has not started the transaction)</li>
</ul></div>
<p class="pBody"><a name="wp1009323"> </a>
If a message is not immediately available when using <code class="cCode">TPQWAIT</code>, <code class="cCode">TMQUEUE</code> requires an action resource so that <code class="cCode">TMQUEUE</code> may service other requests. You may want to increase the number of actions the queue space may handle concurrently. Use the <code class="cCode">-A</code> <code class="cCodeEmphasis">actions</code> option to the <code class="cCode">qspacecreate</code> or <code class="cCode">qspacechange</code> commands. This option specifies the number of additional actions that can be handled concurrently. When a waiting operation is encountered and additional actions are available, the blocking operation is set aside until it can be satisfied. If no actions are available, the call to <code class="cCode">tpdequeue</code> fails.
</p>
<h3 class="pHeading2"><a name="wp1009324"> </a>
TMQFORWARD and Retries for an Unavailable Service
</h3>
<p class="pBody"><a name="wp1004032"> </a>
When a <code class="cCode">TMQFORWARD</code> server attempts to forward messages to a service that is not available, the situation can develop where the retry limit for the queue may be reached. The message is then moved to the error queue (if one exists). To avoid this situation the administrator should either shut the <code class="cCode">TMQFORWARD</code> server down or set the retry count higher.
</p>
<p class="pBody"><a name="wp1006219"> </a>
When a message is moved to the error queue it is no longer associated with the original queue. If errors are going to be handled by the administrator moving the message back to the service queue when the service is known to be available, then the queue name may be stored as part of the <code class="cCode">corrid</code> in the <code class="cCode">TPQCTL</code> structure so the queue name is associated with the message.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1012894"> </a>
Windows Standard I/O
</h2><p class="pBody"><a name="wp1012895"> </a>
In order to carry out a command that you have configured within a <code class="cCode">qmadmin()</code> session, such as the <code class="cCode">qchange ... Queue capacity command</code> described in <a href="qadm.html#wp1003917">Using Queue Capacity Limits</a>, the Windows <code class="cCode">CreateProcess()</code> function spawns a child process as a <code class="cCode">DETACHED PROCESS</code>. This type of process does <em class="cEmphasis">not</em> have an associated console for standard input/output. Therefore, for instance, if you use standard DOS syntax to set the <code class="cCode">qchange ... Queue capacity command</code> to run a built-in DOS command (such as <code class="cCode">dir</code> or <code class="cCode">date</code>) and then pipe or redirect the standard output to a file, the file will be empty when the command completes.
</p>
<p class="pBody"><a name="wp1012190"> </a>
As an example of resolving this problem, suppose that for the <code class="cCode">qchange ... Queue capacity command</code> you want to capture <code class="cCode">date</code> information in a file using command <code class="cCode">date /t &gt; x.out</code>. To accomplish this task interactively, you would proceed as follows:
</p>
<a name="wp1012191"> </a><div class="pPreformatted"><pre>qmadmin<br />&gt; qopen <code class="cCodeEmphasis">yourQspace<br /></code>&gt; qchange <code class="cCodeEmphasis">yourQname<br /></code>&gt; <code class="cCodeEmphasis">go through all the setups... the threshold queue capacity warning,<br />&#160;&#160;&#160;and so on<br /></code><code class="cCode">&gt; &quot;Queue capacity command: &quot; cmd /c date /t &gt; x.out</code></pre></div><p class="pBody"><a name="wp1012192"> </a>
To accomplish this task from a command file, say <code class="cCodeEmphasis">yourFile</code><code class="cCode">.cmd</code>, you would add the command <code class="cCode">date /t &gt; x.out</code> to <code class="cCodeEmphasis">yourFile</code><code class="cCode">.cmd</code> and then proceed as follows:
</p>
<a name="wp1012193"> </a><div class="pPreformatted"><pre>qmadmin<br />&gt; qopen <code class="cCodeEmphasis">yourQspace<br /></code>&gt; qchange <code class="cCodeEmphasis">yourQname<br /></code>&gt; <code class="cCodeEmphasis">go through all the setups... the threshold queue capacity warning,<br />&#160;&#160;&#160;and so on<br /></code>&gt; &quot;Queue capacity command: &quot; <code class="cCodeEmphasis">yourFile</code>.cmd</pre></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="qadm.html"><img id="LongDescNotReq7" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="qoview.html"><img id="LongDescNotReq8" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="qpgm.html"><img id="LongDescNotReq9" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
