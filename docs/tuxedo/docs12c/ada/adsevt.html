<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="3" />
<meta name="LOC_US_CHANGE" content="41998" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux12c/ada/fm/adsevt.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="06/28/12 11:40:32" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Subscribing to Events</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Administering an Oracle Tuxedo Application at Run Time
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="adevnt.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="admigt.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
&nbsp;
<a href="../pdf/ada.pdf" target="pdf"><img id="LongDescNotReq5" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq6" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1021377"> </a>
Subscribing to Events
</h1>
<p class="pBody"><a name="wp1020796"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1009746"> </a><a href="adsevt.html#wp1010399">Process of Using the EventBroker</a> </li>
<li><a name="wp1009769"> </a><a href="adsevt.html#wp1018704">How to Configure EventBroker Servers</a></li>
<li><a name="wp1011080"> </a><a href="adsevt.html#wp1010095">How to Set the Polling Interval</a></li>
<li><a name="wp1011117"> </a><a href="adsevt.html#wp1010594">Subscribing, Posting, and Unsubscribing to Events with the ATMI and the EVENT_MIB</a></li>
<li><a name="wp1022172"> </a><a href="adsevt.html#wp1022196">Subscribing, Posting, and Unsubscribing to Events across Domains</a></li>
<li><a name="wp1012489"> </a><a href="adsevt.html#wp1009421">How to Select a Notification Method</a></li>
<li><a name="wp1011112"> </a><a href="adsevt.html#wp1002005">How to Cancel a Subscription to an Event</a></li>
<li><a name="wp1013476"> </a><a href="adsevt.html#wp1011285">How to Use the EventBroker with Transactions</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1010399"> </a>
Process of Using the EventBroker
</h2><p class="pBody"><a name="wp1010440"> </a>
Use of the EventBroker requires the completion of several preparatory steps. The following flowchart lists these steps and indicates whether each step should be performed by an application administrator or programmer.
</p>
<p class="pGraphic"><a name="wp1019319"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/evproc.gif" height="175" width="374" usemap="#evproc_gif" alt="Notification Methods Supported by the EventBroker" id="wp1019293"/>
<map name="evproc_gif">
<area href="../adsevt.html#wplistofevents" shape="rect" coords="19,65,212,108" />
<area href="adsevt.html#wp1002005" shape="rect" coords="37,135,231,166" />
<area href="adsevt.html#wp1018704" shape="rect" coords="37,4,230,43" />
<area href="adsevt.html#wp1010095" shape="rect" coords="37,48,230,78" />
<area href="adsevt.html#wp1010594" shape="rect" coords="37,89,232,124" />
</map>
</div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1010085"> </a>
For instructions on any of these tasks, click on the appropriate box in the flowchart.
</p>
<a name="wp1016731"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>A good way to learn how the EventBroker works is by running bankapp, the sample application delivered with the Oracle Tuxedo system. To find out how to copy bankapp and run it as a demo, see <span class="cHyperlink">
<a href="../tutor/tutba.html">&#8220;Tutorial for bankapp,&#160;a Full C Application&#8221;</a></span> in <span style="font-style: italic">Tutorials for Developing  Oracle Tuxedo ATMI Applications&lt;Default ? Font&gt;</span><span style="font-style: normal">.</span></td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1018704"> </a>
How to Configure EventBroker Servers
</h2><p class="pBody"><a name="wp1019339"> </a>
A client accesses the EventBroker through either of two servers provided by the Oracle Tuxedo system: <a href="../rf5/rf5.html">TMUSREVT(5)</a>, which handles application events, and <a href="../rf5/rf5.html">TMSYSEVT(5)</a>, which handles system events. Both servers process events and trigger the sending of notification to subscribers.
</p>
<p class="pBody"><a name="wp1010090"> </a>
To set up the Oracle Tuxedo EventBroker on your system, you must configure either or both of these servers in the <code class="cCode">SERVERS</code> section of the <code class="cCode">UBBCONFIG</code> file, as shown in the following example.
</p>
<a name="wp1014248"> </a><div class="pPreformatted"><pre>  *SERVERS<br />    TMSYSEVT SRVGRP=ADMIN1 SRVID=100 RESTART=Y GRACE=900 MAXGEN=5 <br />      CLOPT=&quot;-A --&quot; <br />    TMSYSEVT SRVGRP=ADMIN2 SRVID=100 RESTART=Y GRACE=900 MAXGEN=5 <br />      CLOPT=&quot;-A -- -S -p 90&quot;</pre></div><a name="wp1014379"> </a><div class="pPreformatted"><pre>    TMUSREVT SRVGRP=ADMIN1 SRVID=100 RESTART=Y<br />      MAXGEN=5 GRACE=3600 <br />      CLOPT=&quot;-A --&quot; <br />    TMUSREVT SRVGRP=ADMIN2 SRVID=100 RESTART=Y<br />      MAXGEN=5 GRACE=3600 <br />      CLOPT=&quot;-A -- -S -p 120&quot;</pre></div><p class="pBody"><a name="wp1013806"> </a>
We recommend that you assign the principal server to the <code class="cCode">MASTER</code> site, even though either server can reside anywhere on your network.
</p>
<a name="wp1010480"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>You can reduce the network traffic caused by event postings and notifications by assigning secondary servers to other machines in your network. </td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1010095"> </a>
How to Set the Polling Interval
</h2><p class="pBody"><a name="wp1014165"> </a>
Periodically, the secondary server polls the primary server to obtain the current subscription list, which includes filtering and notification rules. By default, polling is done every 30 seconds. If necessary, however, you can specify a different interval.
</p>
<p class="pBody"><a name="wp1014019"> </a>
You can configure the polling interval (represented in seconds) with the <code class="cCode">-p</code> command-line option in <a href="../rf5/rf5.html">TMUSREVT(5)</a> or <a href="../rf5/rf5.html">TMSYSEV(5)</a> entries in the configuration file, as follows:
</p>
<a name="wp1014052"> </a><div class="pPreformatted"><pre>-p <span style="font-style: italic">poll_seconds</span></pre></div><p class="pBody"><a name="wp1014065"> </a>
It may appear that event messages are lost while subscriptions are being added and secondary servers are being updated.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1010594"> </a>
Subscribing, Posting, and Unsubscribing to Events with the ATMI and the EVENT_MIB
</h2><p class="pBody"><a name="wp1012113"> </a>
As the administrator for your Oracle Tuxedo application, you can enter subscription requests on behalf of a client or server process through calls to the <code class="cCode">T_EVENT_COMMAND</code> class of the <a href="../rf5/rf5.html">EVENT_MIB(5)</a>. You can also use invoke the <a href="../rf3c/rf3c.html">tpsubscribe(3c)</a> function to subscribe, programmatically, to an event.
</p>
<p class="pBody"><a name="wp1017532"> </a>
<a href="adsevt.html#wp1012114">Figure&#160;6-1</a> shows how clients and servers use the EventBroker to subscribe to events, to post events, and to unsubscribe to events.
</p>
<div class="pFigureTitle"><a name="wp1012114"> </a>
Figure&#160;6-1  Subscribing to an Event
</div>

 
 <p class="pGraphic"><a name="wp1012118"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/event1_1.gif" alt="Subscribing to an Event" id="wp1012116"/></div><p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1019228"> </a>
Identifying Event Categories Using eventexpr and filter
</h3>
<p class="pBody"><a name="wp1019229"> </a>
Clients or servers can subscribe to events by calling <a href="../rf3c/rf3c.html">tpsubscribe(3c)</a>. The <code class="cCode">tpsubscribe()</code> function takes one required argument: <code class="cCodeEmphasis">eventexpr</code>. The value of <code class="cCodeEmphasis">eventexpr</code> can be a wildcard string that identifies the set of event names about which the user wants to be notified. Wildcard strings are described on the <a href="../rf3c/rf3c.html">tpsubscribe(3c)</a> reference page in the Oracle Tuxedo ATMI C Function Reference&lt;Default ? Font&gt;.
</p>
<p class="pBody"><a name="wp1019233"> </a>
As an example, a user on a UNIX system platform who wants to be notified of all events related to the category of networking can specify the following value of <code class="cCodeEmphasis">eventexpr</code>:
</p>
<a name="wp1019234"> </a><div class="pPreformatted"><pre><code class="cCode">\.SysNetwork.*</code></pre></div><p class="pBody"><a name="wp1019235"> </a>
The backslash preceding the period (.) indicates that the period is literal. (Without the preceding backslash, the period (.) would match any character except the end-of-line character.) The combination <code class="cCode">.*</code> at the end of <code class="cCode">\.SysNetwork.*</code> matches zero or more occurrences of any character except the end-of-line character.
</p>
<p class="pBody"><a name="wp1019236"> </a>
In addition, clients or servers can filter event data by specifying the optional <code class="cCodeEmphasis">filter</code> argument when calling <code class="cCode">tpsubscribe()</code>. The value of <code class="cCodeEmphasis">filter</code> is a string containing a Boolean filter rule that must be evaluated successfully before the EventBroker posts the event.
</p>
<p class="pBody"><a name="wp1019237"> </a>
As an example, a user who wants to be notified <em class="cEmphasis">only</em> about system events having a severity level of <code class="cCode">ERROR</code> can specify the following value of <code class="cCodeEmphasis">filter</code>:
</p>
<a name="wp1019238"> </a><div class="pPreformatted"><pre><code class="cCode">&#8221;TA_EVENT_SEVERITY=&#8217;ERROR&#8217;&#8221;</code></pre></div><p class="pBody"><a name="wp1019239"> </a>
When an event name is posted that evaluates successfully against <code class="cCodeEmphasis">eventexpr</code>, the EventBroker tests the posted data against the filter rule associated with <code class="cCodeEmphasis">eventexpr</code>. If the data passes the filter rule or if there is no filter rule for the event, the subscriber receives a notification along with any data posted with the event.
</p>
<h3 class="pHeading2"><a name="wp1010096"> </a>
Accessing the EventBroker
</h3>
<p class="pBody"><a name="wp1012473"> </a>
Your application can access the EventBroker through either the ATMI or the <a href="../rf5/rf5.html">EVENT_MIB(5)</a>. <a href="adsevt.html#wp1022030">Table&#160;6-1</a> describes both methods.
</p>
<p class="pGraphic"><a name="wp1012140"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1022030table1012153"><caption><a name="wp1022030"> </a>
Table 6-1  <span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">Accessing the EventBroker</span>

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1012155"> </a>
Method
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1012157"> </a>
Function
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1012198"> </a>
Purpose
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="straddledcells" colspan="1" rowspan="3"><div class="pCellBody"><a name="wp1012159"> </a>
<b class="cBold">ATMI </b>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1012165"> </a>
<a href="../rf3c/rf3c.html">tppost(3c)</a>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018007"> </a>
Notifies the EventBroker, or posts an event and any accompanying data. The event is named by the <code class="cCodeEmphasis">eventname</code> argument and the <code class="cCodeEmphasis">data</code> argument, if not NULL, points to the data. The posted event and data are dispatched by the Oracle Tuxedo EventBroker to all subscribers with subscriptions that successfully evaluate against <code class="cCodeEmphasis">eventname</code> and optional filter rules that successfully evaluate against <code class="cCodeEmphasis">data</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1012169"> </a>
<a href="../rf3c/rf3c.html">tpsubscribe(3c)</a>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1012202"> </a>
Subscribes to an event or a set of events named by <code class="cCodeEmphasis">eventexpr</code>. Subscriptions are maintained by the Oracle Tuxedo EventBroker, and are used to notify subscribers when events are posted via <code class="cCode">tppost()</code>. Each subscription specifies one of the following notification methods: client notification, service calls, message enqueuing to stable-storage queues, executing of commands, and writing to the user log. Notification methods are determined by the subscriber&#8217;s process type (that is, whether the process is a client or a server) and the arguments passed to <code class="cCode">tpsubscribe()</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1012275"> </a>
<a href="../rf3c/rf3c.html">tpunsubscribe(3c)</a>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018108"> </a>
Removes an event subscription or a set of event subscriptions from the Oracle Tuxedo EventBroker&#8217;s list of active subscriptions. <code class="cCodeEmphasis">subscription</code> is an event subscription handle returned by <code class="cCode">tpsubscribe()</code>. Setting <code class="cCodeEmphasis">subscription</code> to the wildcard value, <code class="cCode">-1</code>, directs <code class="cCode">tpunsubscribe</code> to unsubscribe to all nonpersistent subscriptions previously made by the calling process. Nonpersistent subscriptions are those made without the <code class="cCode">TPEVPERSIST</code> bit setting in the <code class="cCode">ctl-&gt;flags</code> parameter of <code class="cCode">tpsubscribe()</code>. Persistent subscriptions can be deleted only by using the handle returned by <code class="cCode">tpsubscribe()</code>.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1012267"> </a>
<a href="../rf5/rf5.html">EVENT_MIB(5)</a>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1012269"> </a>
N/A
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1018210"> </a>
The <code class="cCode">EVENT_MIB</code> is a management information base (MIB) that stores subscription information and filtering rules. In your own application, you cannot define new events for the Oracle Tuxedo EventBroker using <code class="cCode">EVENT_MIB</code>, but you can customize the EventBroker to track events and notify subscribers of occurrences of special interest to the application.
</div>
<div class="pCellBody"><a name="wp1018211"> </a>
You can use the <code class="cCode">EVENT_MIB</code> to subscribe to an event, or to modify or cancel a subscription.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<a name="wp1011856"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td><a href="../rf3c/rf3c.html">tppost(3c)</a>, <a href="../rf3c/rf3c.html">tpsubscribe(3c)</a>, and <a href="../rf3c/rf3c.html">tpunsubscribe(3c)</a> are C functions. Equivalent routines (<a href="../rf3cbl/rf3cbl.html">TPPOST(3cbl)</a>, <a href="../rf3cbl/rf3cbl.html">TPSUBSCRIBE(3cbl)</a>, and <a href="../rf3cbl/rf3cbl.html">TPUNSUBSCRIBE(3cbl)</a>) are provided for COBOL programmers. See the Oracle Tuxedo ATMI C Function Reference&lt;Default ? Font&gt; and the Oracle Tuxedo ATMI COBOL Function Reference&lt;Default ? Font&gt; for details.</td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1022196"> </a>
Subscribing, Posting, and Unsubscribing to Events across Domains
</h2><h3 class="pHeading2"><a name="wp1022260"> </a>
Overview
</h3>
<p class="pBody"><a name="wp1022261"> </a>
Tuxedo is now equipped to subscribe, post, and unsubscribe brokered events in cross domain environment.
</p>
<p class="pBody"><a name="wp1022262"> </a>
To realize such feature, two new sections, DM_EVT_IN and DM_EVT_OUT, are added to DMCONFIG to manage static event in/out information.
</p>
<p class="pBody"><a name="wp1022263"> </a>
For details of <code class="cCode">DM_EVT_IN</code> and <code class="cCode">DM_EVT_OUT</code>, see &#8220;<code class="cHyperlinkCode">
<a href="../rf5/rf5.html">DMCONFIG(5)</a></code>&#8221; in <span style="font-style: italic">Tuxedo Reference Guide</span>.
</p>
<a name="wp1022246"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>In <code class="cCode">UBBCONFIG</code>, the <code class="cCode">EvtBroker</code> server should be configured prior to the <code class="cCode">GWT</code> server as <code class="cCode">GWT</code> will subscribe the configured events to the <code class="cCode">EvtBroker</code> when starting up.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1022387"> </a>
Configurations in DMCONFIG
</h3>
<h4 class="pHeading3"><a name="wp1022388"> </a>
How to Process Brokered Events Crossing Domains
</h4>
<p class="pBody"><a name="wp1022375"> </a>
<a href="adsevt.html#wp1022475">Figure&#160;6-2</a> as below illustrates a typical processing flow of subscribing, posting, and unsubscribing a brokered event in cross domain environment.
</p>
<div class="pFigureTitle"><a name="wp1022475"> </a>
Figure&#160;6-2  Cross Domain Event Overall Flow
</div>

 
 <p class="pBodyRelative"><a name="wp1022418"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/ada-06-1-3.gif" height="322" width="525" alt="Cross Domain Event Overall Flow" id="wp1022440"/></div><p class="pBodyRelative">

</p>
<h4 class="pHeading3"><a name="wp1022510"> </a>
How to Configure DMCONFIG &#8212; Case Study
</h4>
<p class="pBody"><a name="wp1022511"> </a>
This use case elaborates how to get <code class="cCode">DMCONFIG</code> well configured. 
</p>
<p class="pBody"><a name="wp1022512"> </a>
As shown on <a href="adsevt.html#wp1022475">Figure&#160;6-2</a>, two clients (Client A and Client B) are located in two domains (Domain A and Domain B), each has one machine within SHM mode (Machine A and Machine B). 
</p>
<p class="pBody"><a name="wp1022579"> </a>
For machine A, use <code class="cCode">dmloadcf</code> to create new <code class="cCode">BDMCONFIG</code> with additional configurations in <code class="cCode">DMCONFIG</code> as below, and then tmboot Tuxedo.
</p>
<a name="wp1022515"> </a><div class="pPreformatted"><pre>*DM_EVT_IN<br />MACHINEB_EVT<br />			LACCESSPOINT=DOMAINA</pre></div><a name="wp1022737"> </a><div class="pPreformatted"><pre>*DM_EVT_OUT<br />MACHINEA_EVT	<br />			LACCESSPOINT= DOMAINA<br />			RACCESSPOINT= DOMAINB                                           </pre></div><p class="pBody"><a name="wp1022738"> </a>
For machine B, use <code class="cCode">dmloadcf</code> to create new <code class="cCode">BDMCONFIG</code> with additional configurations in <code class="cCode">DMCONFIG</code> as below, and then tmboot Tuxedo.
</p>
<a name="wp1022518"> </a><div class="pPreformatted"><pre>*DM_EVT_IN<br />MACHINEA_EVT<br />                 LACCESSPOINT=DOMAINB</pre></div><a name="wp1022429"> </a><div class="pPreformatted"><pre>*DM_EVT_OUT<br />MACHINEB_EVT	<br />                 LACCESSPOINT= DOMAINB<br />                 RACCESSPOINT= DOMAINA</pre></div><p class="pBody"><a name="wp1022801"> </a>
After configuring as above, take a two-step test as below by two clients.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1022802"> </a>Client B issues <code class="cCode">tpsubscribe</code> (&#8220;<code class="cCode">MACHINEA_EVT</code>&#8221;) on Machine B;</li>
<li><a name="wp1022803"> </a>Client A issues <code class="cCode">tppost</code> (&#8220;<code class="cCode">MACHINEA_EVT</code>&#8221;) on Machine A.</li>
</ol></div>
<p class="pBody"><a name="wp1022804"> </a>
Result: Client B will receive the event <code class="cCode">MACHINEA_EVT</code> if <code class="cCode">DMCONFIG</code> is configured correctly.
</p>
<p class="pBody"><a name="wp1022805"> </a>
In cross domain environment, all events should be explicitly imported or exported &#8212; requests for an unknown domain will not be accepted. Once configured correctly, GWT server will automatically subscribe every configured event to the local Event Broker when Tuxedo starts up. When receiving a remote event message, local GWT will forward this request to Event Broker. On the other side, when a local event is posted, the Event Broker will forward this event to the local GWT which has subscribed such event. After that, the local GWT will forward this event to the configured remote domain&#8217;s GWT.
</p>
<h3 class="pHeading2"><a name="wp1022892"> </a>
Dynamically Modifying the Event Configurations
</h3>
<p class="pBody"><a name="wp1022893"> </a>
Besides allowing users to set up static configurations as above, Tuxedo provides two administration methods to dynamically modify the event configurations as needed without shutting the system down: dmadmin command and MIB operations.
</p>
<p class="pBody"><a name="wp1023372"> </a>
For &#8220;dmadmin&#8221; command, two sub-commands (&#8220;advertiseevent&#8221; and &#8220;unadvertiseevent&#8221;) and two sections (&#8220;EVENTS_IN&#8221; and &#8220;EVENTS_OUT&#8221;) are added to support the modification of event configurations dynamically. Related classes are added in MIB operations.
</p>
<p class="pBody"><a name="wp1023377"> </a>
For detailed information, see <code class="cHyperlinkCode">
<a href="../rfcm/rfcmd.html">dmadmin(1)</a></code> <span style="font-style: normal">in </span><span style="font-style: italic">Tuxedo Command Reference</span>, and <code class="cHyperlinkCode">
<a href="../rf5/rf5.html">DM_MIB(5)</a></code><span style="font-style: normal"> in </span><span style="font-style: italic">Tuxedo Reference Guide</span>.
</p>
<h3 class="pHeading2"><a name="wp1022896"> </a>
Interoperability
</h3>
<p class="pBody"><a name="wp1023060"> </a>
This feature is enabled from Tuxedo 12. To use this crossing domain event broker, two determinants should be taken into consideration - the version of <code class="cCode">GWT</code> and of EvtBroker.
</p>
<p class="pBody"><a name="wp1023093"> </a>
On one hand, the <code class="cCode">GWT</code> of local domain must be Tuxedo 12c version or above; otherwise, this feature will fail to be supported. On the other hand, the version of the EvtBroker also determines whether this feature can be well supported as following three scenarios:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1022898"> </a>If EvtBroker is within Tuxedo 12c version, the remote domain users can subscribe, post, and unsubscribe crossing domain events as discussed above. </li>
<li><a name="wp1022899"> </a>If the EvtBroker is lower than Tuxedo 12c, remote users must follow the two tips as below to  subscribe, post, and unsubscribe crossing domain events. </li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1022900"> </a>Tip 1: the parameter &#8220;eventexpr&#8221; in tpsubscribe() must be the &#8220;event_name&#8221; specified in DM_EVT_IN section other than the real event name.</li>
<li><a name="wp1022901"> </a>Tip 2: &#8220;EVT_EXPR&#8221; in DM_EVT_IN section takes no effect in this situation.</li>
</ul></div>
<li><a name="wp1022789"> </a>In a local domain, the co-existence of EvtBroker in different versions, say, one is in Tuxedo 12c while the other is in a lower version, is not recommended. </li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1009421"> </a>
How to Select a Notification Method
</h2><p class="pBody"><a name="wp1010919"> </a>
The EventBroker supports a variety of methods for notifying subscribers of events, as shown in <a href="adsevt.html#wp1015367">Figure&#160;6-3</a>. 
</p>
<div class="pFigureTitle"><a name="wp1015367"> </a>
Figure&#160;6-3  Notification Methods Supported by the EventBroker
</div>

 
 <p class="pGraphic"><a name="wp1015371"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/event.gif" alt="Notification Methods Supported by the EventBroker" id="wp1015369"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1015347"> </a>
Whichever notification method you choose, the procedure for implementing it is the same: in your call to <code class="cCode">tpsubscribe()</code>, specify an argument that refers to a structure of type <code class="cCode">TPEVCTL</code>. 
</p>
<p class="pBody"><a name="wp1015481"> </a>
If the value of the argument is NULL, the EventBroker sends an unsolicited message to the subscriber. Two of these methods, having the notification sent to a service and having it sent to a queue in stable storage, cannot be requested directly by a client. Instead, a client must invoke a service routine to subscribe on its behalf.
</p>
<p class="pBody"><a name="wp1015548"> </a>
For each subscription, you can select any of the following notification methods. The EventBroker can:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1017615"> </a><span style="font-style: normal">Notify the client</span>&#8212;the EventBroker keeps track of events in which the client is interested and sends unsolicited notifications to the client when they occur. Some events are anonymously posted. A client can join an application, regardless of whether any other clients have subscribed, and post events to the EventBroker. The EventBroker matches these events against its database of subscriptions and sends an unsolicited notification to the appropriate clients. (See the definition of the <code class="cCode">T_EVENT_CLIENT</code> class in the <a href="../rf5/rf5.html">EVENT_MIB(5)</a> entry in the File Formats, Data Descriptions, MIBs, and System Processes Reference&lt;Default ? Font&gt;.)</li>
<li><a name="wp1017619"> </a><span style="font-style: normal">Invoke a service</span>&#8212;if a subscriber wants event notifications to be sent to service calls, then the <code class="cCode">ctl</code> parameter must point to a valid <code class="cCode">TPEVCTL</code> structure. (See the definition of the <code class="cCode">T_EVENT_SERVICE</code> class in the <a href="../rf5/rf5.html">EVENT_MIB(5)</a> entry in the File Formats, Data Descriptions, MIBs, and System Processes Reference&lt;Default ? Font&gt;.)</li>
<li><a name="wp1015620"> </a><span style="font-style: normal">Enqueue messages to stable-storage queues</span>&#8212;for subscriptions to stable-storage queues, a queue space, queue name, and correlation identifier are specified, in addition to values for <code class="cCode">eventexpr</code> and <code class="cCode">filter</code>, so that matching can be performed. The correlation identifier can be used to differentiate among several subscriptions characterized by the same event expression and filter rule, and destined for the same queue. (See the definition of the <code class="cCode">T_EVENT_QUEUE</code> class in the <a href="../rf5/rf5.html">EVENT_MIB(5)</a> entry in the File Formats, Data Descriptions, MIBs, and System Processes Reference&lt;Default ? Font&gt;.)</li>
<li><a name="wp1010802"> </a><span style="font-style: normal">Execute commands</span>&#8212;using the <code class="cCode">T_EVENT_COMMAND</code> class of the <code class="cCode">EVENT_MIB</code>, subscribers can invoke an executable process. When a match is found, the data is used as the name of the executable process and any required options. (See the definition of the <code class="cCode">T_EVENT_COMMAND</code> class in the <a href="../rf5/rf5.html">EVENT_MIB(5)</a> entry in the File Formats, Data Descriptions, MIBs, and System Processes Reference&lt;Default ? Font&gt;.)</li>
<li><a name="wp1010796"> </a><span style="font-style: normal">Write messages to the user log (</span><span style="font-style: normal">ULOG)</span>&#8212;using the <code class="cCode">T_EVENT_USERLOG</code> class of the <code class="cCode">EVENT_MIB</code>, subscribers can write system <code class="cCode">USERLOG</code> messages. When events are detected and matched, they are written to the <code class="cCode">USERLOG</code>. (See the definition of the <code class="cCode">T_EVENT_USERLOG</code> class in the <a href="../rf5/rf5.html">EVENT_MIB(5)</a> entry in the File Formats, Data Descriptions, MIBs, and System Processes Reference&lt;Default ? Font&gt;.)</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1002005"> </a>
How to Cancel a Subscription to an Event
</h2><p class="pBody"><a name="wp1010895"> </a>
When a client leaves an application by calling <a href="../rf3c/rf3c.html">tpterm(3c)</a>, all of its subscriptions are <em class="cEmphasis">canceled</em> unless the subscription is specified as persistent. (If persistent, the subscription continues to receive postings even after a client performs a <code class="cCode">tpterm()</code>.) If the client later rejoins the application and wants to renew those subscriptions, it must subscribe again. 
</p>
<p class="pBody"><a name="wp1019915"> </a>
A well-behaved client unsubscribes before calling <code class="cCode">tpterm()</code>. This is accomplished by issuing a <a href="../rf3c/rf3c.html">tpunsubscribe(3c)</a> call before leaving an application.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1011285"> </a>
How to Use the EventBroker with Transactions
</h2><p class="pBody"><a name="wp1014536"> </a>
Special handling is needed to use the EventBroker with transactions.
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1015798"> </a>Before you can use the EventBroker with transactions, you must configure the <code class="cCode">NULL_TMS</code> parameter with the <a href="../rf5/rf5.html">TMUSREVT(5)</a> server for the server groups in which the EventBroker is running.</li>
<li><a name="wp1015839"> </a>The advantage of posting an event in a transaction is that all of the work, including work not related to the posting, is guaranteed to be complete if the transaction is successful. If any work performed within the transaction fails, it is guaranteed that all the work done within the transaction will be rolled back. The disadvantage is that the poster takes a risk that something may cause the transaction to be aborted, and the posting will be lost.</li>
<li><a name="wp1015842"> </a>To specify that a subscription is part of a transaction, use the <code class="cCode">TPEVTRAN</code> flag with <a href="../rf3c/rf3c.html">tpsubscribe(3c)</a>. If the subscription is made transactionally, the action taken in response to an event will be part of the caller&#8217;s transaction.</li>
<a name="wp1014538"> </a><table class="ListNote">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>This method can be used only for subscriptions that cause an Oracle Tuxedo service to be invoked, or that cause a record to be enqueued on a permanent queue. </td>
</tr>
</table>

</ul></div>
<h3 class="pHeading2"><a name="wp1011998"> </a>
How Transactions Work with the EventBroker
</h3>
<p class="pBody"><a name="wp1014604"> </a>
If both a poster and a subscriber agree to link their transactions, they create a form of voting. The poster makes an assertion that something is true and infects the message with this transaction. (In other words, the message that leaves the originating process is marked as being associated with the transaction.) The transaction goes to the EventBroker. 
</p>
<p class="pBody"><a name="wp1015851"> </a>
The EventBroker&#8217;s actions, such as calling the service or putting a message in the queue for the subscriber, are also part of the same transaction. If a service routine that is running encounters an error, it can fail the transaction, rolling back everything, including all other transactional subscriptions and the poster&#8217;s original transaction, which might have invoked other services and performed other database work. The poster makes an assertion (&#8220;I&#8217;m about to do this&#8221;), provides data, and links the data to its transaction. 
</p>
<p class="pBody"><a name="wp1013632"> </a>
A number of anonymous subscribers, that is, subscribers about which the poster knows nothing, are invoked transactionally. If any subscriber fails to link its work with the poster&#8217;s work, the whole transaction is rolled back. All transactional subscribers must agree to link their work with the poster&#8217;s work, or all the work is rolled back. If a poster has not allowed the posting to participate in its transaction, the EventBroker starts a separate transaction, and gathers all the transactional subscriptions into that transaction. If any of these transactions fail, all the work done on behalf of the transactional subscriptions is rolled back, but the poster&#8217;s transaction is not rolled back. This process is controlled by the <code class="cCode">TPEVTRAN</code> flag.
</p>
<h4 class="pHeading3"><a name="wp1011999"> </a>
Example of Using the EventBroker with Transactions
</h4>
<p class="pBody"><a name="wp1011336"> </a>
A stock trade is about to be completed by a brokerage application. A number of database records have been updated by various services during the trade transaction. A posting states that the trade is about to happen. 
</p>
<p class="pBody"><a name="wp1017211"> </a>
An application responsible for maintaining an audit trail of such trades has subscribed to this event. Specifically, the application has requested the placement of a record in a specified queue whenever an event of this type is posted. A service routine responsible for determining whether trades can be performed, also subscribes to this type of event; it, too, is notified whenever such a trade is proposed.
</p>
<p class="pBody"><a name="wp1020065"> </a>
If all goes well, the trade is completed and an audit trail is made.
</p>
<p class="pBody"><a name="wp1017220"> </a>
If an error occurs in the queue and no audit trail can be made, the entire stock trade is rolled back. Similarly, if the service routine fails, the transaction is rolled back. If all is successful, the trade is made and the transaction is committed.
</p>
<h3 class="pHeading2"><a name="wp1009588"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1020126"> </a><a href="adevnt.html#wp1015305"><span class="cHyperlink">
&#8220;What Is the EventBroker?&#8221; on page&#160;5-2</span></a></li>
<li><a name="wp1022134"> </a><span class="cHyperlink">
<a href="../int/intman.html">&#8220;Managing Events Using EventBroker&#8221;</a></span> in Introducing Oracle Tuxedo ATMI&lt;Default ? Font&gt;</li>
<li><a name="wp1022137"> </a><span class="cHyperlink">
<a href="../tutor/tutov.html">&#8220;Using Event-based Communication&#8221;</a></span> in Tutorials for Developing  Oracle Tuxedo ATMI Applications&lt;Default ? Font&gt;</li>
<li><a name="wp1020231"> </a><a href="../rf3c/rf3c.html">tppost(3c)</a>, <a href="../rf3c/rf3c.html">tpsubscribe(3c)</a>, and <a href="../rf3c/rf3c.html">tpunsubscribe(3c)</a> in the Oracle Tuxedo ATMI C Function Reference&lt;Default ? Font&gt;</li>
<li><a name="wp1020492"> </a><a href="../rf3cbl/rf3cbl.html">TPPOST(3cbl)</a>, <a href="../rf3cbl/rf3cbl.html">TPSUBSCRIBE(3cbl)</a>, and <a href="../rf3cbl/rf3cbl.html">TPUNSUBSCRIBE(3cbl)</a> in the Oracle Tuxedo ATMI COBOL Function Reference&lt;Default ? Font&gt;</li>
<li><a name="wp1020171"> </a><a href="../rf5/rf5.html">EVENT_MIB(5)</a>, <a href="../rf5/rf5.html">EVENTS(5)</a>, <a href="../rf5/rf5.html">TMSYSEVT(5)</a>, and <a href="../rf5/rf5.html">TMUSREVT(5)</a> in the File Formats, Data Descriptions, MIBs, and System Processes Reference&lt;Default ? Font&gt;</li>
</ul></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="adsevt.html"><img id="LongDescNotReq7" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="adevnt.html"><img id="LongDescNotReq8" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="admigt.html"><img id="LongDescNotReq9" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
