<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="3" />
<meta name="LOC_US_CHANGE" content="41861" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux12c/jdg/fm/dvlibrary.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="06/26/12 11:23:01" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Using the Jolt Class Library</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Using Oracle Jolt
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="dvrepos.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="dvbeans.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/jdg.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1073620"> </a>
Using the Jolt Class Library
</h1>
<p class="pBody"><a name="wp1007345"> </a>
The Oracle Jolt Class Library provides developers with a set of object-oriented Java language classes for accessing Oracle Tuxedo services. The class library contains the class files that implement the Jolt API. Using these classes, you can extend applications for Internet and intranet transaction processing. You can use the Jolt Class Library to customize access to Oracle Tuxedo services from Java applets.
</p>
<p class="pBody"><a name="wp1051983"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018880"> </a><a href="dvlibrary.html#wp1007375">Class Library Functionality Overview</a></li>
<li><a name="wp1018882"> </a><a href="dvlibrary.html#wp1007576">Jolt Object Relationships</a></li>
<li><a name="wp1018886"> </a><a href="dvlibrary.html#wp1007716">Jolt Class Library Walkthrough</a></li>
<li><a name="wp1018888"> </a><a href="dvlibrary.html#wp1054085">Using Oracle Tuxedo Buffer Types with Jolt</a></li>
<li><a name="wp1018890"> </a><a href="dvlibrary.html#wp1074262">Multithreaded Applications</a></li>
<li><a name="wp1018892"> </a><a href="dvlibrary.html#wp1012983">Event Subscription and Notifications</a></li>
<li><a name="wp1018894"> </a><a href="dvlibrary.html#wp1008811">Clearing Parameter Values</a></li>
<li><a name="wp1018896"> </a><a href="dvlibrary.html#wp1008320">Reusing Objects</a></li>
<li><a name="wp1018898"> </a><a href="dvlibrary.html#wp1008459">Deploying and Localizing Jolt Applets</a></li>
<li><a name="wp1075174"> </a><a href="dvlibrary.html#wp1074966">Using SSL</a></li>
</ul></div>
<p class="pBody"><a name="wp1007370"> </a>
To use the information in the following sections, you need to be generally familiar with the Java programming language and object-oriented programming concepts. All the programming examples are in Java code.
</p>
<a name="wp1007371"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>All program examples are only fragments used to illustrate Jolt capabilities. They are not intended to be compiled and run as provided. These program examples require additional code to be fully executable. </td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1007375"> </a>
Class Library Functionality Overview
</h2><p class="pBody"><a name="wp1007376"> </a>
The Jolt Class Library gives the Oracle Tuxedo application developer the tools to develop client-side applications or applets that run as independent Java applications or in a Java-enabled Web browser. The <code class="cCode">bea.jolt</code> package contains the Jolt Class Library. To use the Jolt Class Library, the client program or applet must import this package. For an example of how to import the <code class="cCode">bea.jolt</code> package, refer to the listing <a href="dvlibrary.html#wp1007810">Jolt Transfer of Funds Example (SimXfer.java)</a>.
</p>
<h3 class="pHeading2"><a name="wp1007384"> </a>
Java Applications Versus Java Applets
</h3>
<p class="pBody"><a name="wp1007385"> </a>
Java programs that run in a browser are called applets. Applets are small, easily downloaded parts of an overall application that perform specific functions. Many popular browsers impose limitations on the capabilities of Java applets in order to provide a high degree of security for the users of the browser. Applets have the following restrictions:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1007386"> </a>An applet ordinarily cannot read or write files on any host system.</li>
<li><a name="wp1007387"> </a>An applet cannot start any program on the host (client) that is executing the applet.</li>
<li><a name="wp1007388"> </a>An applet can make a network connection only to the host from which the applet originated; it cannot make other network connections, not even to the client machine.</li>
</ul></div>
<p class="pBody"><a name="wp1007389"> </a>
Programming workarounds exist for most restrictions on Java applets. Check your browser&#8217;s Web site (for example, www.netscape.com or www.microsoft.com) or developer documentation for specific information about the applet capabilities that the browser supports or restricts. You can also use Jolt Relay to work around some of the network connection restrictions.
</p>
<p class="pBody"><a name="wp1007390"> </a>
A Java application, however, is not run in the context of a browser and is not restricted in the same ways. For example, a Java application can start another application on the host machine where it is executing. While an applet relies on the windowing environment of a browser or appletviewer for much of its user interface, a Java application requires that you create your own user interface. An applet is designed to be small and highly portable. A Java application, on the other hand, can operate much like any other non-Java program. The security restrictions for applets imposed by various browsers and the scope of the two program types are the most important differences between a Java application and a Java applet.
</p>
<h3 class="pHeading2"><a name="wp1007391"> </a>
Jolt Class Library Features
</h3>
<p class="pBody"><a name="wp1007392"> </a>
The Jolt Class Library has the following characteristics:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1007393"> </a>Features fully thread-safe classes.</li>
<li><a name="wp1007394"> </a>Encapsulates typical transaction functions such as logon, synchronous calling, transaction begin, commit, rollback, and logoffs as Java objects.</li>
<li><a name="wp1007395"> </a>Contains methods that allow you to set idle timeouts for continuous and intermittent client network connections.</li>
<li><a name="wp1010135"> </a>Features methods that allow a Jolt client to subscribe to and receive event-based notifications.</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1007399"> </a>
Error and Exception Handling
</h3>
<p class="pBody"><a name="wp1070580"> </a>
The Jolt Class Library returns both Jolt interpreter and Oracle Tuxedo errors as exceptions. The Jolt Class Library Reference contains the Jolt classes and lists the errors or exceptions thrown for each class. The <em class="cEmphasis">Oracle Jolt API Reference</em> contains the Error and Exception Class Reference.
</p>
<h3 class="pHeading2"><a name="wp1007404"> </a>
Jolt Client/Server Relationship
</h3>
<p class="pBody"><a name="wp1007406"> </a>
Oracle Jolt works in a distributed client/server environment and connects Java clients to Oracle Tuxedo-based applications. 
</p>
<p class="pBody"><a name="wp1057120"> </a>
<a href="dvlibrary.html#wp1007411">Figure&#160;5-1</a> illustrates the client/server relationship between a Jolt program and the Jolt Server.
</p>
<div class="pFigureTitle"><a name="wp1007411"> </a>
Figure&#160;5-1  Jolt Client/Server Relationship
</div>

 
 <p class="pBody"><a name="wp1007454"> </a>
As illustrated in the figure, the Jolt Server acts as a proxy for a native Oracle Tuxedo client, implementing functionality available through the native Oracle Tuxedo client. The Oracle Jolt Server accepts requests from Oracle Jolt clients and maps those requests into Oracle Tuxedo service requests through the Oracle Tuxedo ATMI interface. Requests and associated parameters are packaged into a message buffer and delivered over the network to the Oracle Jolt Server. The Oracle Jolt Connection Manager handles all communication between the Oracle Jolt Server and the Oracle Jolt applet using the Oracle Jolt Transaction Protocol. The Oracle Jolt Server unpacks the data from the message, performs any necessary data conversions, such as numeric format conversions or character set conversions, and makes the appropriate service request to Oracle Tuxedo as specified by the message. 
</p>
<p class="pBody"><a name="wp1007462"> </a>
Once a service request enters the Oracle Tuxedo system, it is executed in exactly the same manner as any other Oracle Tuxedo request. The results are returned through the ATMI interface to the Oracle Jolt Server, which packages the results and any error information into a message that is sent to the Oracle Jolt client applet. The Oracle Jolt client then maps the contents of the message into the various Oracle Jolt client interface objects, completing the request.
</p>
<p class="pBody"><a name="wp1007465"> </a>
On the client side, the user program contains the client application code. The Jolt Class Library packages a JoltSession and JoltTransaction, which in turn handle service requests. 
</p>
<p class="pBody"><a name="wp1007467"> </a>
<a href="dvlibrary.html#wp1055290">Table&#160;5-1</a> describes the client-side requests and Jolt Server-side actions in a simple example program.
</p>
<p class="pGraphic"><a name="wp1007554"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1055290table1007468"><caption><a name="wp1055290"> </a>
Table 5-1  Jolt Client/Server Interaction

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th colspan="2" rowspan="1"><div class="pCellHeading"><a name="wp1055297"> </a>
Jolt Client
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1055303"> </a>
Jolt Server
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055305"> </a>
1
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055307"> </a>
<code class="cCode">attr=new JoltSessionAttributes();</code>
</div>
<div class="pCellBody"><a name="wp1055308"> </a>
<code class="cCode">attr.setString(attr.APPADDRESS, &#8220;//myhost:8000&#8221;);</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055310"> </a>
Binds the client to the Oracle Tuxedo environment
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055312"> </a>
2
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055314"> </a>
<code class="cCode">session=new JoltSession(attr, username, userRole, userPassword, appPassword);</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055317"> </a>
Logs the client onto Oracle Tuxedo
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055319"> </a>
3
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055321"> </a>
<code class="cCode">withdrawal=new JoltRemoteService( servname, session );</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055324"> </a>
Looks up the service attributes in the Repository
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055327"> </a>
4
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055329"> </a>
<code class="cCode">withdrawal.addString(&#8220;accountnumber&#8221;, &#8220;123&#8221;);</code>
</div>
<div class="pCellBody"><a name="wp1055330"> </a>
<code class="cCode">withdrawal.addFloat(&#8220;amount&#8221;, (float) 100.00);</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055333"> </a>
Populates variables in the client (no Jolt Server activity)
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055335"> </a>
5
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055337"> </a>
<code class="cCode">trans=new JoltTransaction( time-out, session);</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055342"> </a>
Begins a new Tuxedo transaction
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055344"> </a>
6
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055346"> </a>
<code class="cCode">withdrawal.call(trans);</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055348"> </a>
Executes the Oracle Tuxedo service
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055350"> </a>
7
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055352"> </a>
<code class="cCode">trans.commit() or trans.rollback();</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055356"> </a>
Completes or rolls back transaction
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055358"> </a>
8
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055360"> </a>
<code class="cCode">balance=withdrawal.getFloatDef(&#8220;balance,&#8221; (float) 0.0);</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055362"> </a>
Retrieves the results (no Jolt Server activity)
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055364"> </a>
9
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055366"> </a>
<code class="cCode">session.endSession();</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1055369"> </a>
Logs the client off of Oracle Tuxedo
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1056822"> </a>
The following tasks summarize the interaction shown in the previous table, <a href="dvlibrary.html#wp1055290">Jolt Client/Server Interaction.</a>
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1056824"> </a>Bind the client to the Oracle Tuxedo environment using the <code class="cCode">JoltSessionAttributes</code> class.</li>
<li><a name="wp1007562"> </a>Establish a session.</li>
<li><a name="wp1007563"> </a>Set variables.</li>
<li><a name="wp1018488"> </a>Perform the necessary transaction processing.</li>
<li><a name="wp1007564"> </a>Log the client off of the Oracle Tuxedo system. </li>
</ol></div>
<p class="pBody"><a name="wp1007566"> </a>
Each of these activities is handled through the use of the Jolt Class Library classes. These classes include methods for setting and clearing data and for handling remote service actions. <a href="dvlibrary.html#wp1007576">Jolt Object Relationships</a> describes the Jolt Class Library classes in more detail.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1007576"> </a>
Jolt Object Relationships
</h2><p class="pBody"><a name="wp1007577"> </a>
<a href="dvlibrary.html#wp1007579">Figure&#160;5-2</a> illustrates the relationship between the instantiated objects of the Jolt Class Library classes.
</p>
<div class="pFigureTitle"><a name="wp1007579"> </a>
Figure&#160;5-2  Jolt Object Relationships
</div>

 
 <p class="pGraphic"><a name="wp1007647"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/jdg-5-1-02.gif" height="318" width="521" alt="Jolt Object Relationships" id="wp1007581"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1070225"> </a>
As objects, the Jolt classes interact in various relationships with each other. In the previous figure, the relationships are divided into three basic categories:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1070227"> </a>Contains-a relationship&#8212;at the class level an object can contain other objects. For example, a JoltTransaction stores (or contains) a JoltSession object. </li>
<li><a name="wp1007658"> </a>Is-a relationship&#8212;the is-a relationship usually occurs at the class instance or sub-object level and denotes that the object is an instance of a particular object.</li>
<li><a name="wp1007659"> </a>Uses-a relationship&#8212;an object can use another object without containing it. For example, a JoltSession can use the JoltSessionAttributes object to obtain the host and port information.</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1007716"> </a>
Jolt Class Library Walkthrough
</h2><p class="pBody"><a name="wp1059081"> </a>
Use Jolt classes to perform the basic functions of transaction processing: logon/logoff; synchronous service calling; transaction begin, commit, and rollback. The following sections describe how Jolt classes are used to perform these functions.
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1059255"> </a><a href="dvlibrary.html#wp1059899">Logon and Logoff</a></li>
<li><a name="wp1059260"> </a><a href="dvlibrary.html#wp1059101">Synchronous Service Calling</a></li>
<li><a name="wp1059265"> </a><a href="dvlibrary.html#wp1059276">Transaction Begin, Commit, and Rollback</a></li>
</ul></div>
<p class="pBody"><a name="wp1059776"> </a>
You can also use the Jolt class library to develop multithreaded applications, define Tuxedo buffer types, and subscribe to events and unsolicited messages. These functions are discussed in later sections.
</p>
<h3 class="pHeading2"><a name="wp1059899"> </a>
Logon and Logoff 
</h3>
<p class="pBody"><a name="wp1059087"> </a>
The client application must log on to the Oracle Tuxedo environment prior to initiating any transaction activity. The Jolt Class Library provides the JoltSessionAttributes class and JoltSession class to establish a connection to an Oracle Tuxedo system.
</p>
<p class="pBody"><a name="wp1059096"> </a>
The JoltSessionAttributes class will contain the connection properties of Jolt and Oracle Tuxedo systems as well as various other properties of the two systems. To establish a connection, the client application must create an instance of the JoltSession class. This instance is the JoltSession object. After the developer instantiates a Jolt Session and Oracle Tuxedo object, the Jolt and Oracle Tuxedo logon capability is enabled. Calling the endSession method ends the session and allows the user to log off.
</p>
<h3 class="pHeading2"><a name="wp1059101"> </a>
Synchronous Service Calling
</h3>
<p class="pBody"><a name="wp1059102"> </a>
Transaction activities such as requests and replies are handled through a JoltRemoteService object (an instance of the JoltRemoteService class). Each JoltRemoteService object refers to an exported Oracle Tuxedo request/reply service. You must provide a service name and a JoltSession object to instantiate a JoltRemoteService object before it can be used. 
</p>
<p class="pBody"><a name="wp1059109"> </a>
To use a JoltRemoteService object:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1059110"> </a>Set the input parameters.</li>
<li><a name="wp1059111"> </a>Invoke the service.</li>
<li><a name="wp1059112"> </a>Examine the output parameters.</li>
</ol></div>
<p class="pBody"><a name="wp1059113"> </a>
For efficiency, Jolt does not make a copy of any input parameter object; only the references to the object (for example, string and byte array) are saved. Because JoltRemoteService object is a stateful object, its input parameters and the request attributes are retained throughout the life of the object. You can use the <code class="cCode">clear()</code> method to reset the attributes and input parameters before reusing the JoltRemoteService object.
</p>
<p class="pBody"><a name="wp1059270"> </a>
Because Jolt is designed for a multithreaded environment, you can invoke multiple JoltRemoteService objects simultaneously by using the Java multithreading capability. Refer to <a href="dvlibrary.html#wp1074262">Multithreaded Applications</a> for additional information.
</p>
<h3 class="pHeading2"><a name="wp1059276"> </a>
Transaction Begin, Commit, and Rollback
</h3>
<p class="pBody"><a name="wp1059279"> </a>
In Jolt, a transaction is represented as an object of the class JoltTransaction. The transaction begins when the transaction object is instantiated. The transaction object is created with a timeout and JoltSession object parameter:
</p>
<a name="wp1059126"> </a><div class="pPreformatted"><pre>trans = new JoltTransaction(timeout, session)</pre></div><p class="pBody"><a name="wp1059127"> </a>
Jolt uses an explicit transaction model for any services involved in a transaction. The transaction service invocation requires a JoltTransaction object as a parameter. Jolt also requires that the service and the transaction belong to the same session. Jolt does <em class="cEmphasis">not </em>allow you to use services and transactions that are not bound to the same session.
</p>
<p class="pBody"><a name="wp1059076"> </a>
The sample code in the listing <a href="dvlibrary.html#wp1007810">Jolt Transfer of Funds Example (SimXfer.java)</a> describes how to use the Jolt Class Library and includes the use of the JoltSessionAttributes, JoltSession, JoltRemoteService, and JoltTransaction classes. 
</p>
<p class="pBody"><a name="wp1007732"> </a>
The same sample combines two user-defined Oracle Tuxedo services (WITHDRAWAL and DEPOSIT) to perform a simulated TRANSFER transaction. If the WITHDRAWAL operation fails, a rollback is performed. Otherwise, a DEPOSIT is performed and a commit completes the transaction. 
</p>
<p class="pBody"><a name="wp1007733"> </a>
The following programming steps describe the transaction process shown in the sample code listing <a href="dvlibrary.html#wp1007810">Jolt Transfer of Funds Example (SimXfer.java)</a>:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1007738"> </a>Set the connection attributes like <code class="cCodeEmphasis">hostnam</code><code class="cCode">e</code> and <code class="cCodeEmphasis">portnumber</code> in the JoltSessionAttribute object. </li>
<p class="pBodyRelative"><a name="wp1055033"> </a>
Refer to this line in the following code listing:
</p>
<a name="wp1007743"> </a><div class="pPreformattedRelative"><pre>sattr = new JoltSessionAttributes();</pre></div><li><a name="wp1007744"> </a>The <code class="cCode">sattr.checkAuthenticationLevel()</code> allows the application to determine the level of security required to log on to the server. </li>
<p class="pBodyRelative"><a name="wp1055034"> </a>
Refer to this line in the following code listing:
</p>
<a name="wp1007749"> </a><div class="pPreformattedRelative"><pre>switch (sattr.checkAuthenticationLevel())</pre></div><li><a name="wp1007750"> </a>The logon is accomplished by instantiating a JoltSession object. </li>
<p class="pBodyRelative"><a name="wp1055035"> </a>
Refer to these lines in the following code listing: 
</p>
<a name="wp1007755"> </a><div class="pPreformattedRelative"><pre>session = new JoltSession (sattr, <code class="cCodeEmphasis">userName</code>, <code class="cCodeEmphasis">userRole</code>, <br /><code class="cCodeEmphasis">userPassword</code>, <code class="cCodeEmphasis">appPassword</code>);</pre></div><p class="pBodyRelative"><a name="wp1007756"> </a>
This example does not explicitly catch <code class="cCode">SessionException</code> errors.
</p>
<li><a name="wp1007759"> </a>All JoltRemoteService calls require a service to be specified and the session key returned from <code class="cCode">JoltSession()</code>. </li>
<p class="pBodyRelative"><a name="wp1055036"> </a>
Refer to these lines in the following code listing:
</p>
<a name="wp1007764"> </a><div class="pPreformattedRelative"><pre>withdrawal = new JoltRemoteService(&#8220;WITHDRAWAL&#8221;, session);</pre></div><a name="wp1007766"> </a><div class="pPreformattedRelative"><pre>deposit = new JoltRemoteService(&#8220;DEPOSIT&#8221;, session);</pre></div><p class="pBodyRelative"><a name="wp1012197"> </a>
These calls bind the service definition of both the WITHDRAWAL and DEPOSIT services, which are stored in the Jolt Repository, to the withdrawal and deposit objects, respectively. The services WITHDRAWAL and DEPOSIT must be defined in the Jolt Repository; otherwise a ServiceException is thrown. This example does not explicitly catch ServiceException errors.
</p>
<li><a name="wp1007770"> </a>Once the service definitions are returned, the application-specific fields such as account number ACCOUNT_ID and withdrawal amount SAMOUNT are automatically populated. </li>
<p class="pBodyRelative"><a name="wp1055037"> </a>
Refer to these lines in the following code listing:
</p>
<a name="wp1007775"> </a><div class="pPreformattedRelative"><pre>withdrawal.addInt(&#8220;ACCOUNT_ID&#8221;, 100000);</pre></div><a name="wp1007777"> </a><div class="pPreformattedRelative"><pre>withdrawal.addString(&#8220;SAMOUNT&#8221;, &#8220;100.00&#8221;);</pre></div><p class="pBodyRelative"><a name="wp1007778"> </a>
The <code class="cCode">add*()</code> methods can throw <code class="cCode">IllegalAccessError</code> or <code class="cCode">NoSuchFieldError</code> exceptions.
</p>
<li><a name="wp1007779"> </a>The JoltTransaction call allows a timeout to be specified if the transaction does not complete within the specified time. </li>
<p class="pBodyRelative"><a name="wp1055038"> </a>
Refer to this line in the following code listing:
</p>
<a name="wp1007784"> </a><div class="pPreformattedRelative"><pre>trans = new JoltTransaction(5,session);</pre></div><li><a name="wp1007785"> </a>Once the withdrawal service definition is automatically populated, the withdrawal service is invoked by calling the <code class="cCode">withdrawal.call(trans)</code> method. </li>
<p class="pBodyRelative"><a name="wp1055039"> </a>
Refer to this line in the following code listing:
</p>
<a name="wp1007790"> </a><div class="pPreformattedRelative"><pre>withdrawal.call(trans);</pre></div><li><a name="wp1007793"> </a>A failed WITHDRAWAL can be rolled back. </li>
<p class="pBodyRelative"><a name="wp1055040"> </a>
Refer to this line in the following code listing: 
</p>
<a name="wp1007796"> </a><div class="pPreformattedRelative"><pre>trans.rollback();</pre></div><li><a name="wp1007797"> </a>Otherwise, once the DEPOSIT is performed, all the transactions are committed. Refer to these lines in the following code listing:</li>
<a name="wp1007802"> </a><div class="pPreformattedRelative"><pre>deposit.call(trans);</pre></div><a name="wp1007804"> </a><div class="pPreformattedRelative"><pre>trans.commit();</pre></div></ol></div>
<p class="pBody"><a name="wp1007808"> </a>
<a href="dvlibrary.html#wp1007810">Listing&#160;5-1</a> shows an example of a simple application for the transfer of funds using the Jolt classes. 
</p>
<div class="pCodeTitle"><a name="wp1007810"> </a>
Listing&#160;5-1	   Jolt Transfer of Funds Example (SimXfer.java)
</div> <a name="wp1018501"> </a><div class="pPreformatted"><pre>/* Copyright 1999 Oracle Systems, Inc.  All Rights Reserved */<br />import bea.jolt.*;<br />public class SimXfer<br />{<br />    public static void main (String[] args)<br />    {<br />        JoltSession&#160;session;<br />        JoltSessionAttributes&#160;sattr;<br />        JoltRemoteService withdrawal;<br />        JoltRemoteService&#160;deposit;<br />        JoltTransaction&#160;trans;<br />        String userName=null;<br />        String userPassword=null;<br />        String appPassword=null;<br />        String userRole=&#8221;myapp&#8221;;</pre></div><a name="wp1020916"> </a><div class="pPreformatted"><pre>        sattr = new JoltSessionAttributes(); 					<br />        sattr.setString(sattr.APPADDRESS, &#8220;//bluefish:8501&#8221;);</pre></div><a name="wp1021033"> </a><div class="pPreformatted"><pre>        switch (sattr.checkAuthenticationLevel())		 <br />        {<br />        case JoltSessionAttributes.NOAUTH:<br />            System.out.println(&#8220;NOAUTH\n&#8221;);<br />            break;<br />        case JoltSessionAttributes.APPASSWORD:<br />            appPassword = &#8220;appPassword&#8221;;<br />            break;<br />        case JoltSessionAttributes.USRPASSWORD:<br />             userName = &#8220;myname&#8221;; <br />            userPassword = &#8220;mysecret&#8221;;<br />            appPassword = &#8220;appPassword&#8221;;<br />            break;<br />        }<br />        sattr.setInt(sattr.IDLETIMEOUT, 300);<br />        session = new JoltSession(sattr, userName, userRole,<br />        userPassword, appPassword);<br />        // Simulate a transfer<br />        withdrawal = new JoltRemoteService(&#8220;WITHDRAWAL&#8221;, session);<br />        deposit = new JoltRemoteService(&#8220;DEPOSIT&#8221;, session);</pre></div><a name="wp1021050"> </a><div class="pPreformatted"><pre>        withdrawal.addInt(&#8220;ACCOUNT_ID&#8221;, 100000);<br />        withdrawal.addString(&#8220;SAMOUNT&#8221;, &#8220;100.00&#8221;);</pre></div><a name="wp1021130"> </a><div class="pPreformatted"><pre>        // Begin the transaction w/ a 5 sec timeout<br />        trans = new JoltTransaction(5, session);<br />        try<br />        {<br />            withdrawal.call(trans);<br />        }</pre></div><a name="wp1021144"> </a><div class="pPreformatted"><pre>        catch (ApplicationException e)<br />        {<br />            e.printStackTrace();<br />            // This service uses the STATLIN field to report errors<br />            // back to the client application.<br />            System.err.println(withdrawal.getStringDef(&#8220;STATLIN&#8221;,&#8221;NO <br />            STATLIN&#8221;));<br />            System.exit(1);<br />        }</pre></div><a name="wp1021171"> </a><div class="pPreformatted"><pre>        String wbal = withdrawal.getStringDef(&#8220;SBALANCE&#8221;, &#8220;$-1.0&#8221;);</pre></div><a name="wp1021123"> </a><div class="pPreformatted"><pre>        // remove leading &#8220;$&#8221; before converting string to float<br />        float w = Float.valueOf(wbal.substring(1)).floatValue();<br />        if (w &lt; 0.0)<br />        {<br />            System.err.println(&#8220;Insufficient funds&#8221;);<br />            trans.rollback();<br />            System.exit(1);<br />        }<br />        else            // now attempt to deposit/transfer the funds<br />        {<br />            deposit.addInt(&#8220;ACCOUNT_ID&#8221;, 100001);<br />            deposit.addString(&#8220;SAMOUNT&#8221;, &#8220;100.00&#8221;);</pre></div><a name="wp1021208"> </a><div class="pPreformatted"><pre>            deposit.call(trans);<br />            String dbal = deposit.getStringDef(&#8220;SBALANCE&#8221;, &#8220;-1.0&#8221;);<br />            trans.commit();</pre></div><a name="wp1021231"> </a><div class="pPreformatted"><pre>            System.out.println(&#8220;Successful withdrawal&#8221;);<br />            System.out.println(&#8220;New balance is: &#8220; + wbal);</pre></div><a name="wp1021232"> </a><div class="pPreformatted"><pre>            System.out.println(&#8220;Successful deposit&#8221;);<br />            System.out.println(&#8220;New balance is: &#8220; + dbal);<br />        }</pre></div><a name="wp1021099"> </a><div class="pPreformatted"><pre>        session.endSession();<br />        System.exit(0);<br />        } // end main<br />    } // end SimXfer</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1054085"> </a>
Using Oracle Tuxedo Buffer Types with Jolt
</h2><p class="pBody"><a name="wp1054086"> </a>
Jolt supports the following built-in Oracle Tuxedo buffer types:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1053895"> </a>FML, FML32</li>
<li><a name="wp1053901"> </a>VIEW, VIEW32</li>
<li><a name="wp1054104"> </a>X_COMMON</li>
<li><a name="wp1054113"> </a>X_C_TYPE</li>
<li><a name="wp1053913"> </a>CARRAY</li>
<li><a name="wp1062114"> </a>X_OCTET</li>
<li><a name="wp1062115"> </a>STRING</li>
<li><a name="wp1062124"> </a>XML</li>
<li><a name="wp1073946"> </a>MBSTRING</li>
</ul></div>
<a name="wp1062116"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>X_OCTET is used identically to CARRAY.<br />X_COMMON and X_C_TYPE are used identically to VIEW.</td>
</tr>
</table>

<p class="pBody"><a name="wp1007902"> </a>
Of the Oracle Tuxedo built-in buffer types, the Jolt programmer should be particularly aware of how Jolt handles the CARRAY (character array) and STRING buffer types:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1068235"> </a>The CARRAY type is used to handle data opaquely (that is, the characters of a CARRAY data type are not interpreted in any way). Therefore, no data conversion is performed between a Jolt client and Oracle Tuxedo service. </li>
<li><a name="wp1068317"> </a>The STRING data type is character and, unlike CARRAY, you can determine its transmission length by counting the number of characters in the buffer until reaching the null character. Therefore, data is automatically converted when data is exchanged by machines with different character sets.</li>
</ul></div>
<p class="pBody"><a name="wp1068279"> </a>
For more information about all the Oracle Tuxedo typed buffers, data types, and buffer types, refer to the following documents:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1068283"> </a><em class="cEmphasis">Programming Oracle Tuxedo ATMI Applications Using C</em></li>
<li><a name="wp1068287"> </a><em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em></li>
<li><a name="wp1068291"> </a><em class="cEmphasis">Oracle Tuxedo ATMI FML Function Reference</em></li>
<li><a name="wp1068295"> </a><em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1041254"> </a>
Using the STRING Buffer Type
</h3>
<p class="pBody"><a name="wp1068396"> </a>
The STRING buffer type is an array of non-null characters that terminates with a null character. Unlike CARRAY, you can determine its transmission length by counting the number of characters in the buffer until reaching the null character. Since the STRING buffer is self-describing, the Oracle Tuxedo System can convert data automatically when data is exchanged by machines with different character sets.
</p>
<a name="wp1018351"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>During the data conversion from Jolt to STRING, the null terminator is automatically appended to the end of the STRING buffers because a Java string is not null-terminated.</td>
</tr>
</table>

<p class="pBody"><a name="wp1032026"> </a>
Using the STRING buffer type requires two main steps:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1061375"> </a>Define the Tuxedo service that you will be using with the buffer type.</li>
<li><a name="wp1061376"> </a>Write the code that uses the STRING buffer type.</li>
</ol></div>
<p class="pBody"><a name="wp1061377"> </a>
The next two sections provide examples that demonstrate these steps.
</p>
<p class="pBody"><a name="wp1061374"> </a>
The <code class="cCode">ToUpper</code> code fragment shown in the listing <a href="dvlibrary.html#wp1070282">Use of the STRING Buffer Type (ToUpper.java)</a> illustrates how Jolt works with a service whose buffer type is STRING. The <code class="cCode">ToUpper</code> Oracle Tuxedo Service is available in the Oracle Tuxedo <code class="cCode">simpapp</code> example.
</p>
<h4 class="pHeading3"><a name="wp1040438"> </a>
Define TOUPPER in the Repository Editor
</h4>
<p class="pBody"><a name="wp1040443"> </a>
Before running the <code class="cCode">ToUpper.java</code> example, you need to define the <code class="cCode">TOUPPER</code> service through the Jolt Repository Editor.
</p>
<a name="wp1041290"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Refer to <a href="dvrepos.html">Using the Jolt Repository Editor</a> for more information about defining your services and adding new parameters.</td>
</tr>
</table>

<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1065109"> </a>In the Jolt Repository Editor Logon window, click <b class="cBold">Services</b>.</li>
<div class="pFigureTitle"><a name="wp1065112"> </a>
Figure&#160;5-3  Add a TOUPPER Service
</div>

 
 <p class="pGraphic"><a name="wp1039438"> </a>
<br />
<img src="wwimages/4-3.gif" alt="Add a TOUPPER Service" id="wp1039436"/><br />

</p>
<li><a name="wp1065132"> </a>In the Services window, select the <b class="cBold">TOUPPER</b> service in the SIMPSERV package.</li>
<li><a name="wp1065133"> </a>Click <b class="cBold">Edit</b>.</li>
<div class="pFigureTitle"><a name="wp1064476"> </a>
Figure&#160;5-4  Set Input and Output Buffer Types to STRING
</div>

 
 <p class="pGraphic"><a name="wp1040308"> </a>
<br />
<img src="wwimages/4-4.gif" alt="Set Input and Output Buffer Types to STRING" id="wp1040306"/><br />

</p>
<li><a name="wp1064483"> </a>In the Edit Services window, define an input buffer type of STRING and an output buffer type of STRING. Refer to the figure <a href="dvlibrary.html#wp1064476">Set Input and Output Buffer Types to STRING</a>.)</li>
<li><a name="wp1064487"> </a>For the TOUPPER service, define only one parameter named STRING, which is both an input and an output parameter.</li>
<li><a name="wp1064982"> </a>Click <b class="cBold">Save Service</b>.</li>
</ol></div>
<h4 class="pHeading3"><a name="wp1064481"> </a>
ToUpper.java Client Code
</h4>
<p class="pBody"><a name="wp1070279"> </a>
The <code class="cCode">ToUpper.java</code> Java code fragment in <a href="dvlibrary.html#wp1070282">Listing&#160;5-2</a> illustrates how Jolt works with a service with a buffer type of STRING. The example shows a Jolt client using a STRING buffer to pass data to a server. The Oracle Tuxedo server would take the buffer, convert the string to all uppercase letters, and pass the string back to the client. The following example assumes that a session object was already instantiated.
</p>
<div class="pCodeTitle"><a name="wp1070282"> </a>
Listing&#160;5-2	   Use of the STRING Buffer Type (ToUpper.java)
</div> <a name="wp1070283"> </a><div class="pPreformatted"><pre>/* Copyright 1996 Oracle Systems, Inc.  All Rights Reserved */<br />import bea.jolt.*;<br />public class ToUpper<br />  {<br />    public static void main (String[] args)<br />    {<br />        JoltSession            session;<br />        JoltSessionAttributes  sattr;<br />        JoltRemoteService      toupper;<br />        JoltTransaction        trans;<br />        String userName=null;<br />        String userPassword=null;<br />        String appPassword=null;<br />        String userRole=&#8221;myapp&#8221;;<br />        String outstr;</pre></div><a name="wp1021668"> </a><div class="pPreformatted"><pre>        sattr = new JoltSessionAttributes();<br />        sattr.setString(sattr.APPADDRESS, &#8220;//myhost:8501&#8221;);</pre></div><a name="wp1021687"> </a><div class="pPreformatted"><pre>        switch (sattr.checkAuthenticationLevel())<br />        {<br />        case JoltSessionAttributes.NOAUTH:<br />            break;<br />        case JoltSessionAttributes.APPASSWORD:<br />            appPassword = &#8220;appPassword&#8221;;<br />            break;<br />        case JoltSessionAttributes.USRPASSWORD:<br />            userName = &#8220;myname&#8221;; <br />            userPassword = &#8220;mysecret&#8221;;<br />            appPassword = &#8220;appPassword&#8221;;<br />            break;<br />        }<br />        sattr.setInt(sattr.IDLETIMEOUT, 300);<br />        session = new JoltSession(sattr, userName, userRole, <br />        userPassword, appPassword);<br />        toupper = new JoltRemoteService (&#8220;TOUPPER&#8221;, session);<br />        toupper.setString(&#8220;STRING&#8221;, &#8220;hello world&#8221;);<br />        toupper.call(null);<br />        outstr = toupper.getStringDef(&#8220;STRING&#8221;, null);<br />        if (outstr != null)<br />            System.out.println(outstr);</pre></div><a name="wp1021924"> </a><div class="pPreformatted"><pre>        session.endSession();<br />                  System.exit(0);<br />    } // end main<br />  } // end ToUpper</pre></div><h3 class="pHeading2"><a name="wp1007973"> </a>
Using the CARRAY Buffer Type
</h3>
<p class="pBody"><a name="wp1007974"> </a>
The CARRAY buffer type is a simple character array buffer type that is built into the Oracle Tuxedo system. Because the system does not interpret the data (although the data type is known) when you use the CARRAY buffer type, you must specify a data length in the Jolt client application. The Jolt client must specify a data length when passing this buffer type.
</p>
<p class="pBody"><a name="wp1068241"> </a>
For example, if an Oracle Tuxedo service uses a CARRAY buffer type and the user sets a 32-bit integer (in Java the integer is in big-endian byte order), then the data is sent unmodified to the Oracle Tuxedo service.
</p>
<p class="pBody"><a name="wp1069292"> </a>
To use the CARRAY buffer type, you first define the Tuxedo service that you will be using with the buffer type. Then, write the code that uses the buffer type. The next two sections demonstrate these steps.
</p>
<a name="wp1054521"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>X_OCTET is used identically to CARRAY.</td>
</tr>
</table>

<h4 class="pHeading3"><a name="wp1038022"> </a>
Define the Tuxedo Service in the Repository Editor
</h4>
<p class="pBody"><a name="wp1061800"> </a>
Before running the ECHO example, you must write and boot a Tuxedo ECHO service. The ECHO service takes a buffer and passes it back to the Jolt client. You need to define the ECHO service in the Jolt Repository Editor. 
</p>
<a name="wp1069304"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Refer to <a href="dvrepos.html">Using the Jolt Repository Editor</a> for more information about defining your services and adding new parameters.</td>
</tr>
</table>

<div class="pFigureTitle"><a name="wp1061804"> </a>
Figure&#160;5-5  Repository Editor: Add the ECHO Service
</div>

 
 <p class="pGraphic"><a name="wp1061823"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/4-5.gif" alt="Repository Editor: Add the ECHO Service" id="wp1061807"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1061813"> </a>
Use the Repository Editor to add the ECHO service as follows:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1059425"> </a>In the Repository Editor, add a service called ECHO. </li>
<li><a name="wp1061378"> </a>Define the input buffer type and output buffer type as <b class="cBold">CARRAY</b>. </li>
<li><a name="wp1061379"> </a>Define only one parameter named CARRAY, which is both an input and output parameter.</li>
</ol></div>
<a name="wp1061741"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If using the X_OCTET buffer type, you must change the Input Buffer Type and Output Buffer Type fields to X_OCTET.</td>
</tr>
</table>

<div class="pFigureTitle"><a name="wp1065871"> </a>
Figure&#160;5-6  Repository Editor: Edit ECHO Service
</div>

 
 <h4 class="pHeading3"><a name="wp1065876"> </a>
tryOnCARRAY.java Client Code
</h4>
<p class="pBody"><a name="wp1038404"> </a>
The code in the following listing illustrates how Jolt works with a service with a buffer type of CARRAY. Because Jolt does not look into the CARRAY data stream, it is the programmer&#39;s responsibility to ensure that the data formats between the Jolt client and the CARRAY service match. The example in <a href="dvlibrary.html#wp1007991">Listing&#160;5-3</a> assumes that a session object was already instantiated. 
</p>
<div class="pCodeTitle"><a name="wp1007991"> </a>
Listing&#160;5-3	   CARRAY Buffer Type Example
</div> <a name="wp1007992"> </a><div class="pPreformatted"><pre>/* Copyright 1996 Oracle Systems, Inc. All Rights Reserved */</pre></div><a name="wp1022057"> </a><div class="pPreformatted"><pre>  /* This code fragment illustrates how Jolt works with a service  <br />   * whose buffer type is CARRAY.<br />   */</pre></div><a name="wp1022064"> </a><div class="pPreformatted"><pre>import java.io.*;<br />import bea.jolt.*;<br />class ...<br />{<br />    ...<br />    public void tryOnCARRAY()<br />    {<br />        byte data[];<br />        JoltRemoteService csvc;<br />        DataInputStream din;<br />        DataOutputStream dout;<br />        ByteArrayInputStream bin;<br />        ByteArrayOutputStream bout;<br />        /*<br />         * Use java.io.DataOutputStream to put data into a byte array<br />         */<br />        bout = new ByteArrayOutputStream(512);<br />        dout = new DataOutputStream(bout);<br />        dout.writeInt(100);<br />        dout.writeFloat((float) 300.00);<br />        dout.writeUTF(&quot;Hello World&quot;);<br />        dout.writeShort((short) 88);<br />        /*<br />         * Copy the byte array into a new byte array &quot;data&quot;.  Then<br />         * issue the Jolt remote service call.<br />         */<br />        data = bout.toByteArray();<br />        csvc = new JoltRemoteService(&quot;ECHO&quot;, session);<br />        csvc.setBytes(&quot;CARRAY&quot;, data, data.length);<br />        csvc.call(null);<br />        /*<br />         * Get the result from JoltRemoteService object and use<br />         * java.io.DataInputStream to extract each individual value<br />         * from the byte array.<br />         */<br />        data = csvc.getBytesDef(&quot;CARRAY&quot;, null);<br />        if (data != null)<br />        {<br />            bin = new ByteArrayInputStream(data);<br />            din = new DataInputStream(bin);<br />            System.out.println(din.readInt());<br />            System.out.println(din.readFloat());<br />            System.out.println(din.readUTF());<br />            System.out.println(din.readShort());<br />        }<br />    }<br />}</pre></div><h3 class="pHeading2"><a name="wp1018544"> </a>
Using the FML Buffer Type
</h3>
<p class="pBody"><a name="wp1026329"> </a>
FML (Field Manipulation Language) is a flexible data structure that can be used as a typed buffer. The FML data structure stores tagged values that are typed, variable in length, and may have multiple occurrences. The typed buffer is treated as an abstract data type in FML.
</p>
<p class="pBody"><a name="wp1032524"> </a>
FML gives you the ability to access and update data values without having to know how the data is structured and stored. In your application program, you simply access or update a field in the fielded buffer by referencing its identifier. To perform the operation, the FML run time determines the field location and data type. 
</p>
<p class="pBody"><a name="wp1039399"> </a>
FML is especially suited for use with Jolt clients because the client and server code can be in two languages (for example, Java and C); the client/server platforms can have different data type specifications; or the interface between the client and the server can change frequently. 
</p>
<p class="pBody"><a name="wp1039410"> </a>
The following <code class="cCode">tryOnFml</code> examples illustrate the use of the FML buffer type. The examples show a Jolt client using FML buffers to pass data to a server. The server takes the buffer, creates a new FML buffer to store the data, and passes that buffer back to the Jolt client. The examples consist of the following components.
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1032398"> </a>The <a href="dvlibrary.html#wp1018263">tryOnFml.java Code Example</a> is a Jolt client that contains a PASSFML service.</li>
<li><a name="wp1032871"> </a>The <a href="dvlibrary.html#wp1032487">tryOnFml.f16 Field Definitions</a> is an Oracle Tuxedo FML field definitions table used by the PASSFML service.</li>
<li><a name="wp1032483"> </a>The <a href="dvlibrary.html#wp1028345">tryOnFml.c Code Example</a> is a server code fragment that contains the server side C code for handling the data sent by the Jolt client. </li>
</ul></div>
<h4 class="pHeading3"><a name="wp1032493"> </a>
tryOnFml.java Client Code
</h4>
<p class="pBody"><a name="wp1033637"> </a>
The <code class="cCode">tryOnFml.java</code> Java code fragment in <a href="dvlibrary.html#wp1018263">Listing&#160;5-4</a> illustrates how Jolt works with a service whose buffer type is FML. In this example, it is assumed that a session object was already instantiated.
</p>
<div class="pCodeTitle"><a name="wp1018263"> </a>
Listing&#160;5-4	   tryOnFml.java Code Example
</div> <a name="wp1039386"> </a><div class="pPreformatted"><pre>/* Copyright 1997 Oracle Systems, Inc. All Rights Reserved */<br /><br />import bea.jolt.*;<br />class ...<br />{<br />    ...<br />    public void tryOnFml ()<br />    {<br />        JoltRemoteService passFml;<br />        String outputString;<br />        int outputInt;<br />        float outputFloat;<br />                 ... <br />        passFml = new JoltRemoteService(&quot;PASSFML&quot;,session); <br />        passFml.setString(&quot;INPUTSTRING&quot;, &quot;John&quot;);<br />        passFml.setInt(&quot;INPUTINT&quot;, 67);<br />        passFml.setFloat(&quot;INPUTFLOAT&quot;, (float)12.0);<br />        passFml.call(null);<br />        outputString = passFml.getStringDef(&quot;OUTPUTSTRING&quot;, null);<br />        outputInt = passFml.getIntDef(&quot;OUTPUTINT&quot;, -1);<br />        outputFloat = passFml.getFloatDef(&quot;OUTPUTFLOAT&quot;, (float)-1.0);<br />        System.out.print(&quot;String =&quot; + outputString);<br />        System.out.print(&quot; Int =&quot; + outputInt);<br />        System.out.println(&quot; Float =&quot; + outputFloat);<br />        }<br />}</pre></div><h4 class="pHeading3"><a name="wp1075909"> </a>
FML Field Definitions
</h4>
<p class="pBody"><a name="wp1075913"> </a>
The entries in the following listing,<a href="dvlibrary.html#wp1032487">tryOnFml.f16 Field Definitions,</a> show the FML field definitions for the previous listing, <a href="dvlibrary.html#wp1018263">tryOnFml.java Code Example.</a>
</p>
<div class="pCodeTitle"><a name="wp1032487"> </a>
Listing&#160;5-5	   tryOnFml.f16 Field Definitions
</div> <a name="wp1032488"> </a><div class="pPreformatted"><pre>#<br /># FML field definition table<br />#<br />*base    4100<br />INPUTSTRING   1    string<br />INPUTINT      2    long<br />INPUTFLOAT    3    float<br />OUTPUTSTRING  4    string<br />OUTPUTINT     5    long<br />OUTPUTFLOAT   	6    float</pre></div><h4 class="pHeading3"><a name="wp1041867"> </a>
Define PASSFML in the Repository Editor
</h4>
<p class="pBody"><a name="wp1041871"> </a>
The BULKPKG package contains the PASSFML service, which is used with the <code class="cCode">tryOnFml.java</code> and <code class="cCode">tryOnFml.c</code> code. Before running the <code class="cCode">tryOnFml.java</code> example, you need to modify the PASSFML service through the Jolt Repository Editor. 
</p>
<a name="wp1032251"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Refer to <a href="dvrepos.html">Using the Jolt Repository Editor</a> for more information about defining a service.</td>
</tr>
</table>

<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1032170"> </a>In the Edit Services window of the Jolt Repository Editor, define the PASSFML service with an input buffer type of FML and an output buffer type of FML.</li>
<p class="pBodyRelative"><a name="wp1059558"> </a>
The figure <a href="dvlibrary.html#wp1059561">Repository Editor Window: Edit Services (PASSFML)</a> illustrates the PASSFML service, and Input Buffer and Output Buffer of FML.
</p>
<div class="pFigureTitle"><a name="wp1059561"> </a>
Figure&#160;5-7  Repository Editor Window: Edit Services (PASSFML)
</div>

 
 <p class="pGraphic"><a name="wp1059565"> </a>
<br />
<img src="wwimages/4-7.gif" alt="Repository Editor Window: Edit Services (PASSFML)" id="wp1059563"/><br />

</p>
<li><a name="wp1059585"> </a>Select the input buffer type and output buffer type as <b class="cBold">FML</b> for the PASSFML service.</li>
<li><a name="wp1059583"> </a>Click<b class="cBold"> Edit</b> to display the Edit Parameters window as shown in <a href="dvlibrary.html#wp1059592">Figure&#160;5-8</a>.</li>
<div class="pFigureTitle"><a name="wp1059592"> </a>
Figure&#160;5-8  Edit the PASSFML Parameters
</div>

 
 <p class="pGraphic"><a name="wp1059575"> </a>
<br />
<img src="wwimages/4-8.gif" alt="Edit the PASSFML Parameters" id="wp1059573"/><br />

</p>
<li><a name="wp1059595"> </a>Define the parameter for the PASSFML service.</li>
<li><a name="wp1059596"> </a>Repeat steps 2-4 for each parameter in the PASSFML service.</li>
</ol></div>
<h4 class="pHeading3"><a name="wp1075922"> </a>
tryOnFml.c Server Code
</h4>
<p class="pBody"><a name="wp1075923"> </a>
<a href="dvlibrary.html#wp1028345">Listing&#160;5-6</a> illustrates the server side code for using the FML buffer type. The PASSFML service reads in an input FML buffer and outputs a FML buffer. 
</p>
<div class="pCodeTitle"><a name="wp1028345"> </a>
Listing&#160;5-6	   tryOnFml.c Code Example
</div> <a name="wp1028350"> </a><div class="pPreformatted"><pre>/*</pre></div><a name="wp1032959"> </a><div class="pPreformatted"><pre> * tryOnFml.c <br /> *<br /> * Copyright (c) 1997 Oracle Systems, Inc. All rights reserved<br /> *<br /> * Contains the PASSFML Oracle Tuxedo server.<br /> * <br /> */<br />#include &lt;stdlib.h&gt;<br />#include &lt;stdio.h&gt;<br />#include &lt;ctype.h&gt;<br />#include &lt;sys/types.h&gt;<br />#include &lt;sys/ipc.h&gt;<br />#include &lt;sys/sem.h&gt;<br />#include &lt;sys/stat.h&gt;<br />#include &lt;malloc.h&gt;<br />#include &lt;math.h&gt;<br />#include &lt;string.h&gt;<br />#include &lt;fml.h&gt;<br />#include &lt;fml32.h&gt;<br />#include &lt;Usysflds.h&gt;<br />#include &lt;atmi.h&gt;<br />#include &lt;userlog.h&gt;<br />#include &quot;tryOnFml.f16.h&quot;<br />/* <br /> * PASSFML service reads in a input fml buffer and outputs a fml buffer.<br /> */<br />void<br />PASSFML( TPSVCINFO *rqst )<br />{<br />	FLDLEN	len;<br />	FBFR	*svcinfo = (FBFR *) rqst-&gt;data;<br />	char	inputString[256];<br />	long	inputInt;<br />	float	inputFloat;<br />	FBFR	*fml_ptr;<br />	int	rt;<br />	if (Fget(svcinfo, INPUTSTRING, 0, inputString, &amp;len) &lt; 0) {<br />		(void)userlog(&quot;Fget of INPUTSTRING failed %s&quot;,<br />			Fstrerror(Ferror));<br />		tpreturn(TPFAIL, 0, rqst-&gt;data, 0L, 0);<br />	}<br />	if (Fget(svcinfo, INPUTINT, 0, (char *) &amp;inputInt, &amp;len) &lt; 0) {<br />		(void)userlog(&quot;Fget of INPUTINT failed %s&quot;,Fstrerror(Ferror));<br />		tpreturn(TPFAIL, 0, rqst-&gt;data, 0L, 0);<br />	}<br />	if (Fget(svcinfo, INPUTFLOAT, 0, (char *) &amp;inputFloat, &amp;len) &lt; 0) {<br />		(void)userlog(&quot;Fget of INPUTFLOAT failed %s&quot;,<br />			Fstrerror(Ferror));<br />		tpreturn(TPFAIL, 0, rqst-&gt;data, 0L, 0);<br />	}<br />	/* We could just pass the FML buffer back as is, put lets	*/<br />	/* store it into another FML buffer and pass it back.		*/<br />	if ((fml_ptr = (FBFR *)tpalloc(&quot;FML&quot;,NULL,rqst-&gt;len))==(FBFR *)NULL) {<br />		(void)userlog(&quot;tpalloc failed in PASSFML %s&quot;, <br />			tpstrerror(tperrno));<br />		tpreturn(TPFAIL, 0, rqst-&gt;data, 0L, 0);<br />	}<br />	if(Fadd(fml_ptr, OUTPUTSTRING, inputString, (FLDLEN)0) == -1) {<br />		userlog(&quot;Fadd failed with error: %s&quot;, Fstrerror(Ferror));<br />		tpfree((char *)fml_ptr);<br />		tpreturn(TPFAIL, 0, NULL, 0L, 0);<br />        }<br />	if(Fadd(fml_ptr, OUTPUTINT, (char *)&amp;inputInt, (FLDLEN)0) == -1) {<br />		userlog(&quot;Fadd failed with error: %s&quot;, Fstrerror(Ferror));<br />		tpfree((char *)fml_ptr);<br />		tpreturn(TPFAIL, 0, NULL, 0L, 0);<br />        }<br />	if(Fadd(fml_ptr, OUTPUTFLOAT, (char *)&amp;inputFloat, (FLDLEN)0) == -1) {<br />		userlog(&quot;Fadd failed with error: %d\n&quot;, Fstrerror(Ferror));<br />		tpfree((char *)fml_ptr);<br />		tpreturn(TPFAIL, 0, NULL, 0L, 0);<br />        }<br />	tpreturn(TPSUCCESS, 0, (char *)fml_ptr, 0L, 0);<br />}<br /></pre></div><h3 class="pHeading2"><a name="wp1025896"> </a>
Using the VIEW Buffer Type
</h3>
<p class="pBody"><a name="wp1025897"> </a>
VIEW is a built-in Oracle Tuxedo typed buffer. The VIEW buffer provides a way to use C structures and COBOL records with the Oracle Tuxedo system. The VIEW typed buffer enables the Oracle Tuxedo run-time system to understand the format of C structures and COBOL records based on the view description that is read at run time. 
</p>
<p class="pBody"><a name="wp1029269"> </a>
When allocating a VIEW, your application specifies a VIEW buffer type and a subtype that matches the name of the view (the name that appears in the view description file). The parameter name must match the field name in that view. Because the Oracle Tuxedo run-time system can determine the space needed based on the structure size, your application need not provide a buffer length. The run-time system can also automatically handle such things as computing how much data to send in a request or response, and handle encoding and decoding when the message transfers between different machine types.
</p>
<p class="pBody"><a name="wp1029057"> </a>
The following examples show the use of the VIEW buffer type with a Jolt client and its server-side application. 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1033191"> </a>The <a href="dvlibrary.html#wp1033531">simpview.java Code Example</a> is the Jolt client that contains the code used to connect to Oracle Tuxedo and uses the VIEW buffer type.</li>
<li><a name="wp1029221"> </a>The listing <a href="dvlibrary.html#wp1033501">simpview.v16 Field Definitions</a> contains the Oracle Tuxedo VIEW field definitions.</li>
<li><a name="wp1029235"> </a>The <a href="dvlibrary.html#wp1027335">simpview.c Code Example</a> contains the server side C code for handling the input from the Jolt client.</li>
</ul></div>
<p class="pBody"><a name="wp1033932"> </a>
The Jolt client treats a null character in a VIEW buffer string format as an end-of-line character and truncates any part of the string that follows the null. 
</p>
<h4 class="pHeading3"><a name="wp1061019"> </a>
Define VIEW in the Repository Editor
</h4>
<p class="pBody"><a name="wp1069317"> </a>
Before running the <code class="cCode">simpview.java</code> and <code class="cCode">simpview.c</code> examples, you need to define the SIMPVIEW service through the Jolt Repository Editor.
</p>
<a name="wp1061024"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Refer to <a href="dvrepos.html">Using the Jolt Repository Editor</a> for more information about defining a service.</td>
</tr>
</table>

<div class="pFigureTitle"><a name="wp1061025"> </a>
Figure&#160;5-9  Repository Editor: Add SIMPVIEW Service
</div>

 
 <p class="pGraphic"><a name="wp1061031"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/4-9.gif" height="500" width="587" alt="Repository Editor: Add SIMPVIEW Service" id="wp1061027"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1061032"> </a>
In the Repository Editor add the VIEW service as follows:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1061033"> </a>Add a SIMPVIEW service for the SIMPSERV package.</li>
<li><a name="wp1061034"> </a>Define the SIMPVIEW service with an input buffer type of VIEW and an output buffer type of VIEW.</li>
<div class="pFigureTitle"><a name="wp1061035"> </a>
Figure&#160;5-10  Repository Editor: Edit SIMPVIEW Service
</div>

 
 <p class="pGraphic"><a name="wp1061039"> </a>
<br />
<img src="wwimages/4-10.gif" alt="Repository Editor: Edit SIMPVIEW Service" id="wp1061037"/><br />

</p>
<li><a name="wp1061040"> </a>Define the parameters for the VIEW service. In this example the parameters are:<code class="cCode"> inInt</code>, <code class="cCode">inString</code>, <code class="cCode">outFloat</code>, <code class="cCode">outInt</code>, <code class="cCode">outString</code>.</li>
</ol></div>
<a name="wp1061042"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If using the X_COMMON or X_C_TYPE buffer types, you must put the correct buffer type in the Input Buffer Type and Output Buffer Type fields. Additionally, you must choose the corresponding Input View Name and Output View Name fields.</td>
</tr>
</table>

<h4 class="pHeading3"><a name="wp1061017"> </a>
simpview.java Client Code
</h4>
<p class="pBody"><a name="wp1029282"> </a>
The listing <a href="dvlibrary.html#wp1033531">simpview.java Code Example</a> illustrates how Jolt works with a service whose buffer type is VIEW. The client code is identical to the code used for accessing an FML service.
</p>
<a name="wp1029190"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The code in the following listing does not catch any exceptions. Because all Jolt exceptions are derived from <code class="cCode">java.lang.RunTimeException</code>, the Java Virtual Machine (JVM) catches these exceptions if the application does not. (A well-written application will catch these exceptions and take appropriate actions.)</td>
</tr>
</table>

<p class="pBody"><a name="wp1034833"> </a>
Before running the example in the following listing, you need to add the VIEW service to the SIMPAPP package using the Jolt Repository Editor and write the <code class="cCode">simpview.c</code> Oracle Tuxedo application. This service takes the data from the client VIEW buffer, creates a new buffer and passes it back to the client as a new VIEW buffer. The following example assumes that a session object has already been instantiated.
</p>
<div class="pCodeTitle"><a name="wp1033531"> </a>
Listing&#160;5-7	   simpview.java Code Example
</div> <a name="wp1025899"> </a><div class="pPreformatted"><pre><code class="cCode">/* Copyright 1997 Oracle Systems, Inc. All Rights Reserved */<br />/*<br /> * This code fragment illustrates how Jolt works with a service whose buffer<br /> * type is VIEW. <br /> */<br />import bea.jolt.*;<br />class ...<br />{<br />	...	<br />	public void simpview ()<br />	{<br />		JoltRemoteService ViewSvc;<br />		String outString;<br />		int outInt;<br />		float outFloat;<br />		// Create a Jolt Service for the Oracle Tuxedo service &quot;SIMPVIEW&quot;<br />		ViewSvc = new JoltRemoteService(&quot;SIMPVIEW&quot;,session); <br />		// Set the input parameters required for SIMPVIEW<br />		ViewSvc.setString(&quot;inString&quot;, &quot;John&quot;);<br />		ViewSvc.setInt(&quot;inInt&quot;, 10);<br />		ViewSvc.setFloat(&quot;inFloat&quot;, (float)10.0);<br />		// Call the service. No transaction required, so pass<br />		// a &quot;null&quot; parameter<br />		ViewSvc.call(null);<br />		// Process the results<br />		outString = ViewSvc.getStringDef(&quot;outString&quot;, null);<br />		outInt = ViewSvc.getIntDef(&quot;outInt&quot;, -1);<br />		outFloat = ViewSvc.getFloatDef(&quot;outFloat&quot;, (float)-1.0);<br />		// And display them...<br />		System.out.print(&quot;outString=&quot; + outString + &quot;,&quot;);<br />		System.out.print(&quot;outInt=&quot; + outInt + &quot;,&quot;);<br />		System.out.println(&quot;outFloat=&quot; + outFloat);<br />	}<br />}</code></pre></div><h4 class="pHeading3"><a name="wp1033499"> </a>
VIEW Field Definitions
</h4>
<p class="pBody"><a name="wp1033500"> </a>
The <a href="dvlibrary.html#wp1033501">simpview.v16 Field Definitions</a> listing shows the Oracle Tuxedo VIEW field definitions for the <code class="cCode">simpview.java</code> example that were shown in the previous listing.
</p>
<div class="pCodeTitle"><a name="wp1033501"> </a>
Listing&#160;5-8	   simpview.v16 Field Definitions
</div> <a name="wp1033502"> </a><div class="pPreformatted"><pre>#<br /># VIEW for SIMPVIEW. This view is used for both input and output. The<br /># service could also have used separate input and output views.<br /># The first 3 params are input params, the second 3 are outputs.<br />#<br />VIEW SimpView<br />$<br />#type	cname		fbname	count	flag	size	null<br />string	inString		-	1	-	32	-<br />long	inInt		-	1	-	-	-<br />float	inFloat		-	1	-	-	-<br />string	outString		-	1	-	32	-	<br />long	outInt		-	1	-	-	-<br />float	outFloat		-	1	-	-	-<br />END</pre></div><h4 class="pHeading3"><a name="wp1041897"> </a>
simpview.c Server Code
</h4>
<p class="pBody"><a name="wp1033563"> </a>
In <a href="dvlibrary.html#wp1027335">Listing&#160;5-9</a>, the input and output buffers are VIEW. The code accepts the VIEW buffer data as input and outputs the same data as VIEW. 
</p>
<div class="pCodeTitle"><a name="wp1027335"> </a>
Listing&#160;5-9	   simpview.c Code Example
</div> <a name="wp1062129"> </a><div class="pPreformatted"><pre>/*<br /> * SIMPVIEW.c <br /> *<br /> * Copyright (c) 1997 Oracle Systems, Inc.  All rights reserved<br /> *<br /> * Contains the SIMPVIEW Oracle Tuxedo server.<br /> * <br /> */<br />#include &lt;stdlib.h&gt;<br />#include &lt;stdio.h&gt;<br />#include &lt;ctype.h&gt;<br />#include &lt;sys/types.h&gt;<br />#include &lt;sys/ipc.h&gt;<br />#include &lt;sys/sem.h&gt;<br />#include &lt;sys/stat.h&gt;<br />#include &lt;malloc.h&gt;<br />#include &lt;math.h&gt;<br />#include &lt;string.h&gt;<br />#include &lt;fml.h&gt;<br />#include &lt;fml32.h&gt;<br />#include &lt;Usysflds.h&gt;<br />#include &lt;atmi.h&gt;<br />#include &lt;userlog.h&gt;<br />#include &quot;simpview.h&quot;<br />/*<br /> * Contents of simpview.h.<br /> *<br /> *struct SimpView {<br /> *<br /> *	char	inString[32];<br /> *	long	inInt;<br /> *	float	inFloat;<br /> *	char	outString[32];<br /> *	long	outInt;<br /> *	float	outFloat;<br /> *};<br /> */<br />/* <br /> *  service reads in a input view buffer and outputs a view buffer.<br /> */<br />void<br />SIMPVIEW( TPSVCINFO *rqst )<br />{<br />	/*<br />	 * get the structure (VIEWSVC) from the TPSVCINFO structure<br />	 */<br />	struct SimpView	*svcinfo = (struct SimpView *) rqst-&gt;data;<br />	/*<br />	 * print the input params to the UserLog. Note there is<br />	 * no error checking here. Normally a SERVER would perform<br />	 * some validation of input and return TPFAIL if the input<br />	 * is not correct.<br />	 */<br />	(void)userlog(&quot;SIMPVIEW: InString=%s,InInt=%d,InFloat=%f&quot;,<br />		svcinfo-&gt;inString, svcinfo-&gt;inInt, svcinfo-&gt;inFloat);<br />	/*<br />	 * Populate the output fields and send them back to the caller<br />	 */<br />	<br />	strcpy (svcinfo-&gt;outString, &quot;Return from SIMPVIEW&quot;);<br />	svcinfo-&gt;outInt = 100;<br />	svcinfo-&gt;outFloat = (float) 100.00;<br />	/*<br />	 * If there was an error, return TPFAIL<br />	 * tpreturn(TPFAIL, ErrorCode, (char *)svcinfo, sizeof (*svcinfo), 0);<br />	 */<br />	tpreturn(TPSUCCESS, 0, (char *)svcinfo, sizeof (*svcinfo), 0);<br />}</pre></div><h3 class="pHeading2"><a name="wp1062135"> </a>
Using the XML Buffer Type
</h3>
<p class="pBody"><a name="wp1062157"> </a>
The XML buffer type enables Oracle Tuxedo applications to use XML documents for exchanging data within and between applications. Oracle Tuxedo applications can send and receive XML buffers, and route those buffers to the appropriate servers. All logic for dealing with XML documents, including parsing, resides in the application.
</p>
<p class="pBody"><a name="wp1063497"> </a>
A well-formed XML document consists of: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1063498"> </a>Text in the form of a sequence of encoded characters, including proper headings, opening and closing tags, etc.</li>
<li><a name="wp1063499"> </a>A description of the logical structure of the document and information about that structure.</li>
</ul></div>
<p class="pBody"><a name="wp1062967"> </a>
To use the XML buffer type, you first define the Tuxedo service that you will be using with the buffer type, and then write the code that uses the buffer type. The next two sections demonstrate these steps.
</p>
<a name="wp1068951"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Similar to CARRAY, the XML buffer type is treated as a byte arrary, not a STRING. Therefore, no data conversion takes place between a Jolt client and an Oracle Tuxedo service. </td>
</tr>
</table>

<h4 class="pHeading3"><a name="wp1063224"> </a>
Define the Tuxedo Service in the Repository Editor
</h4>
<p class="pBody"><a name="wp1062142"> </a>
Before running the XML example, you must write and boot a Tuxedo XML service. The XML service takes a buffer and passes it back to the Jolt client. You need to define the XML service in the Jolt Repository Editor. 
</p>
<a name="wp1069336"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Refer to <a href="dvrepos.html">Using the Jolt Repository Editor</a> for more information about defining your services and adding new parameters.</td>
</tr>
</table>

<div class="pFigureTitle"><a name="wp1063741"> </a>
Figure&#160;5-11  Repository Editor: Add the XML Service
</div>

 
 <p class="pGraphic"><a name="wp1068063"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/add_xml.gif" alt="Repository Editor: Add the XML Service" id="wp1068065"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1064268"> </a>
Use the Repository Editor to add the XML service as follows:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1062590"> </a>In the Repository Editor, add a service called ECHO_XML. </li>
<li><a name="wp1062595"> </a>For the ECHO_XML service, define the input buffer type and output buffer type as XML. </li>
<li><a name="wp1062596"> </a>Define the ECHO_XML service with only one parameter named <b class="cBold">XML</b>, which is both an input and output parameter.</li>
<div class="pFigureTitle"><a name="wp1064324"> </a>
Figure&#160;5-12  Repository Editor: Edit the XML Service
</div>

 
 <p class="pGraphic"><a name="wp1068067"> </a>
<br />
<img src="wwimages/edit_xml.gif" alt="Repository Editor: Edit the XML Service" id="wp1068069"/><br />

</p>
</ol></div>
<h4 class="pHeading3"><a name="wp1062606"> </a>
simpxml.java Client Code
</h4>
<p class="pBody"><a name="wp1062608"> </a>
The code in the following listing illustrates how Jolt works with a service with an XML type buffer. Because Jolt does not look into the XML data stream, it is the programmer&#39;s responsibility to ensure that the data formats between the Jolt client and the XML service match. The example in <a href="dvlibrary.html#wp1062611">Listing&#160;5-10</a> assumes that a session object was already instantiated. 
</p>
<div class="pCodeTitle"><a name="wp1062611"> </a>
Listing&#160;5-10	   XML Buffer Type Example
</div> <a name="wp1063526"> </a><div class="pPreformatted"><pre>/* Copyright 2001 Oracle Systems, Inc. All Rights Reserved */<br />/*<br /> * This code fragment illustrates how Jolt works with a service whose buffer<br /> * type is XML. <br /> */</pre></div><a name="wp1066542"> </a><div class="pPreformatted"><pre><code class="cCode">import java.io.*;<br />import java.lang.*;<br />import bea.jolt.*;</code></pre></div><a name="wp1063530"> </a><div class="pPreformatted"><pre><code class="cCode">public class xmldoc {</code></pre></div><a name="wp1066536"> </a><div class="pPreformatted"><pre><code class="cCode">    	public static void main (String[] args) {<br />        		JoltSessionAttributes  sattr;<br />        		JoltSession            session;<br />        		JoltRemoteService      echo_xml;</code></pre></div><a name="wp1063537"> </a><div class="pPreformatted"><pre><code class="cCode">		String inString = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&lt;ORDER&gt;&lt;HEADER DATE=\&quot;05/13/1999\&quot; ORDERNO=\&quot;22345\&quot;/&gt;&lt;COMPANY&gt;ACME&lt;/COMPANY&gt;&lt;LINE&gt;&lt;ITEM MODEL=\&quot;Pabc\&quot; QUANTITY=\&quot;5\&quot;&gt;LAPTOP&lt;/ITEM&gt;&lt;/LINE&gt;&lt;LINE&gt;&lt;ITEM MODEL=\&quot;P500\&quot; QUANTITY=\&quot;15\&quot;&gt;LAPTOP&lt;/ITEM&gt;&lt;/LINE&gt;&lt;/ORDER&gt;&quot;;</code></pre></div><a name="wp1063539"> </a><div class="pPreformatted"><pre><code class="cCode">        		byte data[];<br />        		DataInputStream din;<br />        		DataOutputStream dout;<br />        		ByteArrayInputStream bin;<br />        		ByteArrayOutputStream bout;</code></pre></div><a name="wp1063545"> </a><div class="pPreformatted"><pre><code class="cCode">        		byte odata[];<br />        		String outString = null;<br />        		String appAddress = null;</code></pre></div><a name="wp1068483"> </a><div class="pPreformatted"><pre><code class="cCode">        		//...Create Jolt Session </code></pre></div><a name="wp1068484"> </a><div class="pPreformatted"><pre><code class="cCode">        		try {<br />            			/*<br />           		 	 * Use java.io.DataOutputStream to put data <br />            			 * into a byte array<br />           		 	 */<br />            			bout = new ByteArrayOutputStream(inString.length());<br />            			dout = new DataOutputStream(bout);<br />            			dout.writeBytes(inString);</code></pre></div><a name="wp1063560"> </a><div class="pPreformatted"><pre><code class="cCode">			            /*<br />           		 	 * Copy the byte array into a new byte array &quot;data&quot;.  <br />            			 * Then issue the Jolt remote service call.<br />            	 */<br />            			data = bout.toByteArray();<br />        		} catch (Exception e) {<br />            			System.out.println(&quot;toByteArray error&quot;);<br />            			return;<br />        		}</code></pre></div><a name="wp1067037"> </a><div class="pPreformatted"><pre><code class="cCode">        		try {<br />            			echo_xml = new JoltRemoteService(&quot;ECHO_XML&quot;, session); <br />            			System.out.println(&quot;JoltRemoteService Created&quot;);<br />            			echo_xml.setBytes(&quot;XML&quot;, data, data.length);<br />        		} catch (Exception e) {<br />            			System.out.println(&quot;RemoteService call error&quot; + e);<br />            			return;<br />        		}</code></pre></div><a name="wp1063579"> </a><div class="pPreformatted"><pre><code class="cCode">        		echo_xml.call(null);<br />        		System.out.println(&quot;Service Call Returned&quot;);<br />        		odata = echo_xml.getBytesDef(&quot;XML&quot;, null);</code></pre></div><a name="wp1063583"> </a><div class="pPreformatted"><pre><code class="cCode">        		try {<br />            			System.out.println(&quot;Return String is:&quot; + new String(odata));<br />        		} catch (Exception e) {<br />            			System.err.println(&quot;getByteDef Error&quot;);<br />        		}<br />    	}<br />}</code></pre></div><a name="wp1063591"> </a><div class="pPreformatted"><pre><code class="cCode">// end of class</code></pre></div><h3 class="pHeading2"><a name="wp1073961"> </a>
Using the MBSTRING Buffer Type
</h3>
<p class="pBody"><a name="wp1073963"> </a>
Starting with Tuxedo 9.0, Jolt supports the MBSTRING buffer type which is already supported by Tuxedo ATMI as of Tuxedo 8.1.
</p>
<p class="pBody"><a name="wp1073965"> </a>
Since Java uses Unicode as the standard for multi byte character encoding and provides String class for handling Unicode string data, Jolt MBSTRING support will use the String class as the MBSTRING container on the Java client side. Jolt automatically converts the Unicode MBSTRING data in a String object between byte array MBSTRING data, which is the ATMI&#8217;s MBSTRING representation, when the data is transferred between a Jolt client and a Tuxedo server.
</p>
<p class="pBody"><a name="wp1073967"> </a>
The following methods are added to <code class="cCode">bea.jolt.Message</code> interface and to <code class="cCode">bea.jolt.JoltMessage</code> and <code class="cCode">bea.jolt.JoltRemoteService</code> classes.
</p>
<p class="pBody"><a name="wp1073969"> </a>
<code class="cCode">addMBString<br />setMBString<br />setMBStringItem<br />getMBStringDef<br />getMBStringItemDef</code>
</p>
<p class="pBody"><a name="wp1074003"> </a>
The usage of the MBSTRING buffer type is very similar to the STRING buffer type except that the buffer type specified in the Jolt Repository Editor is &#8220;MBSTRING&#8221; and the Java methods used for setting and getting the MBSTRING data are listed above.
</p>
<p class="pBody"><a name="wp1074005"> </a>
In addition, the following Java system properties are used to specify the character encoding name for MBSTRING data sent to Tuxedo servers.
</p>
<h4 class="pDefTerm"><a name="wp1074007"> </a>
<code class="cCode">bea.jolt.mbencoding</code>
</h4><div class="pDefPara"><a name="wp1074009"> </a>
The Tuxedo encoding name used for converting Unicode MBSTRING data to the corresponding byte array MBSTRING data while sending MBSTRING data to a Tuxedo server. If this property is not specified, the Java default character encoding name is used and mapped to the corresponding Tuxedo encoding name. For example, the default Japanese Windows encoding name &#8220;MS932&#8221; should be mapped to the corresponding Tuxedo encoding name &#8220;CP932&#8221; and specified in this property.
</div>
<h4 class="pDefTerm"><a name="wp1074011"> </a>
<code class="cCode">bea.jolt.mbencodingmap</code>
</h4><div class="pDefPara"><a name="wp1074044"> </a>
The full path name for the file which specifies character encoding name mapping between Jolt clients and Tuxedo servers. This mapping is necessary because the character encoding name for the same character encoding is sometimes different between Java and Tuxedo. For example, the default Japanese Windows encoding name is MS932 in Java, but in Tuxedo it is CP932. If this property is not specified, mapping is not done. 
</div>
<div class="pDefParaCont"><a name="wp1074248"> </a>
This means that the Java character encoding name is directly set in the MBSTRING data sent to the Tuxedo server, and the encoding name which is set in the received MBSTRING data from the Tuxedo server is used as the Java encoding name. This may cause a conversion error if the encoding name is not supported by Java or Tuxedo.
<a name="wp1074258"> </a>
To specify the bea.jolt.mbencoding or bea.jolt.mbencodingmap, <code class="cCode">jolti18n.jar</code> must be included in the <code class="cCode">CLASSPATH</code>. If <code class="cCode">jolti18n.jar</code> is not included in the <code class="cCode">CLASSPATH</code>, the encoding name is set to &#8220;ISO-8859-1&#8221; and no encoding name is done between Java and Tuxedo even if these properties are specified in the Java command line.
</div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1074262"> </a>
Multithreaded Applications
</h2><p class="pBody"><a name="wp1073954"> </a>
As a Java-based set of classes, Jolt supports multithreaded applications; however, various implementations of the Java language differ with respect to certain language and environment features. Jolt programmers need to be aware of the following:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1015952"> </a>The use of preemptive and non-preemptive threads when creating applications or applets with the Jolt Class Library.</li>
<li><a name="wp1015953"> </a>The use of threads to get asynchronous behavior similar to the <code class="cCode">tpacall()</code> function in Oracle Tuxedo.</li>
</ul></div>
<p class="pBody"><a name="wp1015827"> </a>
<a href="dvlibrary.html#wp1008023">Threads of Control</a> describes the issues arising from using threads with different Java implementations and is followed by an example of the use of threads in a Jolt program.
</p>
<a name="wp1008022"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Most Java implementations provide preemptive rather than non-preemptive threads. The difference between these two models can lead to very different performance and programming requirements.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1008023"> </a>
Threads of Control
</h3>
<p class="pBody"><a name="wp1008024"> </a>
Each concurrently operating task in the Java virtual machine is a thread. Threads exist in various states, the important ones being RUNNING, RUNNABLE, or BLOCKED. 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008026"> </a>A RUNNING thread is a currently executing thread. </li>
<li><a name="wp1008028"> </a>A RUNNABLE thread can be run once the current thread has relinquished control of the CPU. There can be many threads in the RUNNABLE state, but only one can be in the RUNNING state. Running a thread means changing the state of a thread from RUNNABLE to RUNNING, and causing the thread to have control of the Java Virtual Machine (VM).</li>
<li><a name="wp1008031"> </a>A BLOCKED thread is a thread that is waiting on the availability of some event or resource.</li>
</ul></div>
<a name="wp1008032"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The Java VM schedules threads of the same priority to run in a round-robin mode.</td>
</tr>
</table>

<h4 class="pHeading3"><a name="wp1008033"> </a>
Preemptive Threading
</h4>
<p class="pBody"><a name="wp1008034"> </a>
The main performance difference between the two threading models arises in telling a running thread to relinquish control of the Java VM. In a preemptive threading environment, the usual procedure is to set a hardware timer that goes off periodically. When the timer goes off, the current thread is moved from the RUNNING to the RUNNABLE state, and another thread is chosen to run. 
</p>
<h4 class="pHeading3"><a name="wp1008035"> </a>
Non-Preemptive Threading
</h4>
<p class="pBody"><a name="wp1008037"> </a>
In a non-preemptive threading environment, a thread must volunteer to give up control of the CPU and move to the RUNNABLE state. Many methods in the Java language classes contain code that volunteers to give up control, and are typically associated with actions that might take a long time. For example, reading from the network generally causes a thread to wait for a packet to arrive. A thread that is waiting on the availability of some event or resource is in the BLOCKED state. When the event occurs or the resource becomes available, the thread becomes RUNNABLE.
</p>
<h3 class="pHeading2"><a name="wp1008039"> </a>
Using Jolt with Non-Preemptive Threading
</h3>
<p class="pBody"><a name="wp1008040"> </a>
If your Jolt-based Java program is running on a non-preemptive threading Virtual Machine (such as Sun Solaris), the program must either:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008041"> </a>Occasionally call a method that blocks the thread, or</li>
<li><a name="wp1008043"> </a>Explicitly give up control of the CPU using the <code class="cCode">Thread.yield()</code> method</li>
</ul></div>
<p class="pBody"><a name="wp1008044"> </a>
The typical usage is to make the following call in all long-running code segments or potentially time-consuming loops:
</p>
<a name="wp1008045"> </a><div class="pPreformatted"><pre>Thread.currentThread.yield();</pre></div><p class="pBody"><a name="wp1008046"> </a>
Without sending this message, the threads used by the Jolt Library may never get scheduled and, as such, the Jolt operation is impaired.
</p>
<p class="pBody"><a name="wp1008048"> </a>
The only virtual machine known to use non-preemptive threading is the Java Developer&#8217;s Kit (JDK) machine running on a Sun platform. If you want your applet to work on JDK 1.3, you must make sure to send the yield messages. As mentioned earlier, some methods contain yields. An important exception is the <code class="cCode">System.in.read</code> method. This method does not cause a thread switch. Rather than rely on these messages, we suggest using yields explicitly.
</p>
<h3 class="pHeading2"><a name="wp1016040"> </a>
Using Threads for Asynchronous Behavior
</h3>
<p class="pBody"><a name="wp1016041"> </a>
You can use threads in Jolt to get asynchronous behavior that is analogous to the <code class="cCode">tpacall()</code> function in Oracle Tuxedo. With this capability, you do not need an asynchronous service request function. You can get this functionality because Jolt is thread-safe. For example, the Jolt client application can start one thread that sends a request to an Oracle Tuxedo service function and then immediately start another thread that sends another request to an Oracle Tuxedo service function. So even though the Jolt <code class="cCode">tpacall()</code> is synchronous, the application is asynchronous because the two threads are running at the same time. 
</p>
<h3 class="pHeading2"><a name="wp1016038"> </a>
Using Threads with Jolt
</h3>
<p class="pBody"><a name="wp1008055"> </a>
A Jolt client-side program or applet is fully thread-safe. Jolt support of multithreaded applications includes the following client characteristics:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008056"> </a>Multiple sessions per client</li>
<li><a name="wp1015361"> </a>Multithreaded within a session</li>
<li><a name="wp1008057"> </a>Client application manages threads, not asynchronous calls</li>
<li><a name="wp1008058"> </a>Performs synchronous calls</li>
</ul></div>
<p class="pBody"><a name="wp1016024"> </a>
<a href="dvlibrary.html#wp1013413">Listing&#160;5-11</a> illustrates the use of two threads in a Jolt application.
</p>
<div class="pCodeTitle"><a name="wp1013413"> </a>
Listing&#160;5-11	   Using Multiple Threads with Jolt (ThreadBank.java)
</div> <a name="wp1013414"> </a><div class="pPreformatted"><pre>/* Copyright 1996 Oracle Systems, Inc.  All Rights Reserved */<br />import bea.jolt.*;<br />public class ThreadBank<br />{<br />   public static void main (String [] args)<br />   {<br />      JoltSession session;<br />      try<br />      {<br />         JoltSessionAttributes dattr;<br />         String userName = null;<br />         String userPasswd = null;<br />         String appPasswd = null;<br />         String userRole = null;</pre></div><a name="wp1022828"> </a><div class="pPreformatted"><pre>         // fill in attributes required<br />         dattr = new JoltSessionAttributes();<br />         dattr.setString(dattr.APPADDRESS,&#8221;//bluefish:8501&#8221;);</pre></div><a name="wp1022827"> </a><div class="pPreformatted"><pre>         // instantiate domain<br />         // check authentication level<br />         switch (dattr.checkAuthenticationLevel())<br />         {</pre></div><a name="wp1012979"> </a><div class="pPreformatted"><pre>         case JoltSessionAttributes.NOAUTH:<br />              System.out.println(&#8220;NOAUTH\n&#8221;);<br />              break;<br />         case JoltSessionAttributes.APPASSWORD:<br />              appPasswd = &#8220;myAppPasswd&#8221;;<br />              break;<br />         case JoltSessionAttributes.USRPASSWORD:<br />              userName = &#8220;myName&#8221;;<br />              userPasswd = &#8220;mySecret&#8221;;<br />              appPasswd = &#8220;myAppPasswd&#8221;;<br />              break;<br />   }<br />         dattr.setInt(dattr.IDLETIMEOUT, 60);<br />         session = new JoltSession (dattr, userName, userRole,<br />                                    userPasswd, appPasswd);<br />         T1 t1 = new T1 (session);<br />         T2 t2 = new T2 (session);</pre></div><a name="wp1022796"> </a><div class="pPreformatted"><pre>         t1.start();<br />         t2.start();</pre></div><a name="wp1022829"> </a><div class="pPreformatted"><pre>         Thread.currentThread().yield();<br />         try<br />         {<br />            while (t1.isAlive() &amp;&amp; t2.isAlive())<br />            {<br />               Thread.currentThread().sleep(1000);<br />               <br />            }<br />         }<br />         catch (InterruptedException e)<br />         {<br />            System.err.println(e);<br />            if (t2.isAlive())<br />            {<br />               System.out.println(&#8220;job 2 is still alive&#8221;);<br />               try<br />               {<br />                  Thread.currentThread().sleep(1000);<br />               }<br />               catch (InterruptedException e1)<br />               {   <br />                  System.err.println(e1);<br />               }<br />            }<br />            else if (t1.isAlive())<br />            {   System.out.println(&#8220;job1 is still alive&#8221;);<br />               try<br />               {<br />                  Thread.currentThread().sleep(1000);<br />               }<br />               catch (InterruptedException e1)<br />               {<br />                  System.err.println(e1);<br />               }<br />            }<br />         }<br />         session.endSession();<br />      }<br />      catch (SessionException e)<br />      {<br />         System.err.println(e);<br />      }<br />      finally<br />      {<br />         System.out.println(&#8220;normal ThreadBank term&#8221;);<br />      }<br />   }<br />}<br /><br />class T1 extends Thread<br />{<br />   JoltSession j_session;<br />   JoltRemoteService j_withdrawal;</pre></div><a name="wp1022830"> </a><div class="pPreformatted"><pre>   public T1 (JoltSession session)<br />   {<br />      j_session=session;<br />      j_withdrawal= new JoltRemoteService(&#8220;WITHDRAWAL&#8221;,j_session);<br />   }<br />   public void run() <br />   {<br />      j_withdrawal.addInt(&#8220;ACCOUNT_ID&#8221;,10001);<br />      j_withdrawal.addString(&#8220;SAMOUNT&#8221;,&#8221;100.00&#8221;);<br />      try<br />      {<br />         System.out.println(&#8220;Initiating Withdrawal from account 10001&#8221;);<br />         j_withdrawal.call(null);<br />         String W = j_withdrawal.getStringDef(&#8220;SBALANCE&#8221;,&#8221;-1.0&#8221;);<br />         System.out.println(&#8220;--&gt;Withdrawal Balance: &#8220; + W);<br />      }<br />      catch (ApplicationException e)<br />      {<br />         e.printStackTrace();<br />         System.err.println(e);<br />      }<br />   }<br />}</pre></div><a name="wp1022831"> </a><div class="pPreformatted"><pre>class T2 extends Thread<br />{<br />   JoltSession j_session;<br />   JoltRemoteService j_deposit;</pre></div><a name="wp1022832"> </a><div class="pPreformatted"><pre>   public T2 (JoltSession session)<br />   {<br />      j_session=session;<br />      j_deposit= new JoltRemoteService(&#8220;DEPOSIT&#8221;,j_session);<br />   }<br />   public void run() <br />   {<br />      j_deposit.addInt(&#8220;ACCOUNT_ID&#8221;,10000);<br />      j_deposit.addString(&#8220;SAMOUNT&#8221;,&#8221;100.00&#8221;);<br />      try<br />      {<br />         System.out.println(&#8220;Initiating Deposit from account 10000&#8221;);<br />         j_deposit.call(null);<br />         String D = j_deposit.getStringDef(&#8220;SBALANCE&#8221;,&#8221;-1.0&#8221;);<br />         System.out.println(&#8220;--&gt;Deposit Balance: &#8220; + D);<br />      }<br />      catch (ApplicationException e)<br />      {<br />         e.printStackTrace();<br />         System.err.println(e);<br />      }<br />   }<br />}</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1012983"> </a>
Event Subscription and Notifications
</h2><p class="pBody"><a name="wp1014765"> </a>
Programmers developing client applications with Jolt can receive event notifications from either Oracle Tuxedo Services or other Oracle Tuxedo clients. The Jolt Class Library contains classes that support the following types of Oracle Tuxedo notifications for handling event-based communication:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008845"> </a><b class="cBold">Unsolicited Event Notifications</b>&#8212;these are notifications that a Jolt client receives as a result of an Oracle Tuxedo client or service issuing a broadcast using either a <code class="cCode">tpbroadcast()</code> or a directly targeted message via a<code class="cCode"> tpnotify()</code> ATMI call.</li>
<li><a name="wp1008846"> </a><b class="cBold">Brokered Event Notifications</b>&#8212;these notifications are received by a Jolt client through the Oracle Tuxedo Event Broker. The notifications are only received when the Jolt client subscribes to an event <em class="cEmphasis">and</em> any Oracle Tuxedo client or server issues a system-posted event or <code class="cCode">tppost()</code> call.</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1011551"> </a>
Event Subscription Classes
</h3>
<p class="pBody"><a name="wp1011548"> </a>
The Jolt Class Library provides four classes that implement the asynchronous notification mechanism for Jolt client applications:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1011600"> </a>JoltSession&#8212;the JoltSession class includes an <code class="cCode">onReply()</code> method for receiving notifications and notification messages.</li>
<li><a name="wp1018754"> </a>JoltReply&#8212;the JoltReply class gives the client application access to any messages received with an event or notification.</li>
<li><a name="wp1018755"> </a>JoltMessage&#8212;the JoltMessage class provides <code class="cCode">get()</code> methods for obtaining information about the notification or event.</li>
<li><a name="wp1011649"> </a>JoltUserEvent&#8212;the JoltUserEvent class supports subscription to both unsolicited and event notification types. </li>
</ul></div>
<p class="pBody"><a name="wp1011813"> </a>
For additional information about these classes refer to the Oracle Jolt API Reference.
</p>
<h3 class="pHeading2"><a name="wp1010063"> </a>
Notification Event Handler
</h3>
<p class="pBody"><a name="wp1010076"> </a>
For both unsolicited notifications and a brokered event notification, the Jolt client application requires an event handler routine that is invoked upon receipt of a notification. Jolt only supports a single handler per session. In Oracle Tuxedo versions, you cannot determine which event generated a notification. Therefore, you cannot invoke an event-specific handler based on a particular event. 
</p>
<p class="pBody"><a name="wp1011535"> </a>
The client application must provide a single handler (by overriding the <code class="cCode">onReply()</code> method) per session that will be invoked for all notifications received by that client for that session. The single handler call-back function is used for both unsolicited and event notification types. It is up to the (user-supplied) handler routine to determine what event caused the handler invocation and to take appropriate action. If the user does not override the session handler, then notification messages are silently discarded by the default handler.
</p>
<p class="pBody"><a name="wp1014560"> </a>
The Jolt client provides the call back function by subclassing the JoltSession class and overriding the <code class="cCode">onReply()</code> method with a user-defined <code class="cCode">onReply()</code> method.
</p>
<p class="pBody"><a name="wp1010306"> </a>
In Oracle Tuxedo/ATMI clients, processing in the handler call-back function is limited to a subset of ATMI calls. This restriction does not apply to Jolt clients. Separate threads are used to monitor notifications and run the event handler method. A Jolt client can perform all Jolt-supported functionality from within the handler. All the rules that apply to a normal Jolt client program apply to the handler, such as a single transaction per session at any time.
</p>
<p class="pBody"><a name="wp1010307"> </a>
Each invocation of the handler method takes place in a separate thread. The application developer should ensure that the <code class="cCode">onReply() </code>method is either synchronized or written thread-safe, because separate threads could be executing the method simultaneously.
</p>
<p class="pBody"><a name="wp1011477"> </a>
Jolt uses an implicit model for enabling the handler routine. When a client subscribes to an event, Jolt internally enables the handler for that client, thus enabling unsolicited notifications as well. A Jolt client cannot subscribe to event notifications without also receiving unsolicited notifications. In addition, a single <code class="cCode">onReply()</code> method is invoked for both types of notifications.
</p>
<h3 class="pHeading2"><a name="wp1010182"> </a>
Connection Modes
</h3>
<p class="pBody"><a name="wp1008855"> </a>
Jolt supports notification receipts for clients working in either connection-retained or connection-less modes of operation. Connection-retained clients receive all notifications. Jolt clients working in connection-less mode receive notifications while they have an active network connection to the Jolt Session Handler (JSH). When the network connection is closed, the JSH logs and drops notifications destined for the client. Jolt clients operating in a connection-less mode do not receive unsolicited messages or notifications while they do not have an active network connection. All messages received during this time are logged and discarded by the JSH.
</p>
<p class="pBody"><a name="wp1008856"> </a>
Connection mode notification handling includes acknowledged notifications for Jolt&#160; clients in the Oracle Tuxedo environment. If a JSH receives an acknowledged notification for a client and the client does not have an active network connection, the JSH logs an error and returns a failure acknowledgment to the notification.
</p>
<h3 class="pHeading2"><a name="wp1010526"> </a>
Notification Data Buffers
</h3>
<p class="pBody"><a name="wp1010527"> </a>
When a client receives notification, it is accompanied by a data buffer. The data buffer can be of any Oracle Tuxedo data buffer type. Jolt clients (for example, the handler) receive these buffers as a <code class="cCode">JoltMessage</code> object and should use the appropriate <code class="cCode">JoltMessage</code> class <code class="cCode">get*()</code> methods to retrieve the data from this object. 
</p>
<p class="pBody"><a name="wp1010723"> </a>
The Jolt Repository does not need to have the definition of the buffers used for notification. However, the Jolt client application programmer needs to know field names. 
</p>
<p class="pBody"><a name="wp1010733"> </a>
The Jolt system does not provide functionality equivalent to <code class="cCode">tptypes()</code> in Oracle Tuxedo. For FML and VIEW buffers, the data is accessed using the <code class="cCode">get*()</code> methods with the appropriate field name, for example:
</p>
<a name="wp1010528"> </a><div class="pPreformatted"><pre>getIntDef (&quot;ACCOUNT_ID&quot;, -1);</pre></div><p class="pBody"><a name="wp1010529"> </a>
For STRING and CARRAY buffers, the data is accessed by the same name as the buffer type:
</p>
<a name="wp1010530"> </a><div class="pPreformatted"><pre>getStringDef (&quot;STRING&quot;, null);<br />getBytesDef (&quot;CARRAY&quot;, null);</pre></div><p class="pBody"><a name="wp1010532"> </a>
STRING and CARRAY buffers contain only a single data element. This complete element is returned by the preceding <code class="cCode">get*()</code> methods.
</p>
<h3 class="pHeading2"><a name="wp1010829"> </a>
Oracle Tuxedo Event Subscription
</h3>
<p class="pBody"><a name="wp1010842"> </a>
Oracle Tuxedo brokered event notification allows Oracle Tuxedo programs to post events without knowing what other programs are supposed to receive notification of an event&#8217;s occurrence. The Jolt event notification allows Jolt client applications to subscribe to Oracle Tuxedo events that are broadcast or posted using the Oracle Tuxedo <code class="cCode">tpnotify()</code> or <code class="cCode">tpbroadcast()</code> calls.
</p>
<p class="pBody"><a name="wp1010979"> </a>
Jolt clients can only subscribe to events and notifications that are generated by other components in Oracle Tuxedo (such as an Oracle Tuxedo service or client). Jolt clients can not send events or notifications.
</p>
<h4 class="pHeading3"><a name="wp1010589"> </a>
Supported Subscription Types
</h4>
<p class="pBody"><a name="wp1010952"> </a>
Jolt only supports notification types of subscriptions. The Jolt <code class="cCode">onReply()</code> method is called when a subscription is fulfilled. The Jolt API does not support dispatching a service routine or enqueueing a message to an application queue when a notification is received.
</p>
<h4 class="pHeading3"><a name="wp1008885"> </a>
Subscribing to Notifications
</h4>
<p class="pBody"><a name="wp1008886"> </a>
If a Jolt client subscribes to a single event notification, the client receives both unsolicited messages and event notification. Subscribing to an event implicitly enables unsolicited notification. This means that if the application creates a JoltUserEvent object for Event &quot;X&quot;, the client automatically receives notifications directed to it as a result of <code class="cCode">tpnotify()</code> or <code class="cCode">tpbroadcast()</code>. 
</p>
<a name="wp1011024"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Subscribing to single event notification is <em class="cEmphasis">not </em>the recommended method for enabling unsolicited notification. If you want unsolicited notification, the application should explicitly subscribe to unsolicited notifications (as described in the JoltUserEvent class). The next section is about <em class="cEmphasis">unsubscribing</em> from notifications. </td>
</tr>
</table>

<h4 class="pHeading3"><a name="wp1008887"> </a>
Unsubscribing from Notifications
</h4>
<p class="pBody"><a name="wp1014296"> </a>
To stop subscribing to event notifications and/or unsolicited messages, you need to use the JoltUserEvent unsubscribe method. In Jolt, disabling unsolicited notifications with an unsubscribe method does not turn off all subscription notifications. This differs from Oracle Tuxedo. In Oracle Tuxedo the use of <code class="cCode">tpsetunsol()</code> with a NULL handler turns off all subscription notifications.
</p>
<p class="pBody"><a name="wp1014301"> </a>
When unsubscribing, the following considerations apply:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1014182"> </a>If a client is subscribed to a single event, unsubscribing from notification disables both event notification and unsolicited messages.</li>
<li><a name="wp1008889"> </a>If a client has multiple subscriptions, then unsubscribing from any single subscription disables only that single subscription. Unsolicited notifications continue. Only the last subscription to be unsubscribed causes unsolicited notification to stop. </li>
<li><a name="wp1014026"> </a>If a client subscribes to both unsolicited and event notifications, then unsubscribing to only the unsolicited notification will not stop either type of notification from continuing. In addition, this unsubscribe does not throw an exception. However, the Jolt API notes that an unsubscribe has taken place, and a subsequent unsubscribe to the remaining event disables both event notification and unsolicited messages.</li>
</ul></div>
<p class="pBody"><a name="wp1014354"> </a>
If you want to stop unsolicited messages in your client application, you need to make sure that you have unsubscribed to all events. 
</p>
<h3 class="pHeading2"><a name="wp1011044"> </a>
Using the Jolt API to Receive Oracle Tuxedo Notifications
</h3>
<p class="pBody"><a name="wp1012129"> </a>
The <a href="dvlibrary.html#wp1008960">Asynchronous Notification</a> listing shows how to use the Jolt Class Library for receiving notifications and includes the use of the <code class="cCode">JoltSession</code>, <code class="cCode">JoltReply</code>, <code class="cCode">JoltMessage</code> and <code class="cCode">JoltUserEvent</code> classes.
</p>
<div class="pCodeTitle"><a name="wp1008960"> </a>
Listing&#160;5-12	   Asynchronous Notification
</div> <a name="wp1009049"> </a><div class="pPreformatted"><pre>class EventSession extends <code class="cCodeBold">JoltSession<br /></code>{<br />    public EventSession( <code class="cCodeBold">JoltSessionAttributes</code> attr, String user,<br />                         String role, String upass, String apass )<br />    {<br />           super(attr, user, role, upass, apass);<br />    }<br />    /**<br />    * Override the default unsolicited message handler.<br />    * @param reply a place holder for the unsolicited message<br />    * @see bea.jolt.JoltReply<br />    */<br />    public void <code class="cCodeBold">onReply</code>( JoltReply reply )<br />    {<br />        // Print out the STRING buffer type message which contains<br />        // only one field; the field name must be &quot;STRING&quot;.  If the<br />        // message uses CARRAY buffer type, the field name must be<br />        // &quot;CARRAY&quot;.  Otherwise, the field names must conform to the<br />        // elements in FML or VIEW.</pre></div><a name="wp1022934"> </a><div class="pPreformatted"><pre>        <code class="cCodeBold">JoltMessage</code> msg = (JoltMessage) reply.getMessage();<br />        System.out.println(msg.getStringDef(&quot;STRING&quot;, &quot;No Msg&quot;));<br />    }<br />    public static void main( Strings args[] )<br />    {<br />        <code class="cCodeBold">JoltUserEvent</code>&#160;&#160;unsolEvent;<br />        JoltUserEvent&#160;&#160;&#160;helloEvent;<br />        EventSession&#160;&#160;&#160;&#160;session;<br />        ...</pre></div><a name="wp1008996"> </a><div class="pPreformatted"><pre>        // Instantiate my session object which can print out the<br />        // unsolicited messages.  Then subscribe to HELLO event<br />        // and Unsolicited Notification which both use STRING<br />        // buffer type for the unsolicited messages.</pre></div><a name="wp1022935"> </a><div class="pPreformatted"><pre>        session = new EventSession(...);<br /><br />        helloEvent = new JoltUserEvent(&quot;HELLO&quot;, null, session);<br />        unsolEvent = new JoltUserEvent(JoltUserEvent.UNSOLMSG, null,<br />                                       session);<br />        ...<br />        // Unsubscribe the HELLO event and unsolicited notification.<br />        helloEvent.<code class="cCodeBold">unsubscribe</code>();<br />        unsolEvent.unsubscribe();<br />    }<br />}</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1008811"> </a>
Clearing Parameter Values
</h2><p class="pBody"><a name="wp1057902"> </a>
The Jolt Class Library contains the <code class="cCode">clear()</code> method, which allows you to remove existing attributes from an object and, in effect, provides for the reuse of the object. The <a href="dvlibrary.html#wp1008226">Jolt Object Reuse (reuseSample.java)</a> listing illustrates how to use the <code class="cCode">clear()</code> method to clear parameter values and how to reuse the JoltRemoteService parameter values; you do not have to destroy the service to reuse it. Instead, the <code class="cCode">svc.clear()</code>; statement is used to discard the existing input parameters before reusing the <code class="cCode">addString()</code> method.
</p>
<div class="pCodeTitle"><a name="wp1008226"> </a>
Listing&#160;5-13	   Jolt Object Reuse (reuseSample.java)
</div> <a name="wp1008227"> </a><div class="pPreformatted"><pre>/* Copyright 1999 Oracle Systems, Inc. All Rights Reserved */<br />import java.net.*;<br />import java.io.*;<br />import bea.jolt.*;<br />/*<br /> * This is a Jolt sample program that illustrates how to reuse the<br /> * JoltRemoteService after each invocation.<br /> */<br />class reuseSample<br />{<br /><code class="cCodeBold">    </code>private static JoltSession s_session;<br /><code class="cCodeBold">    </code>static void init( String host, short port )<br /><code class="cCodeBold">    </code>{<br />        /* Prepare to connect to the Tuxedo domain.  */<br />        JoltSessionAttributes attr = new JoltSessionAttributes();<br />        attr.setString(attr.APPADDRESS,&#8221;//&#8221;+ host+&#8221;:&#8221; + port);</pre></div><a name="wp1023042"> </a><div class="pPreformatted"><pre>        String username = null;<br />        String userrole = &#8220;sw-developer&#8221;;<br />        String applpasswd = null;<br />        String userpasswd = null;</pre></div><a name="wp1023068"> </a><div class="pPreformatted"><pre>        /* Check what authentication level has been set. */<br />        switch (attr.checkAuthenticationLevel())<br />        {<br />            case JoltSessionAttributes.NOAUTH:<br />                break;<br />            case JoltSessionAttributes.APPASSWORD:<br />                applpasswd = &#8220;secret8&#8221;;<br />                break;<br />            case JoltSessionAttributes.USRPASSWORD:<br />                username = &#8220;myName&#8221;;<br />                userpasswd = &#8220;BEA#1&#8221;;<br />                applpasswd = &#8220;secret8&#8221;;<br />                break;<br />        }</pre></div><a name="wp1023199"> </a><div class="pPreformatted"><pre>        /* Logon now without any idle timeout (0). */<br />        /* The network connection is retained until logoff. */<br />        attr.setInt(attr.IDLETIMEOUT, 0);<br />        s_session = new JoltSession(attr, username, userrole,<br />        userpasswd, applpasswd);<br />    }</pre></div><a name="wp1023258"> </a><div class="pPreformatted"><pre>    public static void main( String args[] )<br />    {<br />        String host;<br />        short  port;<br />        JoltRemoteService svc;</pre></div><a name="wp1023283"> </a><div class="pPreformatted"><pre>        if (args.length != 2)<br />        {<br />            System.err.println(&#8220;Usage: reuseSample host port&#8221;);<br />            System.exit(1);<br />        }</pre></div><a name="wp1023343"> </a><div class="pPreformatted"><pre>        /* Get the host name and port number for initialization. */<br />        host = args[0];<br />        port = (short)Integer.parseInt(args[1]);</pre></div><a name="wp1023422"> </a><div class="pPreformatted"><pre>        init(host, port);</pre></div><a name="wp1023425"> </a><div class="pPreformatted"><pre>        /* Get the object reference to the DELREC service.  This<br />         * service has no output parameters, but has only one input<br />         * parameter.<br />         */<br />        svc = new JoltRemoteService(&#8220;DELREC&#8221;, s_session);<br />        try<br />        {<br />            /* Set input parameter REPNAME. */<br />            svc.addString(&#8220;REPNAME&#8221;, &#8220;Record1&#8221;);<br />            svc.call(null);<br />            /* Change the input parameter before reusing it */<br />            svc.setString(&#8220;REPNAME&#8221;, &#8220;Record2&#8221;);<br />            svc.call(null);</pre></div><a name="wp1023632"> </a><div class="pPreformatted"><pre>            /* Simply discard all input parameters */<br />            svc.clear();<br />            svc.addString(&#8220;REPNAME&#8221;, &#8220;Record3&#8221;);<br />            svc.call(null);<br />        }<br />        catch (ApplicationException e)<br />        {<br />            System.err.println(&#8220;Service DELREC failed: &#8220;+<br />            e.getMessage()+&#8221; &#8220;+ svc.getStringDef(&#8220;MESSAGE&#8221;, null));<br />        }</pre></div><a name="wp1023734"> </a><div class="pPreformatted"><pre>        /* Logoff now and get rid of the object. */<br />        s_session.endSession();<br />    }<br />} </pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1008320"> </a>
Reusing Objects
</h2><p class="pBody"><a name="wp1015332"> </a>
The following listing, <a href="dvlibrary.html#wp1008323">Extending Jolt Remote Service (extendSample.java),</a> illustrates one way to subclass the JoltRemoteService class. In this case, a TransferService class is created by subclassing the JoltRemoteService class. The TransferService class extends the JoltRemoteService class, adding a Transfer feature that makes use of the Oracle Tuxedo BANKAPP funds TRANSFER service.
</p>
<p class="pBody"><a name="wp1015360"> </a>
<a href="dvlibrary.html#wp1008323">Listing&#160;5-14</a> uses the <code class="cCode">extends</code> keyword from the Java language. The <code class="cCode">extends</code> keyword is used in Java to subclass a base (parent) class. The following code shows one of many ways to extend from JoltRemoteService.
</p>
<div class="pCodeTitle"><a name="wp1008323"> </a>
Listing&#160;5-14	   Extending Jolt Remote Service (extendSample.java)
</div> <a name="wp1008324"> </a><div class="pPreformatted"><pre>/* Copyright 1999 Oracle Systems, Inc. All Rights Reserved */</pre></div><a name="wp1023772"> </a><div class="pPreformatted"><pre>import java.net.*;<br />import java.io.*;<br />import bea.jolt.*;</pre></div><a name="wp1023781"> </a><div class="pPreformatted"><pre>/*<br /> * This Jolt sample code fragment illustrates how to customize<br /> * JoltRemoteService. It uses the Java language &#8220;extends&#8221; mechanism <br /> */<br />class TransferService extends JoltRemoteService<br />{<br />    public String  fromBal;<br />    public String  toBal;</pre></div><a name="wp1023782"> </a><div class="pPreformatted"><pre>    public TransferService( JoltSession session )<br />    {<br />        super(&#8220;TRANSFER&#8221;, session);<br />    }</pre></div><a name="wp1023787"> </a><div class="pPreformatted"><pre>    public String doxfer( int fromAcctNum, int toAcctNum, String amount )<br />    {<br />        /* Clear any previous input parameters */<br />        this.clear();</pre></div><a name="wp1023796"> </a><div class="pPreformatted"><pre>        /* Set the input parameters */<br />        this.setIntItem(&#8220;ACCOUNT_ID&#8221;, 0, fromAcctNum);<br />        this.setIntItem(&#8220;ACCOUNT_ID&#8221;, 1, toAcctNum);<br />        this.setString(&#8220;SAMOUNT&#8221;, amount );</pre></div><a name="wp1023813"> </a><div class="pPreformatted"><pre>        try<br />        {<br />            /* Invoke the transfer service. */<br />            this.call(null);</pre></div><a name="wp1023958"> </a><div class="pPreformatted"><pre>            /* Get the output parameters */<br />            fromBal = this.getStringItemDef(&#8220;SBALANCE&#8221;, 0, null);<br />            if (fromBal == null)<br />                return &#8220;No balance from Account &#8220; + <br />                fromAcctNum;<br />            toBal = this.getStringItemDef(&#8220;SBALANCE&#8221;, 1, null);<br />            if (toBal == null)<br />                return &#8220;No balance from Account &#8220; + toAcctNum;<br />            return null;<br />        }<br />        catch (ApplicationException e)<br />        {<br />            /* The transaction failed, return the reason */<br />            return this.getStringDef(&#8220;STATLIN&#8221;, &#8220;Unknown reason&#8221;);<br />        }<br />    }<br />}</pre></div><a name="wp1023945"> </a><div class="pPreformatted"><pre>class extendSample<br />{<br />    public static void main( String args[] )<br />    {<br />        JoltSession s_session;<br />        String<code class="cCodeBold">   </code>host;<br />        short    port;<br />        TransferService xfer;<br />        String   failure;</pre></div><a name="wp1024021"> </a><div class="pPreformatted"><pre>        if (args.length != 2)<br />        {<br />            System.err.println(&#8220;Usage: reuseSample host port&#8221;);<br />        System.exit(1);<br />        }</pre></div><a name="wp1024100"> </a><div class="pPreformatted"><pre>        /* Get the host name and port number for initialization. */<br />        host = args[0];<br />        port = (short)Integer.parseInt(args[1]);</pre></div><a name="wp1024113"> </a><div class="pPreformatted"><pre>        /* Prepare to connect to the Tuxedo domain.  */<br />        JoltSessionAttributes attr = new JoltSessionAttributes();<br />        attr.setString(attr.APPADDRESS,&#8221;//&#8221;+ host+&#8221;:&#8221; + port);</pre></div><a name="wp1024154"> </a><div class="pPreformatted"><pre>        String username = null;<br />        String userrole = &#8220;sw-developer&#8221;;<br />        String applpasswd = null;<br />        String userpasswd = null;</pre></div><a name="wp1024155"> </a><div class="pPreformatted"><pre>        /* Check what authentication level has been set. */<br />        switch (attr.checkAuthenticationLevel())<br />        {<br />            case JoltSessionAttributes.NOAUTH:<br />                break;<br />            case JoltSessionAttributes.APPASSWORD:<br />                applpasswd = &#8220;secret8&#8221;;<br />                break;<br />            case JoltSessionAttributes.USRPASSWORD:<br />                username = &#8220;myName&#8221;;<br />                userpasswd = &#8220;BEA#1&#8221;;<br />                applpasswd = &#8220;secret8&#8221;;<br />                break;<br />        }</pre></div><a name="wp1024250"> </a><div class="pPreformatted"><pre>        /* Logon now without any idle timeout (0). */<br />        /* The network connection is retained until logoff. */<br />        attr.setInt(attr.IDLETIMEOUT, 0);<br />        s_session = new JoltSession(attr, username, userrole,<br />        userpasswd, applpasswd);</pre></div><a name="wp1024255"> </a><div class="pPreformatted"><pre>        /*<br />         * TransferService extends from JoltRemoteService and uses the<br />         * standard Oracle Tuxedo BankApp TRANSFER service.  We invoke this<br />         * service twice with different parameters.  Note, we assume<br />         * that &#8220;s_session&#8221; is initialized somewhere before.<br />         */</pre></div><a name="wp1024280"> </a><div class="pPreformatted"><pre>        xfer = new TransferService(s_session);<br />        if ((failure = xfer.doxfer(10000, 10001, &#8220;500.00&#8221;)) != null)<br />            System.err.println(&#8220;Tranasaction failed: &#8220; + failure);<br />        else<br />        {<br />            System.out.println(&#8220;Transaction is done.&#8221;);<br />            System.out.println(&#8220;From Acct Balance: &#8220;+xfer.fromBal);<br />            System.out.println(&#8220;  To Acct Balance: &#8220;+xfer.toBal);<br />        }</pre></div><a name="wp1074499"> </a><div class="pPreformatted"><pre>        if ((failure = xfer.doxfer(51334, 40343, &#8220;$123.25&#8221;)) != null)<br />            System.err.println(&#8220;Tranasaction failed: &#8220; + failure);<br />        else<br />        {<br />            System.out.println(&#8220;Transaction is done.&#8221;);<br />            System.out.println(&#8220;From Acct Balance: &#8220;+xfer.fromBal);<br />            System.out.println(&#8220;  To Acct Balance: &#8220;+xfer.toBal);<br />        }<br />} <br />}</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1008459"> </a>
Deploying and Localizing Jolt Applets
</h2><p class="pBody"><a name="wp1008461"> </a>
Using the Jolt Class Library, you can build Java applications that execute from within a client Web browser. For these types of applications, perform the following application development tasks:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008462"> </a>Deploy your Jolt applet in an HTML page.</li>
<li><a name="wp1008463"> </a>Localize your Jolt applets for different languages and character sets.</li>
</ul></div>
<p class="pBody"><a name="wp1008464"> </a>
The following sections describe these application development considerations.
</p>
<h3 class="pHeading2"><a name="wp1008465"> </a>
Deploying a Jolt Applet
</h3>
<p class="pBody"><a name="wp1008468"> </a>
When you deploy a Jolt applet, consider the following: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008471"> </a>Installation and configuration requirements for the Oracle Tuxedo server and Jolt Server</li>
<li><a name="wp1008473"> </a>Client-side execution of the applet</li>
<li><a name="wp1008474"> </a>Requirements for the Web server that downloads the Java applet </li>
</ul></div>
<p class="pBody"><a name="wp1057928"> </a>
Information for configuring the Oracle Tuxedo server and Jolt server to work with Jolt is available in <em class="cEmphasis">Installing the Oracle Tuxedo System</em>. The following sections describe common client and Web server considerations for deploying Jolt applets.
</p>
<h3 class="pHeading2"><a name="wp1008479"> </a>
Client Considerations
</h3>
<p class="pBody"><a name="wp1008480"> </a>
When you write a Java applet that incorporates Jolt classes, the applet works just as any other Java applet in an HTML page. A Jolt applet can be embedded in an HTML page using the HTML applet tag:
</p>
<a name="wp1008484"> </a><div class="pPreformatted"><pre>&lt;applet code=&#8220;applet_name.class&#8221;&gt; &lt;/applet&gt;</pre></div><p class="pBody"><a name="wp1008486"> </a>
If the Jolt applet is embedded in an HTML page, the applet is downloaded when the HTML page loads. You can code the applet to run immediately after it is downloaded, or you can include code that sets the applet to run based upon a user action, a timeout, or a set interval. You can also create an applet that downloads in the HTML page, but opens in another window or, for instance, simply plays a series of sounds or musical tunes at intervals. The programmer has a large degree of freedom in coding the applet initialization procedure.
</p>
<a name="wp1008487"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If the user loads a new HTML page into the browser, the applet execution is stopped.</td>
</tr>
</table>

<h3 class="pHeading2"><a name="wp1008489"> </a>
Web Server Considerations
</h3>
<p class="pBody"><a name="wp1008494"> </a>
When you use the Jolt classes in a Java applet, the Jolt Server must run on the same machine as the Web server that downloads the Java applet unless you install Jolt Relay on the Web server.
</p>
<p class="pBody"><a name="wp1008495"> </a>
When a webmaster sets up a Web server, a directory is specified to store all the HTML files. Within that directory, a subdirectory named &#8220;classes&#8221; must be created to contain all Java class files and packages. For example: 
</p>
<a name="wp1008499"> </a><div class="pPreformatted"><pre>&lt;html-dir&gt;/classes/bea/jolt</pre></div><p class="pBody"><a name="wp1008501"> </a>
Or, you can set the <code class="cCode">CLASSPATH</code> to include the <code class="cCode">jolt.jar</code> file that contains all the Jolt classes.
</p>
<a name="wp1051953"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>You can place the Jolt classes subdirectory anywhere. For convenient access, you may want to place it in the same directory as the HTML files. The only requirement for the Jolt classes subdirectory is that the classes must be made available to the Web server. </td>
</tr>
</table>

<p class="pBody"><a name="wp1008503"> </a>
The HTML file for the Jolt applet should refer the codebase to the <code class="cCode">jolt.jar</code> file or the <code class="cCode">classes</code> directory. For example:
</p>
<a name="wp1008505"> </a><div class="pPreformatted"><pre>    /export/html/<br />        |___ classes/<br />        |    |_____ bea/<br />        |    |    |______ jolt/<br />        |    |          |_____ JoltSessionAttributes.class<br />        |    |          |_____ JoltRemoteServices.class<br />        |    |          |_____ ...<br />        |    |_____ mycompany/<br />        |         |________ app.class<br />        |___ ex1.html<br />        |___ ex2.html</pre></div><p class="pBody"><a name="wp1008507"> </a>
The webmaster may specify the &#8220;app&#8221; applet in <code class="cCode">ex1.html</code> as:
</p>
<a name="wp1008508"> </a><div class="pPreformatted"><pre>&lt;applet codebase=&#8220;classes&#8221; code=mycompany.app.class width=400 height=200&gt;</pre></div><h3 class="pHeading2"><a name="wp1008511"> </a>
Localizing a Jolt Applet
</h3>
<p class="pBody"><a name="wp1008513"> </a>
If your Jolt application is intended for international use, you must address certain localization issues. Localization considerations apply to applications that execute from a client Web browser and applications that are designed to run outside a Web browser environment. Localization tasks can be divided into two categories: 
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1008514"> </a>Adapting an application from its original language to a target language.</li>
<li><a name="wp1008515"> </a>Translating strings from one language to another. This sometimes requires specifying a different alphabet or a character set from the one used in the original language.</li>
</ul></div>
<p class="pBody"><a name="wp1008516"> </a>
For localization, the Jolt Class Library package relies on the conventions of the Java language and the Oracle Tuxedo system. Jolt transfers Java 16-bit Unicode characters to the JSH. The JSH provides a mechanism to convert Unicode to the local character set. 
</p>
<p class="pBody"><a name="wp1008517"> </a>
For information about the Java implementation for Unicode and character escapes, refer to your Java Development Kit (JDK) documentation.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1074966"> </a>
Using SSL
</h2><p class="pBody"><a name="wp1074974"> </a>
Jolt can use SSL as the preferred secure transport mechanism instead of default Link Level Encryption. To enable Jolt to use SSL, the JSL must be configured with &#39;-s secure_port&#39; in the TUXEDO UBBCONFIG file.
</p>
<p class="pBody"><a name="wp1075615"> </a>
Jolt client library automatically chooses SSL if the JSL connection port is the SSL port. The SSL requires Jolt client to provide information about the location of the X.509 certificate, the private key, and passphrase that is used to encrypt the passphrase.
</p>
<p class="pBody"><a name="wp1074979"> </a>
There are five attributes added to the JoltSessionAttributes class to handle these requirement:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1074982"> </a>KEYSTORE&#8212;file path for client private key and X.509 certificate</li>
<li><a name="wp1075042"> </a>KSPASSPHRASE&#8212;key store passphrase</li>
<li><a name="wp1075043"> </a>TRUSTSTORE&#8212;trust store file path for trusted X.509 certificates</li>
<li><a name="wp1075044"> </a>TSPASSPHRASE&#8212;trust store passphrase</li>
<li><a name="wp1074967"> </a>KEYPASSPHRASE&#8212;private key passphrase</li>
</ul></div>
<p class="pBody"><a name="wp1075079"> </a>
Jolt client library uses the third-party Java Secure Socket Extension (JSSE) implementation for SSL communication. The following JSSE implementations have been tested:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1075673"> </a>Sun JSSE implementation bundled in Sun JRE 5.0</li>
<li><a name="wp1075677"> </a>Sun JSSE implementation bundled in HP JRE 5.0</li>
<li><a name="wp1075678"> </a>IBM JSSE implementation bundled in IBM JRE 5.0</li>
</ul></div>
<p class="pBody"><a name="wp1075636"> </a>
<a href="dvlibrary.html#wp1075085">Listing&#160;5-15</a> is the sample Jolt client code to make it possible to use SSL when communicate with JSL/JSH.
</p>
<div class="pCodeTitle"><a name="wp1075085"> </a>
Listing&#160;5-15	   Using SSL in Jolt Client Code
</div> <a name="wp1075544"> </a><div class="pPreformatted"><pre>import java.util.*;<br />import bea.jolt.*;<br /></pre></div><a name="wp1075555"> </a><div class="pPreformatted"><pre>public class simpcl extends Object {</pre></div><a name="wp1075556"> </a><div class="pPreformatted"><pre>    private String           userName      = null;</pre></div><a name="wp1075557"> </a><div class="pPreformatted"><pre>    private String           userRole      = null;</pre></div><a name="wp1075375"> </a><div class="pPreformatted"><pre>    private String           appPassword   = null;</pre></div><a name="wp1075376"> </a><div class="pPreformatted"><pre>    private String           userPassword  = null;</pre></div><a name="wp1075377"> </a><div class="pPreformatted"><pre>    private JoltSessionAttributes attr     = null;</pre></div><a name="wp1075378"> </a><div class="pPreformatted"><pre>    private JoltSession          session   = null;</pre></div><a name="wp1075379"> </a><div class="pPreformatted"><pre>    private JoltRemoteService    toupper   = null;</pre></div><a name="wp1075380"> </a><div class="pPreformatted"><pre>    private JoltTransaction      trans     = null;</pre></div><a name="wp1075382"> </a><div class="pPreformatted"><pre>    // JSL is configured with &#39;-s 5555&#39;</pre></div><a name="wp1075383"> </a><div class="pPreformatted"><pre>    // the communication between jolt client and JSH will use SSL</pre></div><a name="wp1075384"> </a><div class="pPreformatted"><pre>    private String               address   = new String(&#39;//cerebrum:5555&#39;);</pre></div><a name="wp1075386"> </a><div class="pPreformatted"><pre>    public static void main(String args[]) {</pre></div><a name="wp1075387"> </a><div class="pPreformatted"><pre>        simpcl c = new simpcl();</pre></div><a name="wp1075388"> </a><div class="pPreformatted"><pre>        c.doTest();</pre></div><a name="wp1075389"> </a><div class="pPreformatted"><pre>    }</pre></div><a name="wp1075391"> </a><div class="pPreformatted"><pre>    public void doTest() {</pre></div><a name="wp1075392"> </a><div class="pPreformatted"><pre>        attr = new JoltSessionAttributes();</pre></div><a name="wp1075394"> </a><div class="pPreformatted"><pre>        // adding these session attribute</pre></div><a name="wp1075395"> </a><div class="pPreformatted"><pre>        attr.setString(attr.APPADDRESS, address);</pre></div><a name="wp1075396"> </a><div class="pPreformatted"><pre>        attr.setString(attr.TRUSTSTORE,&#39;c:\\samples\\samplecacerts&#39;);</pre></div><a name="wp1075397"> </a><div class="pPreformatted"><pre>        attr.setString(attr.KEYSTORE, &#39;c:\\samples\\client\\testkeys&#39;);</pre></div><a name="wp1075600"> </a><div class="pPreformatted"><pre>        // Only key store and key will be protected by passphrase in this sample.</pre></div><a name="wp1075601"> </a><div class="pPreformatted"><pre>        // But optionly the trust store can also be protected by a passphrase</pre></div><a name="wp1075602"> </a><div class="pPreformatted"><pre>        // although it is not in this sample.</pre></div><a name="wp1075402"> </a><div class="pPreformatted"><pre>        attr.setString(attr.KSPASSPHRASE, &#39;passphrase&#39;);</pre></div><a name="wp1075403"> </a><div class="pPreformatted"><pre>        attr.setString(attr.KEYPASSPHRASE, &#39;passphrase&#39;);</pre></div><a name="wp1075404"> </a><div class="pPreformatted"><pre>        attr.setInt(attr.IDLETIMEOUT, 300);</pre></div><a name="wp1075406"> </a><div class="pPreformatted"><pre>        userName = &#39;juser&#39;;</pre></div><a name="wp1075407"> </a><div class="pPreformatted"><pre>        userRole = &#39;JUSER&#39;;</pre></div><a name="wp1075408"> </a><div class="pPreformatted"><pre>        userPassword = &#39;abcd&#39;;</pre></div><a name="wp1075409"> </a><div class="pPreformatted"><pre>        appPassword = &#39;abcd&#39;;</pre></div><a name="wp1075411"> </a><div class="pPreformatted"><pre>        session = new JoltSession(attr, userName, userRole, userPassword, </pre></div><a name="wp1075412"> </a><div class="pPreformatted"><pre>                              appPassword);</pre></div><a name="wp1075414"> </a><div class="pPreformatted"><pre>        // access a Tuxedo TOUPPER service</pre></div><a name="wp1075415"> </a><div class="pPreformatted"><pre>        toupper = new JoltRemoteService(&#39;TOUPPER&#39;, session);</pre></div><a name="wp1075416"> </a><div class="pPreformatted"><pre>        toupper.addString(&#39;STRING&#39;, &#39;string&#39;);</pre></div><a name="wp1075417"> </a><div class="pPreformatted"><pre>        trans = new JoltTransaction(60, session);</pre></div><a name="wp1075418"> </a><div class="pPreformatted"><pre>        try {</pre></div><a name="wp1075419"> </a><div class="pPreformatted"><pre>            toupper.call(trans);</pre></div><a name="wp1075420"> </a><div class="pPreformatted"><pre>        } catch (ApplicationException ae) {</pre></div><a name="wp1075421"> </a><div class="pPreformatted"><pre>            ae.printStackTrace();</pre></div><a name="wp1075422"> </a><div class="pPreformatted"><pre>            System.exit(1);</pre></div><a name="wp1075423"> </a><div class="pPreformatted"><pre>        }</pre></div><a name="wp1075425"> </a><div class="pPreformatted"><pre>        String retString = toupper.getStringDef(&#39;STRING&#39;, null);</pre></div><a name="wp1075426"> </a><div class="pPreformatted"><pre>        trans.commit();</pre></div><a name="wp1075427"> </a><div class="pPreformatted"><pre>        System.out.println(&#39; returned: &#39; + retString);</pre></div><a name="wp1075428"> </a><div class="pPreformatted"><pre>        session.endSession();</pre></div><a name="wp1075429"> </a><div class="pPreformatted"><pre>        return;</pre></div><a name="wp1075430"> </a><div class="pPreformatted"><pre>    }</pre></div><a name="wp1075367"> </a><div class="pPreformatted"><pre>}</pre></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="dvlibrary.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="dvrepos.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="dvbeans.html"><img id="LongDescNotReq10" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
