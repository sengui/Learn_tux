<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="2" />
<meta name="LOC_US_CHANGE" content="41908" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux12c/CORBA_ref/fm/serverap.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="06/26/12 11:01:27" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Server-side Mapping</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">CORBA Programming Reference
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="corba_api.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next_grey1.gif" border="0" alt="Next" />&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/CORBA_ref.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1014557"> </a>
Server-side Mapping
</h1>
<p class="pBody"><a name="wp1010624"> </a>
Server-side mapping refers to the portability constraints for an object implementation written in C++. The term <em class="cEmphasis">server</em> is not meant to restrict implementations to situations in which method invocations cross-address space or machine boundaries. This mapping addresses any implementation of an Object Management Group (OMG) Interface Definition Language (IDL) interface.
</p>
<a name="wp1010781"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>The information in this chapter is based on the <span style="font-style: italic">Common Object Request Broker: Architecture and Specification, </span>Revision 2.4.2, February 2001, published by the Object Management Group (OMG). Used with permission of the OMG.</td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1010626"> </a>
Implementing Interfaces
</h2><p class="pBody"><a name="wp1009476"> </a>
To define an implementation in C++, you define a C++ class with any valid C++ name. For each operation in the interface, the class defines a nonstatic member function with the mapped name of the operation (the mapped name is the same as the OMG IDL identifier).
</p>
<p class="pBody"><a name="wp1011177"> </a>
The server application mapping specifies two alternative relationships between the implementation class supplied by the application and the generated class or classes for the interface. Specifically, the mapping requires support for both inheritance-based relationships and delegation-based relationships. Conforming applications may use either or both of these alternatives. Oracle Tuxedo CORBA supports both inheritance-based and delegation-based relationships.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1010937"> </a>
Inheritance-based Interface Implementation
</h2><p class="pBody"><a name="wp1010938"> </a>
In the inheritance-based interface implementation approach, the implementation classes are derived from a generated base class based on the OMG IDL interface definition. The generated base classes are known as skeleton classes, and the derived classes are known as <span style="font-style: normal">implementation</span><span style="font-style: italic"> </span>classes. Each operation of the interface has a corresponding virtual member function declared in the skeleton class. The generated skeleton class is partially opaque to the programmer, though it will contain a member function corresponding to each operation in the interface. The signature of the member function is identical to that of the generated client stub class.
</p>
<p class="pBody"><a name="wp1010939"> </a>
To implement this interface using inheritance, a programmer must derive from this skeleton class and implement each of the operations in the OMG IDL interface. To allow portable implementations to multiple inheritances from both skeleton classes and implementation classes for other base interfaces without error or ambiguity, the <code class="cCode">Tobj_ServantBase</code> class must be a virtual base class of the skeleton, and the <code class="cCode">PortableServer::ServantBase</code> class must be a virtual base class of the <code class="cCode">Tobj_ServantBase</code> class. The inheritance among the implementation class, the skeleton class, the <code class="cCode">Tobj_ServantBase</code> class, and the <code class="cCode">PortableServer::ServantBase</code> class must all be public virtual.
</p>
<p class="pBody"><a name="wp1012103"> </a>
The implementation class or servant must only derive directly from a single generated skeleton class. Direct derivation from multiple skeleton classes could result in ambiguous errors due to multiple definitions of the <code class="cCode">_this()</code> operation. This should not be a limitation, however, since CORBA objects have only a single most-derived interface. C++ servants that are intended to support multiple interface types can utilize the delegation-based interface implementation approach. See <a href="serverap.html#wp1012109">Listing&#160;15-1</a> for an example of OMG IDL that uses interface inheritance.
</p>
<div class="pCodeTitle"><a name="wp1012109"> </a>
Listing&#160;15-1	   OMG IDL That Uses Interface Inheritance
</div> <a name="wp1012149"> </a><div class="pPreformatted"><pre><code class="cCode">// IDL<br />interface A<br />{<br />    short op1() ;<br />    void op2(in long val) ;<br />};</code></pre></div><div class="pCodeTitle"><a name="wp1011468"> </a>
Listing&#160;15-2	   Interface Class A
</div> <a name="wp1012198"> </a><div class="pPreformatted"><pre><code class="cCode">// C++ <br />class  A : public virtual CORBA::Object<br /> {<br />    public:<br />        virtual CORBA::Short op1 (); <br />        virtual void op2 (CORBA::Long val); <br />};</code></pre></div><p class="pBody"><a name="wp1012172"> </a>
On the server side, a skeleton class is generated. This class is partially opaque to the programmer, though it does contain a member function corresponding to each operation in the interface.
</p>
<p class="pBody"><a name="wp1011472"> </a>
For the Portable Object Adapter (POA), the name of the skeleton class is formed by prepending the string &#8220;<code class="cCode">POA_</code>&#8221; to the fully scoped name of the corresponding interface, and the class is directly derived from the servant base class <code class="cCode">Tobj_ServantBase</code>. The C++ mapping for <code class="cCode">Tobj_ServantBase</code> is as follows:
</p>
<a name="wp1011473"> </a><div class="pPreformatted"><pre>// C++<br />class Tobj_ServantBase<br />{<br />    public:<br />        virtual void activate_object(const char* stroid);<br />        virtual void deactivate_object (<br />            const char* stroid, <br />            TobjS::DeactivateReasonValue reason<br />        );<br />}</pre></div><p class="pBody"><a name="wp1011474"> </a>
The <code class="cCode">activate_object()</code> and <code class="cCode">deactivate_object()</code> member functions are described in detail in the sections <a href="tpfw.html#wp1017358">Tobj_ServantBase:: activate_object()</a> and <a href="tpfw.html#wp1103525">Tobj_ServantBase::_add_ref()</a>.
</p>
<p class="pBody"><a name="wp1011484"> </a>
The skeleton class for interface A shown above would appear as shown in <a href="serverap.html#wp1011486">Listing&#160;15-3</a>.
</p>
<div class="pCodeTitle"><a name="wp1011486"> </a>
Listing&#160;15-3	   Skeleton Class for Interface A
</div> <a name="wp1012240"> </a><div class="pPreformatted"><pre><code class="cCode">// C++<br />class POA_A : public Tobj_ServantBase <br />{<br />    public:<br />        // ... server-side ORB-implementation-specific<br />        // goes here...</code></pre></div><a name="wp1012241"> </a><div class="pPreformatted"><pre><code class="cCode">        virtual CORBA::Short op1 () = 0; <br />        virtual void op2 (CORBA::Long val) = 0; <br />        //...<br />};</code></pre></div><p class="pBody"><a name="wp1012201"> </a>
If interface A were defined within a module rather than at global scope (<span style="font-style: normal">for example</span>, <code class="cCode">Mod::A</code>), the name of its skeleton class would be <code class="cCode">POA_Mod::A</code>. This helps to separate server application skeleton declarations and definitions from C++ code generated for the client.
</p>
<p class="pBody"><a name="wp1011492"> </a>
To implement this interface using inheritance, you must derive from this skeleton class and implement each of the operations in the corresponding OMG IDL interface. An implementation class declaration for interface A would take the form shown in <a href="serverap.html#wp1011497">Listing&#160;15-4</a>.
</p>
<div class="pCodeTitle"><a name="wp1011497"> </a>
Listing&#160;15-4	   Interface A Implementation Class Declaration
</div> <a name="wp1011498"> </a><div class="pPreformatted"><pre>// C++<br />class A_impl : public POA_A<br />{<br />  public:<br />       CORBA::Short op1();<br />       void op2(CORBA::Long val);<br />       ...<br />};</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1010970"> </a>
Delegation-based Interface Implementation
</h2><p class="pBody"><a name="wp1011951"> </a>
The delegation-based interface implementation approach is an alternative to using inheritance when implementing CORBA objects. This approach is used when the overhead of inheritance is too high or cannot be used. For example, due to the invasive nature of inheritance, implementing objects using existing legacy code might be impossible if inheritance for some global class were required. Instead, delegation can be used to solve these types of problems. Delegation is a more natural fit doing object implementations when the Process-Entity design pattern is used. In this pattern, the Process object would delegate operations onto one or more entity objects.
</p>
<p class="pBody"><a name="wp1010972"> </a>
In the delegation-based approach, the implementation does not inherit from a skeleton class. Instead, the implementation can be coded as required for the application, and a wrapper object will delegate upcalls to that implementation. This &#8220;wrapper object,&#8221; called a <span style="font-style: italic">tie</span>, is generated by the IDL compiler, along with the same skeleton class used for the inheritance approach. The generated <span style="font-style: italic">tie</span> class is partially opaque to the programmer, though, like the skeleton, it provides a method corresponding to each OMG IDL operation for the associated interface. The name of the generated <span style="font-style: italic">tie</span> class is the same as the generated skeleton class with the addition that the string <code class="cCode">_tie</code> is appended to the end of the class name.
</p>
<p class="pBody"><a name="wp1010973"> </a>
An instance of the <code class="cCode">tie</code> class is the servant, not the C++ object being delegated to by the tie object, that is passed as the argument to the operations that require a <code class="cCode">Servant</code> argument. It should also be noted that the tied object has no access to the <code class="cCode">_this( )</code> operation, nor should it access data members directly.
</p>
<p class="pBody"><a name="wp1010974"> </a>
A type-safe tie class is implemented using C++ templates. The code shown in <a href="serverap.html#wp1011379">Listing&#160;15-5</a> illustrates a tie class generated from the Derived interface in the previous OMG IDL example.
</p>
<div class="pCodeTitle"><a name="wp1011379"> </a>
Listing&#160;15-5	   Tie Class Generated from the Derived Interface
</div> <a name="wp1012590"> </a><div class="pPreformatted"><pre><code class="cCode">// C++<br />template &lt;class T&gt;<br />class POA_A_tie : public POA_A {<br />public:<br />    POA_A_tie(T&amp; t) <br />        : _ptr(&amp;t), _poa(PortableServer::POA::_nil()), _rel(0) {}<br />    POA_A_tie(T&amp; t, PortableServer::POA_ptr poa)<br />        : _ptr(&amp;t), _poa(PortableServer::POA::_duplicate(poa)), _rel(0) {}<br />    POA_A_tie(T* tp, CORBA::Boolean release = 1)<br />        : _ptr(tp), _poa(PortableServer::POA::_nil()), _rel(release) {}<br />    POA_A_tie(T* tp, PortableServer::POA_ptr poa, CORBA::Boolean release = 1)<br />        : _ptr(tp), _poa(PortableServer::POA::_duplicate(poa)), _rel(release) {}<br />    ~POA_A_tie()<br />    { CORBA::release(_poa);<br />    if (_rel) delete _ptr;<br />    }<br />    <br />    // tie-specific functions<br />    T* _tied_object () {return _ptr;}<br />    void _tied_object(T&amp; obj) <br />    { if (_rel) delete _ptr;<br />    _ptr = &amp;obj;<br />    _rel = 0;<br />    }<br />    void _tied_object(T* obj, CORBA::Boolean release = 1) <br />    { if (_rel) delete _ptr;<br />    _ptr = obj;<br />    _rel = release;<br />    }<br />    <br />    CORBA::Boolean _is_owner() { return _rel; }<br />    void _is_owner (CORBA::Boolean b) { _rel = b; }<br />    <br />    // IDL operations*************************************<br />    CORBA::Short op1 ()<br />    {<br />        return _ptr-&gt;op1 (); <br />    }</code></pre></div><a name="wp1013839"> </a><div class="pPreformatted"><pre><code class="cCode"><br />    <br />    void op2 (CORBA::Long val)<br />    {<br />        _ptr-&gt;op2 (val); <br />    }<br />    // ***************************************************<br />    <br />    // override ServantBase operations<br />    PortableServer::POA_ptr _default_POA()<br />    {<br />        if (!CORBA::is_nil(_poa)) <br />        {<br />            return _poa;<br />        }<br />        else {<br />#ifdef WIN32<br />            return ServantBase::_default_POA();<br />#else<br />            return PortableServer::ServantBase::_default_POA();<br />#endif<br />        }<br />    }<br />    <br />private:<br />    T* _ptr;<br />    PortableServer::POA_ptr _poa;<br />    CORBA::Boolean _rel;<br />    <br />    // copy and assignment not allowed<br />    POA_A_tie (const POA_A_tie&lt;T&gt; &amp;);<br />    void operator=(const POA_A_tie&lt;T&gt; &amp;);<br />};</code></pre></div><p class="pBody"><a name="wp1012244"> </a>
This class definition is a template generated by the IDL compiler. You typically use it by first getting a pointer to the legacy class and then instantiating the tie class with that pointer. For example:
</p>
<a name="wp1012639"> </a><div class="pPreformatted"><pre><code class="cCode">Old::Legacy * legacy = new Old::Legacy( oid);<br />POA_A_tie&lt;Old::Legacy&gt; * A_servant_ptr = <br />             new POA_A_tie&lt;Old::Legacy&gt;( legacy );</code></pre></div><p class="pBody"><a name="wp1011537"> </a>
As you can see, the tie class contains definitions for the op1 and op2 operations of the interface that assume that the legacy class has operations with the same signatures as those given in the IDL. If this is the case, you can use the tie class file as is, letting it delegate exactly. It is more likely, however, that the legacy class will not have identical signatures or you may have to do more than a single function call. In that case, it is your job to replace the code for op1 and op2 in this generated code. The code for each operation typically makes invocations on the legacy class using the tie class variable <code class="cCode">_ptr</code>, which contains the pointer to the legacy class. For example, you might change the following lines:
</p>
<a name="wp1012680"> </a><div class="pPreformatted"><pre>    <code class="cCode">CORBA::Short op1 () {return _ptr-&gt;op1 (); }<br />    void op2 (CORBA::Long val) {_ptr-&gt;op2 (val); }</code></pre></div><p class="pBody"><a name="wp1011543"> </a>
to the following:
</p>
<a name="wp1012845"> </a><div class="pPreformatted"><pre><code class="cCode">CORBA::Short op1 ()<br />{<br />    return _ptr-&gt;op37 (); <br />}<br />    <br />void op2 (CORBA::Long val)<br />{<br />    CORBA::Long temp;<br />    temp = val + 15;<br />    _ptr-&gt;lookup(val, temp, 43); <br />}</code></pre></div><p class="pBody"><a name="wp1011558"> </a>
An instance of this template class performs the task of delegation. When the template is instantiated with a class type that provides the operation of the <code class="cCode">Derived</code> interface, then the <code class="cCode">POA_Derived_tie</code> class will delegate all operations to an instance of that implementation class. A reference or pointer to the actual implementation object is passed to the appropriate tie constructor when an instance of the <code class="cCode">POA_Derived_tie</code> class is created. When a request is invoked on it, the tie servant will just delegate the request by calling the corresponding method on the implementation class.
</p>
<p class="pBody"><a name="wp1010983"> </a>
The use of templates for tie classes allows the application developer to provide specializations for some or all of the template&#8217;s operations for a given instantiation of the template. This allows the application to use legacy classes for tied object types, where the operation signatures of the tied object will differ from that of the tie class.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1011189"> </a>
Implementing Operations
</h2><p class="pBody"><a name="wp1011190"> </a>
The signature of an implementation member function is the mapped signature of the OMG IDL operation. Unlike the client-side mapping, the OMG specifies that the function header for the server-side mapping include the appropriate exception specification. An example of this is shown in <a href="serverap.html#wp1011196">Listing&#160;15-6</a>.
</p>
<div class="pCodeTitle"><a name="wp1011196"> </a>
Listing&#160;15-6	   Exception Specification
</div> <a name="wp1011197"> </a><div class="pPreformatted"><pre>// IDL<br />interface A<br />{<br />     exception B {};<br />     void f() raises(B);<br />};</pre></div><a name="wp1011198"> </a><div class="pPreformatted"><pre>// C++<br />class MyA : public virtual POA_A<br />{<br />  public:<br />     void f(); <br />     ...<br />};</pre></div><p class="pBody"><a name="wp1011200"> </a>
Since all operations and attributes may raise CORBA system exceptions, <code class="cCode">CORBA::SystemException</code> must appear in all exception specifications, even when an operation has no <code class="cCode">raises</code> clause. 
</p>
<a name="wp1011201"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Because of the differences in C++ compilers, it is best to leave out the &quot;throw declaration&quot; in the method signature. Some systems cause the application server to crash if an undeclared exception is thrown in a method that has declared the exceptions it will throw.</td>
</tr>
</table>

<p class="pBody"><a name="wp1011203"> </a>
Within a member function, the &#8220;this&#8221; pointer refers to the implementation object&#8217;s data as defined by the class. In addition to accessing the data, a member function may implicitly call another member function defined by the same class. An example of this is shown in <a href="serverap.html#wp1011208">Listing&#160;15-7</a>.
</p>
<div class="pCodeTitle"><a name="wp1011208"> </a>
Listing&#160;15-7	   Calling Another Member Function
</div> <a name="wp1011209"> </a><div class="pPreformatted"><pre>// IDL<br />interface A<br />{<br />     void f();<br />     void g();<br />};<br /><br />// C++<br />class MyA : public virtual POA_A<br />{<br />  public:<br />       void f();<br />       void g();<br />  private:<br />       long x_;<br />};<br /><br />void<br />MyA::f();<br />{<br />       x_ = 3;<br />       g();<br />}</pre></div><p class="pBody"><a name="wp1011211"> </a>
When a servant member function is invoked in this manner, it is being called simply as a C++ member function, not as the implementation of an operation on a CORBA object. 
</p>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="serverap.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="corba_api.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq10" src="/global_resources/images/nexttop_disabled.gif" border="0" alt="Next" />
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
