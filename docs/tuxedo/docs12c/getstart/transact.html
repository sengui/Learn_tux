<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41824" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux12c/getstart/fm/transact.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="06/26/12 11:07:23" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Using Transactions</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Getting Started with Oracle Tuxedo CORBA Applications
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="security.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next_grey1.gif" border="0" alt="Next" />&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/getstart.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1032673"> </a>
Using Transactions
</h1>
<p class="pBody"><a name="wp1023518"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018556"> </a><a href="transact.html#wp1018509">Overview of the Transaction Service</a></li>
<li><a name="wp1018584"> </a><a href="transact.html#wp1019130">What Happens During a Transaction</a></li>
<li><a name="wp1018585"> </a><a href="transact.html#wp1018579">Transactions Sample Application</a></li>
<li><a name="wp1018586"> </a><a href="transact.html#wp1020129">Development Steps</a></li>
</ul></div>
<a name="wp1024522"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>This topic describes using the C++ interface to the CORBA Services Object Transaction service. For a complete description of all the transaction features available in the CORBA environment of the Oracle Tuxedo product and instructions for implementing the transaction features, see <a href="../trans/index.html">Using CORBA Transactions</a> in the Oracle Tuxedo online documentation.</td>
</tr>
</table>

<a name="wp1033030"> </a><table class="Note">
<tr>
<td valign="top"><b class="texthide">Note:</b></td>
<td>The Oracle Tuxedo CORBA Java client and Oracle Tuxedo CORBA Java client ORB were deprecated in Tuxedo 8.1 and are no longer supported. All Oracle Tuxedo CORBA Java client and Oracle Tuxedo CORBA Java client ORB text references, associated code samples, should only be used to help implement/run third party Java ORB libraries, and for programmer reference only.</td>
</tr>
</table>
<a name="wp1033031"> </a><table class="Note">
<tr>
<td valign="top"><b class="texthide">Note:</b></td>
<td>Technical support for third party CORBA Java ORBs should be provided by their respective vendors. Oracle Tuxedo does not provide any technical support or documentation for third party CORBA Java ORBs.</td>
</tr>
</table>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1018509"> </a>
Overview of the Transaction Service
</h2><p class="pBody"><a name="wp1018690"> </a>
One of the most fundamental features of the Oracle Tuxedo product is transaction management. Transactions are a means to guarantee that database transactions are completed accurately and that they take on all the ACID properties (atomicity, consistency, isolation, and durability) of a high-performance transaction. The Oracle Tuxedo system protects the integrity of your transactions by providing a complete infrastructure for ensuring that database updates are done accurately, even across a variety of resource managers.
</p>
<p class="pBody"><a name="wp1025591"> </a>
The Oracle Tuxedo system uses the following:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018512"> </a>The CORBA Services Object Transaction Service (OTS) </li>
</ul></div>
<p class="pBody"><a name="wp1031454"> </a>
The CORBA environment in the Oracle Tuxedo product provides a C++ interface to the Object Transaction Service. The OTS is accessed through the TransactionCurrent environmental object. For information about using the TransactionCurrent environmental object, see <a href="../creclient/index.html">Creating CORBA Client Applications</a> in the Oracle Tuxedo online documentation. 
</p>
<p class="pBody"><a name="wp1019350"> </a>
OTS provides the following support for your business transactions:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1018980"> </a>Creates a global transaction identifier when a client application initiates a transaction.</li>
<li><a name="wp1018981"> </a>Works with the TP Framework to track objects that are involved in a transaction and, therefore, need to be coordinated when the transaction is ready to commit.</li>
<li><a name="wp1018982"> </a>Notifies the resource managers&#8212;which are, most often, databases&#8212;when they are accessed on behalf of a transaction. Resource managers then lock the accessed records until the end of the transaction.</li>
<li><a name="wp1018983"> </a>Orchestrates the two-phase commit when the transaction completes, which ensures that all the participants in the transaction commit their updates simultaneously. It coordinates the commit with any databases that are being updated using the Open Group XA protocol. Almost all relational databases support this standard.</li>
<li><a name="wp1018984"> </a>Executes the rollback procedure when the transaction must be stopped.</li>
<li><a name="wp1018985"> </a>Executes a recovery procedure when failures occur. It determines which transactions were active in the machine at the time of the crash, and then determines whether the transaction should be rolled back or committed.</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1019130"> </a>
What Happens During a Transaction
</h2><p class="pBody"><a name="wp1022347"> </a>
<a href="transact.html#wp1022389">Figure&#160;5-1</a> illustrates how transactions work in a Oracle Tuxedo CORBA application.
</p>
<div class="pFigureTitle"><a name="wp1022389"> </a>
Figure&#160;5-1  How Transactions Work in a Oracle Tuxedo CORBA Application
</div>

 
 <p class="pGraphic"><a name="wp1022390"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/trans90.gif" alt="How Transactions Work in a Oracle Tuxedo CORBA Application" id="wp1031563"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1022453"> </a>
A basic transaction works in the following way:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1019324"> </a>The client application uses the Bootstrap object to return an object reference to the TransactionCurrent object for the Oracle Tuxedo domain.</li>
<li><a name="wp1022478"> </a>A client application begins a transaction using the <code class="cCode">Tobj::TransactionCurrent::begin()</code> method, and issues a request to the CORBA interface through the TP Framework. All operations on the CORBA interface execute within the scope of a transaction. </li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1022493"> </a>If a call to any of these operations raises an exception (either explicitly or as a result of a communication failure), the exception can be caught and the transaction can be rolled back.</li>
<li><a name="wp1019326"> </a>If no exceptions occur, the client application commits the current transaction using the <code class="cCode">Tobj::TransactionCurrent::commit()</code> method. This method ends the transaction and starts the processing of the operation. The transaction is committed only if all of the participants in the transaction agree to commit. </li>
</ul></div>
<li><a name="wp1024188"> </a>The <code class="cCode">Tobj::TransactionCurrent:commit()</code> method causes the TP Framework to call the Transaction Manager to complete the transaction.</li>
<li><a name="wp1022503"> </a>The Transaction Manager updates the database.</li>
</ol></div>
<a name="wp1030830"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>Oracle Tuxedo CORBA also supports the use of the CORBA Interoperable Naming Service (INS) to obtain an initial object reference for the Security Service. For information on the INS bootstrapping mechanism, see the <a href="../CORBA_ref/index.html">CORBA Programming Reference</a>.</td>
</tr>
</table>

<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1018579"> </a>
Transactions Sample Application
</h2><p class="pBody"><a name="wp1020232"> </a>
In the Transactions sample application, the operation of registering for courses is executed within the scope of a transaction. The transaction model used in the Transactions sample application is a combination of the conversational model and the model in which a single client invocation invokes multiple individual operations on a database.
</p>
<p class="pBody"><a name="wp1020668"> </a>
The Transactions sample application works in the following way:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1020233"> </a>Students submit a list of courses for which they want to be registered.</li>
<li><a name="wp1020234"> </a>For each course in the list, the CORBA server application checks whether:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1020235"> </a>The course is in the database.</li>
<li><a name="wp1020236"> </a>The student is already registered for a course.</li>
<li><a name="wp1020237"> </a>The student exceeds the maximum number of credits the student can take.</li>
</ul></div>
<li><a name="wp1020238"> </a>One of the following occurs:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1020239"> </a>If the course meets all the criteria, the CORBA server application registers the student for the course.</li>
<li><a name="wp1020240"> </a>If the course is not in the database or if the student is already registered for the course, the CORBA server application adds the course to a list of courses for which the student could not be registered. After processing all the registration requests, the CORBA server application returns the list of courses for which registration failed. The CORBA client application can then choose to either commit the transaction (thereby registering the student for the courses for which registration request succeeded) or to roll back the transaction (thus, not registering the student for any of the courses).</li>
<li><a name="wp1020242"> </a>If the student exceeds the maximum number of credits the student can take, the CORBA server application returns a <code class="cCode">TooManyCredits</code> user exception to the CORBA client application. The CORBA client application provides a brief message explaining that the request was rejected. The CORBA client application then rolls back the transaction.</li>
</ul></div>
</ol></div>
<p class="pBody"><a name="wp1020247"> </a>
<a href="transact.html#wp1028862">Figure&#160;5-2</a> illustrates how the Transactions sample application works.
</p>
<div class="pFigureTitle"><a name="wp1028862"> </a>
Figure&#160;5-2  Transactions Sample Application
</div>

 
 <p class="pGraphic"><a name="wp1028863"> </a>
</p>
<div class="figure" align="left"><img src="wwimages/transac2.gif" alt="Transactions Sample Application" id="wp1028872"/></div><p class="pGraphic">

</p>
<p class="pBody"><a name="wp1028864"> </a>
The Transactions sample application shows two ways in which a transaction can be rolled back:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1020779"> </a>Nonfatal. If the registration for a course fails because the course is not in the database, or because the student is already registered for the course, the CORBA server application returns the numbers of those courses to the CORBA client application. The decision to roll back the transaction lies with the user of the CORBA client application.</li>
<li><a name="wp1020780"> </a>Fatal. If the registration for a course fails because the student exceeds the maximum number of credits he or she can take, the CORBA server application generates a CORBA exception and returns it to the CORBA client application. The decision to roll back the transaction also lies with the CORBA client application.</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1020129"> </a>
Development Steps
</h2><p class="pBody"><a name="wp1019162"> </a>
This topic describes the development steps for writing a Oracle Tuxedo CORBA application that includes transactions. <a href="transact.html#wp578516">Table&#160;5-1</a> lists the development steps.
</p>
<p class="pGraphic"><a name="wp1019685"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp578516table1019694"><caption><a name="wp578516"> </a>
Table 5-1  <span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">Development Steps for Oracle Tuxedo CORBA Applications That Have Transactions</span>

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1019696"> </a>
Step
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1019698"> </a>
Description
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019797"> </a>
1
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019799"> </a>
Write the OMG IDL code for the transactional CORBA interface.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019704"> </a>
2
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019706"> </a>
Define the transaction policies for the CORBA interface in the Implementation Configuration file (ICF). 
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019708"> </a>
3
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019710"> </a>
Write the CORBA client application.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019712"> </a>
4
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019714"> </a>
Write the CORBA server application.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019716"> </a>
5
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1019718"> </a>
Create a configuration file.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1021903"> </a>
The Transactions sample application is used to demonstrate these development steps. The source files for the Transactions sample application are located in the <code class="cCode">\samples\corba\university </code>directory of the Oracle Tuxedo software. For information about building and running the Transactions sample application, see <a href="../usamples/index.html">Guide to the CORBA University Sample Application</a> in the Oracle Tuxedo online documentation.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1024668"> </a>
Step 1: Write the OMG IDL Code
</h2><p class="pBody"><a name="wp1019173"> </a>
You need to specify interfaces involved in transactions in Object Management Group (OMG) Interface Definition Language (IDL) just as you would any other CORBA interface. You must also specify any user exceptions that may occur from using the interface.
</p>
<p class="pBody"><a name="wp1020305"> </a>
For the Transactions sample application, you would define in OMG IDL the <code class="cCode">Registrar</code> interface and the <code class="cCode">register_for_courses()</code> operation. The <code class="cCode">register_for_courses()</code> operation has a parameter, <code class="cCode">NotRegisteredList,</code> which returns to the CORBA client application the list of courses for which registration failed. If the value of <code class="cCode">NotRegisteredList</code> is empty, the CORBA client application commits the transaction. You also need to define the <code class="cCode">TooManyCredits</code> user exception.
</p>
<p class="pBody"><a name="wp1021089"> </a>
<a href="transact.html#wp1021105">Listing&#160;5-1</a> includes the OMG IDL code for the Transactions sample application.
</p>
<div class="pCodeTitle"><a name="wp1021105"> </a>
Listing&#160;5-1	   OMG IDL Code for the Transactions Sample Application
</div> <a name="wp1022770"> </a><div class="pPreformatted"><pre>#pragma prefix &quot;beasys.com&quot;<br />module UniversityT</pre></div><a name="wp1022771"> </a><div class="pPreformatted"><pre>{<br />	typedef unsigned long CourseNumber;<br />	typedef sequence&lt;CourseNumber&gt; CourseNumberList;<br /><br />	struct CourseSynopsis<br />	{<br />		CourseNumber   course_number;<br />		string         title;<br />	};<br />	typedef sequence&lt;CourseSynopsis&gt; CourseSynopsisList;<br /><br />	interface CourseSynopsisEnumerator<br />	{<br />	//Returns a list of length 0 if there are no more entries<br />	CourseSynopsisList get_next_n(<br />		in  unsigned long number_to_get, // 0 = return all<br />		out unsigned long number_remaining<br />	);<br /><br />	void destroy();<br />	};<br />	typedef unsigned short Days;<br />	const Days MONDAY    =  1;<br />	const Days TUESDAY   =  2;<br />	const Days WEDNESDAY =  4;<br />	const Days THURSDAY  =  8;<br />	const Days FRIDAY    = 16;</pre></div><a name="wp1022772"> </a><div class="pPreformatted"><pre>//Classes restricted to same time block on all scheduled days, <br />//starting on the hour</pre></div><a name="wp1022773"> </a><div class="pPreformatted"><pre>struct ClassSchedule<br />{<br />	Days           class_days; // bitmask of days<br />	unsigned short start_hour; // whole hours in military time<br />	unsigned short duration;   // minutes<br />};</pre></div><a name="wp1022774"> </a><div class="pPreformatted"><pre>struct CourseDetails<br />{<br />	CourseNumber   course_number;<br />	double         cost;<br />	unsigned short number_of_credits;<br />	ClassSchedule  class_schedule;<br />	unsigned short number_of_seats;<br />	string         title;<br />	string         professor;<br />	string         description;<br />};<br />	typedef sequence&lt;CourseDetails&gt; CourseDetailsList;<br />	typedef unsigned long StudentId;</pre></div><a name="wp1022775"> </a><div class="pPreformatted"><pre>struct StudentDetails<br />{<br />	StudentId         student_id;<br />	string            name;<br />	CourseDetailsList registered_courses;<br />};</pre></div><a name="wp1022776"> </a><div class="pPreformatted"><pre>enum NotRegisteredReason<br />{<br />	AlreadyRegistered,<br />	NoSuchCourse<br />};</pre></div><a name="wp1022777"> </a><div class="pPreformatted"><pre>struct NotRegistered<br />{<br />	CourseNumber        course_number;<br />	NotRegisteredReason not_registered_reason;<br />};<br />	typedef sequence&lt;NotRegistered&gt; NotRegisteredList;</pre></div><a name="wp1022778"> </a><div class="pPreformatted"><pre>exception TooManyCredits<br />{<br />	unsigned short maximum_credits;<br />};</pre></div><a name="wp1022779"> </a><div class="pPreformatted"><pre>//The Registrar interface is the main interface that allows<br />//students to access the database.<br />interface Registrar<br />{<br />	CourseSynopsisList<br />	get_courses_synopsis(<br />		in string                    search_criteria,<br />	 	in unsigned long             number_to_get,<br />	 	out unsigned long            number_remaining,<br />		out CourseSynopsisEnumerator rest);</pre></div><a name="wp1022781"> </a><div class="pPreformatted"><pre>   	CourseDetailsList get_courses_details(in CourseNumberList<br />	 courses);<br />	StudentDetails get_student_details(in StudentId student);<br />	NotRegisteredList register_for_courses(<br />		in StudentId        student,<br />		in CourseNumberList courses<br />	) raises (<br />		TooManyCredits<br />	);</pre></div><a name="wp1022782"> </a><div class="pPreformatted"><pre>};</pre></div><a name="wp1022783"> </a><div class="pPreformatted"><pre>// The RegistrarFactory interface finds Registrar interfaces.</pre></div><a name="wp1022784"> </a><div class="pPreformatted"><pre>interface RegistrarFactory<br />{<br />	Registrar find_registrar(<br />	);<br />};</pre></div><h3 class="pHeading2"><a name="wp1020601"> </a>
Step 2: Define Transaction Policies for the Interfaces
</h3>
<p class="pBody"><a name="wp1021011"> </a>
Transaction policies are used on a per-interface basis. During design, it is decided which interfaces within a Oracle Tuxedo CORBA application will handle transactions.<span style="font-weight: bold"> </span>The transaction policies are listed in the following table.
</p>
<p class="pGraphic"><a name="wp1021250"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1021265table1021263">
  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1021265"> </a>
Transaction Policy
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1021267"> </a>
Description
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023879"> </a>
<code class="cCode">always</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023881"> </a>
The interface must always be part of a transaction. If the interface is not part of a transaction, a transaction will be automatically started by the TP Framework.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023901"> </a>
ignore
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1023903"> </a>
The interface is not transactional; however, requests made to this interface within a scope of a transaction are allowed. The AUTOTRAN parameter, specified in the UBBCONFIG file for this interface, is ignored.  
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021269"> </a>
<code class="cCode">never</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021271"> </a>
The interface is not transactional. Objects created for this interface can never be involved in a transaction. The Oracle Tuxedo system generates the <code class="cCode">INVALID_TRANSACTION</code> exception if an interface with this policy is involved in a transaction.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021273"> </a>
<code class="cCode">optional</code>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1021275"> </a>
The interface might be transactional. Objects can be involved in a transaction if the request is transactional. This transaction policy is the default.
</div>
<p class="pTableNote"><a name="wp1029657"> </a><table>
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>To define transactional properties for a request you can also use the <code class="cCode">autotran</code> parameter.</td></tr>
</table>
</p>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1020907"> </a>
During development, you decide which interfaces will execute in a transaction by assigning transaction policies.
</p>
<p class="pBody"><a name="wp1020908"> </a>
For CORBA server applications, you specify transaction policies in the Implementation Configuration File (ICF).  A template ICF file is created when you run the <code class="cCode">genicf </code>command.
</p>
<p class="pBody"><a name="wp1020889"> </a>
In the Transactions sample application, the transaction policy of the <code class="cCode">Registrar </code>interface is set to <code class="cCode">always</code>.
</p>
<h3 class="pHeading2"><a name="wp1019179"> </a>
Step 3: Write the CORBA Client Application
</h3>
<p class="pBody"><a name="wp1021525"> </a>
The CORBA client application needs code that performs the following tasks:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1021508"> </a>Obtains a reference to the TransactionCurrent or TransactionFactory object from the Bootstrap object.</li>
<li><a name="wp1021549"> </a>Begins a transaction by invoking the <code class="cCode">Tobj::TransactionCurrent::begin()</code> operation on the TransactionCurrent object.</li>
<li><a name="wp1021556"> </a>Invokes operations on the object. In the Transactions sample application, the CORBA client application invokes the  <code class="cCode">register_for_courses()</code> operation on the <code class="cCode">Registrar</code> object, passing a list of courses.</li>
</ol></div>
<p class="pBody"><a name="wp1022064"> </a>
<a href="transact.html#wp1021729">Listing&#160;5-2</a>  illustrates the portion of the CORBA C++ client application in the Transactions sample application that illustrates the development steps for transactions.
</p>
<div class="pCodeTitle"><a name="wp1021729"> </a>
Listing&#160;5-2	   <b class="cBold">Transactions Code for CORBA C++ Client Applications</b>
</div> <a name="wp1021730"> </a><div class="pPreformatted"><pre>CORBA::Object_var var_transaction_current_oref =  <br />     Bootstrap.resolve_initial_references(&quot;TransactionCurrent&quot;);<br />CosTransactions::Current_var var_transaction_current_ref=<br />     CosTransactions::Current::_narrow(var_transaction_current_oref.in());<br /><code class="cCode">//Begin the transaction<br />var_transaction_current_ref-&gt;begin();<br />try 	 {<br />		     // Perform the operation inside the transaction<br />     pointer_Registar_ref-&gt;register_for_courses(student_id, course_number_list);<br />     // ...<br />     // If operation executes with no errors, commit the transaction:<br />     CORBA::Boolean report_heuristics = CORBA_TRUE;<br />     var_transaction_current_ref-&gt;commit(report_heuristics);<br />}<br />catch (...) {<br />      // If the operation has problems executing, rollback the <br />      // transaction. Then throw the original exception again.<br />      // If the rollback fails, ignore the exception and throw the<br />      // original exception again.        <br />      try {<br />           var_transaction_current_ref-&gt;rollback();<br />      }<br />      catch (...) {<br />            TP::userlog(&quot;rollback failed&quot;);<br />      }<br />      throw;<br />}</code></pre></div><h3 class="pHeading2"><a name="wp1019195"> </a>
Step 4: Write the CORBA Server Application
</h3>
<p class="pBody"><a name="wp1019196"> </a>
When using transactions in CORBA server applications, you need to write methods that implement the interface&#8217;s operations. In the Transactions sample application, you would write a method implementation for the <code class="cCode">register_for_courses()</code> operation.
</p>
<p class="pBody"><a name="wp1022115"> </a>
If your Oracle Tuxedo CORBA application uses a database, you need to include code in the CORBA server application that opens and closes an XA resource manager. These operations are included in the <code class="cCode">Server::initialize()</code> and <code class="cCode">Server::release()</code> operations of the Server object.
</p>
<p class="pBody"><a name="wp1025133"> </a>
<a href="transact.html#wp1023469">Listing&#160;5-3</a> shows the portion of the code for the Server object in the Transactions sample application that opens and closes the XA resource manager.
</p>
<a name="wp1024243"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>For a complete example of a C++ server application that implements transactions, see the Transactions sample application in <a href="../trans/index.html">Using CORBA Transactions</a> in the Oracle Tuxedo online documentation.</td>
</tr>
</table>

<div class="pCodeTitle"><a name="wp1023469"> </a>
Listing&#160;5-3	   C++ Server Object in Transactions Sample Application
</div> <a name="wp1023470"> </a><div class="pPreformatted"><pre>CORBA::Boolean Server::initialize(int argc, char* argv[])<br />{<br />	TRACE_METHOD(&quot;Server::initialize&quot;);<br />	try {<br />		open_database();<br />		begin_transactional();<br />		register_fact();<br />		return CORBA_TRUE;<br />	}<br />	catch (CORBA::Exception&amp; e) {<br />		LOG(&quot;CORBA exception : &quot; &lt;&lt;e);<br />	}<br />	catch (SamplesDBException&amp; e) {<br />		LOG(&quot;Can&#8217;t connect to database&quot;);<br />	}<br />	catch (...) {<br />		LOG(&quot;Unexpected exception&quot;);<br />	}<br />	cleanup();<br />	return CORBA_FALSE;<br />}<br /></pre></div><a name="wp1031332"> </a><div class="pPreformatted"><pre>void Server::release()<br />{<br />	TRACE_METHOD(&quot;Server::release&quot;);<br />	cleanup();<br />}</pre></div><a name="wp1024287"> </a><div class="pPreformatted"><pre>static void cleanup()<br />{<br />	unregister_factory();<br />	end_transactional();<br />	close_database();<br />}<br /><br />// Utilities to manage transaction resource manager<br />CORBA::Boolean s_became_transactional = CORBA_FALSE;<br />static void begin_transactional()<br />{<br />	TP::open_xa_rm();<br />	s_became_transactional = CORBA_TRUE;<br />}<br />static void end_transactional()<br />{<br />	if(!s_became_transactional){<br />	     // cleanup not necessary<br />	     return;<br />	}	<br />	try {<br />	     TP::close_xa_rm ();<br />	}<br />	catch (CORBA::Exception&amp; e) {<br />	       LOG(&quot;CORBA Exception : &quot; &lt;&lt; e);<br />	}<br />	catch (...) {<br />	       LOG(&quot;unexpected exception&quot;);<br /> 	}<br />	s_became_transactional = CORBA_FALSE;<br />}</pre></div><h3 class="pHeading2"><a name="wp1023471"> </a>
Step 5: Create a Configuration File
</h3>
<p class="pBody"><a name="wp1019207"> </a>
You need to add the following information to the configuration file for a transactional Oracle Tuxedo CORBA application.
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1022263"> </a>In the <code class="cCode">SERVERS</code> section specify the transactional group for the CORBA server application and for the application that manages the database.</li>
<li><a name="wp1022278"> </a>In the <code class="cCode">GROUPS</code> section define the server group. In the <code class="cCode">OPENINFO</code> and <code class="cCode">CLOSEINFO </code>parameters of the <code class="cCode">GROUPS</code> section, include information to open and close the XA resource manager for the database. You obtain this information from the product documentation for your database. Note that the default version of the <code class="cCode">com.beasys.Tobj.Server.initialize()</code> operation automatically opens the resource manager.</li>
<li><a name="wp1031601"> </a>Include the pathname to the transaction log (<code class="cCode">TLOG</code>) in the <code class="cCode">TLOGDEVICE</code> parameter. For more information about the transaction log, see <a href="../ada/index.html">Administering a Oracle Tuxedo Application at Run Time</a> in the Oracle Tuxedo online documentation.</li>
</ul></div>
<p class="pBody"><a name="wp1019215"> </a>
<a href="transact.html#wp1022290">Listing&#160;5-4</a> includes the portions of the configuration file that define this information for the Transactions sample application.
</p>
<div class="pCodeTitle"><a name="wp1022290"> </a>
Listing&#160;5-4	   Configuration File for Transactions Sample Application
</div> <a name="wp1022952"> </a><div class="pPreformatted"><pre>*RESOURCES<br />	IPCKEY    55432<br />	DOMAINID  university<br />	MASTER    SITE1<br />	MODEL     SHM<br />	LDBAL     N<br />	SECURITY  APP_PW				</pre></div><a name="wp1022953"> </a><div class="pPreformatted"><pre>*MACHINES<br />	BLOTTO<br />	LMID = SITE1<br />	APPDIR = C:\TRANSACTION_SAMPLE<br />	TUXCONFIG=C:\TRANSACTION_SAMPLE\tuxconfig<br />	TLOGDEVICE=C:\APP_DIR\TLOG<br />	TLOGNAME=TLOG<br />	TUXDIR=&quot;C:\tuxdir&quot;<br />	MAXWSCLIENTS=10</pre></div><a name="wp1022954"> </a><div class="pPreformatted"><pre>*GROUPS<br />	SYS_GRP<br />	  LMID      = SITE1<br />	  GRPNO     = 1<br />	ORA_GRP<br />	  LMID      = SITE1<br />	  GRPNO     = 2</pre></div><a name="wp1022955"> </a><div class="pPreformatted"><pre>	OPENINFO  = &quot;ORACLE_XA:Oracle_XA+SqlNet=ORCL+Acc=P<br />	/scott/tiger+SesTm=100+LogDir=.+MaxCur=5&quot;<br />	OPENINFO  = &quot;ORACLE_XA:Oracle_XA+Acc=P/scott/tiger<br />	+SesTm=100+LogDir=.+MaxCur=5&quot;<br />	CLOSEINFO = &quot;&quot;<br />	TMSNAME   = &quot;TMS_ORA&quot;</pre></div><a name="wp1022956"> </a><div class="pPreformatted"><pre>*SERVERS<br />	DEFAULT:<br />	RESTART = Y<br />	MAXGEN  = 5<br /><br />	TMSYSEVT<br />	  SRVGRP  = SYS_GRP<br />	  SRVID   = 1</pre></div><a name="wp1022957"> </a><div class="pPreformatted"><pre>	TMFFNAME<br />	  SRVGRP  = SYS_GRP<br />	  SRVID   = 2<br />	  CLOPT   = &quot;-A -- -N -M&quot;</pre></div><a name="wp1022958"> </a><div class="pPreformatted"><pre>	TMFFNAME<br />	  SRVGRP  = SYS_GRP<br />	  SRVID   = 3<br />	  CLOPT   = &quot;-A -- -N&quot;</pre></div><a name="wp1022959"> </a><div class="pPreformatted"><pre>	TMFFNAME<br />	  SRVGRP  = SYS_GRP<br />	  SRVID   = 4<br />	  CLOPT   = &quot;-A -- -F&quot;</pre></div><a name="wp1022960"> </a><div class="pPreformatted"><pre>	TMIFRSVR<br />	  SRVGRP  = SYS_GRP<br />	  SRVID   = 5<br /><br />	UNIVT_SERVER<br />	  SRVGRP  = ORA_GRP<br />	  SRVID   = 1<br />	  RESTART = N</pre></div><a name="wp1022961"> </a><div class="pPreformatted"><pre>   	ISL<br />	  SRVGRP  = SYS_GRP<br />	  SRVID   = 6<br />	  CLOPT   = -A -- -n //MACHINENAME:2500</pre></div><a name="wp1022962"> </a><div class="pPreformatted"><pre>*SERVICES</pre></div><p class="pBody"><a name="wp1022289"> </a>
For information about the transaction log and defining parameters in the Configuration file, see <a href="../ads/index.html">Setting Up a Oracle Tuxedo Application</a> in the Oracle Tuxedo online documentation.
</p>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="transact.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="security.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq10" src="/global_resources/images/nexttop_disabled.gif" border="0" alt="Next" />
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
