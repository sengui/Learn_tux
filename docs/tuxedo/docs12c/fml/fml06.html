<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41824" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux12c/fml/fm/fml06.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="06/26/12 11:06:13" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>FML and VIEWS Examples</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Programming an Oracle Tuxedo ATMI Application Using FML
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="fml05.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="fmlxa.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/fml.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1005561"> </a>
FML and VIEWS Examples
</h1>
<p class="pBody"><a name="wp1004502"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1003951"> </a><a href="fml06.html#wp1003954">VIEWS Examples</a></li>
<li><a name="wp1003952"> </a><a href="fml06.html#wp1004024">FML Examples in bankapp</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1003954"> </a>
VIEWS Examples
</h2><p class="pBody"><a name="wp1003962"> </a>
The VIEWS examples provided in this section are unrelated to the example FML program that appears later in this section.
</p>
<h3 class="pHeading2"><a name="wp1003964"> </a>
Sample Viewfile
</h3>
<p class="pBody"><a name="wp1003966"> </a>
<a href="fml06.html#wp1003967">Listing&#160;6-1</a> is a sample of a viewfile containing a source view description, <code class="cCode">custdb</code>.
</p>
<div class="pCodeTitle"><a name="wp1003967"> </a>
Listing&#160;6-1	   Sample Viewfile
</div> <a name="wp1003968"> </a><div class="pPreformatted"><pre># BEGINNING OF VIEWFILE<br />VIEW custdb<br />#  /* This is a comment */<br />#  /* This is another comment */<br />#TYPE        CNAME    FBNAME      COUNT   FLAG  SIZE   NULL<br />carray       bug      BUG_CURS    4       -     12     &quot;no bugs&quot;<br />long         custid   CUSTID      2       -      -      -1<br />short        super    SUPER_NUM   1       -      -      999<br />long         youid    ID          1       -      -      -1<br />float        tape     TAPE_SENT   1       -      -      -.001<br />char         ch       CHR         1       -      -      &quot;0&quot;<br />string       action   ACTION      4       -     20      &quot;no action&quot;<br />END<br />#END OF VIEWFILE</pre></div><h3 class="pHeading2"><a name="wp1003971"> </a>
Sample Field Table
</h3>
<p class="pBody"><a name="wp1003975"> </a>
<a href="fml06.html#wp1003976">Listing&#160;6-2</a> is a sample of a field table needed to compile the view in the last section.
</p>
<div class="pCodeTitle"><a name="wp1003976"> </a>
Listing&#160;6-2	   Sample Field Table
</div> <a name="wp1003977"> </a><div class="pPreformatted"><pre># name          number  type    flags   comments<br />CUSTID          2048    long    -       -<br />VERSION_RUN     2055    string  -       -<br />ID              2056    long    -       -<br />CHR             2057    char    -       -<br />TAPE_SENT       2058    float   -       -<br />SUPER_NUM       2066    short   -       -<br />ACTION          2074    string  -       -<br />BUG_CURS        2085    carray  -     -</pre></div><h3 class="pHeading2"><a name="wp1003980"> </a>
Sample Header File Produced by viewc
</h3>
<p class="pBody"><a name="wp1003984"> </a>
<a href="fml06.html#wp1003985">Listing&#160;6-3</a> shows a header file produced by the view compiler. Assume that the viewfile in the earlier section was used as input to <code class="cCode">viewc</code>. 
</p>
<div class="pCodeTitle"><a name="wp1003985"> </a>
Listing&#160;6-3	   Sample Header File Produced by viewc
</div> <a name="wp1003986"> </a><div class="pPreformatted"><pre>struct custdb {<br />char    bug[4][12];             /* null=&quot;no bugs&quot;   */<br />long    custid[2];              /* null=-1          */<br />short   super;                  /* null=999         */<br />long    youid;                  /* null=-1          */<br />float   tape;                   /* null=-0.001000   */<br />char    ch;                     /* null=&quot;0&quot;         */<br />char    action[4][20];          /* null=&quot;no action&quot; */<br />};</pre></div><h3 class="pHeading2"><a name="wp1003989"> </a>
Sample Header File Produced by mkfldhdr
</h3>
<p class="pBody"><a name="wp1003992"> </a>
<a href="fml06.html#wp1003993">Listing&#160;6-4</a> shows a header file produced from a field table file by <code class="cCode">mkfldhdr</code>. Assume that a field table file containing the definitions of the fields shown in the previous examples was used as input to <code class="cCode">mkfldhdr</code>. 
</p>
<div class="pCodeTitle"><a name="wp1003993"> </a>
Listing&#160;6-4	   Sample Header File Produced by mkfldhdr(1)
</div> <a name="wp1003994"> </a><div class="pPreformatted"><pre>/* custdb.flds.h as generated by mkfldhdr from a field table:      */<br />/*       fname       fldid                                         */<br />/*       -----       -----                                         */<br />#define  ACTION      ((FLDID)43034)  /* number: 2074  type: string */<br />#define  BUG_CURS    ((FLDID)51237)  /* number: 2085  type: carray */<br />#define  CUSTID      ((FLDID)10240)  /* number: 2048  type: long   */<br />#define  SUPER_NUM   ((FLDID)2066)   /* number: 2066  type: short  */<br />#define  TAPE_SENT   ((FLDID)26634)  /* number: 2058  type: float  */<br />#define  VERSION_RUN ((FLDID)43015)  /* number: 2055  type: string */<br />#define  ID          ((FLDID)10248)  /* number: 2056  type: long   */<br />#define  CHR         ((FLDID)18441)  /* number: 2057  type: char   */</pre></div><h3 class="pHeading2"><a name="wp1003997"> </a>
Sample COBOL COPY File
</h3>
<p class="pBody"><a name="wp1003999"> </a>
<a href="fml06.html#wp1004000">Listing&#160;6-5</a> shows the COBOL COPY file, <code class="cCode">CUSTDB.cbl</code>, produced by <code class="cCode">viewc</code> with the <code class="cCode">-C</code> option.
</p>
<div class="pCodeTitle"><a name="wp1004000"> </a>
Listing&#160;6-5	   Sample COBOL COPY File
</div> <a name="wp1004001"> </a><div class="pPreformatted"><pre>*       VIEWFILE: &quot;t.v&quot;<br />*       VIEWNAME: &quot;custdb&quot;<br />             05 BUG OCCURS 4 TIMES              PIC X(12).<br />*       NULL=&quot;no bugs&quot;<br />             05 CUSTID OCCURS 2 TIMES           PIC S9(9) USAGE IS COMP-5.<br />*       NULL=-1<br />             05 SUPER                           PIC S9(4) USAGE IS COMP-5.<br />*       NULL=999<br />             05 FILLER                          PIC X(02).<br />             05 YOUID                           PIC S9(9) USAGE IS COMP-5.<br />*       NULL=-1<br />             05 TAPE                            USAGE IS COMP-1.<br />*       NULL=-0.001000<br />             05 CH                              PIC X(01).<br />*       NULL=&#39;0&#39;<br />             05 ACTION OCCURS 4 TIMES           PIC X(20).<br />*       NULL=&quot;no action&quot;<br />              05 FILLER                             PIC X(03).</pre></div><p class="pBody"><a name="wp1004003"> </a>
For a sample COBOL program that includes a COBOL COPY file produced by <code class="cCode">viewc -C</code>, see <em class="cEmphasis">Programming an Oracle Tuxedo ATMI Application Using COBOL</em>.
</p>
<h3 class="pHeading2"><a name="wp1004008"> </a>
Sample VIEWS Program
</h3>
<p class="pBody"><a name="wp1004010"> </a>
The following program in <a href="fml06.html#wp1004015">Listing&#160;6-6</a> is an example of the use of VIEWS to map a structure to a fielded buffer. The environment variables discussed in <a href="fml03.html">Setting Up Your Environment for FML and VIEWS</a> must be properly set for this program to work.
</p>
<p class="pBody"><a name="wp1004011"> </a>
Information on compiling FML programs can be found on the <a href="../rf5/rf5.html">compilation(5)</a> reference page in <em class="cEmphasis">Oracle Tuxedo File Formats, Data Descriptions, MIBs, and System Processes Reference</em>.
</p>
<div class="pCodeTitle"><a name="wp1004015"> </a>
Listing&#160;6-6	   Sample VIEWS Program
</div> <a name="wp1004016"> </a><div class="pPreformatted"><pre>/* sample VIEWS program */<br />#include stdio.h&gt;<br />#include &quot;fml.h&quot;<br />#include &quot;custdb.flds.h&quot;     /* field header file shown in */<br />/* &#8220;Sample Header File Produced by viewc&#8221; listing */<br />#include &quot;custdb.h&quot;          /* C structure header file produced by */<br />/* viewc shown in &#8220;Sample Field Table&#8221; listing */<br />#define NF 800<br />#define NV 400<br />extern Ferror;<br />main()<br />{<br />  /* declare needed program variables and FML functions */<br />    FBFR *fbfr,*Falloc();<br />    void F_error();<br />    char *str, *cstruct, buff[100];<br />    struct custdb cust;<br /> <br />  /* allocate a fielded buffer */<br />    if ((fbfr = Falloc(NF,NV)) == NULL) {<br />            F_error(&quot;sample.program&quot;);<br />            exit(1);<br />  }<br /> <br />     /* initialize str pointer to point to buff     */<br />     /* copy string values into buff, and           */<br />     /* Fadd values into some of the fields in fbfr */<br /> <br />     str = &amp;buff;<br />     strcpy(str,&quot;13579&quot;);<br />     if (Fadd(fbfr,ACTION,str,(FLDLEN)6) &lt; 0)<br />                  F_error(&quot;Fadd&quot;);<br />     strcpy(str,&quot;act11&quot;);<br />     if (Fadd(fbfr,ACTION,str,(FLDLEN)6) &lt; 0)<br />                  F_error(&quot;Fadd&quot;);<br />     strcpy(str,&quot;This is a one test.&quot;);<br />     if (Fadd(fbfr,BUG_CURS,str,(FLDLEN)19) &lt; 0)<br />                  F_error(&quot;Fadd&quot;);<br />     strcpy(str,&quot;This is a two test.&quot;);<br />     if (Fadd(fbfr,BUG_CURS,str,(FLDLEN)19) &lt; 0)<br />                  F_error(&quot;Fadd&quot;);<br />     strcpy(str,&quot;This is a three test.&quot;);<br />     if (Fadd(fbfr,BUG_CURS,str,(FLDLEN)21) &lt; 0)<br />                  F_error(&quot;Fadd&quot;);<br /> <br /> /* Print out the current contents of the fbfr */<br /> <br />     printf(&quot;fielded buffer before:\n&quot;); Fprint(fbfr);<br /> <br /> /* Put values in the C structure */<br /> <br />    cust.tape = 12345;<br />    cust.super = 999;<br />    cust.youid = 80;<br />    cust.custid[0] = -1; cust.custid[1] = 75;<br />    str = cust.bug[0][0];<br />    strncpy(str,&quot;no bugs12345&quot;,12);<br />    str = cust.bug[1][0];<br />    strncpy(str,&quot;yesbugs01234&quot;,12);<br />    str = cust.bug[2][0];<br />    strncpy(str,&quot;no bugsights&quot;,12);<br />    str = cust.bug[3][0];<br />    strncpy(str,&quot;no bugsysabc&quot;,12);<br />    str = cust.action[0][0];<br />    strcpy(str,&quot;yesaction&quot;);<br />    str = cust.action[1][0];<br />    strcpy(str,&quot;no action&quot;);<br />    str = cust.action[2][0];<br />    strcpy(str,&quot;222action&quot;);<br />    str = cust.action[3][0];<br />    strcpy(str,&quot;no action&quot;);<br />  cust.ch = &#39;0&#39;;<br />  cstruct = (char *)&amp;cust;<br /> <br />  /* Update the fbfr with the values in the C structure */<br />  /* using the custdb view description. */<br /> <br />  if (Fvstof(fbfr,cstruct,FUPDATE,&quot;custdb&quot;) &lt; 0) {<br />             F_error(&quot;custdb&quot;);<br />             Ffree(fbfr);<br />             exit(1);<br />  }<br /> <br />  /* Note that the following would transfer */<br />  /* data from fbfr to cstruct */<br />  /*<br />  if (Fvftos(fbfr,cstruct,&quot;custdb&quot;) &lt; 0) {<br />             F_error(&quot;custdb&quot;);<br />             Ffree(fbfr);<br />             exit(1);<br />  } */<br /> <br />  /* print out the values in the C structure and */<br />  /* the values in the fbfr       */<br /> <br />  printf(&quot;cstruct contains:\en&quot;);<br />  printf(&quot;action=:%s:\n&quot;,cust.action[0][0]);<br />  printf(&quot;action=:%s:\n&quot;,cust.action[1][0]);<br />  printf(&quot;action=:%s:\n&quot;,cust.action[2][0]);<br />  printf(&quot;action=:%s:\n&quot;,cust.action[3][0]);<br />  printf(&quot;custid=%ld\n&quot;,cust.custid[0]);<br />  printf(&quot;custid=%ld\n&quot;,cust.custid[1]);<br />  printf(&quot;youid=%ld\n&quot;,cust.youid);<br />  printf(&quot;tape=%f\n&quot;,cust.tape);<br />  printf(&quot;super=%d\n&quot;,cust.super);<br />  printf(&quot;bug=:%.12s:\n&quot;,cust.bug[0][0]);<br />  printf(&quot;bug=:%.12s:\n&quot;,cust.bug[1][0]);<br />  printf(&quot;bug=:%.12s:\n&quot;,cust.bug[2][0]);<br />  printf(&quot;bug=:%.12s:\en&quot;,cust.bug[3][0]);<br />  printf(&quot;ch=:%c:\n\n&quot;,cust.ch);<br /> <br /> printf(&quot;fielded buffer after:\n&quot;);<br />  Fprint(fbfr);<br />  Ffree(fbfr);<br />  exit(0);<br /> <br />}</pre></div><h3 class="pHeading2"><a name="wp1004019"> </a>
Example of VIEWS in bankapp
</h3>
<p class="pBody"><a name="wp1004020"> </a>
<code class="cCode">bankapp</code> is a sample application distributed with the Oracle Tuxedo system. It includes two files in which a VIEWS structure is used. The structure in the example is one that does not map to an FML buffer, so FML functions are not used to get data into or out of the structure members.
</p>
<p class="pBody"><a name="wp1004021"> </a>
<code class="cCode">$TUXDIR/apps/bankapp/audit.c</code> is a client program that uses command-line options to determine how to set up a service request in a <code class="cCode">VIEW</code> typed buffer.
</p>
<p class="pBody"><a name="wp1004022"> </a>
The code in the server <code class="cCode">$TUXDIR/apps/bankapp/BAL.ec</code> accepts the service request and shows the fields from a <code class="cCode">VIEW</code> buffer being used to formulate ESQL statements.
</p>
<h3 class="pHeading2"><a name="wp1004302"> </a>
See Also
</h3>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1004303"> </a><a href="../rfcm/rfcmd.html">viewc,&#160;viewc32(1)</a> in <em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
<li><a name="wp1004333"> </a><a href="../rfcm/rfcmd.html">mkfldhdr,&#160;mkfldhdr32(1)</a> in <em class="cEmphasis">Oracle Tuxedo Command Reference</em></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1004024"> </a>
FML Examples in bankapp
</h2><p class="pBody"><a name="wp1004025"> </a>
<code class="cCode">bankapp</code> is a sample application distributed with the Oracle Tuxedo system. The servers
</p>
<a name="wp1004026"> </a><div class="pPreformatted"><pre>ACCT.ec<br />BTADD.ec<br />TLR.ec</pre></div><p class="pBody"><a name="wp1004027"> </a>
show FML functions being used to manipulate data in FML typed buffers that have been passed to the servers from <code class="cCode">bankclt</code>, the bankapp client.
</p>
<p class="pBody"><a name="wp1004028"> </a>
Note that in these servers the ATMI functions <a href="../rf3c/rf3c.html">tpalloc(3c)</a> and <a href="../rf3c/rf3c.html">tprealloc(3c)</a>&#8212;rather than the FML functions <a href="../rf3fml/rf3fml.html">Falloc,&#160;Falloc32(3fml)</a> and <a href="../rf3fml/rf3fml.html">Frealloc,&#160;Frealloc32(3fml)</a>&#8212;are used to allocate message buffers.
</p>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="fml06.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="fml05.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="fmlxa.html"><img id="LongDescNotReq10" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
