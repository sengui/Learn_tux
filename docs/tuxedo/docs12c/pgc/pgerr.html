<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="41824" />
<meta name="LOC_US_SRCFILE" content="//depot/tuxedo/tux12c/pgc/fm/pgerr.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="06/26/12 11:38:00" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Managing Errors</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">Programming an Oracle Tuxedo ATMI Application Using C
</h1>
<!-- page title end -->

    <table id="SummaryNotReq2" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="pgthr.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next_grey1.gif" border="0" alt="Next" />&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
&nbsp;
<a href="../pdf/pgc.pdf" target="pdf"><img id="LongDescNotReq5" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq6" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1401022"> </a>
Managing Errors
</h1>
<p class="pBody"><a name="wp1358400"> </a>
This topic includes the following sections:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155408"> </a><a href="pgerr.html#wp1155434">System Errors</a></li>
<li><a name="wp1155412"> </a><a href="pgerr.html#wp1155665">Application Errors</a></li>
<li><a name="wp1155416"> </a><a href="pgerr.html#wp1155677">Handling Errors</a></li>
<li><a name="wp1155420"> </a><a href="pgerr.html#wp1155712">Transaction Considerations</a></li>
<li><a name="wp1155424"> </a><a href="pgerr.html#wp1155876">Central Event Log</a></li>
<li><a name="wp1391171"> </a><a href="pgerr.html#wp1396598">Debugging Application Processes</a></li>
<li><a name="wp1391175"> </a><a href="pgerr.html#wp1396651">Comprehensive Example</a></li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155434"> </a>
System Errors
</h2><p class="pBody"><a name="wp1155435"> </a>
The Oracle Tuxedo system uses the <a href="../rf5/rf5.html">tperrno(5)</a> variable to supply information to a process when a function fails. All ATMI functions that normally return an integer or pointer return <code class="cCode">-1</code> or <code class="cCode">NULL</code>, respectively, on error and set <code class="cCode">tperrno()</code> to a value that describes the nature of the error. When a function does not return to its caller, as in the case of <a href="pgserv.html#wp1167965">tpreturn()</a> or <a href="pgserv.html#wp1168061">tpforward()</a>, which are used to terminate a service routine, the only way the system can communicate success or failure is through the variable <code class="cCode">tperrno()</code> in the requester.
</p>
<p class="pBody"><a name="wp1391338"> </a>
The tperrordetail<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> and tpstrerrordetail<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> functions can be used to obtain additional detail about an error in the most recent Oracle Tuxedo system call on the current thread. <code class="cCode">tperrordetail()</code> returns an integer (with an associated symbolic name) which is then used as an argument to <code class="cCode">tpstrerrordetail()</code> to retrieve a pointer to a string that contains the error message. The pointer can then be used as an argument to userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> or <code class="cCode">fprintf()</code>. For a list of the symbolic names that can be returned, refer to tperrordetail<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> in the <em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em>.
</p>
<p class="pBody"><a name="wp1155440"> </a>
<a href="../rf5/rf5.html">tpurcode(5)</a> is used to communicate user-defined conditions only. The system sets the value of <code class="cCode">tpurcode</code> to the value of the <code class="cCodeEmphasis">rcode</code> argument of <a href="pgserv.html#wp1167965">tpreturn()</a>. The system sets <code class="cCode">tpurcode</code>, regardless of the value of the <code class="cCodeEmphasis">rval</code> argument of <code class="cCode">tpreturn()</code>, unless an error is encountered by <code class="cCode">tpreturn()</code> or a transaction timeout occurs.
</p>
<p class="pBody"><a name="wp1260332"> </a>
The codes returned in <a href="../rf5/rf5.html">tperrno(5)</a> represent categories of errors, which are listed in <a href="pgerr.html#wp905423">Table&#160;11-1</a>. 
</p>
<p class="pGraphic"><a name="wp1260407"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp905423table1260333"><caption><a name="wp905423"> </a>
Table 11-1  <span style="font-style: normal; font-weight: bold; text-decoration: none; vertical-align: baseline">tperrno Error Categories</span>

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1260335"> </a>
Error Category
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1260337"> </a>
tperrno Values
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260339"> </a>
Abort
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260341"> </a>
<code class="cCode">TPEABORT</code><sup class="cSuperscript">2</sup>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260343"> </a>
Oracle Tuxedo system<sup class="cSuperscript">1</sup>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260345"> </a>
<code class="cCode">TPESYSTEM</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260347"> </a>
Call descriptor
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260349"> </a>
<code class="cCode">TPELIMIT</code> and <code class="cCode">TPEBADDESC</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260351"> </a>
Conversational
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260353"> </a>
<code class="cCode">TPEVENT</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266604"> </a>
Duplicate operation
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266606"> </a>
<code class="cCode">TPEMATCH</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260355"> </a>
General communication
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260357"> </a>
<code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPESVCERR</code>, <code class="cCode">TPEBLOCK</code>, and <code class="cCode">TPGOTSIG</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260359"> </a>
Heuristic decision
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260361"> </a>
<code class="cCode">TPEHAZARD</code><sup class="cSuperscript">2</sup><sup class="cSuperscript"> </sup>and <code class="cCode">TPEHEURISTIC</code><sup class="cSuperscript">2</sup>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260363"> </a>
Invalid argument<sup class="cSuperscript">1</sup>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260365"> </a>
<code class="cCode">TPEINVAL</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266545"> </a>
MIB
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266547"> </a>
<code class="cCode">TPEMIB</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260367"> </a>
No entry
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260369"> </a>
<code class="cCode">TPENOENT</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260371"> </a>
Operating system<sup class="cSuperscript">1</sup>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260373"> </a>
<code class="cCode">TPEOS</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260375"> </a>
Permission
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260377"> </a>
<code class="cCode">TPEPERM</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260382"> </a>
Protocol<a href="#wp1260381" title="Footnote 1"><sup class="Footnote">1</sup></a>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260384"> </a>
<code class="cCode">TPEPROTO</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266534"> </a>
Queueing
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266536"> </a>
<code class="cCode">TPEDIAGNOSTIC</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266519"> </a>
Release compatibility
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1266521"> </a>
<code class="cCode">TPERELEASE</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260386"> </a>
Resource manager
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260388"> </a>
<code class="cCode">TPERMERR</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260390"> </a>
Timeout
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260392"> </a>
<code class="cCode">TPETIME</code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260394"> </a>
Transaction
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260402"> </a>
<code class="cCode">TPETRAN<a href="#wp1260401" title="Footnote 2"><sup class="Footnote">2</sup></a></code>
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260404"> </a>
Typed buffer mismatch
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1260406"> </a>
<code class="cCode">TPEITYPE</code> and <code class="cCode">TPEOTYPE</code>
</div>
</td>
</tr>
</table>

<table class="footnote" id="SummaryNotReq1">  <tr>
    <td><p class="pTableFootnote"><a name="wp1260381"> </a>
<a href="#wp1260382" title="Footnote 1"><sup class="Footnote">1</sup></a>Applicable to all ATMI functions for which failure is reported by the value returned in <a href="../rf5/rf5.html">tperrno(5)</a>.
</p>

<p class="pTableFootnote"><a name="wp1260401"> </a>
<a href="#wp1260402" title="Footnote 2"><sup class="Footnote">2</sup></a>Refer to <a href="pgerr.html#wp1155758">Fatal Transaction Errors</a> for more information on this error category.
</p>

</td>
  </tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1260408"> </a>
As footnote 1 shows, four categories of errors are reported by <a href="../rf5/rf5.html">tperrno(5)</a> and are applicable to all ATMI functions. The remaining categories are used only for specific ATMI functions.The following sections describe some error categories in detail.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155518"> </a>
Abort Errors
</h2><p class="pBody"><a name="wp1155521"> </a>
For information on the errors that lead to abort, refer to <a href="pgerr.html#wp1155758">Fatal Transaction Errors</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155523"> </a>
Oracle Tuxedo System Errors
</h2><p class="pBody"><a name="wp1155524"> </a>
Oracle Tuxedo system errors indicate problems at the <em class="cEmphasis">system level</em>, rather than at the application level. When Oracle Tuxedo system errors occur, the system writes messages explaining the exact nature of the errors to the central event log, and returns <code class="cCode">TPESYSTEM</code> in <a href="../rf5/rf5.html">tperrno(5)</a>. For more information, refer to the <a href="pgerr.html#wp1155876">Central Event Log</a>. Because these errors occur in the system, rather than in the application, you may need to consult the system administrator to correct them.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155528"> </a>
Call Descriptor Errors
</h2><p class="pBody"><a name="wp1155529"> </a>
Call descriptor errors occur as a result of exceeding the maximum limit of call descriptors or referencing an invalid value. Asynchronous and conversational calls return <code class="cCode">TPELIMIT</code> when the maximum number of outstanding call descriptors has been exceeded. <code class="cCode">TPEBADDESC</code> is returned when an invalid call descriptor value is specified for an operation.
</p>
<p class="pBody"><a name="wp1155530"> </a>
Call descriptor errors occur only during asynchronous calls or conversational calls. (Call descriptors are not used for synchronous calls.) Asynchronous calls depend on call descriptors to associate replies with the corresponding requests. Conversational send and receive functions depend on call descriptors to identify the connection; the call that initiates the connection depends on the availability of a call descriptor. 
</p>
<p class="pBody"><a name="wp1155531"> </a>
Troubleshooting of call descriptor errors can be done by checking for specific errors at the application level.
</p>
<h3 class="pHeading2"><a name="wp1155532"> </a>
Limit Errors
</h3>
<p class="pBody"><a name="wp1155533"> </a>
The system allows up to 50 outstanding call descriptors (replies) per context (or Oracle Tuxedo application association). This limit is enforced by the system; it cannot be redefined by your application.
</p>
<p class="pBody"><a name="wp1155534"> </a>
The limit for call descriptors for simultaneous conversational connections is more flexible than the limit for replies. The application administrator defines the limit in the configuration file. When the application is not running, the administrator can modify the <code class="cCode">MAXCONV</code> parameter in the <code class="cCode">RESOURCES</code> section of the configuration file. When the application is running, the administrator can modify the <code class="cCode">MACHINES</code> section dynamically. Refer to <a href="../rfcm/rfcmd.html">tmconfig,&#160;wtm</a><a href="../rfcm/rfcmd.html">config(1)</a> in the <em class="cEmphasis">Oracle Tuxedo Command Reference</em> for more information.
</p>
<h3 class="pHeading2"><a name="wp1155538"> </a>
Invalid Descriptor Errors
</h3>
<p class="pBody"><a name="wp1155539"> </a>
A call descriptor can become invalid and, if referenced, cause an error to be returned to <a href="../rf5/rf5.html">tperrno(5)</a> in either of two situations:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155540"> </a>A call descriptor is used to retrieve a message, which may be a failed message (<code class="cCode">TPEBADDESC</code>).</li>
<li><a name="wp1155541"> </a>An attempt is made to reuse a stale call descriptor (<code class="cCode">TPEBADDESC</code>). </li>
</ul></div>
<p class="pBody"><a name="wp1155542"> </a>
A call descriptor might become stale, for example, in the following circumstances:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155543"> </a>When the application calls <a href="pgglob.html#wp1045451">tpabort()</a> or <a href="pgglob.html#wp1045424">tpcommit()</a> and transaction replies (sent without the <code class="cCode">TPNOTRAN</code> flag) remain to be retrieved. </li>
<li><a name="wp1155544"> </a>A transaction times out. When the timeout is reported by a call to <a href="pgreq.html#wp1098002">tpgetrply()</a>, no message is retrieved using the specified descriptor and the descriptor becomes stale. </li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1259219"> </a>
Conversational Errors
</h2><p class="pBody"><a name="wp1259220"> </a>
When an unknown descriptor is specified for conversational services, the <a href="pgconv.html#wp1062634">tpsend()</a>, <a href="pgconv.html#wp1062702">tprecv()</a>, and <a href="pgconv.html#wp1082308">tpdiscon()</a> functions return <code class="cCode">TPEBADDESC</code>.
</p>
<p class="pBody"><a name="wp1155547"> </a>
When <a href="pgconv.html#wp1062634">tpsend()</a> and <a href="pgconv.html#wp1062702">tprecv()</a> fail with a <code class="cCode">TPEEVENT</code> error after a conversational connection is established, an event has occurred. Data may or may not be sent by <a href="pgconv.html#wp1062634">tpsend()</a>, depending on the event. The system returns <code class="cCode">TPEEVENT</code> in the <code class="cCodeEmphasis">revent</code> parameter passed to the function call and the course of action is dictated by the particular event.
</p>
<p class="pBody"><a name="wp1155550"> </a>
For a complete description of conversational events, refer to <a href="pgconv.html#wp1062850">Understanding Conversational Communication Events</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1267083"> </a>
Duplicate Object Error
</h2><p class="pBody"><a name="wp1268950"> </a>
The <code class="cCode">TPEMATCH</code> error code is returned in <a href="../rf5/rf5.html">tperrno(5)</a> when an attempt is made to perform an operation that results in a duplicate object. The following table lists the functions that may return the <code class="cCode">TPEMATCH</code> error code and the associated cause.
</p>
<p class="pGraphic"><a name="wp1402835"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp1269152table1269150">
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellHeading"><a name="wp1269152"> </a>
Function
</div>
</td>
    <td class="table" scope="row"><div class="pCellHeading"><a name="wp1269154"> </a>
Cause
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269156"> </a>
<span class="cHyperlink">
<a href="pgserv.html#wp1168143">tpadvertise</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269158"> </a>
The <code class="cCodeEmphasis">svcname</code> specified is already advertised for the server but with a function other than <code class="cCodeEmphasis">func</code>. Although the function fails, <code class="cCodeEmphasis">svcname</code> remains advertised with its current function (that is, <code class="cCodeEmphasis">func</code> does not replace the current function name).
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269224"> </a>
<span class="cHyperlink">
<a href="pgglob.html#wp1132082">tpresume</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269227"> </a>
The <code class="cCodeEmphasis">tranid</code> points to a transaction identifier that another process has already resumed. In this case, the caller&#8217;s state with respect to the transaction is not changed.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269207"> </a>
<span class="cHyperlink">
<a href="pgevb.html#wp1081229">tpsubscribe </a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1269210"> </a>
The specified subscription information has already been listed with the EventBroker.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p class="pBody"><a name="wp1269246"> </a>
For more information on these functions, refer to the <em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em>
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1266623"> </a>
General Communication Call Errors
</h2><p class="pBody"><a name="wp1155553"> </a>
General communication call errors can occur during any communication calls, regardless of whether those calls are synchronous or asynchronous. Any of the following errors may be returned in <a href="../rf5/rf5.html">tperrno(5)</a>: <code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPESVCERR</code>, <code class="cCode">TPEBLOCK</code>, or <code class="cCode">TPGOTSIG.</code>
</p>
<h3 class="pHeading2"><a name="wp1155554"> </a>
TPESVCFAIL and TPESVCERR Errors
</h3>
<p class="pBody"><a name="wp1259501"> </a>
If the reply portion of a communication fails as a result of a call to <a href="pgreq.html#wp1055338">tpcall()</a> or <a href="pgreq.html#wp1098002">tpgetrply()</a>, the system returns <code class="cCode">TPESVCERR</code> or <code class="cCode">TPSEVCFAIL</code> to <a href="../rf5/rf5.html">tperrno(5)</a>. The system determines the error by the arguments that are passed to <a href="pgserv.html#wp1167965">tpreturn()</a> and the processing that is performed by this function. 
</p>
<p class="pBody"><a name="wp1155556"> </a>
If <a href="pgserv.html#wp1167965">tpreturn()</a> encounters an error in processing or handling arguments, the system returns an error to the original requester and sets <a href="../rf5/rf5.html">tperrno(5)</a> to <code class="cCode">TPESVCERR</code>. The receiver determines that an error has occurred by checking the value of <code class="cCode">tperrno()</code>. The system does not send the data from the <code class="cCode">tpreturn()</code> function, and if the failure occurred on <a href="pgreq.html#wp1098002">tpgetrply()</a>, it renders the call descriptor invalid. 
</p>
<p class="pBody"><a name="wp1155557"> </a>
If <a href="pgserv.html#wp1167965">tpreturn()</a> does not encounter the <code class="cCode">TPESVCERR</code> error, then the value returned in <code class="cCodeEmphasis">rval</code> determines the success or failure of the call. If the application specifies <code class="cCode">TPFAIL</code> in the <code class="cCodeEmphasis">rval</code> parameter, the system returns <code class="cCode">TPESVCFAIL</code> in <a href="../rf5/rf5.html">tperrno(5)</a> and sends the data message to the caller. If <code class="cCodeEmphasis">rval</code> is set to <code class="cCode">TPSUCCESS</code>, the system returns successfully to the caller, <code class="cCode">tperrno()</code> is not set, and the caller receives the data.
</p>
<h3 class="pHeading2"><a name="wp1155558"> </a>
TPEBLOCK and TPGOTSIG Errors
</h3>
<p class="pBody"><a name="wp1155559"> </a>
The <code class="cCode">TPEBLOCK</code> and <code class="cCode">TPGOTSIG</code> error codes may be returned at the request or the reply end of a message and, as a result, can be returned for all communication calls. 
</p>
<p class="pBody"><a name="wp1155560"> </a>
The system returns <code class="cCode">TPEBLOCK</code> when a blocking condition exists and the process sending a request (synchronously or asynchronously) indicates, by setting its <code class="cCodeEmphasis">flags</code> parameter to <code class="cCode">TPPNOBLOCK</code>, that it does not want to wait on a blocking condition. A blocking condition can exist when a request is being sent if, for example, all the system queues are full. 
</p>
<p class="pBody"><a name="wp1155561"> </a>
When <a href="pgreq.html#wp1055338">tpcall()</a> indicates a no blocking condition, only the sending part of the communication is affected. If a call successfully sends a request, the system does not return <code class="cCode">TPEBLOCK</code>, regardless of any blocking situation that may exist while the call waits for the reply. 
</p>
<p class="pBody"><a name="wp1155562"> </a>
The system returns <code class="cCode">TPEBLOCK</code> for <a href="pgreq.html#wp1098002">tpgetrply()</a> when a call is made with <code class="cCodeEmphasis">flags</code> set to <code class="cCode">TPNOBLOCK</code> and a blocking condition is encountered while <code class="cCode">tpgetrply()</code> is awaiting the reply. This may occur, for example, if a message is not currently available.
</p>
<p class="pBody"><a name="wp1155563"> </a>
The <code class="cCode">TPGOTSIG</code> error indicates an interruption of a system call by a signal; this situation is not actually an error condition. If the <code class="cCodeEmphasis">flags</code> parameter for the communication functions is set to <code class="cCode">TPSIGRSTRT</code>, the calls do not fail and the system does not return the <code class="cCode">TPGOTSIG</code> error code in <a href="../rf5/rf5.html">tperrno(5)</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155564"> </a>
Invalid Argument Errors
</h2><p class="pBody"><a name="wp1155565"> </a>
Invalid argument errors indicate that an invalid argument was passed to a function. Any ATMI function that takes arguments can fail if you pass it arguments that are invalid. In the case of a function that returns to the caller, the function fails and causes <a href="../rf5/rf5.html">tperrno(5)</a> to be set to <code class="cCode">TPEINVAL</code>. In the case of <a href="pgserv.html#wp1167965">tpreturn()</a> or <a href="pgserv.html#wp1168061">tpforward()</a>, the system sets <code class="cCode">tperrno()</code> to <code class="cCode">TPESVCERR</code> for either the <a href="pgreq.html#wp1055338">tpcall()</a> or <a href="pgreq.html#wp1098002">tpgetrply()</a> function that initiated the request and is waiting for results to be returned.
</p>
<p class="pBody"><a name="wp1155566"> </a>
You can correct an invalid argument error at the <em class="cEmphasis">application level</em> by ensuring that you pass only valid arguments to functions. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1392886"> </a>
MIB Error
</h2><p class="pBody"><a name="wp1392893"> </a>
The tpadmcall<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> function returns <code class="cCode">TPEMIB</code> in <a href="../rf5/rf5.html">tperrno(5)</a> in the event an administrative request fails. <code class="cCodeEmphasis">outbuf</code> is updated and returned to the caller with FML32 fields indicating the cause of the error. For more information on the cause of the error, refer to <a href="../rf5/rf5.html">MIB(5)</a> and <a href="../rf5/rf5.html">TM_MIB(5)</a> in <em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155567"> </a>
No Entry Errors
</h2><p class="pBody"><a name="wp1155568"> </a>
No entry errors result from a lack of entries in the system tables or the data structure used to identify buffer types. The meaning of the no entry type error, <code class="cCode">TPENOENT</code>, depends on the function that is returning it. <a href="pgerr.html#wp905516">Table&#160;11-2</a> lists the functions that return this error and describes various causes of error. 
</p>
<p class="pGraphic"><a name="wp1155616"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp905516table1155569"><caption><a name="wp905516"> </a>
Table 11-2  No Entry Errors

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1155571"> </a>
Function
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1155573"> </a>
Cause
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155575"> </a>
<span class="cHyperlink">
<a href="pgbuf.html#wp1262143">tpalloc()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155577"> </a>
The system does not know about the type of buffer requested. For a buffer type and/or subtype to be known, there must be an entry for it in a type switch data structure that is defined in the Oracle Tuxedo system libraries. Refer to <a href="../rf5/rf5.html">tuxtypes(5)</a> and <a href="../rf5/rf5.html">typesw(5)</a> in the <em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em> for more information. 
</div>
<div class="pCellBody"><a name="wp1155581"> </a>
On an application level, ensure that you have referenced a known type; otherwise, check with the system administrator.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155583"> </a>
<span class="cHyperlink">
<a href="pgclt.html#wp1030381">tpinit()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155585"> </a>
The calling process cannot join the application because there is no space left in the bulletin board to make an entry for it. Check with the system administrator.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155587"> </a>
 <a href="pgreq.html#wp1055338">tpcall()</a><code class="cCode"> <br /></code><span class="cHyperlink">
<a href="pgreq.html#wp1055487">tpacall()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155589"> </a>
The calling process references a service called that is not known to the system since there is no entry for it in the bulletin board. On an application level, ensure that you have referenced the service correctly; otherwise, check with the system administrator.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155591"> </a>
<span class="cHyperlink">
<a href="pgconv.html#wp1089600">tpconnect()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155593"> </a>
The system cannot connect to the specified name because the service named does not exist or it is not a conversational service.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155595"> </a>
<span class="cHyperlink">
<a href="pgreq.html#wp1055635">tpgprio()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155597"> </a>
The calling process seeks a request priority when no request has been made. This is an application-level error.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155599"> </a>
<span class="cHyperlink">
<a href="pgserv.html#wp1168162">tpunadvertise()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155601"> </a>
The system cannot unadvertise the service name because the name is not currently advertised by the calling process.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155603"> </a>
tpenqueue<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span><code class="cCode"> </code><span class="cHyperlink">
<a href="../rf3c/rf3c.html">tpdequeue</a>(3c)</span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155605"> </a>
The system cannot access the queue space because the associated <a href="../rf5/rf5.html">TMQUEUE(5)</a>server is not available. Refer to the <em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em> for more information.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155610"> </a>
<span class="cHyperlink">
tppost()</span><a href="pgevb.html#wp1081416">       </a><span class="cHyperlink">
<a href="pgevb.html#wp1081229">tpsubscribe() </a></span>  <span class="cHyperlink">
<a href="pgevb.html#wp1081383">tpunsubscribe()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155612"> </a>
The system cannot access the Oracle Tuxedo system Event Broker. Refer to <a href="pgevb.html">Writing Event-based Clients and Servers</a> for more information.
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155617"> </a>
Operating System Errors
</h2><p class="pBody"><a name="wp1155618"> </a>
Operating system errors indicate that an operating system call has failed. The system returns <code class="cCode">TPEOS</code> in <a href="../rf5/rf5.html">tperrno(5)</a>. On UNIX systems, the system returns a numeric value identifying the failed system call in the global variable <code class="cCode">Uunixerr</code>. To resolve operating system errors, you may need to consult your system administrator.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155619"> </a>
Permission Errors
</h2><p class="pBody"><a name="wp1155620"> </a>
If a calling process does not have the correct permissions to join the application, the <a href="pgclt.html#wp1030381">tpinit()</a> call fails, returning <code class="cCode">TPEPERM</code> in <a href="../rf5/rf5.html">tperrno(5)</a>. Permissions are set in the configuration file, outside of the application. If you encounter this error, check with the application administrator to make sure the necessary permissions are set in the configuration file.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155621"> </a>
Protocol Errors
</h2><p class="pBody"><a name="wp1155622"> </a>
Protocol errors occur when an ATMI function is invoked, either in the wrong order or using an incorrect process. For example, a client may try to begin communicating with a server before joining the application. Or <a href="pgglob.html#wp1045424">tpcommit()</a> may be called by a transaction participant instead of the initiator.
</p>
<p class="pBody"><a name="wp1155623"> </a>
You can correct a protocol error at the <em class="cEmphasis">application level</em> by enforcing the rules of order and proper usage of ATMI calls. 
</p>
<p class="pBody"><a name="wp1155624"> </a>
To determine the cause of a protocol error, answer the following questions:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155625"> </a>Is the call being made in the correct order?</li>
<li><a name="wp1155626"> </a>Is the call being made by the correct process?</li>
</ul></div>
<p class="pBody"><a name="wp1155627"> </a>
Protocol errors return the <code class="cCode">TPEPROTO</code> value in <a href="../rf5/rf5.html">tperrno(5)</a>.
</p>
<p class="pBody"><a name="wp1155633"> </a>
Refer to &#8220;Introduction to the C Application-Transaction Monitor Interface&#8221; in the <em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em> for more information. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1268098"> </a>
Queuing Error
</h2><p class="pBody"><a name="wp1268105"> </a>
The tpenqueue<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> or tpdequeue<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> function returns <code class="cCode">TPEDIAGNOSTIC</code> in <a href="../rf5/rf5.html">tperrno(5)</a> if the enqueuing or dequeuing on a specified queue fails. The reason for failure can be determined by the diagnostic returned via the <code class="cCodeEmphasis">ctl</code> buffer. For a list of valid <code class="cCodeEmphasis">ctl</code> flags, refer to tpenqueue<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> or tpdequeue<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> in the <em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em>
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1268224"> </a>
Release Compatibility Error
</h2><p class="pBody"><a name="wp1268310"> </a>
The Oracle Tuxedo system returns <code class="cCode">TPERELEASE</code> in <a href="../rf5/rf5.html">tperrno(5)</a> if a compatibility issue exists between multiple releases of an Oracle Tuxedo system participating in an application domain. 
</p>
<p class="pBody"><a name="wp1268661"> </a>
For example, the <code class="cCode">TPERELEASE</code> error may be returned if the <code class="cCode">TPACK</code> flag is set when issuing the tpnotify<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> function (indicating that the caller blocks until an acknowledgment message is received from the target client), but the target client is using an earlier release of the Oracle Tuxedo system that does not support the <code class="cCode">TPACK</code> acknowledgement protocol. 
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155635"> </a>
Resource Manager Errors
</h2><p class="pBody"><a name="wp1155636"> </a>
Resource manager errors can occur with calls to tpopen<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> and tpclose<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>, in which case the system returns the value of <code class="cCode">TPERMERR</code> in <a href="../rf5/rf5.html">tperrno(5)</a>. This error code is returned for <code class="cCode">tpopen()</code> when the resource manager fails to open correctly. Similarly, this error code is returned for <code class="cCode">tpclose()</code> when the resource manager fails to close correctly. To maintain portability, the Oracle Tuxedo system does not return a more detailed explanation of this type of failure. To determine the exact nature of a resource manager error, you must interrogate the resource manager.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155637"> </a>
Timeout Errors
</h2><p class="pBody"><a name="wp1155638"> </a>
The Oracle Tuxedo system supports timeout errors to establish a limit on the amount of time that the application waits for a service request or transaction. The Oracle Tuxedo system supports two types of configurable timeout mechanisms: blocking and transaction.
</p>
<p class="pBody"><a name="wp1155639"> </a>
A <em class="cEmphasis">blocking timeout</em> specifies the maximum amount of time that an application waits for a reply to a service request. The application administrator defines the blocking timeout for the system in the configuration file. 
</p>
<p class="pBody"><a name="wp1155640"> </a>
A <em class="cEmphasis">transaction timeout</em> defines the duration of a transaction, which may involve several service requests. To define the transaction timeout for an application, pass the <code class="cCodeEmphasis">timeout</code> argument to <a href="pgglob.html#wp1045304">tpbegin()</a>.
</p>
<p class="pBody"><a name="wp1155641"> </a>
The system may return timeout errors on communication calls for either blocking or transaction timeouts, and on <a href="pgglob.html#wp1045424">tpcommit()</a> for transaction timeouts only. In each case, if a process is in transaction mode and the system returns <code class="cCode">TPETIME</code> on a failed call, a transaction timeout has occurred.
</p>
<p class="pBody"><a name="wp1155642"> </a>
By default, if a process is not in transaction mode, the system performs blocking timeouts. When you set the <code class="cCodeEmphasis">flags</code> parameter of a communication call to <code class="cCode">TPNOTIME</code>, the flag setting applies to blocking timeouts only. If a process is in transaction mode, blocking timeouts are not performed and the <code class="cCode">TPNOTIME</code> flag setting is not relevant. 
</p>
<p class="pBody"><a name="wp1155643"> </a>
If a process is not in transaction mode and a blocking timeout occurs on an asynchronous call, the communication call that blocked fails, but the call descriptor is still valid and may be used on a reissued call. Other communication is not affected.
</p>
<p class="pBody"><a name="wp1155644"> </a>
When a transaction timeout occurs, the call descriptor to an asynchronous transaction reply (specified without the <code class="cCode">TPNOTRAN</code> flag) becomes stale and may no longer be referenced. 
</p>
<p class="pBody"><a name="wp1155645"> </a>
<code class="cCode">TPETIME</code> indicates a blocking timeout on a communication call if the call was not made in transaction mode or if the <code class="cCodeEmphasis">flags</code> parameter was not set to <code class="cCode">TPNOBLOCK</code>.
</p>
<a name="wp1155646"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>If you set the <code class="cCode">TPNOBLOCK</code> flag, a blocking timeout cannot occur because the call returns immediately if a blocking condition exists.</td>
</tr>
</table>

<p class="pBody"><a name="wp1155649"> </a>
For additional information on handling timeout errors, refer to <a href="pgerr.html#wp1155712">Transaction Considerations</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155651"> </a>
Transaction Errors
</h2><p class="pBody"><a name="wp1155652"> </a>
For information on transactions and the non-fatal and fatal errors that can occur, refer to <a href="pgerr.html#wp1155712">Transaction Considerations</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1393580"> </a>
Typed Buffer Errors
</h2><p class="pBody"><a name="wp1155657"> </a>
Typed buffer errors are returned when requests or replies to processes are sent in buffers of an unknown type. The <a href="pgreq.html#wp1055338">tpcall()</a>, <a href="pgreq.html#wp1055487">tpacall()</a>, and <a href="pgconv.html#wp1089600">tpconnect()</a> functions return <code class="cCode">TPEITYPE</code> when a request data buffer is sent to a service that does not recognize the type of the buffer.
</p>
<p class="pBody"><a name="wp1155658"> </a>
Processes recognize buffer types that are identified in both the configuration file and the Oracle Tuxedo system libraries that are linked into the process. These libraries define and initialize a data structure that identifies the typed buffers that the process recognizes. You can tailor the library to each process, or an application can supply its own copy of a file that defines the buffer types. An application can set up the buffer type data structure (referred to as a buffer type switch) on a process-specific basis. For more information, see <a href="../rf5/rf5.html">tuxtypes(5)</a>and <a href="../rf5/rf5.html">typesw(5)</a> in the <em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em>. 
</p>
<p class="pBody"><a name="wp1155662"> </a>
The <a href="pgreq.html#wp1055338">tpcall()</a>, <a href="pgreq.html#wp1098002">tpgetrply()</a>, tpdequeue<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>, and <a href="pgconv.html#wp1062702">tprecv()</a> functions return <code class="cCode">TPEOTYPE</code> when a reply message is sent in a buffer that is not recognized or not allowed by the caller. In the latter case, the buffer type is included in the type switch, but the type returned does not match the type that was allocated to receive the reply and a change in buffer type is not allowed by the caller. The caller indicates this preference by setting <code class="cCodeEmphasis">flags</code> to <code class="cCode">TPNOCHANGE</code>. In this case, strong type checking is enforced; the system returns <code class="cCode">TPEOTYPE</code> when it is violated. By default, weak type checking is used. In this case, a buffer type other than the type originally allocated may be returned, as long as that type is recognized by the caller. The rules for sending replies are that the reply buffer must be recognized by the caller and, if strong type checking has been indicated, you must observe it.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155665"> </a>
Application Errors
</h2><p class="pBody"><a name="wp1155666"> </a>
Within an application, you can pass information about user-defined errors to calling programs using the <code class="cCodeEmphasis">rcode</code> argument of <a href="pgserv.html#wp1167965">tpreturn()</a>. Also, the system sets the value of <code class="cCode">tpurcode</code> to the value of the <code class="cCodeEmphasis">rcode</code> argument of <code class="cCode">tpreturn()</code>. For more information about tpreturn<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> or <a href="../rf5/rf5.html">tpurcode(5)</a>, refer to the <em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em> and the <em class="cEmphasis">File Formats, Data Descriptions, MIBs, and System Processes Reference</em>, respectively.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155677"> </a>
Handling Errors
</h2><p class="pBody"><a name="wp1155678"> </a>
Your application logic should test for error conditions for the calls that have return values, and take appropriate action when an error occurs. Specifically, you should:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1394063"> </a>Test to determine whether a <code class="cCode">-1</code> or <code class="cCode">NULL</code> value has been returned (depending on the function call).</li>
<li><a name="wp1394067"> </a>Invoke code that contains a switch statement that tests for specific values of <a href="../rf5/rf5.html">tperrno(5)</a> and performs the appropriate application logic.</li>
</ul></div>
<p class="pBody"><a name="wp1394076"> </a>
The ATMI supports three functions, tpstrerrordetail<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>, tpstrerror<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>, and <a href="../rf3fml/rf3fml.html">Fstrerror,&#160;Fstrerr</a><a href="../rf3fml/rf3fml.html">or32(3fml)</a>, for retrieving the text of an error message from the message catalogs for the Oracle Tuxedo system and FML. The functions return pointers to the appropriate error messages. Your program can use a pointer to direct the referenced text to userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> or to another destination. For details, refer to tpstrerrordetail<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> and tpstrerror<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> in the <em class="cEmphasis">Oracle Tuxedo ATMI C Function Reference</em>, and <a href="../rf3fml/rf3fml.html">Fstrerror,&#160;Fstrer</a><a href="../rf3fml/rf3fml.html">ror32(3fml)</a> in the <em class="cEmphasis">Oracle Tuxedo ATMI FML Function Reference</em>.
</p>
<p class="pBody"><a name="wp1394100"> </a>
<a href="pgerr.html#wp1394102">Listing&#160;11-1</a> shows a typical method of handling errors. The <code class="cCode">atmicall()</code> function in this example represents a generic ATMI call. Note the code after the switch statement (line 21): it shows how <code class="cCode">tpurcode</code> can be used to interpret an application-defined return code.
</p>
<div class="pCodeTitle"><a name="wp1394102"> </a>
Listing&#160;11-1	   Handling Errors
</div> <a name="wp1394103"> </a><div class="pPreformatted"><pre>001   #include &lt;stdio.h&gt;<br />002   #include &quot;atmi.h&quot;<br />003   <br />004   main()<br />005    <br />006   {<br />007   int rtnval;<br />008    <br />009   if (tpinit((TPINIT *) NULL) == -1)<br />010     <code class="cCodeEmphasis"> </code><em class="cEmphasis">error message, exit program;<br /></em>011   if (tpbegin(30, 0) == -1)<br />012     <code class="cCodeEmphasis"> error message, tpterm, exit program;<br /></code>013    <br />014   <code class="cCodeEmphasis">allocate any buffers,<br /></code>015   <code class="cCodeEmphasis">make atmi calls<br /></code>016   <code class="cCodeEmphasis">check return value<br /></code>017    <br />018   rtnval = <code class="cCodeEmphasis">atmicall()</code>;<br />019    <br />020   if (rtnval == -1) {<br />021       switch(tperrno) {<br />022       case TPEINVAL:<br />023           fprintf(stderr, &quot;Invalid arguments were given to <em class="cEmphasis">atmicall</em>\n&quot;);<br />024           fprintf(stderr, &quot;e.g., service name was null or flags wrong\n&quot;);<br />025           break;<br />026       case ...:<br />027           fprintf(stderr, &quot;. . .&quot;);<br />028           break;<br />029    <br />030   <code class="cCodeEmphasis">Include all error cases described in the atmicall(3) reference </code>031   <code class="cCodeEmphasis">page.<br /></code>032   <code class="cCodeEmphasis">Other return codes are not possible, so there should be no </code>033   <code class="cCodeEmphasis">default within the switch statement.<br /></code>034    <br />035   if (tpabort(0) == -1) {<br />036      char *p;<br />037      fprintf(stderr, &quot;abort was attempted but failed\n&quot;);<br />038      p = tpstrerror(tperrno);<br />039      userlog(&quot;%s&quot;, p);<br />040   }<br />041   }<br />042   else<br />043   if (tpcommit(0) == -1)<br />044   fprintf(stderr, &quot;REPORT program failed at commit time\n&quot;);<br />045    <br />046   <code class="cCodeEmphasis">The following code fragment shows how an application-specific <br /></code>047   <code class="cCodeEmphasis">return code can be examined</code>.<br />048   .<br />049   .<br />050   .<br />051   ret = tpcall(&quot;servicename&quot;, (char*)sendbuf, 0, (char    **)&amp;rcvbuf, &amp;rcvlen, \<br />052   (long)0);<br />053   .<br />054   .<br />055   .<br />056   (void) fprintf(stdout, &quot;Returned tpurcode is: %d\n&quot;, tpurcode);<br />057    <br />058    <br />059   free all buffers<br />060   tpterm();<br />061   exit(0);<br />062   }</pre></div><p class="pBody"><a name="wp1155698"> </a>
The values of <a href="../rf5/rf5.html">tperrno(5)</a> provide details about the nature of each problem and suggest the level at which it can be corrected. If your application defines a list of error conditions specific to your processing, the same can be said for the values of <code class="cCode">tpurcode</code>.
</p>
<p class="pBody"><a name="wp1394168"> </a>
<a href="pgerr.html#wp1394169">Listing&#160;11-2</a> shows how to use the tpstrerrordetail<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> function to obtain additional detail when an error is encountered.
</p>
<div class="pCodeTitle"><a name="wp1394169"> </a>
Listing&#160;11-2	   Handling Errors Using tpstrerrordetail( )
</div> <a name="wp1394170"> </a><div class="pPreformatted"><pre>001   #include &lt;stdio.h&gt;<br />002   #include &lt;string.h&gt;<br />003   #include &lt;atmi.h&gt;		/* BEA Tuxedo  Header File */<br />004   #define LOOP_ITER 	100<br />005   #if defined(__STDC__) || defined(__cplusplus)<br />006   main(int argc, char *argv[])<br />007   #else<br />008   main(argc, argv)<br />009   int argc;<br />010   char *argv[];<br />011   #endif<br />012   {<br />013   	char *sendbuf, *rcvbuf;<br />014   	long sendlen, rcvlen;<br />015   	int ret;<br />016   	int i;<br />017   	if(argc != 2) {<br />018   		(void) fprintf(stderr, &quot;Usage: simpcl string\n&quot;);<br />019   		exit(1);<br />020   	}<br />021   	/* Attach to BEA Tuxedo System as a Client Process */<br />022   	if (tpinit((TPINIT *) NULL) == -1) {<br />023   		(void) fprintf(stderr, &quot;Tpinit failed\n&quot;);<br />024   		exit(1);<br />025   	}<br />026   	sendlen = strlen(argv[1]);<br />027   <br />028   	/* Allocate STRING buffers for the request and the reply */<br />029   <br />030   	if((sendbuf = (char *) tpalloc(&quot;STRING&quot;, NULL, sendlen+1)) == NULL) {<br />031   		(void) fprintf(stderr,&quot;Error allocating send buffer\n&quot;);<br />032   		tpterm();<br />033   		exit(1);<br />034   	}<br />035   <br />036   	if((rcvbuf = (char *) tpalloc(&quot;STRING&quot;, NULL, sendlen+1)) == NULL) {<br />037   		(void) fprintf(stderr,&quot;Error allocating receive buffer\n&quot;);<br />038   		tpfree(sendbuf);<br />039   		tpterm();<br />040   		exit(1);<br />041   	}<br />042   <br />043   for( i=0; i&lt;LOOP_ITER; i++) {<br />044   	(void) strcpy(sendbuf, argv[1]);<br />045   <br />046   	/* Request the service TOUPPER, waiting for a reply */<br />047   	ret = tpcall(&quot;TOUPPER&quot;, (char *)sendbuf, 0, (char **)&amp;rcvbuf, &amp;rcvlen, (long)0);<br />048   <br />049   	if(ret == -1) {<br />050   		(void) fprintf(stderr, &quot;Can&#39;t send request to service<br />TOUPPER\n&quot;);<br />051   		(void) fprintf(stderr, &quot;Tperrno = %d, %s\n&quot;, tperrno, tpstrerror(tperrno));<br />052   <br />053   		ret = tperrordetail(0); <br />054   		if(ret == -1) {<br />055   			(void) fprintf(stderr, &quot;tperrodetail() failed!\n&quot;);<br />056   			(void) fprintf(stderr, &quot;Tperrno = %d, %s\n&quot;, tperrno, tpstrerror(tperrno));<br />057   		}<br />058   		else if (ret != 0) {<br />059   			 (void) fprintf( stderr, &quot;errordetail:%s\n&quot;,<br />060   					tpstrerrordetail( ret, 0));<br />061   		}<br />062   		tpfree(sendbuf);<br />063   		tpfree(rcvbuf);<br />064   		tpterm();<br />065   		exit(1);<br />066   	}<br />067   	(void) fprintf(stdout, &quot;Returned string is: %s\n&quot;, rcvbuf);<br />068   }<br />069   <br />070   	/* Free Buffers &amp; Detach from System/T */<br />071   	tpfree(sendbuf);<br />072   	tpfree(rcvbuf);<br />073   	tpterm();<br />074   	return(0);</pre></div><a name="wp1394171"> </a><div class="pPreformatted"><pre>}</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155712"> </a>
Transaction Considerations
</h2><p class="pBody"><a name="wp1155713"> </a>
The following sections describe how various programming features work when used in transaction mode. The first section provides rules of basic communication etiquette that should be observed in code written for transaction mode.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155714"> </a>
Communication Etiquette
</h2><p class="pBody"><a name="wp1155715"> </a>
When writing code to be run in transaction mode, you must observe the following rules of basic communication etiquette:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155716"> </a>Processes that are participants in the same transaction must require replies for all requests. To include a request that requires no reply, set the <code class="cCodeEmphasis">flags</code> parameter of <a href="pgreq.html#wp1055487">tpacall()</a> to <code class="cCode">TPNOTRAN</code> or <code class="cCode">TPNOREPLY</code>.</li>
<li><a name="wp1155717"> </a>A service must retrieve all asynchronous transaction replies before calling <a href="pgserv.html#wp1167965">tpreturn()</a> or <a href="pgserv.html#wp1168061">tpforward()</a>. This rule must be observed regardless of whether the code is running in transaction mode.</li>
<li><a name="wp1155718"> </a>The initiator must retrieve all asynchronous transaction replies (made without the <code class="cCode">TPNOTRAN</code> flag) before calling <a href="pgglob.html#wp1045424">tpcommit()</a>.</li>
<li><a name="wp1276052"> </a>Replies must be retrieved for asynchronous calls that expect replies from non-participants of the transaction, that is, replies to requests made with <a href="pgreq.html#wp1055487">tpacall()</a> in which the transaction, but not the reply, is suppressed.</li>
<li><a name="wp1276053"> </a>If a transaction has not timed out but is marked &#8220;abort-only,&#8221; any further communication should be performed with the <code class="cCode">TPNOTRAN</code> flag set so that the results of the communication are preserved after the transaction is rolled back.</li>
<li><a name="wp1155721"> </a>If a transaction has timed out:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1155722"> </a>The descriptor for the timed-out call becomes stale and any further reference to it returns <code class="cCode">TPEBADDESC</code>.</li>
<li><a name="wp1155723"> </a>Further calls to <a href="pgreq.html#wp1098002">tpgetrply()</a> or <a href="pgconv.html#wp1062702">tprecv()</a> for any outstanding descriptors return a global state of transaction timeout; the system sets <a href="../rf5/rf5.html">tperrno(5)</a> to <code class="cCode">TPETIME</code>.</li>
<li><a name="wp1155724"> </a>Asynchronous calls can be made with the <code class="cCodeEmphasis">flags</code> parameter of <a href="pgreq.html#wp1055487">tpacall()</a> set to <code class="cCode">TPNOREPLY</code>, <code class="cCode">TPNOBLOCK</code>, or <code class="cCode">TPNOTRAN</code>.</li>
</ul></div>
<li><a name="wp1155725"> </a>Once a transaction has been marked &#8220;abort-only&#8221; for reasons other than timeout, a call to <a href="pgreq.html#wp1098002">tpgetrply()</a> returns whatever value represents the local state of the call; that is, it returns either success or an error code that reflects the local condition.</li>
<li><a name="wp1260132"> </a>Once a descriptor is used with <a href="pgreq.html#wp1098002">tpgetrply()</a> to retrieve a reply, or with <a href="pgconv.html#wp1062634">tpsend()</a> or <a href="pgconv.html#wp1062702">tprecv()</a> to report an error condition, it becomes invalid and any further reference to it returns <code class="cCode">TPEBADDESC</code>. This rule is always observed, regardless of whether the code is running in transaction mode.</li>
<li><a name="wp1155727"> </a>Once a transaction is aborted, all outstanding transaction call descriptors (made without the <code class="cCode">TPNOTRAN</code> flag) become stale, and any further references to them return <code class="cCode">TPEBADDESC</code>.</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155729"> </a>
Transaction Errors
</h2><p class="pBody"><a name="wp1155730"> </a>
The following sections describe transaction-related errors. 
</p>
<h3 class="pHeading2"><a name="wp1155731"> </a>
Non-fatal Transaction Errors
</h3>
<p class="pBody"><a name="wp1155732"> </a>
When transaction errors occur, the system returns <code class="cCode">TPETRAN</code> in <a href="../rf5/rf5.html">tperrno(5)</a>. The precise meaning of such an error, however, depends on the function that is returning it. <a href="pgerr.html#wp905559">Table&#160;11-3</a> lists the functions that return transaction errors and describes possible causes of them. 
</p>
<p class="pGraphic"><a name="wp1155756"> </a>
</p>
<div align="left">
<table class="table" cellpadding="3" cellspacing="0" id="wp905559table1155733"><caption><a name="wp905559"> </a>
Table 11-3  Transaction Errors

</caption>

  <tr bgcolor="#CCCCCC" align="center" valign="top">    <th scope="col"><div class="pCellHeading"><a name="wp1155735"> </a>
Function
</div>
</th>
    <th scope="col"><div class="pCellHeading"><a name="wp1155737"> </a>
Cause
</div>
</th>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155739"> </a>
<span class="cHyperlink">
<a href="pgglob.html#wp1045304">tpbegin()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155741"> </a>
Usually caused by a transient system error that occur during an attempt to start the transaction. The problem may clear up with a repeated call.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155743"> </a>
<span class="cHyperlink">
<a href="pgserv.html#wp1168043">tpcancel()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155745"> </a>
The function was called for a transaction reply after a request was made without the <code class="cCode">TPNOTRAN</code> flag.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155747"> </a>
<span class="cHyperlink">
<a href="pgglob.html#wp1132082">tpresume()</a></span>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155749"> </a>
The Oracle Tuxedo system is unable to resume a global transaction because the caller is currently participating in work outside the global transaction with one or more resource managers. All such work must be completed before the global transaction can be resumed. The caller&#8217;s state with respect to the local transaction is unchanged.
</div>
</td>
</tr>
  <tr align="left" valign="top">    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155751"> </a>
<a href="pgconv.html#wp1089600">tpconnect()</a>, <a href="pgevb.html#wp1081416">tppost()</a>, <a href="pgreq.html#wp1055338">tpcall()</a>, and <a href="pgreq.html#wp1055487">tpacall()</a>
</div>
</td>
    <td class="table" scope="row"><div class="pCellBody"><a name="wp1155753"> </a>
A call was made in transaction mode to a service that does not support transactions. Some services belong to server groups that access a database management system (DBMS) that, in turn, support transactions. Other services, however, do not belong to such groups. In addition, some services that support transactions may require interoperation with software that does not. For example, a service that prints a form may work with a printer that does not support transactions. Services that do not support transactions may not function as participants in a transaction. 
</div>
<div class="pCellBody"><a name="wp1155754"> </a>
The grouping of services into servers and server groups is an administrative task. In order to determine which services support transactions, check with your application administrator. 
</div>
<div class="pCellBody"><a name="wp1155755"> </a>
You can correct transaction-level errors at the application level by enabling the <code class="cCode">TPNOTRAN</code> flag or by accessing the service for which an error was returned outside of the transaction. 
</div>
</td>
</tr>
</table>
</div>
<p class="pGraphic">

</p>
<h3 class="pHeading2"><a name="wp1155758"> </a>
Fatal Transaction Errors
</h3>
<p class="pBody"><a name="wp1155759"> </a>
When a fatal transaction error occurs, the application should explicitly abort the transaction by having the initiator call <a href="pgglob.html#wp1045451">tpabort()</a>. Therefore, it is important to understand the errors that are fatal to transactions. Three conditions cause a transaction to fail:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155760"> </a>The initiator or a participant in the transaction causes it to be marked &#8220;abort-only&#8221; for one of the following reasons:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1155761"> </a> <a href="pgserv.html#wp1167965">tpreturn()</a> encounters an error while processing its arguments; <a href="../rf5/rf5.html">tperrno(5)</a> is set to <code class="cCode">TPESVCERR</code>.</li>
<li><a name="wp1155762"> </a>The <code class="cCodeEmphasis">rval</code> argument to <a href="pgserv.html#wp1167965">tpreturn()</a> was set to <code class="cCode">TPFAIL</code>; <a href="../rf5/rf5.html">tperrno(5)</a> is set to <code class="cCode">TPESVCFAIL</code>.</li>
<li><a name="wp1155763"> </a>The <code class="cCodeEmphasis">type</code> or <code class="cCodeEmphasis">subtype</code> of the reply buffer is not known or not allowed by the caller and, as a result, success or failure cannot be determined; <a href="../rf5/rf5.html">tperrno(5)</a> is set to <code class="cCode">TPEOTYPE</code>.</li>
</ul></div>
<li><a name="wp1155764"> </a>The transaction times out; <a href="../rf5/rf5.html">tperrno(5)</a> is set to <code class="cCode">TPETIME</code>.</li>
<li><a name="wp1155765"> </a><a href="pgglob.html#wp1045424">tpcommit()</a> is called by a participant rather than by the originator of a transaction; <a href="../rf5/rf5.html">tperrno(5)</a> is set to <code class="cCode">TPEPROTO</code>.</li>
</ul></div>
<p class="pBody"><a name="wp1155766"> </a>
The only protocol error that is fatal to transactions is calling <a href="pgglob.html#wp1045424">tpcommit()</a> from the wrong participant in a transaction. This error can be corrected in the application during the development phase.
</p>
<p class="pBody"><a name="wp1155767"> </a>
If <a href="pgglob.html#wp1045424">tpcommit()</a> is called after an initiator/participant failure or transaction timeout, the result is an implicit abort error. Then, because the commit failed, the transaction should be aborted.
</p>
<p class="pBody"><a name="wp1155768"> </a>
If the system returns <code class="cCode">TPESVCERR</code>, <code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPEOTYPE</code>, or <code class="cCode">TPETIME</code> for any communication call, the transaction should be aborted explicitly with a call to <a href="pgglob.html#wp1045451">tpabort()</a>. You need not wait for outstanding call descriptors before explicitly aborting the transaction. However, because these descriptors are considered stale after the call is aborted, any attempt to access them after the transaction is terminated returns <code class="cCode">TPEBADDESC</code>.
</p>
<p class="pBody"><a name="wp1155769"> </a>
In the case of <code class="cCode">TPESVCERR</code>, <code class="cCode">TPESVCFAIL</code>, and <code class="cCode">TPEOTYPE</code>, communication calls continue to be allowed as long as the transaction has not timed out. When these errors are returned, the transaction is marked abort-only. To preserve the results of any further work, you should call any communication functions with the <code class="cCodeEmphasis">flags</code> parameter set to <code class="cCode">TPNOTRAN</code>. By setting this flag, you ensure that the work performed for the transaction marked &#8220;abort-only&#8221; will not be rolled back when the transaction is aborted.
</p>
<p class="pBody"><a name="wp1155770"> </a>
When a transaction timeout occurs, communication can continue, but communication requests cannot:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155771"> </a>Require replies</li>
<li><a name="wp1155772"> </a>Block</li>
<li><a name="wp1155773"> </a>Be performed on behalf of the caller&#8217;s transaction</li>
</ul></div>
<p class="pBody"><a name="wp1155774"> </a>
Therefore, to make asynchronous calls, you must set the <code class="cCodeEmphasis">flags</code> parameter to <code class="cCode">TPNOREPLY</code>, <code class="cCode">TPNOBLOCK</code>, or <code class="cCode">TPNOTRAN</code>.
</p>
<h3 class="pHeading2"><a name="wp1155775"> </a>
Heuristic Decision Errors
</h3>
<p class="pBody"><a name="wp1155776"> </a>
The <a href="pgglob.html#wp1045424">tpcommit()</a> function may return <code class="cCode">TPEHAZARD</code> or <code class="cCode">TPEHEURISTIC</code>, depending on how <code class="cCode">TP_COMMIT_CONTROL</code> is set. 
</p>
<p class="pBody"><a name="wp1155777"> </a>
If you set <code class="cCode">TP_COMMIT_CONTROL</code> to <code class="cCode">TP_CMT_LOGGED</code>, the application obtains control before the second phase of a two-phase commit is performed. In this case, the application may not be aware of a heuristic decision that occurs during the second phase. 
</p>
<p class="pBody"><a name="wp1155778"> </a>
<code class="cCode">TPEHAZARD</code> or <code class="cCode">TPEHEURISTIC</code> can be returned in a one-phase commit, however, if a single resource manager is involved in the transaction and it returns a heuristic decision or a hazard indication during a one-phase commit.
</p>
<p class="pBody"><a name="wp1155779"> </a>
If you set <code class="cCode">TP_COMMIT_CONTROL</code> to <code class="cCode">TP_CMT_COMPLETE</code>, then the system returns <code class="cCode">TPEHEURISTIC</code> if any resource manager reports a heuristic decision, and <code class="cCode">TPEHAZARD</code> if any resource manager reports a hazard. <code class="cCode">TPEHAZARD</code> specifies that a participant failed during the second phase of commit (or during a one-phase commit) and that it is not known whether a transaction completed successfully.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155780"> </a>
Transaction Timeouts
</h2><p class="pBody"><a name="wp1155784"> </a>
As described in <a href="pgerr.html#wp1155729">Transaction Errors</a>, two types of timeouts can occur in an Oracle Tuxedo application: blocking and transaction. The following sections describe how various programming features are affected by transaction timeouts. Refer to <a href="pgerr.html#wp1155729">Transaction Errors</a> for more information on timeouts.
</p>
<h3 class="pHeading2"><a name="wp1394977"> </a>
Effect on the tpcommit() Function
</h3>
<p class="pBody"><a name="wp1155790"> </a>
What is the state of a transaction if a timeout occurs after a call to <a href="pgglob.html#wp1045424">tpcommit()</a>? If the transaction timed out and the system knows that it was aborted, the system reports these events by setting <a href="../rf5/rf5.html">tperrno(5)</a> to <code class="cCode">TPEABORT</code>. If the status of the transaction is unknown, the system sets the error code to <code class="cCode">TPETIME</code>. 
</p>
<p class="pBody"><a name="wp1155791"> </a>
When the state of a transaction is in doubt, you must query the resource manager. First, verify whether or not any of the changes that were part of the transaction were applied. Then you can determine whether the transaction was committed or aborted.
</p>
<h3 class="pHeading2"><a name="wp1155792"> </a>
Effect on the TPNOTRAN Flag
</h3>
<p class="pBody"><a name="wp1155793"> </a>
When a process is in transaction mode and makes a communication call with <code class="cCodeEmphasis">flags</code> set to <code class="cCode">TPNOTRAN</code>, it prohibits the called service from becoming a participant in the current transaction. Whether the service request succeeds or fails has no impact on the outcome of the transaction. The transaction can still timeout while waiting for a reply that is due from a service, whether it is part of the transaction or not.
</p>
<p class="pBody"><a name="wp1155796"> </a>
For additional information on using the <code class="cCode">TPNOTRAN</code> flag, refer to <a href="pgerr.html#wp1395085">tpreturn( ) and tpforward( ) Functions</a>.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1395085"> </a>
tpreturn( ) and tpforward( ) Functions
</h2><p class="pBody"><a name="wp1155806"> </a>
If you call a process while running in transaction mode, tpreturn() and <a href="pgserv.html#wp1168061">tpforward()</a> place the service portion of the transaction in a state that allows it to be either committed or aborted when the transaction completes. You can call a service several times on behalf of the same transaction. The system does not fully commit or abort the transaction until the initiator of the transaction calls <a href="pgglob.html#wp1045424">tpcommit()</a> or <a href="pgglob.html#wp1045451">tpabort()</a>.
</p>
<p class="pBody"><a name="wp1155807"> </a>
Neither <a href="pgserv.html#wp1167965">tpreturn()</a> nor <a href="pgserv.html#wp1168061">tpforward()</a> should be called until all outstanding descriptors for the communication calls made within the service have been retrieved. If you call <code class="cCode">tpreturn()</code> with outstanding descriptors for which <code class="cCodeEmphasis">rval</code> is set to <code class="cCode">TPSUCCESS</code>, the system encounters a protocol error and returns <code class="cCode">TPESVCERR</code> to the process waiting on <a href="pgreq.html#wp1098002">tpgetrply()</a>. If the process is in transaction mode, the system marks the caller as &#8220;abort-only.&#8221; Even if the initiator of the transaction calls <a href="pgglob.html#wp1045424">tpcommit()</a>, the system implicitly aborts the transaction. If you call <code class="cCode">tpreturn()</code> with outstanding descriptors for which <code class="cCodeEmphasis">rval</code> is set to <code class="cCode">TPFAIL</code>, the system returns <code class="cCode">TPESVCFAIL</code> to the process waiting on <code class="cCode">tpgetrply()</code>. The effect on the transaction is the same.
</p>
<p class="pBody"><a name="wp1155808"> </a>
When you call <a href="pgserv.html#wp1167965">tpreturn()</a> while running in transaction mode, this function can affect the result of the transaction by the processing errors that it encounters or that are retrieved from the value placed in <code class="cCodeEmphasis">rval</code> by the application. 
</p>
<p class="pBody"><a name="wp1155809"> </a>
You can use <a href="pgserv.html#wp1168061">tpforward()</a> to indicate that success has been achieved up to a particular point in the processing of a request. If no application errors have been detected, the system invokes <code class="cCode">tpforward()</code>; otherwise, the system invokes <a href="pgserv.html#wp1167965">tpreturn()</a> with <code class="cCode">TPFAIL</code>. If you call <code class="cCode">tpforward()</code> improperly, the system considers the call a processing error and returns a failed message to the requester.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155810"> </a>
tpterm( ) Function
</h2><p class="pBody"><a name="wp1155811"> </a>
Use the <a href="pgclt.html#wp1030538">tpterm()</a> function to remove a client context from an application. 
</p>
<p class="pBody"><a name="wp1155812"> </a>
If the client context is in transaction mode, the call fails with <code class="cCode">TPEPROTO</code> returned in <a href="../rf5/rf5.html">tperrno(5)</a>, and the client context remains part of the application and in transaction mode. 
</p>
<p class="pBody"><a name="wp1155813"> </a>
When the call is successful, the client context is allowed no further communication or participation in transactions because the current thread of execution is no longer part of the application.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155814"> </a>
Resource Managers
</h2><p class="pBody"><a name="wp1155815"> </a>
When you use an ATMI function to define transactions, the Oracle Tuxedo system executes an internal call to pass any global transaction information to each resource manager participating in the transaction. When you call <a href="pgglob.html#wp1045424">tpcommit()</a> or <a href="pgglob.html#wp1045451">tpabort()</a>, for example, the system makes internal calls to direct each resource manager to commit or abort the work it did on behalf of the caller&#8217;s global transaction. 
</p>
<p class="pBody"><a name="wp1155816"> </a>
When a global transaction has been initiated, either explicitly or implicitly, you should not make explicit calls to the resource manager&#8217;s transaction functions in your application code. Failure to follow this transaction rule causes indeterminate results. You can use the <a href="pgglob.html#wp1045502">tpgetlev()</a> function to determine whether a process is already in a global transaction before calling the resource manager&#8217;s transaction function.
</p>
<p class="pBody"><a name="wp1155817"> </a>
Some resource managers allow programmers to configure certain parameters (such as the transaction consistency level) by specifying options available in the interface to the resource managers themselves. Such options are made available in two forms:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155818"> </a>Resource manager-specific function calls that can be used by programmers of distributed applications to configure options.</li>
<li><a name="wp1155819"> </a>Hard-coded options incorporated in the transaction interface supplied by the provider of the resource manager.</li>
</ul></div>
<p class="pBody"><a name="wp1155820"> </a>
Consult the documentation for your resource managers for additional information.
</p>
<p class="pBody"><a name="wp1155821"> </a>
The method of setting options varies for each resource manager. In the Oracle Tuxedo System SQL resource manager, for example, the <code class="cCode">set transaction</code> statement is used to negotiate specific options (consistency level and access mode) for a transaction that has already been started by the Oracle Tuxedo system.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155822"> </a>
Sample Transaction Scenarios
</h2><p class="pBody"><a name="wp1155823"> </a>
The following sections provide some considerations for the following transaction scenarios:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155827"> </a><a href="pgerr.html#wp1155837">Called Service in Same Transaction as Caller</a></li>
<li><a name="wp1155831"> </a><a href="pgerr.html#wp1155844">Called Service in Different Transaction with AUTOTRAN Set</a></li>
<li><a name="wp1155835"> </a><a href="pgerr.html#wp1155862">Called Service That Starts a New Explicit Transaction</a></li>
</ul></div>
<h3 class="pHeading2"><a name="wp1155837"> </a>
Called Service in Same Transaction as Caller
</h3>
<p class="pBody"><a name="wp1155838"> </a>
When a caller in transaction mode calls another service to participate in the current transaction, the following facts apply:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155839"> </a> <a href="pgserv.html#wp1167965">tpreturn()</a> and <a href="pgserv.html#wp1168061">tpforward()</a>, when called by the participating service, place that service&#8217;s portion of the transaction in a state from which it can be either aborted or committed by the initiator.</li>
<li><a name="wp1155840"> </a>The success or failure of the called process affects the current transaction. If any fatal transaction errors are encountered by the participant, the current transaction is marked &#8220;abort-only.&#8221;</li>
<li><a name="wp1155841"> </a>Whether or not the tasks performed by a successful participant are applied depends on the fate of the transaction. In other words, if the transaction is aborted, the work of all participants is reversed.</li>
<li><a name="wp1155842"> </a>The <code class="cCode">TPNOREPLY</code> flag cannot be used when calling another service to participate in the current transaction.</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1155844"> </a>
Called Service in Different Transaction with AUTOTRAN Set
</h3>
<p class="pBody"><a name="wp1155845"> </a>
If you issue a communication call with the <code class="cCode">TPNOTRAN</code> flag set and the called service is configured such that a transaction automatically starts when the service is called, the system places both the calling and called processes in transaction mode, but the two constitute different transactions. In this situation, the following facts apply:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155846"> </a> <a href="pgserv.html#wp1167965">tpreturn()</a> plays the initiator&#8217;s transaction role: it terminates the transaction in the service in which the transaction was automatically started. Alternatively, if the transaction is automatically started in a service that terminates with <a href="pgserv.html#wp1168061">tpforward()</a>, the <code class="cCode">tpreturn()</code> call issued in the last service in the forward chain plays the initiator&#8217;s transaction role: it terminates the transaction. (For an example, refer to the figure called <a href="pgerr.html#wp1395805">Transaction Roles of tpforward( ) and tpreturn() with AUTOTRAN</a>.)</li>
<li><a name="wp1155850"> </a>Because it is in transaction mode, <a href="pgserv.html#wp1167965">tpreturn()</a> is vulnerable to the failure of any participant in the transaction, as well as to transaction timeouts. In this scenario, the system is more likely to return a failed message.</li>
<li><a name="wp1155851"> </a>The state of the caller&#8217;s transaction is not affected by any failed messages or application failures returned to the caller.</li>
<li><a name="wp1155852"> </a>The caller&#8217;s own transaction may timeout as the caller waits for a reply.</li>
<li><a name="wp1155853"> </a>If no reply is expected, the caller&#8217;s transaction cannot be affected in any way by the communication call.</li>
<div class="pFigureTitle"><a name="wp1395805"> </a>
Figure&#160;11-1  Transaction Roles of tpforward( ) and tpreturn() with AUTOTRAN
</div>

 
 <p class="pGraphic"><a name="wp1155859"> </a>
<br />
<img src="wwimages/transaction%7e1.gif" alt="Transaction Roles of tpforward( ) and tpreturn() with AUTOTRAN" id="wp1155857"/><br />

</p>
</ul></div>
<h3 class="pHeading2"><a name="wp1155862"> </a>
Called Service That Starts a New Explicit Transaction
</h3>
<p class="pBody"><a name="wp1259842"> </a>
If a communication call is made with <code class="cCode">TPNOTRAN</code>, and the called service is not automatically placed in transaction mode by a configuration option, the service can define multiple transactions using explicit calls to <a href="pgglob.html#wp1045304">tpbegin()</a>, <a href="pgglob.html#wp1045424">tpcommit()</a>, and <a href="pgglob.html#wp1045451">tpabort()</a>. As a result, the transaction can be completed before a call is issued to <a href="pgserv.html#wp1167965">tpreturn()</a>.
</p>
<p class="pBody"><a name="wp1155864"> </a>
In this situation, the following facts apply:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155865"> </a><a href="pgserv.html#wp1167965">tpreturn()</a> plays no transaction role; that is, the role of <code class="cCode">tpreturn()</code> is always the same, regardless of whether transactions are explicitly defined in the service routine.</li>
<li><a name="wp1155866"> </a> <a href="pgserv.html#wp1167965">tpreturn()</a> can return any value in <code class="cCodeEmphasis">rval</code>, regardless of the outcome of the transaction.</li>
<li><a name="wp1155867"> </a>Typically, the system returns processing errors, buffer type errors, or application failure, and follows the normal rules for <code class="cCode">TPESVCFAIL</code>, <code class="cCode">TPEITYPE</code>/<code class="cCode">TPEOTYPE</code>, and <code class="cCode">TPESVCERR</code>.</li>
<li><a name="wp1155868"> </a>The state of the caller&#8217;s transaction is not affected by any failed messages or application failures returned to the caller.</li>
<li><a name="wp1155869"> </a>The caller is vulnerable to the possibility that its own transaction may time out as it waits for its reply.</li>
<li><a name="wp1155870"> </a>If no reply is expected, the caller&#8217;s transaction cannot be affected in any way by the communication call.</li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155871"> </a>
Oracle TUXEDO System-supplied Subroutines
</h2><p class="pBody"><a name="wp1160979"> </a>
The Oracle Tuxedo system-supplied subroutines, <a href="pgserv.html#wp1386336">tpsvrinit()</a>, <a href="pgserv.html#wp1387047">tpsvrdone()</a> tpsvrthrinit<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>, and tpsvrthrdone<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>, must follow certain rules when used in transactions.
</p>
<a name="wp1396056"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>tpsvrthrinit<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> and tpsvrthrdone<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> can be specified for multithreaded applications only. <a href="pgserv.html#wp1386336">tpsvrinit()</a> and <a href="pgserv.html#wp1387047">tpsvrdone()</a> can be specified for both threaded and non-threaded applications.</td>
</tr>
</table>

<p class="pBody"><a name="wp1155873"> </a>
The Oracle Tuxedo system server calls <a href="pgserv.html#wp1386336">tpsvrinit()</a> or tpsvrthrinit<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> during initialization. Specifically, <code class="cCode">tpsvrinit()</code> or tpsvrthrinit<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> is called after the calling process becomes a server but before it starts handling service requests. If <code class="cCode">tpsvrinit()</code> or tpsvrthrinit<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> performs any asynchronous communication, all replies must be retrieved before the function returns; otherwise, the system ignores all pending replies and the server exits. If <code class="cCode">tpsvrinit()</code> or tpsvrthrinit<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> defines any transactions, they must be completed with all asynchronous replies retrieved before the function returns; otherwise, the system aborts the transaction and ignores all outstanding replies. In this case, the server exits gracefully.
</p>
<p class="pBody"><a name="wp1155874"> </a>
The Oracle Tuxedo system server abstraction calls <a href="pgserv.html#wp1387047">tpsvrdone()</a> or tpsvrthrdone<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> after it finishes processing service requests but before it exits. At this point, the server&#8217;s services are no longer advertised, but the server has not yet left the application. If <code class="cCode">tpsvrdone()</code> or tpsvrthrdone<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> initiates communication, it must retrieve all outstanding replies before it returns; otherwise, pending replies are ignored by the system and the server exits. If a transaction is started within <code class="cCode">tpsvrdone()</code> or tpsvrthrdone<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>, it must be completed with all replies retrieved; otherwise, the system aborts the transaction and ignores the replies. In this case, too, the server exits.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1155876"> </a>
Central Event Log
</h2><p class="pBody"><a name="wp1155877"> </a>
The central event log is a record of significant events in your Oracle Tuxedo application. Messages about these events are sent to the log by your application clients and services via the userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> function. 
</p>
<p class="pBody"><a name="wp1155878"> </a>
Any analysis of the central event log must be provided by the application. You should establish strict guidelines for the events that are to be recorded in the userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>. Application debugging can be simplified by eliminating trivial messages.
</p>
<p class="pBody"><a name="wp1358049"> </a>
For information on configuring the central event log on the Windows 2003 platform, refer to <em class="cEmphasis">Using Oralce Tuxedo ATMI on Windows</em>.
</p>
<h3 class="pHeading2"><a name="wp1358053"> </a>
Log Name
</h3>
<p class="pBody"><a name="wp1155880"> </a>
The application administrator defines (in the configuration file) the absolute pathname that is used as the prefix of the name of the userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> error message file on each machine. The userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> function creates a date&#8212;in the form <code class="cCodeEmphasis">mmddyy</code>, representing the month, day, and year&#8212;and adds this date to the pathname prefix, forming the full filename of the central event log. A new file is created daily. Thus, if a process sends messages to the central event log on succeeding days, the messages are written into different files.
</p>
<h3 class="pHeading2"><a name="wp1155881"> </a>
Log Entry Format
</h3>
<p class="pBody"><a name="wp1155882"> </a>
Entries in the log consist of the following components:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155883"> </a>Tag consisting of:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1155884"> </a>Time of day (<code class="cCodeEmphasis">hhmmss</code>)</li>
<li><a name="wp1155885"> </a>Machine name (for example, the name returned by the <code class="cCode">uname</code>(1) command on a UNIX system)</li>
<li><a name="wp1155886"> </a>Name, process ID, and thread ID (which is 0 on platforms that do not support threads) of the thread calling userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span></li>
<li><a name="wp1155887"> </a>Context ID of the thread calling userlog(<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>3c)</span></li>
</ul></div>
<li><a name="wp1155888"> </a>Message text</li>
<p class="pBodyRelative"><a name="wp1155889"> </a>
The text of each message is preceded by the catalog name and number of that message.
</p>
<li><a name="wp1396373"> </a>Optional arguments in <code class="cCode">printf</code>(3S) format</li>
</ul></div>
<p class="pBody"><a name="wp1155891"> </a>
For example, suppose that a security program executes the following call at <code class="cCode">4:22:14pm</code> on a UNIX machine called <code class="cCode">mach1</code> (as returned by the <code class="cCode">uname</code> command): 
</p>
<a name="wp1396378"> </a><div class="pPreformattedRelative"><pre>userlog(&quot;Unknown User &#8217;%s&#8217; \n&quot;, usrnm);</pre></div><p class="pBody"><a name="wp1155894"> </a>
The resulting log entry appears as follows: 
</p>
<a name="wp1155895"> </a><div class="pPreformattedRelative"><pre>162214.mach1!security.23451: Unknown User &#8217;abc&#8217;</pre></div><p class="pBody"><a name="wp1155896"> </a>
In this example, the process ID for security is <code class="cCode">23451</code>, and the variable <code class="cCode">usrnm</code> contains the value <code class="cCode">abc</code>.
</p>
<p class="pBody"><a name="wp1155897"> </a>
If the preceding message was generated by the Oracle Tuxedo system (rather than by the application), it might appear as follows: 
</p>
<a name="wp1155898"> </a><div class="pPreformattedRelative"><pre>162214.mach1!security.23451: LIBSEC_CAT: 999: Unknown User &#8217;abc&#8217;</pre></div><p class="pBody"><a name="wp1155899"> </a>
In this case, the message catalog name is <code class="cCode">LIBSEC_CAT </code>and the message number is <code class="cCode">999</code>.
</p>
<p class="pBody"><a name="wp1155900"> </a>
If the message is sent to the central event log while the process is in transaction mode, other components are added to the tag in the user log entry. These components consist of the literal string <code class="cCode">gtrid</code> followed by three long hexadecimal integers. The integers uniquely identify the global transaction and make up what is referred to as the global transaction identifier, that is, the <code class="cCode">gtrid</code>. This identifier is used mainly for administrative purposes, but it also appears in the tag that prefixes the messages in the central event log. If the system writes the message to the central event log in transaction mode, the resulting log entry appears as follows: 
</p>
<a name="wp1155901"> </a><div class="pPreformattedRelative"><pre>162214.mach1!security.23451: gtrid x2 x24e1b803 x239:<br />   Unknown User &#8217;abc&#8217;</pre></div><h3 class="pHeading2"><a name="wp1155902"> </a>
Writing to the Event Log
</h3>
<p class="pBody"><a name="wp1155903"> </a>
To write a message to the event log, you must perform the following steps:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1155904"> </a>Assign the error message you wish to write to the log to a variable of type <code class="cCode">char *</code> and use the variable name as the argument to the call.</li>
<li><a name="wp1155905"> </a>Specify the literal text of the message within double quotes, as the argument to the userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> call, as shown in the following example:</li>
<a name="wp1396551"> </a><div class="pPreformatted"><pre>.<br />.<br />.<br />/* Open the database to be accessed by the transactions.*/<br />if(tpopen() == -1) {<br />      userlog(&quot;tpsvrinit: Cannot open database %s, tpstrerror(tperrno)&quot;);<br />      return(-1);<br />}<br />.<br />.<br />.</pre></div></ul></div>
<p class="pBody"><a name="wp1155908"> </a>
In this example, the message is sent to the central event log if tpopen<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> returns <code class="cCode">-1</code>.
</p>
<p class="pBody"><a name="wp1396596"> </a>
The userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span> signature is similar to that of the UNIX System <code class="cCode">printf</code>(3S) function. The format portion of both functions can contain literal strings and/or conversion specifications for a variable number of arguments.
</p>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1396598"> </a>
Debugging Application Processes
</h2><p class="pBody"><a name="wp1396607"> </a>
Although you can use userlog<span class="cHyperlink">
<a href="../rf3c/rf3c.html"></a>(3c)</span>statements to debug application software, it is sometimes necessary to use a debugger command for more complex problem solving.
</p>
<p class="pBody"><a name="wp1396608"> </a>
The following sections describe how to debug an application on UNIX and Windows 2003 platforms.
</p>
<h3 class="pHeading2"><a name="wp1396609"> </a>
Debugging Application Processes on UNIX Platforms
</h3>
<p class="pBody"><a name="wp1396610"> </a>
The standard UNIX system debugging command is <code class="cCode">dbx</code>(1). For complete information about this tool, refer to <code class="cCode">dbx</code>(1) in a UNIX system reference manual. If you use the <code class="cCode">-g</code> option to compile client processes, you can debug those processes using the procedures described on the <code class="cCode">dbx</code>(1) reference page. 
</p>
<p class="pBody"><a name="wp1396611"> </a>
To run the <code class="cCode">dbx</code> command, enter the following:
</p>
<a name="wp1396612"> </a><div class="pPreformattedRelative"><pre>dbx <code class="cCodeEmphasis">client</code></pre></div><p class="pBody"><a name="wp1396613"> </a>
To execute a client process: 
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1396614"> </a>Set any desired breakpoints in the code.</li>
<li><a name="wp1396615"> </a>Enter the <code class="cCode">dbx</code> command.</li>
<li><a name="wp1396616"> </a>At the <code class="cCode">dbx</code> prompt (<code class="cCode">*</code>), type the <code class="cCode">run</code> subcommand (<code class="cCode">r</code>) and any options you want to pass to the client program&#8217;s <code class="cCode">main()</code>.</li>
</ol></div>
<p class="pBody"><a name="wp1396617"> </a>
The task of debugging server programs is more complicated. Normally a server is started using the <code class="cCode">tmboot</code> command, which starts the server on the correct machine with the correct options. When using <code class="cCode">dbx</code>, it is necessary to run a server directly rather than through the <code class="cCode">tmboot</code> command. To run a server directly, enter the <code class="cCode">r</code> (short for <code class="cCode">run</code>) subcommand after the prompt displayed by the <code class="cCode">dbx</code> command.
</p>
<p class="pBody"><a name="wp1396621"> </a>
The Oracle Tuxedo <a href="../rfcm/rfcmd.html">tmboot(1)</a> command passes undocumented command-line options to the server&#8217;s predefined <code class="cCode">main()</code>. To run a server directly, you must pass these options, manually, to the <code class="cCode">r</code> subcommand. To find out which options need to be specified, run <code class="cCode">tmboot</code> with the <code class="cCode">-n</code> and <code class="cCode">-d 1</code> options. The <code class="cCode">-n</code> option instructs <code class="cCode">tmboot</code> not to execute a boot; <code class="cCode">-d 1</code> instructs it to display level 1 debugging statements. By default, the <code class="cCode">-d 1</code> option returns information about all processes. If you want information about only one process, you can specify your request accordingly with additional options. For more information, refer to the <em class="cEmphasis">Oracle Tuxedo Command Reference</em>. 
</p>
<p class="pBody"><a name="wp1396625"> </a>
The output of <code class="cCode">tmboot -n -d 1</code> includes a list of the command-line options passed by <code class="cCode">tmboot</code> to the server&#8217;s <code class="cCode">main()</code>, as shown in the following example: 
</p>
<a name="wp1396626"> </a><div class="pPreformattedRelative"><pre>exec server -g 1 -i 1 -u sfmax -U /tuxdir/appdir/ULOG -m 0 -A</pre></div><p class="pBody"><a name="wp1396627"> </a>
Once you have the list of required command-line options, you are ready to run the server program directly, with the <code class="cCode">r</code> subcommand of <code class="cCode">dbx</code>(1). The following command line is an example:
</p>
<a name="wp1396628"> </a><div class="pPreformattedRelative"><pre>*r -g 1 -i 1 -u sfmax -U /tuxdir/appdir/ULOG -m 0 -A </pre></div><p class="pBody"><a name="wp1396629"> </a>
You may not use <code class="cCode">dbx</code>(1) to run a server that is already running as part of the configuration. If you try to do so, the server exits gracefully, indicating a duplicate server in the central event log.
</p>
<h3 class="pHeading2"><a name="wp1396630"> </a>
Debugging Application Processes on Windows 2003 Platforms
</h3>
<p class="pBody"><a name="wp1396631"> </a>
On a Windows 2003 platform, a graphical debugger is provided as part of the Microsoft Visual C++ environment. For complete information about this tool, refer to the Microsoft Visual C++ reference manual.
</p>
<p class="pBody"><a name="wp1396632"> </a>
To invoke the Microsoft Visual C++ debugger, enter the <code class="cCode">start</code> command as follows:
</p>
<a name="wp1396633"> </a><div class="pPreformatted"><pre>start msdev -p <code class="cCodeEmphasis">process_ID</code></pre></div><a name="wp1396634"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>For versions of the Microsoft Visual C++ debugger that are earlier than 5.0, enter the <code class="cCode">start</code> command as follows:</td>
</tr>
</table>

<a name="wp1396635"> </a><table class="Note">
<tr>
<td valign="top"><b class="texthide">Note:</b></td>
<td><code class="cCode">start msdev -p </code><code class="cCodeEmphasis">process_id</code></td>
</tr>
</table>
<p class="pBody"><a name="wp1396636"> </a>
To invoke the debugger and automatically enter a process, specify the process name and arguments on the <code class="cCode">start</code> command line, as follows:
</p>
<a name="wp1396637"> </a><div class="pPreformatted"><pre>start msdev <code class="cCodeEmphasis">filename argument</code></pre></div><p class="pBody"><a name="wp1396638"> </a>
For example, to invoke the debugger and enter the <code class="cCode">simpcl.exe</code> process with the <code class="cCode">ConvertThisString</code> argument, enter the following command:
</p>
<a name="wp1396639"> </a><div class="pPreformatted"><pre><code class="cCode">start msdev simpcl.exe ConvertThisString</code></pre></div><p class="pBody"><a name="wp1396640"> </a>
When a user-mode exception occurs, you are prompted to invoke the default system debugger to examine the location of the program failure and the state of the registers, stacks, and so on. By default, <code class="cCode">Dr. Watson</code> is used in the Windows 2003 environment uses as the default debugger for user-mode exception failures, while the kernel debugger is used in the Win32 SDK environment. 
</p>
<p class="pBody"><a name="wp1396641"> </a>
To modify the default debugger used by the Windows 2003 system for user-mode exception failures, perform the following steps:
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1396642"> </a>Run <code class="cCode">regedit</code> or <code class="cCode">regedt32</code>.</li>
<li><a name="wp1396643"> </a>Within the <code class="cCode">HKEY_LOCAL_MACHINE</code> subtree, navigate to <code class="cCode">\SOFTWARE\Microsoft\Windows\CurrentVersion\AeDebug</code></li>
<li><a name="wp1396644"> </a>Double-click on the <code class="cCode">Debugger</code> key to advance into the registry string editor.</li>
<li><a name="wp1396645"> </a>Modify the existing string to specify the debugger of your choice. </li>
<p class="pBodyRelative"><a name="wp1396646"> </a>
For example, to request the debugger supplied with the Microsoft Visual C++ environment, enter the following command:
</p>
<a name="wp1396647"> </a><div class="pPreformattedRelative"><pre>msdev.exe -p %ld -e %ld</pre></div></ol></div>
<a name="wp1396648"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>For versions of the Microsoft Visual C++ debugger that are earlier than 5.0, enter the following command:</td>
</tr>
</table>

<a name="wp1396649"> </a><table class="Note">
<tr>
<td valign="top"><b class="texthide">Note:</b></td>
<td>msvc.exe -p %ld -e %ld</td>
</tr>
</table>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1396651"> </a>
Comprehensive Example
</h2><p class="pBody"><a name="wp1396652"> </a>
Transaction integrity, message communication, and resource access are the major requirements of an Online-Transaction-Processing (OLTP) application.
</p>
<p class="pBody"><a name="wp1396653"> </a>
This section provides a code sample that illustrates the ATMI transaction, buffer management, and communication routines operating together with SQL statements that access a resource manager. The example is borrowed from the <code class="cCode">ACCT</code> server that is part of the Oracle Tuxedo banking application (<code class="cCode">bankapp</code>) and illustrates the <code class="cCode">CLOSE_ACCT</code> service.
</p>
<p class="pBody"><a name="wp1396654"> </a>
The example shows how the <code class="cCode">set transaction</code> statement (line 49) is used to set the consistency level and access mode of the transaction before the first SQL statement that accesses the database. (When read/write access is specified, the consistency level defaults to high consistency.) The SQL query determines the amount to be withdrawn in order to close the account based on the value of the <code class="cCode">ACCOUNT_ID</code> (lines 50-58).
</p>
<p class="pBody"><a name="wp1396656"> </a>
<a href="pgbuf.html#wp1262143">tpalloc()</a> allocates a buffer for the request message to the <code class="cCode">WITHDRAWAL</code> service, and the <code class="cCode">ACCOUNT_ID</code> and the amount to be withdrawn are placed in the buffer (lines 62-74). Next, a request is sent to the <code class="cCode">WITHDRAWAL</code> service via a <a href="pgreq.html#wp1055338">tpcall()</a> call (line 79). An SQL <code class="cCode">delete</code> statement then updates the database by removing the account in question (line 86).
</p>
<p class="pBody"><a name="wp1396658"> </a>
If all is successful, the buffer allocated in the service is freed (line 98) and the <code class="cCode">TPSVCINFO</code> data buffer that was sent to the service is updated to indicate the successful completion of the transaction (line 99). Then, if the service was the initiator, the transaction is automatically committed. <a href="pgserv.html#wp1167965">tpreturn()</a> returns <code class="cCode">TPSUCCESS</code>, along with the updated buffer, to the client process that requested the closing of the account. Finally, the successful completion of the requested service is reported on the status line of the form.
</p>
<p class="pBody"><a name="wp1396660"> </a>
After each function call, success or failure is determined. If a failure occurs, the buffer allocated in the service is freed, any transaction begun in the service is aborted, and the <code class="cCode">TPSVCINFO</code> buffer is updated to show the cause of failure (lines 80-83). Finally, <a href="pgserv.html#wp1167965">tpreturn()</a> returns <code class="cCode">TPFAIL</code> and the message in the updated buffer is reported on the status line of the form.
</p>
<a name="wp1396662"> </a><table class="Note">
<tr>
<td valign="top"><strong>Note:</strong></td>
<td>When specifying the consistency level of a global transaction in a service routine, take care to define the level in the same way for all service routines that may participate in the same transaction.</td>
</tr>
</table>

<div class="pCodeTitle"><a name="wp1396663"> </a>
Listing&#160;11-3	   ACCT Server
</div> <a name="wp1396664"> </a><div class="pPreformatted"><pre>001   #include &lt;stdio.h&gt;              /* UNIX */<br />002   #include &lt;string.h&gt;             /* UNIX */<br />003   #include &lt;fml.h&gt;                /* BEA Tuxedo System */<br />004   #include &lt;atmi.h&gt;               /* BEA Tuxedo System */<br />005   #include &lt;Usysflds.h&gt;           /* BEA Tuxedo System */<br />006   #include &lt;sqlcode.h&gt;            /* BEA Tuxedo System */<br />007   #include &lt;userlog.h&gt;            /* BEA Tuxedo System */<br />008   #include &quot;bank.h&quot;               /* BANKING #defines */<br />009   #include &quot;bank.flds.h&quot;          /* bankdb fields */<br />010   #include &quot;event.flds.h&quot;         /* event fields */<br />011<br />012<br />013   EXEC SQL begin declare section;<br />014   static long account_id;                    /* account id */<br />015   static long branch_id;                     /* branch id  */<br />016   static float bal, tlr_bal;                 /* BALANCE    */<br />017   static char acct_type;                     /* account type*/<br />018   static char last_name[20], first_name[20]; /* last name, first name */<br />019   static char mid_init;                      /* middle initial */<br />020   static char address[60];                   /* address    */<br />021   static char phone[14];                     /* telephone */<br />022   static long last_acct;                     /* last account branch gave */<br />023   EXEC SQL end declare section;<br /> <br />024   static FBFR *reqfb;             /* fielded buffer for request message */<br />025   static long reqlen;             /* length of request buffer */<br />026   static char amts[BALSTR];       /* string representation of float */<br /> <br />027   code for OPEN_ACCT service<br /> <br />028   /*<br />029    * Service to close an account<br />030    */<br /> <br />031   void<br />032   #ifdef __STDC__<br />033   LOSE_ACCT(TPSVCINFO *transb)<br /> <br />034   #else<br /> <br />035   CLOSE_ACCT(transb)<br />036   TPSVCINFO *transb;<br />037   #endif<br /> <br />038   {<br />039      FBFR *transf;               /* fielded buffer of decoded message */<br /> <br />040      /* set pointer to TPSVCINFO data buffer */<br />041         transf = (FBFR *)transb-&gt;data;<br /> <br />042      /* must have valid account number */<br />043      if (((account_id = Fvall(transf, ACCOUNT_ID, 0)) &lt; MINACCT) ||<br />044       (account_id &gt; MAXACCT)) {<br />045         (void)Fchg(transf, STATLIN, 0, &quot;Invalid account number&quot;, (FLDLEN)0);<br />046         tpreturn(TPFAIL, 0, transb-&gt;data, 0L, 0);<br />047      }<br /> <br />048      /* Set transaction level */<br />049      EXEC SQL set transaction read write;<br /> <br />050      /* Retrieve AMOUNT to be deleted */<br />051      EXEC SQL declare ccur cursor for<br />052       select BALANCE from ACCOUNT where ACCOUNT_ID = :account_id;<br />053      EXEC SQL open ccur;<br />054      EXEC SQL fetch ccur into :bal;<br />055      if (SQLCODE != SQL_OK) {                /* nothing found */<br />056       (void)Fchg(transf, STATLIN, 0, getstr(&quot;account&quot;,SQLCODE), (FLDLEN)0);<br />057       EXEC SQL close ccur;<br />058       tpreturn(TPFAIL, 0, transb-&gt;data, 0L, 0);<br />059      }<br /> <br />060      /* Do final withdrawal */<br /> <br />061      /* make withdraw request buffer */<br />062      if ((reqfb = (FBFR *)tpalloc(&quot;FML&quot;,NULL,transb-&gt;len)) == (FBFR *)NULL) {<br />063       (void)userlog(&quot;tpalloc failed in close_acct\n&quot;);<br />064       (void)Fchg(transf, STATLIN, 0,<br />065           &quot;Unable to allocate request buffer&quot;, (FLDLEN)0);<br />066       tpreturn(TPFAIL, 0, transb-&gt;data, 0L, 0);<br />067      }<br />068      reqlen = Fsizeof(reqfb);<br />069      (void)Finit(reqfb,reqlen);<br /> <br />070      /* put ID in request buffer */<br />071      (void)Fchg(reqfb,ACCOUNT_ID,0,(char *)&amp;account_id, (FLDLEN)0);<br /> <br />072      /* put amount into request buffer */<br />073      (void)sprintf(amts,&quot;%.2f&quot;,bal);<br />074      (void)Fchg(reqfb,SAMOUNT,0,amts, (FLDLEN)0);<br /> <br />075      /* increase the priority of this withdraw */<br />076      if (tpsprio(PRIORITY, 0L) == -1)<br />077       (void)userlog(&quot;Unable to increase priority of withdraw&quot;);<br /> <br />078      /* tpcall to withdraw service to remove remaining balance */<br />079      if (tpcall(&quot;WITHDRAWAL&quot;, (char *)reqfb, 0L, (char **)&amp;reqfb,<br />080       (long *)&amp;reqlen,TPSIGRSTRT) == -1) {<br />081       (void)Fchg(transf, STATLIN, 0,&quot;Cannot make withdrawal&quot;, (FLDLEN)0);<br />082       tpfree((char *)reqfb);<br />083       tpreturn(TPFAIL, 0,transb-&gt;data, 0L, 0);<br />084      }<br /> <br />085      /* Delete account record */<br /> <br />086      EXEC SQL delete from ACCOUNT where current of ccur;<br />087      if (SQLCODE != SQL_OK) {                /* Failure to delete */<br />088       (void)Fchg(transf, STATLIN, 0,&quot;Cannot close account&quot;, (FLDLEN)0);<br />089        EXEC SQL close ccur;<br />090        tpfree((char *)reqfb);<br />091        tpreturn(TPFAIL, 0, transb-&gt;data, 0L, 0);<br />092      }<br />093      EXEC SQL close ccur;<br /> <br />094      /* prepare buffer for successful return */<br />095      (void)Fchg(transf, SBALANCE, 0, Fvals(reqfb,SAMOUNT,0), (FLDLEN)0);<br />096      (void)Fchg(transf, FORMNAM, 0, &quot;CCLOSE&quot;, (FLDLEN)0);<br />097      (void)Fchg(transf, STATLIN, 0, &quot; &quot;, (FLDLEN)0);<br />098      tpfree((char *)reqfb);<br />099      tpreturn(TPSUCCESS, 0, transb-&gt;data, 0L, 0);<br />100   }</pre></div>
 
<br/>
    <table id="SummaryNotReq3" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="pgerr.html"><img id="LongDescNotReq7" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="pgthr.html"><img id="LongDescNotReq8" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<img id="LongDescNotReq9" src="/global_resources/images/nexttop_disabled.gif" border="0" alt="Next" />
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
