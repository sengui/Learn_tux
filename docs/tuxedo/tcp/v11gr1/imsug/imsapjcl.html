<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="40264" />
<meta name="LOC_US_SRCFILE" content="//depot/ecs/tcp/v11gr1/imsug/fm/imsapjcl.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="08/24/10 07:24:46" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Sample JCL and User Exits</title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">IMS User Guide
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="imsapcfx.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="imsaptax.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/imsug.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1007418"> </a>
Sample JCL and User Exits
</h1>
<p class="pBody"><a name="wp1006571"> </a>
Use the following sample JCL and user exits to run the BEA Tuxedo Mainframe Adapter for TCP (IMS) (hereafter referenced as TMA TCP for IMS) product:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1006579"> </a><a href="imsapjcl.html#wp1006604"><span class="cHyperlink">
JCL for Executing TMA TCP for IMS</span></a> </li>
<li><a name="wp1006591"> </a><a href="imsapjcl.html#wp1006667"><span class="cHyperlink">
Sample User Exits Enabling IMS Clients to Communicate to Remote Services</span></a> </li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1006595"> </a><a href="imsapjcl.html#wp1006676"><span class="cHyperlink">
OTMA Prerouting User Exit (DFSYPRX0)</span></a> </li>
<li><a name="wp1006599"> </a><a href="imsapjcl.html#wp1006696"><span class="cHyperlink">
OTMA Destination Resolution User Exit (DFSYDRU0)</span></a> </li>
</ul></div>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1006604"> </a>
JCL for Executing TMA TCP for IMS
</h2><p class="pBody"><a name="wp1006609"> </a>
The JCL distribution library contains sample JCL for executing the TMA TCP for IMS product. You must modify the sample JCL to conform to the conventions and standards for your installation. Modifications include the following:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1006610"> </a>Adding an appropriate job card</li>
<li><a name="wp1006611"> </a>Changing the names of IBM product datasets (IMS, TCP/IP for z/OS, and LE/370) to match those used by your installation</li>
<li><a name="wp1006615"> </a>Changing the names of TMA TCP for IMS datasets to match those used by your installation</li>
<li><a name="wp1006616"> </a>Changing the names of certain program modules (for example, the linkage editor), if necessary, to match those used by your installation</li>
</ul></div>
<h3 class="pHeading2"><a name="wp1006654"> </a>
Executing TMA TCP for IMS 
</h3>
<p class="pBody"><a name="wp1006658"> </a>
<a href="imsapjcl.html#wp1006663"><span class="cHyperlink">
Listing&#160;D-1</span></a> is sample JCL for executing as an OTMA client. Use the following JCL only as a reference for modifying the standard OTMA JCL for use with the TMA TCP for IMS product.
</p>
<div class="pCodeTitle"><a name="wp1006663"> </a>
Listing&#160;D-1	   Sample Run JCL 
</div> <a name="wp1006664"> </a><div class="pPreformatted"><pre>//JOBNAME  JOB    ETC.<br />//***************************************************************<br />//*  BRING UP BEA TMA TCP FOR IMS/OTMA                      *<br />//***************************************************************<br />//STEP1    EXEC PGM=BEATCPI,REGION=0M,TIME=1440<br />//STEPLIB  DD   DSN=hlq1.hlq2,DISP=SHR<br />//* Place the name of the authorized library in the STEPLIB DD above<br />//SYSTCPD  DD   DISP=SHR,DSN=TCPIP.DATA<br />//MSGLOG   DD   DISP=SHR,DSN=BEATCPI.MSGLOG<br />//MSGCAT   DD   DISP=SHR,DSN=BEATCPI.MSGCAT<br />//SVRLOG   DD   DISP=SHR,DSN=BEATCPI.SVRLOG<br />//CONFIG   DD   DISP=SHR,DSN=hlq1.hlq2.JCL(CONFIG)<br />//* Place the name of the Config file in the CONFIG DD above<br />//SYSPRINT DD   SYSOUT=*<br />//SYSUDUMP DD   SYSOUT=*</pre></div><p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1006667"> </a>
Sample User Exits Enabling IMS Clients to Communicate to Remote Services
</h2><p class="pBody"><a name="wp1006668"> </a>
To enable IMS clients to communicate to remote services through OTMA, you must install both the <code class="cCode">DFSYPRX0</code> and <code class="cCode">DFSYDRU0</code> IBM user exits available in IMS. Customize the exits to recognize specific transactions as well as the Tuxedo Mainframe Adapter OTMA client name as defined in the configuration file. For more information about setting up the configuration file, refer to the <a href="imsconf.html"><span class="cHyperlink">
Configuring Oracle TMA TCP for IMS</span></a> section. Refer to the IBM document <span style="font-style: italic">Open Transaction Manager Access Guide </span>for additional information on the IBM user exits.
</p>
<h3 class="pHeading2"><a name="wp1006676"> </a>
OTMA Prerouting User Exit (DFSYPRX0)
</h3>
<p class="pBody"><a name="wp1006680"> </a>
<a href="imsapjcl.html#wp1006682">Listing&#160;D-2</a> is the sample IBM OTMA prerouting user exit which can be found in the dataset <code class="cCode">BEATCPI</code> source. The IBM <code class="cCode">DFSYPRX0</code> user exit enables IMS to search for a destination for an application request. In the following sample, the lines in bold are modifications that you must make to the IBM <code class="cCode">DFSYPRX0</code> user exit.
</p>
<div class="pCodeTitle"><a name="wp1006682"> </a>
Listing&#160;D-2	   OTMA Pre-routing Sample User Exit (DFSYPRX0)
</div> <a name="wp1006683"> </a><div class="pPreformatted"><pre>TITLE &#39;DFSYPRX0: OTMA PRE-ROUTING USER EXIT&#39;                   <br />DFSYPRX0 CSECT                                                          <br />DFSYPRX0 AMODE 31                                                       <br />DFSYPRX0 RMODE ANY                                                      <br />********************************************************************    <br />*                                                                  *    <br />* DESCRIPTION: OTMA PRE-ROUTING USER EXIT                          *    <br />*                                                                  *    <br />***********************************************************@SCPYRT**    <br />*                                                                  *    <br />*         Licensed Materials - Property of IBM                     *    <br />*                                                                  *    <br />*         &quot;Restricted Materials of IBM&quot;                            *    <br />*                                                                  *    <br />*         5655-158 (C) Copyright IBM Corp. 1991,1996               *    <br />*                                                                  *    <br />***********************************************************@ECPYRT**    <br />*                                                                  *    <br />*   MODULE TYPE:  DC                                               *    <br />*                                                                  *    <br />*   PROCESSOR:    ASSEMBLER H                                      *    <br />*                                                                  *    <br />*   MODULE SIZE: SEE EXTERNAL SYMBOL DICTIONARY PRODUCED BY        *    <br />*                ASSEMBLER                                         *    <br />*                                                                  *    <br />*   ATTRIBUTE:   REENTRANT                                         *    <br />*                                                                  *    <br />*   ENTRY POINT: DFSYPRX0                                          *    <br />*                                                                  *    <br />*   ENTRY INTERFACES :                                             *    <br />*                                                                  *    <br />* STATUS:      RELEASE 5.1      CHANGE LEVEL - 0                   *    <br />*                                                                  *    <br />* FUNCTION:    THIS MODULE IS CALLED BY IMS WHEN AN APPLICATION    *    <br />*              CALL (IE CHNG OR ISRT) RESULTS IN A SEARCH FOR      *    <br />*              A DESTINATION.                                      *    <br />*              DFSYPRX0 DETERMINES IF:                             *    <br />*                1. IMS SHOULD SEARCH FOR THE DESTINATION          *    <br />*                   WITHOUT LOOKING AT ANY OTMA DESTINATIONS       *    <br />*                   (LEGACY PROCESSING).                           *    <br />*                2. IMS SHOULD INCLUDE OTMA DESTINATIONS,          *    <br />*                   AND PROVIDE A DESTINATION CLIENT MEMBER        *    <br />*                   NAME IF NECESSARY.                             *    <br />*                                                                  *    <br />* DEPENDENCY:  IMS/ESA 5.1                                         *    <br />*                                                                  *    <br />* MODULE TYPE: PROCEDURE                                           *    <br />*    ATTRIBUTE:  RE-ENTRANT                                        *    <br />*    PROCESSOR:  ASSEMBLER H                                       *    <br />*                                                                  *    <br />* REGISTERS:   STANDARD ENTRY AND EXIT                             *    <br />*                                                                  *    <br />* MODULE SIZE: SEE ASSEMBLER LISTING                               *    <br />*                                                                  *    <br />* LINKAGE:     BALR 14,15                                          *    <br />*                                                                  *    <br />*                                                                  *    <br />********************************************************************    <br />         EJECT                                                          <br />*********************************************************************** <br />*                                                                     * <br />*  INTERFACE:                                                         * <br />*                                                                     * <br />*       CONTENTS OF REGISTERS AT ENTRY:                               * <br />*              R1     = ADDRESS OF STANDARD IMS USER EXIT PARMLIST    * <br />*                                                                     * <br />*                     STANDARD PARMLIST                               * <br />*                      ---------                                      * <br />*                     |         |                                     * <br />*                     |---------|                                     * <br />*                     |         |                                     * <br />*                     |---------|                                     * <br />*                     |         |      DFSYPRX0 PARMLIST              * <br />*                 +12 |---------|     |---------------|               * <br />*                     |         |----&gt;|INPUT LTERM    | +0            * <br />*                      ---------      |---------------|               * <br />*                                     |DEST NAME      | +8            * <br />*                                     |---------------|               * <br />*                                     |TRAN NAME      | +16           * <br />*                                     |---------------|               * <br />*                                     |FLAGS          | +24           * <br />*                                     |---------------|               * <br />*                                     |USER ID        | +28           * <br />*                                     |---------------|               * <br />*                                     |GROUP          | +36           * <br />*                                     |---------------|               * <br />*                                     |RESERVED       | +44           * <br />*                                     |---------------|               * <br />*                                     |CLIENT MEM NAME| +48           * <br />*                                     |---------------|               * <br />*                                     |A(MCI)         | +64           * <br />*                                     |---------------|               * <br />*                                     |A(STATE DATA)  | +68           * <br />*                                     |---------------|               * <br />*                                     |A(USER DATA)   | +72           * <br />*                                     |---------------|               * <br />*                                     |RESERVED       | +76           * <br />*                                     |---------------|               * <br />*                                     |A(MEM OVERRIDE)| +80           * <br />*                                     |---------------|               * <br />*                                                                     * <br />*                                                                     * <br />*              R13    = SAVE AREA ADDRESS                             * <br />*              R14    = RETURN ADDRESS                                * <br />*              R15    = ENTRY POINT ADDRESS                           * <br />*                                                                     * <br />*                                                                     * <br />*********************************************************************** <br />         EJECT                                                          <br />*********************************************************************** <br />*                                                                     * <br />*       CONTENTS OF OTMA PRE-ROUTING USER EXIT PARMLIST:              * <br />*                                                                     * <br />*              +0     = 8-BYTE NAME OF LTERM/TPIPE WHICH              * <br />*                       INVOKED THE CURRENT TRANSACTION               * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +8     = 8-BYTE DESTINATION NAME                       * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +16    = 8-BYTE TRANSACTION NAME                       * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +24    = 1-BYTE FLAG                                   * <br />*                       X&#39;80&#39; - IF SET, INDICATES THAT AN INPUT       * <br />*                               OTMA PREFIX EXISTS.  THE MCI,         * <br />*                               STATE DATA, AND USER DATA ARE         * <br />*                               ACCESSIBLE IN THIS PARMLIST.          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +25    = SYNCRONIZATION LEVEL IF THE INPUT WAS         * <br />*                       FROM AN OTMA CLIENT.                          * <br />*                                                                     * <br />*              +26    = 2-BYTE RESERVED                               * <br />*                                                                     * <br />*              +28    = 8-BYTE USERID                                 * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +36    = 8-BYTE GROUP ID                               * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +44    = 4-BYTE RESERVED                               * <br />*                                                                     * <br />*              +48    = 16-BYTE NAME OF INPUT CLIENT MEMBER NAME      * <br />*                       IF INPUT WAS FROM A CLIENT, BLANKS OTHERWISE. * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +64    = ADDR(MESSAGE CONTROL INFORMATION),            * <br />*                       AVAILABLE FROM INPUT OTMA MESSAGE PREFIX.     * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +68    = ADDR(STATE DATA),                             * <br />*                       AVAILABLE FROM INPUT OTMA MESSAGE PREFIX.     * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +72    = ADDR(USER DATA),                              * <br />*                       AVAILABLE FROM INPUT OTMA MESSAGE PREFIX.     * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +76    = 4-BYTE RESERVED                               * </pre></div><a name="wp1006684"> </a><div class="pPreformatted"><pre>*                                                                     * <br />*              +80    = ADDR(16-BYTE MEMBER OVERRIDE)                 * <br />*                       THIS FIELD IS USED WHEN THE TRANSACTION IS    * <br />*                       INVOKED FROM A NON-OTMA LTERM, TO INDICATE    * <br />*                       THE CLIENT NAME WHEN AN OTMA DESTINATION      * <br />*                       IS DESIRED.                                   * <br />*                       (LEFT JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN EXIT PARAMETER ONLY.               * <br />*                                                                     * <br />*                                                                     * <br />*       CONTENTS OF REGISTERS AT EXIT:                                * <br />*                                                                     * <br />*              R15    = RETURN CODE                                   * <br />*                                                                     * <br />*                       RETURN CODE CAN BE ONE OF THE FOLLOWINGS:     * <br />*                       0 : CONTINUE DEFAULT PROCESSING:              * <br />*                           IF THE TRANSACTION WAS INVOKED FROM AN    * <br />*                             OTMA TPIPE, THEN OTMA FIND-DESTINATION  * <br />*                             PROCESSING SHOULD OCCUR.                * <br />*                           IF THE TRANSACTION WAS INVOKED FROM A NON-* <br />*                             OTMA LTERM, THEN LEGACY FIND-DESTINATION* <br />*                             PROCESSING SHOULD OCCUR.                * <br />*                       4 : OTMA FIND-DESTINATION PROCESSING SHOULD   * <br />*                           OCCUR.  IF THE TRANSACTION WAS ENTERED    * <br />*                           FROM A NON-OTMA LTERM, THEN A CLIENT      * <br />*                           MEMBER NAME MUST BE PROVIDED IN THE       * <br />*                           PRE-ROUTING PARAMETER LIST.               * <br />*                       8 : LEGACY FIND-DESTINATION PROCESSING        * <br />*                           SHOULD OCCUR.                             * <br />*                                                                     * <br />*                                                                     * <br />*                                                                     * <br />*   REGISTER 13 IS THE ADDRESS OF SAVE AREA.                          * <br />*                                                                     * <br />*   NORMAL LINKAGE CONVENTIONS FOR REGISTER 13, 14 AND 15             * <br />*                                                                     * <br />*                                                                     * <br />*                                                                     * <br />*********************************************************************** <br />*                                                                       <br />*                                                                       <br />         SAVE  (14,12),,DFSYPRX0&amp;SYSDATE&amp;SYSTIME                        <br />         SPACE 2                                                        <br />         LR    R12,R15             MODULE ADDRESSABILITY                <br />         USING DFSYPRX0,R12                                             <br /><code class="cCodeBold">         USING OTMAPARM,R10                                             <br />         USING SXPL,R9                                                  <br />*                                                                       <br />         LR    R9,R1               LOAD PARAMETER BASE                  <br />         L     R10,SXPLFSPL        OTMA SPECIFIC PARAMETERS             <br />         CLC   OTMDEST,MYPIPE      SPECIAL DESTINATION?                 <br />         BNE   PRX01500            B NO                                 <br />         ICM   R8,15,OTMCOVRD      GET ADDRESS OF OVERRIDING NAME       <br />         BZ    PRX01550            B IF NO ADDRESS                      <br />         MVC   0(16,R8),MYCLIENT   SET OVERRIDING CLIENT NAME           <br />         LA    R15,4               ROUTE TO OTMA                        <br />         B     PRX01600            RETURN                               <br />*                                                                       <br />PRX01500 DS    0H                                                       <br />         CLC   OTMTRANS,MYTRAN     SPECIAL TRANSACTION?                 <br />         BNE   PRX01550            B NO                                 <br />         LA    R15,8               INVOKE LEGACY PROCESSING             <br />         B     PRX01600            RETURN                               <br />*                                                                       <br />PRX01550 DS    0H                                                       <br /></code>         LA    R15,0               RC = 0                               <br /><code class="cCodeBold">PRX01600 DS    0H                                                       <br /></code>*                                                                       <br />         RETURN (14,12),,RC=(15)   RETURN WITH RETURN CODE IN R15       <br />         SPACE 2                                                        <br />         REQUATE                                                        <br />         SPACE 2                                                        <br /><code class="cCodeBold">MYPIPE   DC    CL8&#39;BEAOPIPE&#39;       TEST TPIPE                           <br />MYTRAN   DC    CL8&#39;BEACRP01&#39;       TEST TRANSACTION                     <br />MYCLIENT DC    CL16&#39;BEAOTMA01&#39;     TEST CLIENT                          <br />*                                                                       <br />* DATA MACROS                                                           <br />*                                                                       <br />         DFSSXPL                                                        <br />         BEAOTM                                                         <br />*                                                                       <br /></code>         END</pre></div><h4 class="pHeading3"><a name="wp1006686"> </a>
Sample DSECT BEAOTM
</h4>
<p class="pBody"><a name="wp1006690"> </a>
<a href="imsapjcl.html#wp1006692"><span class="cHyperlink">
Listing&#160;D-3</span></a> is the <code class="cCode">DSECT BEAOTM</code> macro referenced previously. A <code class="cCode">DSECT</code> for the OTMA parameter area passed to the <code class="cCode">DFSYPRX0</code> exit is not provided by IBM.
</p>
<div class="pCodeTitle"><a name="wp1006692"> </a>
Listing&#160;D-3	   <code class="cCodeBold">DSECT BEAOTM</code>
</div> <a name="wp1006693"> </a><div class="pPreformatted"><pre>MACRO<br />         BEAOTM<br />OTMAPARM DSECT                   OTMA SPECIFIC PARAMETER LIST<br />OTMLTERM DS    CL8               ORIGINATING LTERM/TPIPE<br />OTMDEST  DS    CL8               DESTINATION NAME<br />OTMTRANS DS    CL8               TRANSACTION NAME<br />OTMFLAGS DS    X                 OTMA FLAGS<br />#OTMINP  EQU   X&#39;80&#39;             INPUT OTMA MSG PREFIX EXISTS<br />OTMSYNCH DS    X                 OTMA SYNCHRONIZATION LEVEL<br />OTMRESVD DS    XL2               RESERVED<br />OTMUSER  DS    CL8               USER ID<br />OTMGROUP DS    CL8               GROUP NAME<br />OTMRESV2 DS    XL4               RESERVED<br />OTMCNAME DS    CL16              ORIGINATING CLIENT NAME<br />OTMMSGCL DS    A                 ADDRESS OF INPUT MESSAGE CTL<br />OTMSTATE DS    A                 ADDRESS OF INPUT STATE DATA<br />OTMUSERD DS    A                 ADDRESS OF INPUT USER DATA<br />OTMRSVD3 DS    XL4               RESERVED<br />OTMCOVRD DS    A                   ADDRESS OF OVERRIDING CLIENT NAME<br />*<br />         MEND</pre></div><h3 class="pHeading2"><a name="wp1006696"> </a>
OTMA Destination Resolution User Exit (DFSYDRU0)
</h3>
<p class="pBody"><a name="wp1006700"> </a>
<a href="imsapjcl.html#wp1006702"><span class="cHyperlink">
Listing&#160;D-4</span></a> is the sample IBM OTMA destination resolution user exit. The IBM <code class="cCode">DFSYDRU0</code> user exit enables IMS to determine whether the destination is an OTMA client, a non-OTMA <code class="cCode">LTERM</code>, a different OTMA client, or an invalid destination. In the following sample, the lines in bold are modifications that you must make to the IBM <code class="cCode">DFSYDRU0</code> user exit.
</p>
<div class="pCodeTitle"><a name="wp1006702"> </a>
Listing&#160;D-4	   OTMA Destination Resolution User Exit (<code class="cCodeBold">DFSYDRU0</code>)
</div> <a name="wp1006703"> </a><div class="pPreformatted"><pre>TITLE &#39;DFSYDRU0: OTMA DESTINATION RESOLUTION USER EXIT&#39;        <br />DFSYDRU0 CSECT                                                          <br />DFSYDRU0 AMODE 31                                                       <br />DFSYDRU0 RMODE ANY                                                      <br />********************************************************************    <br />*                                                                  *    <br />* DESCRIPTION: OTMA DESTINATION RESOLUTION USER EXIT               *    <br />*                                                                  *    <br />***********************************************************@SCPYRT**    <br />*                                                                  *    <br />*         Licensed Materials - Property of IBM                     *    <br />*                                                                  *    <br />*         &quot;Restricted Materials of IBM&quot;                            *    <br />*                                                                  *    <br />*         5655-158 (C) Copyright IBM Corp. 1991,1996               *    <br />*                                                                  *    <br />***********************************************************@ECPYRT**    <br />*                                                                  *    <br />*   MODULE TYPE:  DC                                               *    <br />*                                                                  *    <br />*   PROCESSOR:    ASSEMBLER H                                      *    <br />*                                                                  *    <br />*   MODULE SIZE: SEE EXTERNAL SYMBOL DICTIONARY PRODUCED BY        *    <br />*                ASSEMBLER                                         *    <br />*                                                                  *    <br />*   ATTRIBUTE:   REENTRANT                                         *    <br />*                                                                  *    <br />*   ENTRY POINT: DFSYDRU0                                          *    <br />*                                                                  *    <br />*   ENTRY INTERFACES :                                             *    <br />*                                                                  *    <br />* STATUS:      RELEASE 5.1      CHANGE LEVEL - 0                   *    <br />*                                                                  *    <br />* FUNCTION:    THIS MODULE IS CALLED BY IMS WHEN AN APPLICATION    *    <br />*              CALL (IE CHNG OR ISRT) RESULTS IN A SEARCH FOR      *    <br />*              A DESTINATION, AND OTMA FIND-DEST PROCESSING        *    <br />*              IS TO BE PERFORMED (AS DETERMINED BY DFSYPRX0       *    <br />*              PROCESSING).                                        *    <br />*              DFSYDRU0 DETERMINES IF:                             *    <br />*                1. DESTINATION IS AN OTMA CLIENT TPIPE            *    <br />*                2. DESTINATION IS A NON-OTMA LTERM                *    <br />*                   (LEGACY PROCESSING).                           *    <br />*                3. DESTINATION IS IN A DIFFERENT OTMA CLIENT      *    <br />*                4. DESTINATION IS INVALID                         *    <br />*                                                                  *    <br />* DEPENDENCY:  IMS/ESA 5.1                                         *    <br />*                                                                  *    <br />* MODULE TYPE: PROCEDURE                                           *    <br />*    ATTRIBUTE:  RE-ENTRANT                                        *    <br />*    PROCESSOR:  ASSEMBLER H                                       *    <br />*                                                                  *    <br />* REGISTERS:   STANDARD ENTRY AND EXIT                             *    <br />*                                                                  *    <br />* MODULE SIZE: SEE ASSEMBLER LISTING                               *    <br />*                                                                  *    <br />* LINKAGE:     BALR 14,15                                          *    <br />*                                                                  *    <br />*                                                                  *    <br />********************************************************************    <br />         EJECT                                                          <br />*********************************************************************** <br />*                                                                     * <br />*  INTERFACE:                                                         * <br />*                                                                     * <br />*       CONTENTS OF REGISTERS AT ENTRY:                               * <br />*              R1     = ADDRESS OF STANDARD IMS USER EXIT PARMLIST    * <br />*                                                                     * <br />*                     STANDARD PARMLIST                               * <br />*                      ---------                                      * <br />*                     |         |                                     * <br />*                     |---------|                                     * <br />*                     |         |                                     * <br />*                     |---------|                                     * <br />*                     |         |      DFSYPRX0 PARMLIST              * <br />*                 +12 |---------|     |---------------|               * <br />*                     |         |----&gt;|INPUT LTERM    | +0            * <br />*                      ---------      |---------------|               * <br />*                                     |DEST NAME      | +8            * <br />*                                     |---------------|               * <br />*                                     |TRAN NAME      | +16           * <br />*                                     |---------------|               * <br />*                                     |FLAGS          | +24           * <br />*                                     |---------------|               * <br />*                                     |USER ID        | +28           * <br />*                                     |---------------|               * <br />*                                     |GROUP          | +36           * <br />*                                     |---------------|               * <br />*                                     |DEST CLIENT    | +44           * <br />*                                     |---------------|               * <br />*                                     |RESERVED       | +60           * <br />*                                     |---------------|               * <br />*                                     |INPUT CLIENT   | +64           * <br />*                                     |---------------|               * <br />*                                     |A(MCI)         | +80           * <br />*                                     |---------------|               * <br />*                                     |A(STATE DATA)  | +84           * <br />*                                     |---------------|               * <br />*                                     |A(USER DATA)   | +88           * <br />*                                     |---------------|               * <br />*                                     |RESERVED       | +92           * <br />*                                     |---------------|               * <br />*                                     |A(MEM OVERRIDE)| +96           * <br />*                                     |---------------|               * <br />*                                     |FLAGS          | +100          * <br />*                                     |---------------|               * <br />*                                                                     * <br />*                                                                     * <br />*              R13    = SAVE AREA ADDRESS                             * <br />*              R14    = RETURN ADDRESS                                * <br />*              R15    = ENTRY POINT ADDRESS                           * <br />*                                                                     * <br />*                                                                     * <br />*********************************************************************** <br />         EJECT                                                          <br />*********************************************************************** <br />*                                                                     * <br />*       CONTENTS OF OTMA PRE-ROUTING USER EXIT PARMLIST:              * <br />*                                                                     * <br />*              +0     = 8-BYTE NAME OF LTERM/TPIPE WHICH              * <br />*                       INVOKED THE CURRENT TRANSACTION               * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +8     = 8-BYTE DESTINATION NAME                       * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +16    = 8-BYTE TRANSACTION NAME                       * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +24    = 1-BYTE FLAG                                   * <br />*                       X&#39;80&#39; - IF SET, INDICATES THAT AN INPUT       * <br />*                               OTMA PREFIX EXISTS.  THE MCI,         * <br />*                               STATE DATA, AND USER DATA ARE         * <br />*                               ACCESSIBLE IN THIS PARMLIST.          * <br />*                       X&#39;40&#39; - IF SET, INDICATES THAT A DIFFERENT    * <br />*                               OTMA CLIENT MAY BE SPECIFIED USING    * <br />*                               RETURN CODE OF R15=8. (I.E. MEMBER    * <br />*                               OVERRIDE IS ALLOWED FOR THIS CALL).   * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +25    = SYNCRONIZATION LEVEL IF THE INPUT WAS         * <br />*                       FROM AN OTMA CLIENT.                          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +26    = 1-BYTE FLAG                                   * <br />*                       X&#39;80&#39; - IF SET, TPIPE EXISTS FOR THE CLIENT   * <br />*                       X&#39;40&#39; - IF SET, LTERM EXISTS IN IMS (LEGACY)  * <br />*                       X&#39;20&#39; - IF SET, LU62 DESCRIPTOR EXISTS        * <br />*                       X&#39;10&#39; - IF SET, ETO IS AVAILABLE              * <br />*                       X&#39;08&#39; - IF SET, CLIENT IS ACTIVE              * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +27    = 1-BYTE RESERVED                               * <br />*                                                                     * <br />*              +28    = 8-BYTE USERID                                 * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +36    = 8-BYTE GROUP ID                               * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +44    = 16-BYTE DESTINATION CLIENT NAME               * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +60    = 4-BYTE RESERVED                               * <br />*                                                                     * <br />*              +64    = 16-BYTE NAME OF INPUT CLIENT MEMBER NAME      * <br />*                       IF INPUT WAS FROM A CLIENT, BLANKS OTHERWISE. * <br />*                       (LEFT-JUSTIFIED, PADDED WITH BLANKS)          * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +80    = ADDR(MESSAGE CONTROL INFORMATION),            * <br />*                       AVAILABLE FROM INPUT OTMA MESSAGE PREFIX.     * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +84    = ADDR(STATE DATA),                             * <br />*                       AVAILABLE FROM INPUT OTMA MESSAGE PREFIX.     * <br />*                       THIS IS AN ENTRY PARAMETER ONLY.              * <br />*                                                                     * <br />*              +88    = ADDR(USER DATA),                              * <br />*                       AVAILABLE FROM INPUT OTMA MESSAGE PREFIX.     * <br />*                                                                     * <br />*                       THIS AREA IS ALSO USED TO RETURN NEW OR       * <br />*                       MODIFIED USER DATA, UP TO A MAXIMUM OF        * <br />*                       1024 BYTES.                            @PQ07683 <br />*                                                                     * <br />*                       THE FORMAT OF THE USER DATA IS:               * <br />*                       0-1 LENGTH OF FOLLOWING USER DATA, WHICH      * <br />*                           INCLUDES THIS LENGTH FIELD                * <br />*                       2-  USER DATA                                 * <br />*                                                                     * <br />*              +92    = 4-BYTE RESERVED                               * <br />*                                                                     * <br />*              +96    = ADDR(OUTPUT PARAMETER LIST)                   * <br />*                       THE OUTPUT PARAMETER LIST IS USED TO          * <br />*                       RETURN INFORMATION TO IMS.  SEE UNDER         * <br />*                       CONTENTS OF REGISTERS AT EXIT.                * <br />*                                                                     * <br />*                                                                     * <br />*       CONTENTS OF REGISTERS AT EXIT:                                * <br />*                                                                     * <br />*              R15    = RETURN CODE                                   * <br />*                                                                     * <br />*                       RETURN CODE CAN BE ONE OF THE FOLLOWINGS:     * <br />*                       0 : DESTINATION IS OTMA CLIENT TPIPE          * <br />*                       4 : DESTINATION IS NON-OTMA LTERM (LEGACY)    * <br />*                       8 : DESTINATION IS IN A DIFFERENT CLIENT.     * <br />*                           THE CLIENT NAME MUST BE RETURNED IN       * <br />*                           THE DFSYDRU0 PARMLIST.                    * <br />*                       12: DESTINATION IS INVALID                    * <br />*                                                                     * <br />*          CONTENTS OF OTMA PRE-ROUTING USER EXIT PARMLIST:           * <br />*                                                                     * <br />*              ALL FIELDS IN THE PARMLIST SHOULD REMAIN UNCHANGED.    * <br />*              OUTPUT INFORMATION IS RETURNED AS FOLLOWS:             * <br />*                                                                     * <br />*              +96    = ADDR(OUTPUT PARAMETER LIST)                   * <br />*                       +00 = (16-BYTE MEMBER OVERRIDE)               * <br />*                             THIS FIELD IS USED WHEN THE DESTINATION * <br />*                             IS IN A DIFFERENT OTMA CLIENT.          * <br />*                             RETURN CODE 8 MUST BE SET.              * <br />*                             (LEFT JUSTIFIED, PADDED WITH BLANKS)    * <br />*                                                                     * <br />*                       +16 = 1-BYTE OUTPUT FLAG FIELD                * <br />*                             X&#39;80&#39; = IF SET, INDICATES THAT IF A     * <br />*                                     TPIPE NEEDS TO BE CREATED, IT   * <br />*                                     SHOULD BE A SYNC&#39;D TPIPE.       * <br />*                                     THIS IS ONLY VALID WHEN         * <br />*                                     RETURN CODE = 0.                * <br />*                                                                     * <br />*                       +17 = 15-BYTE RESERVED                        * <br />*                                                                     * <br />*                                                                     * <br />*                                                                     * <br />*   REGISTER 13 IS THE ADDRESS OF SAVE AREA.                          * <br />*                                                                     * <br />*   NORMAL LINKAGE CONVENTIONS FOR REGISTER 13, 14 AND 15             * <br />*                                                                     * <br />*                                                                     * <br />*                                                                     * <br />*********************************************************************** <br />*                                                              @PQ00242 <br />*                                                              @PQ00242 <br />*                                                              @PQ00242 <br />*                                                              @PQ00242 <br />*                                                              @PQ00242 <br />*                                                              @PQ00242 <br />         SAVE  (14,12),,DFSYDRU0&amp;SYSDATE&amp;SYSTIME               @PQ00242 <br />         SPACE 2                                               @PQ00242 <br />         LR    R12,R15             MODULE ADDRESSABILITY       @PQ00242 <br />         USING DFSYDRU0,R12                                    @PQ00242 <br />*                                                              @PQ00242 <br />*                                                                       <br /><code class="cCodeBold">         L     R2,12(,R1)                                               <br />         CLC   44(16,R2),MYCLIENT                                       <br />         BNE   EXIT4                                                    <br />*                                                                       <br />EXIT0    DS    0H                                                       <br /></code>         LA    R15,0               RC = 0                               <br /><code class="cCodeBold">         B     EXIT                                                     <br /></code>*                                                                       <br /><code class="cCodeBold">EXIT4    DS    0H                                                       <br />         LA    R15,4                                                    <br />EXIT     DS    0H                                                       <br /></code>         RETURN (14,12),,RC=(15)   RETURN WITH RETURN CODE IN R15       <br />         SPACE 2                                                        <br />         REQUATE                                                        <br /><code class="cCodeBold">*                                                                       <br />MYCLIENT DC    CL16&#39;BEAOTMA01&#39;     TEST CLIENT                          <br /></code>*                                                                       <br />         END</pre></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="imsapjcl.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="imsapcfx.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="imsaptax.html"><img id="LongDescNotReq10" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
