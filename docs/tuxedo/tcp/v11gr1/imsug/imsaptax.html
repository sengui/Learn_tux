<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

<!-- LOCALIZATION RELATED INFORMATION -->
<meta name="LOC_PROJ_ID" content="WLPF8.1" />
<meta name="LOC_OWNER" content="BEAJ" />
<meta name="LOC_STATUS" content="READY!" />
<meta name="LOC_COMMENT" content="LOC_COMMENT" />
<meta name="LOC_US_REV" content="1" />
<meta name="LOC_US_CHANGE" content="40264" />
<meta name="LOC_US_SRCFILE" content="//depot/ecs/tcp/v11gr1/imsug/fm/imsaptax.fm" />
<!-- LOCALIZATION RELATED INFORMATION -->

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 Platinum Edition for FrameMaker 8.6.6577.0" />
    <meta name="TEMPLATEBASE" content="BEA_WFP_Template_V1.04" />
    <meta name="LASTUPDATED" content="08/24/10 07:24:46" />
    <link rel="StyleSheet" href="/global_resources/edocs.css" type="text/css" media="all" />

<title>Sample IMS Client and Server Transactions </title>

<!-- BEA scripts begin -->

<script language="Javascript" src="/global_resources/js/banner.js" type="text/javascript"></script>
<!-- This script outputs the banner required for edocs documentation. -->

<script language="Javascript" src="floatwin.js" type="text/javascript"></script>
<!-- This script opens a new small floating window and puts TOC<i>&lt;name&gt;</i>.html and IX<i>&lt;name&gt;</i>.html files in it and sets a generic popup window code to enable the display of some viewlets in the WebLogic Platform Tour. -->

<script language="Javascript1.1" src="/global_resources/js/footer.js" type="text/javascript"></script>
<!-- This script outputs the footer with the correct copyright date and link to copyright page.-->

<script language="Javascript1.1" src="/global_resources/js/googlesearch4.js" type="text/javascript"></script>
<!-- This script outputs the google search form. -->

<script language="Javascript1.1" src="/global_resources/js/note.js" type="text/javascript"></script>
<!-- This script outputs a note such as a BETA note. -->

<script language="JavaScript1.1" src="/global_resources/js/search.js" type="text/javascript"></script>
<!-- This script is not for online documents. It is only used by the QuestAgent Java Applet for CD search indexes. -->

<!-- BEA scripts end -->

  </head>

  <body>


<script language="Javascript1.1" type="text/javascript">
GoogleURL();
</script><noscript>This script outputs the google search URL required for search on edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
Banner();
</script><noscript>This script outputs the banner required for edocs documentation.</noscript>

<script language="Javascript1.1" type="text/javascript">
GoogleSearchCollection();
</script><noscript>This script outputs the google search parameters required for search on edocs documentation.</noscript>

<!-- page title -->
<h1 class="booktitle">IMS User Guide
</h1>
<!-- page title end -->

    <table id="SummaryNotReq1" width="100%" border="0" align="left" cellpadding="2%" cellspacing="0">
      <tr> 
        <td>
&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="imsapjcl.html"><img id="LongDescNotReq1" src="/global_resources/images/doc_nav_prev.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="imsaprsn.html"><img id="LongDescNotReq2" src="/global_resources/images/doc_nav_next.gif" border="0" alt="Next" /></a>&nbsp;
<img id="LongDescNotReq3" src="/global_resources/images/doc_nav_dots.gif" border="0" alt="" />&nbsp;
<a accesskey="1" href="javascript:OpenWindowToc();" onmouseover="window.status='Table of Contents'; return true" onfocus="window.status='Table of Contents'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open TOC in new window">      <img id="LongDescNotReq4" src="/global_resources/images/doc_nav_contents.gif" alt="Open TOC in new window" border="0" /></a>&nbsp;
<a accesskey="2" href="javascript:OpenWindowIndex();" onmouseover="window.status='Index'; return true" onfocus="window.status='Index'; return true" onmouseout="window.status=''; return true" onblur="window.status=''; return true" title="Open Index in new window">     <img id="LongDescNotReq5" src="/global_resources//images/doc_nav_index.gif" border="0" alt="Open Index in new window" /></a>&nbsp;
<a href="../pdf/imsug.pdf" target="pdf"><img id="LongDescNotReq6" src="/global_resources/images/doc_nav_pdf.gif" width="59" height="44" alt="View as PDF - New Window" title="View as PDF - New Window" border="0" /></a>&nbsp;
<a href="http://www.adobe.com/products/acrobat/alternate.html" target="_blank"><img id="LongDescNotReq7" src="/global_resources/images/get_reader.gif" width="52" height="44" alt="Get Adobe Reader - New Window" title="Get Adobe Reader - New Window" border="0" /></a>
<a name="link_group_0"></a>
	</td>
      </tr>
    </table>

<a name="skipnav" title="Content starts here"><img src="/global_resources/images/_.gif" alt="Content starts here" border="0" height="1" width="1" /></a>



<h1 class="pChapHead"><a name="wp1007644"> </a>
Sample IMS Client and Server Transactions 
</h1>
<p class="pBody"><a name="wp1007026"> </a>
Oracle Tuxedo Mainframe Adapter for TCP (IMS) (hereafter referenced as TMA TCP for IMS) client and server transactions are ordinary IMS MPP transactions, and when running the Oracle TMA TCP for IMS gateway as an OTMA client, FastPath transactions as well. Transactions can be written in any application programming language supported by IMS. Source code for the sample transactions in this document can be found in the Oracle TMA TCP for IMS <code class="cCode">SOURCE</code> distribution library. The following sample transactions are provided in this document:
</p>
<div class="pSmartList1Bullet"><ul>
<li><a name="wp1006585"> </a><a href="imsaptax.html#wp1006591"><span class="cHyperlink">
IMS Server Transaction</span></a> </li>
<li><a name="wp1006589"> </a><a href="imsaptax.html#wp1006656"><span class="cHyperlink">
IMS Client Transactions</span></a> </li>
</ul></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1006591"> </a>
IMS Server Transaction
</h2><p class="pBody"><a name="wp1006592"> </a>
An IMS server transaction offers a specified service and processes client requests for that service. A server request takes place according to the following sequence of events.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1006593"> </a>A client transaction running on a remote system makes a request for a service offered by the IMS gateway. The remote gateway forwards the request to the IMS gateway, which formats and inserts a <span style="font-style: italic">server request message</span> indirectly through OTMA. The server request message is destined for the IMS server transaction that offers the service.</li>
<li><a name="wp1006594"> </a>IMS schedules the specified server transaction, which retrieves the server request message from the IMS message queue and performs whatever processing is appropriate. If a response is required, the server transaction formats a <span style="font-style: italic">server response message</span> and inserts it into the IMS message queue destined for the Oracle TMA TCP for IMS server response transaction.</li>
<li><a name="wp1006601"> </a>Oracle TMA TCP for IMS retrieves the server response message from the IMS message queue or the OTMA interface and returns the response to the remote system making the request.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1006603"> </a>
BEASVR01 - A Sample IMS Server Transaction
</h3>
<p class="pBody"><a name="wp1006607"> </a>
<a href="imsaptax.html#wp1006609">Listing&#160;E-1</a> is a simple <span style="font-style: italic">echo transaction</span>; that is, it simply returns a response consisting of whatever request data it received.
</p>
<div class="pCodeTitle"><a name="wp1006609"> </a>
Listing&#160;E-1	   Sample IMS Server Transaction
</div> <a name="wp1006610"> </a><div class="pPreformatted"><pre>CBL APOST      *****************************************************************<br />FILE:      BEASVR01<br />PURPOSE:   SAMPLE IMS SERVER TRANSACTION FOR USE WITH        <br />           BEA TMA TCP FOR IMS <br />COMMENTS:  THIS IS A SIMPLE ECHO SERVER TRANSACTION THAT ISSUES A<br />           RESPONSE CONSISTING OF THE SAME DATA AS RECEIVED. <br />LANGUAGE:  COBOL <br />COPYRIGHT  (C) 1997 BEA SYSTEMS, INC. ALL RIGHTS RESERVED <br />*****************************************************************<br /><br />IDENTIFICATION DIVISION.<br />PROGRAM-ID. BEASVR01.<br />ENVIRONMENT DIVISION.<br />CONFIGURATION SECTION.<br />SOURCE-COMPUTER. IBM-370.<br />OBJECT-COMPUTER. IBM-370.<br />DATA DIVISION.<br />WORKING-STORAGE SECTION.<br /><br />77 GU      PIC X(04) VALUE &#39;GU &#39;.<br />77 CHNG    PIC X(04) VALUE &#39;CHNG&#39;.<br />77 ISRT    PIC X(04) VALUE &#39;ISRT&#39;.<br />77 PURG    PIC X(04) VALUE &#39;PURG&#39;.<br /><br />01 BEAGW  PIC X(08) VALUE &#39;BEATCPI &#39;.<br /><br /><br />*****************************************************************<br />*            REQUEST MESSAGE                                   * <br />*****************************************************************<br />    01   REQUEST-MESSAGE.<br />(1)      COPY SERVER.<br />         05 USER-DATA           PIC X(512).<br />*****************************************************************<br />*                  RESPONSE MESSAGE                             *<br />*****************************************************************<br />    01   REQUEST-MESSAGE.<br />(1)      COPY SERVER.<br />         05 USER-DATA           PIC X(512).<br />       LINKAGE SECTION.<br />****************************************************************<br />*                  I/O PCB                                     *<br />****************************************************************<br />01   01 IOPCB.<br />     05 LTERM                   PIC X(08).<br />     05 FILLER                  PIC X(02).<br />     05 IOPCB-STATUS            PIC X(02).<br />     05 FILLER                  PIC X(28).<br />   *****************************************************************<br /><br />     PROCEDURE DIVISION.<br />           ENTRY &#39;DLITCBL&#39; USING IOPCB, ALTPCB.<br />           PERFORM IOPCB-GET    THRU IOPCB-GET-EXIT.<br />           PERFORM ECHO-MSG     THRU ECHO-MSG-EXIT.<br />           PERFORM ISRT-MSG     THRU ISRT-MSG-EXIT.<br />           GO TO 9999-RETURN.<br /><br />*****************************************************************<br />*       RETRIEVE THE REQUEST MESSAGE FROM THE IMS QUEUE         *<br />*****************************************************************<br />      IOPCB-GET.<br />(2)   CALL &#39;CBLTDLI&#39; USING GU, IOPCB, REQUEST-MESSAGE.<br />      IF IOPCB-STATUS NOT = SPACES<br />               GO TO 9999-RETURN.<br /><br />       IOPCB-GET-EXIT.<br />	      EXIT.<br />*****************************************************************<br />*         COMPOSE THE RESPONSE MESSAGE                     *<br />*****************************************************************<br />          ECHO-MSG.<br />* THE RESPONSE MESSAGE HAS THE SAME BASIC FORMAT AS<br />* THE REQUEST MESSAGE. WE CHANGE THE TRAN CODE TO THAT<br />* OF THE DESTINATION. NOTE THAT THE FIELD<br />* BEA-RESERVED MUST BE COPIED INTACT FROM THE<br />* REQUEST MESSAGE TO THE RESPONSE MESSAGE. FOR RE-<br />* SPONSE DATA, WE SIMPLY RETURN THE REQUEST DATA.<br />* HENCE THIS IS AN ECHO TRANSACTION.<br /><br />(3)     MOVE REQUEST-MESSAGE TO RESPONSE-MESSAGE.<br />(4,6)       MOVE BEAGW          TO TRAN-CODE IN RESPONSE-MESSAGE.<br /><br />       ECHO-MSG-EXIT.<br />           EXIT.<br />*****************************************************************<br />*        INSERT RESPONSE MESSAGE TO IMS QUEUE             *<br />*****************************************************************<br />       ISRT-MSG.<br />* (5)   CALL &#39;CBLTDLI&#39; USING ISRT, IOPCB, RESPONSE-MESSAGE.<br />        IF IOPCB-STATUS NOT = SPACES<br />            GO TO 9999-RETURN.<br />ISRT-MSG-EXIT.<br />         EXIT.<br />*****************************************************************<br />*         INSERT RESPONSE MESSAGE TO ALTERNATE PCB              *<br />*****************************************************************<br />      PCB-ISRT.<br />      9999-RETURN.<br />              GOBACK.</pre></div><h4 class="pHeading3"><a name="wp1006613"> </a>
Notes
</h4>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1006617"> </a>The format of the Oracle TMA TCP for IMS server request/response message header is supplied by a COBOL copybook, <code class="cCode">SERVER</code>. The equivalent C language header is provided by the <code class="cCode">BEATCPI.H</code> header file. Both are available in the Oracle TMA TCP for IMS <code class="cCode">INCLUDE</code> distribution library.</li>
<li><a name="wp1006621"> </a>A <code class="cCode">GU</code> (Get Unique) call is issued to retrieve the request message from the IMS message queue. A server request message is always formatted as a single message segment, so a <code class="cCode">GN</code> (Get Next) call is not strictly required.</li>
<li><a name="wp1006630"> </a>The <code class="cCode">USER-DATA</code> (user-defined request data) is simply copied from the request message to the response message.</li>
<li><a name="wp1006633"> </a>The <code class="cCode">TRAN-CODE</code> in the response message is set to that of the Oracle TMA TCP for IMS (in this example, <code class="cCode">BEAGW=&quot;BEATCPI</code>&#8221;; the name may be different in your installation).</li>
<li><a name="wp1006646"> </a>An <code class="cCode">ISRT</code> (Insert) call is issued to insert the message into the IMS message queue, returning the response to Oracle TMA TCP for IMS.</li>
<li><a name="wp1006650"> </a>In cases where no response is required, the server transaction simply performs any processing required by the request and returns to IMS (without sending a response message to Oracle TMA TCP for IMS).</li>
</ol></div>
<p>&nbsp;</p>
<hr noshade="noshade"/>
<h2 class="pHeading1"><a name="wp1006656"> </a>
IMS Client Transactions
</h2><p class="pBody"><a name="wp1006657"> </a>
An IMS client transaction is one that issues a request for a specified remote service made available through Oracle TMA TCP for IMS. IMS client requests (unlike server requests) are processed in two distinct &#8220;phases&#8221;: a <span style="font-style: italic">request</span> phase, followed by a <span style="font-style: italic">response</span> phase. The request and response must be processed by two separate transaction executions (for example, <code class="cCode">T1</code> and <code class="cCode">T2</code>). 
</p>
<h3 class="pHeading2"><a name="wp1006662"> </a>
Request Phase
</h3>
<p class="pBody"><a name="wp1006663"> </a>
A client request takes place according to the following scenario.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1006664"> </a>The request transaction, <code class="cCode">T1</code>, issues a request for a service provided by a remote gateway by inserting a <span style="font-style: italic">client request message</span> into the IMS message queue. The client request message is destined for TMA TCP for IMS, and must specify the name (transaction code) of a response transaction (<code class="cCode">T2</code>).</li>
<li><a name="wp1006671"> </a>The TMA TCP for IMS gateway retrieves the client request message and forwards the request to a remote system which offers the requested service.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1006673"> </a>
Response Phase
</h3>
<p class="pBody"><a name="wp1006674"> </a>
A client response takes place according to the following scenario.
</p>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1006675"> </a>When the response (if required) is received, a <span style="font-style: italic">client response message</span> is formatted and inserted directly into the IMS message queue. If running the OTMA client, the response is placed into the IMS message queue indirectly through the OTMA interface. The client response message is destined for the specified response transaction (T2).</li>
<li><a name="wp1006679"> </a>The response transaction is scheduled by IMS and retrieves the client response message from the IMS message queue. The client response message contains sufficient information to enable the response transaction to correlate the response with the original request.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1006682"> </a>
BEACRQ01 - A Sample IMS Client Request Transaction 
</h3>
<p class="pBody"><a name="wp1006683"> </a>
The following sample IMS client request transaction makes a request for a service called <code class="cCode">TOUPPER</code>, provided by a remote system. The <code class="cCode">TOUPPER</code> service returns a response consisting of the request data translated to uppercase. 
</p>
<div class="pCodeTitle"><a name="wp1006687"> </a>
Listing&#160;E-2	   Sample IMS Client Request Transaction
</div> <a name="wp1006688"> </a><div class="pPreformatted"><pre>CBL APOST                                                             <br />       IDENTIFICATION DIVISION.                                                 <br />       PROGRAM-ID. BEACRQ01.                                                   <br />       ENVIRONMENT DIVISION.                                                    <br />       CONFIGURATION SECTION.                                                   <br />       SOURCE-COMPUTER. IBM-370.                                                <br />       OBJECT-COMPUTER. IBM-370.                                                <br />       DATA DIVISION.                                                           <br />      WORKING-STORAGE SECTION.<br /><br />77 GU        PIC X(04) VALUE &#39;GU &#39;.<br />77 CHNG      PIC X(04) VALUE &#39;CHNG&#39;.<br />77 ISRT      PIC X(04) VALUE &#39;ISRT&#39;.<br />77 PURG      PIC X(04) VALUE &#39;PURG&#39;.<br /><br />01 MSG-IN. <br />   05 MI-LL        PIC S9(04) COMP VALUE +0.<br />   05 MI-ZZ        PIC S9(04) COMP VALUE +0.<br />   05 MI-TRANCODE  PIC X(08) VALUE SPACES.<br />   05 FILLER       PIC X(01) VALUE SPACES.<br />   05 MI-AREA.     PIC X(91) VALUE SPACES. <br />   10 MI-DATA<br /><br />(1)    01 CLIENT-REQUEST.<br />       05 CRR-LL                 PIC 9(04) COMP VALUE 0.<br />       05 CRR-ZZ                 PIC 9(04) COMP VALUE 0.<br />       05 CRR-TRANCODE           PIC X(08) VALUE SPACES.<br />       05 FILLER                 PIC X(01) VALUE SPACES.<br />       05 BEA-RESERVED-1         PIC X(03) VALUE LOW-VALUES. <br />       05 CRR-HEADER-LEN         PIC 9(08) COMP.<br />       05 CRR-CONTEXT-DATA-LEN   PIC 9(08) COMP.<br />       05 CRR-REQUEST-DATA-LEN   PIC 9(08) COMP. <br />       05 CRR-MAX-RESPONSE-LEN   PIC 9(08) COMP.<br />       05 CRR-REQUEST-TYPE       PIC 9(08) COMP.<br />       05 CRR-RESPONSE-FORMAT    PIC 9(08) COMP. <br />       05 CRR-ERROR-CODE         PIC 9(08) COMP. <br />       05 CRR-REASON-CODE        PIC 9(08) COMP. <br />       05 CRR-SERVICE-NAME       PIC X(16) VALUE LOW-VALUES. <br />       05 CRR-RESPONSE-TRAN      PIC X(08) VALUE LOW-VALUES. <br />       05 CRR-ORIGIN-TERMINAL    PIC X(08) VALUE LOW-VALUES.<br />       05 BEA-RESERVED-2         PIC X(16) VALUE LOW-VALUES. <br />       05 CRR-CONTEXT-AREA.<br />          10 CRR-CONTEXT-DATA    PIC X(31) VALUE SPACES.<br />       05 CRR-REQUEST-AREA. <br />          10 CRR-REQUEST-DATA    PIC X(100) VALUE SPACES.<br /><br />LINKAGE SECTION.<br />01 IOPCB. <br />   05 LTERM          PIC   X(08).<br />   05 FILLER         PIC   X(02). <br />   05 IOPCB-STATUS   PIC   X(02).<br />   05 FILLER         PIC   X(28). <br />   01 ALTPCB.<br />   05 ALTPCB-DEST    PIC   X(08). <br />   05 FILLER         PIC   X(02). <br />   05 ALTPCB-STATUS  PIC   X(02). <br />   05 FILLER         PIC   X(10). <br /><br />      PROCEDURE DIVISION.<br />      ENTRY &#39;DLITCBL&#39; USING IOPCB, ALTPCB.<br /><br />(2)   CALL &#39;CBLTDLI&#39; USING GU, IOPCB, MSG-IN.<br />      IF IOPCB-STATUS NOT = SPACES<br />      GO TO 9999-RETURN.<br />                                                                                <br />(3)   MOVE &#39;BEATCPI&#39; TO CRR-TRANCODE.<br />      MOVE 96 TO CRR-HEADER-LEN.<br />      MOVE 1 TO CRR-REQUEST-TYPE.<br />      MOVE 0 TO CRR-RESPONSE-FORMAT.<br />      MOVE LTERM TO CRR-ORIGIN-TERMINAL.<br />      MOVE &#39;TOUPPER&#39; TO CRR-SERVICE-NAME.<br />      MOVE &#39;BEACRP01&#39; TO CRR-RESPONSE-TRAN.<br />      MOVE ALL &#39;A&#39; TO CRR-REQUEST-DATA.<br />      MOVE LENGTH OF CRR-REQUEST-AREA TO<br />           CRR-REQUEST-DATA-LEN.<br />      MOVE CRR-REQUEST-DATA-LEN TO CRR-MAX-RESPONSE-LEN.<br /><br />(4)   MOVE ALL &#39;B&#39; TO CRR-CONTEXT-DATA.<br />      MOVE LENGTH OF CRR-CONTEXT-AREA TO CRR-CONTEXT-DATA-LEN.<br /><br />(5)   COMPUTE CRR-LL = CRR-REQUEST-DATA-LEN +<br />      CRR-CONTEXT-DATA-LEN +<br />      CRR-HEADER-LEN.<br /><br />(6) CALL &#39;CBLTDLI&#39; USING CHNG, ALTPCB, CRR-TRANCODE.<br />      IF ALTPCB-STATUS NOT = SPACES<br />      GO TO 9999-RETURN.<br /><br />(7)   CALL &#39;CBLTDLI&#39; USING ISRT, ALTPCB, CLIENT-REQUEST.<br />      IF ALTPCB-STATUS NOT = SPACES<br />      GO TO 9999-RETURN.<br /><br />(8)   CALL &#39;CBLTDLI&#39; USING PURG, ALTPCB.<br />      IF ALTPCB-STATUS NOT = SPACES<br />      GO TO 9999-RETURN.<br /><br />(9)   9999-RETURN.<br /><br />      GOBACK.</pre></div><h4 class="pHeading3"><a name="wp1006691"> </a>
Notes
</h4>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1006695"> </a>Although not used in the previous example, the format of the TMA TCP for IMS client request/response message header is supplied by a COBOL copybook, <code class="cCode">CLIENT</code>. The equivalent C language header is provided by the <code class="cCode">BEATCPI.H</code> header file. Both are available in the TMA TCP for IMS <code class="cCode">INCLUDE</code> distribution library.</li>
<li><a name="wp1006699"> </a>A <code class="cCode">GU</code> (Get Unique) call is issued to retrieve the terminal input message from the IMS message queue.</li>
<li><a name="wp1006700"> </a>The client request header is initialized as follows:</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1006704"> </a><code class="cCode">CRR-TRANCODE</code> is set to the transaction code of the TMA TCP for IMS gateway (in this example, &#8220;<code class="cCode">BEATCPI</code>&#8221;; the name may be different in your installation).</li>
<li><a name="wp1006705"> </a><code class="cCode">BEA-RESERVED</code>-1 <span style="font-style: italic">must be initialized to binary zero</span>.</li>
<li><a name="wp1006706"> </a><code class="cCode">CRR-HEADER-LEN</code> is set to the length of the client request header (96 bytes).</li>
<li><a name="wp1006707"> </a><code class="cCode">CRR-REQUEST-TYPE</code> is set to 1, specifying that a response is required.</li>
<li><a name="wp1006708"> </a><code class="cCode">CRR-RESPONSE-FORMAT</code> is set to 0, specifying that the response is to be returned as a single message segment.</li>
<li><a name="wp1006709"> </a><code class="cCode">CRR-ORIGIN-TERMINAL</code> is set to the name of the requesting terminal (<code class="cCode">LTERM</code>), obtained from the <code class="cCode">IOPCB</code>.</li>
<li><a name="wp1006710"> </a><code class="cCode">CRR-SERVICE-NAME</code> is set to the name of the service being requested (&#8220;<code class="cCode">TOUPPER</code>&#8221;). <em class="cEmphasis">This name must be the name of the service as locally defined to </em>TMA TCP for IMS<em class="cEmphasis">.</em> This name may (or may not) be the same as the name of the service as defined on the remote system which offers the service.</li>
<li><a name="wp1006714"> </a><code class="cCode">CRR-RESPONSE-TRAN</code> is set to the name of the designated response transaction (&#8220;<code class="cCode">BEACRP01</code>&#8221;).</li>
<li><a name="wp1006715"> </a><code class="cCode">CRR-REQUEST-DATA-LEN</code> is set to the length of user-defined request data being sent.</li>
<li><a name="wp1006717"> </a><code class="cCode">CRR-MAX-RESPONSE-LEN</code> is set to the maximum amount of response data that can be accommodated.</li>
<li><a name="wp1006718"> </a><code class="cCode">BEA-RESERVED-2</code> <span style="font-style: italic">must be initialized to binary zero</span>.</li>
</ul></div>
<li><a name="wp1007448"> </a>Context data is optional and can be any data desired. Typically, context data is used by the response transaction to correlate the response with the original request.</li>
<div class="pSmartList2Bullet"><ul>
<li><a name="wp1007454"> </a><code class="cCode">CRR-CONTEXT-DATA-LEN</code> is set to the length of any user-defined context data included.</li>
</ul></div>
<li><a name="wp1007449"> </a>The length of the message segment (<code class="cCode">LL</code>) is set to the overall length of the client request message (header + context data + request data).</li>
<li><a name="wp1006725"> </a>A <code class="cCode">CHNG</code> (Change) call is issued to set the destination to the transaction code of the TMA TCP for IMS gateway (in this example, &#8220;<code class="cCode">BEATCPI</code>&#8221;; the name may be different in your installation).</li>
<li><a name="wp1006729"> </a>An <code class="cCode">ISRT</code> (Insert) call is issued to insert the client request message into the IMS message queue. Although the client request message is formatted as a single message segment in this example, the client request message may be formatted as multiple message segments, if desired.</li>
<li><a name="wp1006730"> </a>A <code class="cCode">PURG</code> call is issued to signal that the message is complete; for example, there are no additional message segments.</li>
<li><a name="wp1006731"> </a>The requesting transaction does not wait on the response. Rather, the specified response transaction is scheduled by TMA TCP for IMS when processing of the request completes.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1006737"> </a>
BEACRP01 - A Sample IMS Client Response Transaction 
</h3>
<p class="pBody"><a name="wp1006738"> </a>
The following sample IMS client response transaction processes the response from a request for a service called <code class="cCode">TOUPPER</code>, provided by a remote system. The <code class="cCode">TOUPPER</code> service returns a response consisting of the request data translated to uppercase. 
</p>
<div class="pCodeTitle"><a name="wp1006742"> </a>
Listing&#160;E-3	   Sample IMS Response Transaction
</div> <a name="wp1006743"> </a><div class="pPreformatted"><pre>CBL APOST                                                             <br />       IDENTIFICATION DIVISION.                                                 <br />       PROGRAM-ID. BEACRP01.                                                   <br />       ENVIRONMENT DIVISION.                                                    <br />       CONFIGURATION SECTION.                                                   <br />       SOURCE-COMPUTER. IBM-370.                                                <br />       OBJECT-COMPUTER. IBM-370.                                                <br />      DATA DIVISION.<br /><br />WORKING-STORAGE SECTION. <br />     77 GU     PIC X(04) VALUE &#39;GU&#39;.<br />     77 CHNG   PIC X(04) VALUE &#39;CHNG&#39;.<br />     77 ISRT   PIC X(04) VALUE &#39;ISRT&#39;.<br />     77 PURG   PIC X(04) VALUE &#39;PURG&#39;.<br /><br />1 MSG-OUT.<br />    05 MO-LL                 PIC S9(04) COMP VALUE +0.<br />    05 MO-ZZ                 PIC S9(04) COMP VALUE +0.<br />    05 MO-TRANCODE           PIC X(08) VALUE SPACES.<br />    05 FILLER                PIC X(01) VALUE SPACES.<br />    05 MO-AREA<br />       10 MO-DATA            PIC X(91) VALUE SPACES.<br />(1) 01 CLIENT-RESPONSE.<br />    05 CRR-LL                PIC 9(04) COMP VALUE 0.<br />    05 CRR-ZZ                PIC 9(04) COMP VALUE 0.<br />    05 CRR-TRANCODE          PIC X(08) VALUE SPACES. <br />    05 FILLER                PIC X(01) VALUE SPACES. <br />    05 BEA-RESERVED-1        PIC X(03) VALUE LOW-VALUES.<br />    05 CRR-HEADER-LEN        PIC 9(08) COMP. <br />    05 CRR-CONTEXT-DATA-LEN  PIC 9(08) COMP.<br /><br />(7) 05 CRR-RESPONSE-DATA-LEN PIC 9(08) COMP.<br />(7) 05 CRR-MAX-RESPONSE-LEN  PIC 9(08) COMP.<br />    05 CRR-REQUEST-TYPE      PIC 9(08) COMP.<br />(3) 05 CRR-RESPONSE-FORMAT   PIC 9(08) COMP.<br />    05 CRR-ERROR-CODE        PIC S9(08) COMP.<br />    05 CRR-REASON-CODE       PIC S9(08) COMP. <br />    05 CRR-SERVICE-NAME      PIC X(16) VALUE LOW-VALUES.<br />    05 CRR-RESPONSE-TRAN     PIC X(08) VALUE LOW-VALUES.<br />    05 CRR-ORIGIN-TERMINAL   PIC X(08) VALUE LOW-VALUES.<br />    05 BEA-RESERVED-2        PIC X(16) VALUE LOW-VALUES.<br />(6) 05 CRR-CONTEXT-AREA.<br />       10 CRR-CONTEXT-DATA   PIC X(31) VALUE SPACES.<br />    05 CRR-RESPONSE-AREA.<br />       10 CRR-RESPONSE-DATA  PIC X(100) VALUE SPACES.<br /><br />    LINKAGE SECTION.<br /><br />    01 IOPCB.<br />    05 LTERM                 PIC   X(08).<br />    05 FILLER                PIC   X(02).<br />    05 IOPCB-STATUS          PIC   X(02).<br />    05 FILLER                PIC   X(28).<br />    01 ALTPCB<br />    05 ALTPCB-DEST           PIC   X(08).<br />    05 FILLER                PIC   X(02). <br />    05 ALTPCB-STATUS         PIC   X(02).<br />    05 FILLER                PIC   X(10).<br />    01 IOPCB. <br /><br />    PROCEDURE DIVISION.<br />    ENTRY &#39;DLITCBL&#39; USING IOPCB, ALTPCB.<br /><br />(2) CALL &#39;CBLTDLI&#39; USING GU, IOPCB, CLIENT-RESPONSE.<br />    IF IOPCB-STATUS NOT = SPACES <br />    GO TO 9999-RETURN. <br /><br />(4) IF CRR-ERROR-CODE EQUAL 0 AND<br /><br />(5) CRR-REASON-CODE EQUAL 0 <br />    THEN MOVE &#39;PASSED&#39; TO MO-DATA  <br />    ELSE MOVE &#39;FAILED&#39; TO MO-DATA.  <br />    MOVE CRR-TRANCODE TO MO-TRANCODE. <br />    MOVE 84 TO MO-LL.  <br /><br />    CALL &#39;CBLTDLI&#39; USING CHNG, ALTPCB, CRR-ORIGIN-TERMINAL. <br />    IF ALTPCB-STATUS NOT = SPACES <br />    GO TO 9999-RETURN.<br /><br />(8) CALL &#39;CBLTDLI&#39; USING ISRT, ALTPCB, MSG-OUT. <br />    IF ALTPCB-STATUS NOT = SPACES<br />    GO TO 9999-RETURN.<br /><br />    CALL &#39;CBLTDLI&#39; USING PURG, ALTPCB.  <br />    IF ALTPCB-STATUS NOT = SPACES<br />    GO TO 9999-RETURN.<br /><br />    9999-RETURN.<br /><br />    GOBACK.</pre></div><h4 class="pHeading3"><a name="wp1006745"> </a>
Notes
</h4>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1006749"> </a>Although not used in the previous example, the format of the TMA TCP for IMS client request/response message header is supplied by a COBOL copybook, <code class="cCode">CLIENT</code>. The equivalent C language header is provided by the <code class="cCode">BEATCPI.H</code> header file. Both are available in the TMA TCP for IMS <code class="cCode">INCLUDE</code> distribution library.</li>
<li><a name="wp1006753"> </a>A <code class="cCode">GU</code> (Get Unique) call is issued to retrieve the client response message from the IMS message queue.</li>
<li><a name="wp1006754"> </a><code class="cCode">CRR-RESPONSE-FORMAT</code> indicates the response format: single segment or multiple-segment, as specified in the original request. If multi-segment response format is specified, the response message consists of three segments: response header, context data, and response data.</li>
<li><a name="wp1006755"> </a><code class="cCode">CRR-ERROR-CODE</code> indicates whether or not an error occurred. If this field is zero, it indicates that the request was successfully processed. Otherwise, an error occurred and the error code identifies the type of error. The error code should always be checked before processing a response.</li>
<li><a name="wp1006756"> </a><code class="cCode">CRR-REASON-CODE</code> may provide additional information when an error is indicated. A value of zero indicates that no additional information is available.</li>
<li><a name="wp1006757"> </a>Context data, if present, is preserved from the original request message. Typically, the context data is used by the response transaction to correlate the response with the original request.</li>
<li><a name="wp1006758"> </a><code class="cCode">CRR-RESPONSE-DATA-LEN</code> contains the length of any response data returned. However, if a truncation error occurred, this field contains the actual (pretruncated) length of the response data. The amount of response data returned is truncated to the length specified by <code class="cCode">CRR-MAX-RESPONSE-LEN.</code></li>
<li><a name="wp1006759"> </a>A response indicating success or failure (based on the error and reason codes) is written to the original (requesting) terminal, using the <code class="cCode">LTERM</code> preserved in <code class="cCode">CRR-ORIGIN-TERMINAL</code>. Note that a modifiable, alternate <code class="cCode">PCB</code> must be used for this purpose.</li>
</ol></div>
<h3 class="pHeading2"><a name="wp1006762"> </a>
BEACRR01 - A Sample IMS Client Request/Response Transaction
</h3>
<p class="pBody"><a name="wp1006763"> </a>
If desired, the functionality of the IMS client request and response transactions can be combined into a single application transaction. However, logic must be added to perform the appropriate (request or response) processing based upon the dynamic execution context. 
</p>
<div class="pCodeTitle"><a name="wp1006767"> </a>
Listing&#160;E-4	   Sample IMS Request/Response Transaction
</div> <a name="wp1006768"> </a><div class="pPreformatted"><pre>CBL APOST <br />   IDENTIFICATION DIVISION.<br />   PROGRAM-ID. BEACRR01. <br />   ENVIRONMENT DIVISION. <br />   CONFIGURATION SECTION. <br />   SOURCE-COMPUTER. IBM-370. <br />   OBJECT-COMPUTER. IBM-370. <br />   DATA DIVISION.  <br />   WORKING-STORAGE SECTION. <br /><br />   77 GU          PIC X(04) VALUE &#39;GU &#39;.<br />   77 CHNG        PIC X(04) VALUE &#39;CHNG&#39;.<br />   77 ISRT        PIC X(04) VALUE &#39;ISRT&#39;.<br />   77 PURG        PIC X(04) VALUE &#39;PURG&#39;.<br /><br />01 MSG-IN. <br />   05 MI-LL       PIC S9(04) COMP VALUE +0. <br />   05 MI-ZZ       PIC S9(04) COMP VALUE +0.<br />   05 MI-TRANCODE PIC X(08) VALUE SPACES. <br />   05 FILLER      PIC X(01) VALUE SPACES.<br />   05 MI-AREA. <br />      10 MI-DATA  PIC X(91) VALUE SPACES. <br /> 01 MSG-OUT. <br />   05 MO-LL       PIC S9(04) COMP VALUE +0.<br />   05 MO-ZZ       PIC S9(04) COMP VALUE +0.<br />   05 MO-TRANCODE PIC X(08) VALUE SPACES. <br />   05 FILLER      PIC X(01) VALUE SPACES.<br />   05 MO-AREA. <br />      10 MO-DATA  PIC X(91) VALUE SPACES.<br /><br />(1) 01 CLIENT-REQUEST-RESPONSE.<br />    05 CRR-LL               PIC 9(04) COMP VALUE 0.<br />    05 CRR-ZZ               PIC 9(04) COMP VALUE 0. <br />    05 CRR-TRANCODE         PIC X(08) VALUE SPACES.<br />    05 FILLER               PIC X(01) VALUE SPACES.<br />    05 BEA-RESERVED-1       PIC X(03) VALUE LOW-VALUES.<br />    05 CRR-HEADER-LEN       PIC 9(08) COMP. <br />    05 CRR-CONTEXT-DATA-LEN PIC 9(08) COMP. <br />    05 CRR-REQUEST-DATA-LEN PIC 9(08) COMP. <br />    05 CRR-MAX-RESPONSE-LEN PIC 9(08) COMP. <br />    05 CRR-REQUEST-TYPE     PIC 9(08) COMP. <br />    05 CRR-RESPONSE-FORMAT  PIC 9(08) COMP.<br />    05 CRR-ERROR-CODE       PIC 9(08) COMP. <br />    05 CRR-REASON-CODE      PIC 9(08) COMP. <br />    05 CRR-SERVICE-NAME     PIC X(16) VALUE LOW-VALUES.<br />    05 CRR-RESPONSE-TRAN    PIC X(08) VALUE LOW-VALUES. <br />    05 CRR-ORIGIN-TERMINAL  PIC X(08) VALUE LOW-VALUES. <br />    05 BEA-RESERVED-2       PIC X(16) VALUE LOW-VALUES.<br />    05 CRR-CONTEXT-AREA.<br />       10 CRR-CONTEXT-DATA  PIC X(31) VALUE SPACES. <br />    05 CRR-REQUEST-AREA. <br />       10 CRR-REQUEST-DATA  PIC X(100) VALUE SPACES.<br /><br />    LINKAGE SECTION. <br />01  IOPCB. <br />    05 LTERM                PIC   X(08).<br />    05 FILLER               PIC   X(02). <br />    05 IOPCB-STATUS         PIC   X(02). <br />    05 FILLER               PIC   X(28). <br />01  01 ALTPCB.<br />    05 ALTPCB-DEST          PIC   X(08). <br />    05 FILLER               PIC   X(02).<br />    05 ALTPCB-STATUS        PIC   X(02).<br />    05 FILLER               PIC   X(10). <br /><br />    PROCEDURE DIVISION.<br />    ENTRY &#39;DLITCBL&#39; USING IOPCB, ALTPCB.<br />(3) IF LTERM = SPACES OR LOW-VALUES<br />    THEN PERFORM RESPONSE-MESSAGE THRU RESPONSE-MESSAGE-EXIT <br />    ELSE PERFORM REQUEST-MESSAGE THRU REQUEST-MESSAGE-EXIT. <br /><br />    9999-RETURN.<br />         GOBACK.<br /><br />    REQUEST-MESSAGE. <br />    CALL &#39;CBLTDLI&#39; USING GU, IOPCB, MSG-IN. <br />    IF IOPCB-STATUS NOT = SPACES <br />    GO TO REQUEST-MESSAGE-EXIT. <br /><br />    MOVE &#39;BEATCPI&#39; TO CRR-TRANCODE.<br />    MOVE 96 TO CRR-HEADER-LEN. <br />    MOVE 1 TO CRR-REQUEST-TYPE. <br />    MOVE 0 TO CRR-RESPONSE-FORMAT. <br />    MOVE LTERM TO CRR-ORIGIN-TERMINAL. <br />    MOVE &#39;TOUPPER&#39; TO CRR-SERVICE-NAME.  <br />    MOVE MI-TRANCODE TO CRR-RESPONSE-TRAN. <br />    MOVE ALL &#39;A&#39; TO CRR-REQUEST-DATA.<br />    MOVE LENGTH OF CRR-REQUEST-AREA TO CRR-REQUEST-DATA-LEN.<br />    MOVE CRR-REQUEST-DATA-LEN TO CRR-MAX-RESPONSE-LEN.<br />    MOVE ALL &#39;B&#39; TO CRR-CONTEXT-DATA.<br />    MOVE LENGTH OF CRR-CONTEXT-AREA TO CRR-CONTEXT-DATA-LEN. <br />    COMPUTE CRR-LL = CRR-REQUEST-DATA-LEN + <br />                     CRR-CONTEXT-DATA-LEN +  <br />                     CRR-HEADER-LEN.<br /><br />    CALL &#39;CBLTDLI&#39; USING CHNG, ALTPCB, CRR-TRANCODE.<br />    IF ALTPCB-STATUS NOT = SPACES<br />    GO TO REQUEST-MESSAGE-EXIT.<br /><br />    CALL &#39;CBLTDLI&#39; USING ISRT, ALTPCB,CLIENT-REQUEST-RESPONSE.<br />    IF ALTPCB-STATUS NOT = SPACES<br />    GO TO REQUEST-MESSAGE-EXIT.<br /><br />    CALL &#39;CBLTDLI&#39; USING PURG, ALTPCB.<br />    IF ALTPCB-STATUS NOT = SPACES<br />    GO TO REQUEST-MESSAGE-EXIT.<br /><br />    REQUEST-MESSAGE-EXIT.<br />    EXIT.<br /><br />    RESPONSE-MESSAGE.<br /><br />    CALL &#39;CBLTDLI&#39; USING GU, IOPCB, CLIENT-REQUEST-RESPONSE. <br />    IF IOPCB-STATUS NOT = SPACES <br />    GO TO RESPONSE-MESSAGE-EXIT.  <br />    IF CRR-ERROR-CODE EQUAL 0 AND  <br />    CRR-REASON-CODE EQUAL 0<br />    THEN MOVE &#39;PASSED&#39; TO MO-DATA <br />    ELSE MOVE &#39;FAILED&#39; TO MO-DATA.<br />    MOVE CRR-TRANCODE TO MO-TRANCODE.<br />    MOVE 84 TO MO-LL.<br /><br />    CALL &#39;CBLTDLI&#39; USING CHNG, ALTPCB, CRR-ORIGIN-TERMINAL.<br />    IF ALTPCB-STATUS NOT = SPACES<br />    GO TO RESPONSE-MESSAGE-EXIT.<br /><br />    CALL &#39;CBLTDLI&#39; USING ISRT, ALTPCB, MSG-OUT.<br />    IF ALTPCB-STATUS NOT = SPACES <br />    GO TO RESPONSE-MESSAGE-EXIT.<br /><br />    CALL &#39;CBLTDLI&#39; USING PURG, ALTPCB.<br />    IF ALTPCB-STATUS NOT = SPACES<br />    GO TO RESPONSE-MESSAGE-EXIT.<br /><br />    RESPONSE-MESSAGE-EXIT.<br />    EXIT.</pre></div><h4 class="pHeading3"><a name="wp1006770"> </a>
Notes
</h4>
<div class="pSmartList1"><ol type="1" class="pSmartList1">
<li><a name="wp1006774"> </a>Although not used in the previous example, the format of the TMA TCP for IMS client request/response message header is supplied by a COBOL copybook, <code class="cCode">CLIENT</code>. The equivalent C language header is provided by the <code class="cCode">BEATCPI.H</code> header file. Both are available in the TMA TCP for IMS <code class="cCode">INCLUDE</code> distribution library.</li>
<li><a name="wp1006786"> </a>The actual request processing is otherwise identical to that performed by <code class="cCode">BEACRQ01</code>.</li>
<li><a name="wp1006787"> </a>The actual response processing is otherwise identical to that performed by <code class="cCode">BEACRP01</code>.</li>
</ol></div>
 
<br/>
    <table id="SummaryNotReq2" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
&nbsp;
<a href="imsaptax.html"><img id="LongDescNotReq8" src="/global_resources/images/backtop.gif" width="90" height="25" alt="Back to Top" title="Back to Top" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a accesskey="4" href="imsapjcl.html"><img id="LongDescNotReq9" src="/global_resources/images/prevtop.gif" border="0" alt="Previous" /></a>&nbsp;
<a accesskey="5" href="imsaprsn.html"><img id="LongDescNotReq10" src="/global_resources/images/nexttop.gif" border="0" alt="Next" /></a>
<script language="Javascript1.1" type="text/javascript">
Copyright();
</script>
<noscript><a href="http://edocs.bea.com/copyright.html">&copy; BEA Systems</a></noscript>
        </td>
      </tr>
    </table>

<!-- WebAnalytics BEGIN -->

<!--#include virtual="/global_resources/edocs_wt.html"-->
      
<!-- WebAnalytics END -->

  </body>
</html>
